function GM(r,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const o in i)if(o!=="default"&&!(o in r)){const l=Object.getOwnPropertyDescriptor(i,o);l&&Object.defineProperty(r,o,l.get?l:{enumerable:!0,get:()=>i[o]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();var cd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fm(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function HM(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var o=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:function(){return r[i]}})}),t}var Ry={exports:{}},Tv={},Iy={exports:{}},Wn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xw;function WM(){if(Xw)return Wn;Xw=1;var r=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),f=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),_=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),w=Symbol.iterator;function C(ie){return ie===null||typeof ie!="object"?null:(ie=w&&ie[w]||ie["@@iterator"],typeof ie=="function"?ie:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},z=Object.assign,O={};function P(ie,we,ze){this.props=ie,this.context=we,this.refs=O,this.updater=ze||R}P.prototype.isReactComponent={},P.prototype.setState=function(ie,we){if(typeof ie!="object"&&typeof ie!="function"&&ie!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ie,we,"setState")},P.prototype.forceUpdate=function(ie){this.updater.enqueueForceUpdate(this,ie,"forceUpdate")};function M(){}M.prototype=P.prototype;function U(ie,we,ze){this.props=ie,this.context=we,this.refs=O,this.updater=ze||R}var L=U.prototype=new M;L.constructor=U,z(L,P.prototype),L.isPureReactComponent=!0;var B=Array.isArray,$=Object.prototype.hasOwnProperty,X={current:null},Q={key:!0,ref:!0,__self:!0,__source:!0};function te(ie,we,ze){var se,fe={},Le=null,Be=null;if(we!=null)for(se in we.ref!==void 0&&(Be=we.ref),we.key!==void 0&&(Le=""+we.key),we)$.call(we,se)&&!Q.hasOwnProperty(se)&&(fe[se]=we[se]);var He=arguments.length-2;if(He===1)fe.children=ze;else if(1<He){for(var et=Array(He),pt=0;pt<He;pt++)et[pt]=arguments[pt+2];fe.children=et}if(ie&&ie.defaultProps)for(se in He=ie.defaultProps,He)fe[se]===void 0&&(fe[se]=He[se]);return{$$typeof:r,type:ie,key:Le,ref:Be,props:fe,_owner:X.current}}function V(ie,we){return{$$typeof:r,type:ie.type,key:we,ref:ie.ref,props:ie.props,_owner:ie._owner}}function H(ie){return typeof ie=="object"&&ie!==null&&ie.$$typeof===r}function J(ie){var we={"=":"=0",":":"=2"};return"$"+ie.replace(/[=:]/g,function(ze){return we[ze]})}var ce=/\/+/g;function he(ie,we){return typeof ie=="object"&&ie!==null&&ie.key!=null?J(""+ie.key):we.toString(36)}function ge(ie,we,ze,se,fe){var Le=typeof ie;(Le==="undefined"||Le==="boolean")&&(ie=null);var Be=!1;if(ie===null)Be=!0;else switch(Le){case"string":case"number":Be=!0;break;case"object":switch(ie.$$typeof){case r:case e:Be=!0}}if(Be)return Be=ie,fe=fe(Be),ie=se===""?"."+he(Be,0):se,B(fe)?(ze="",ie!=null&&(ze=ie.replace(ce,"$&/")+"/"),ge(fe,we,ze,"",function(pt){return pt})):fe!=null&&(H(fe)&&(fe=V(fe,ze+(!fe.key||Be&&Be.key===fe.key?"":(""+fe.key).replace(ce,"$&/")+"/")+ie)),we.push(fe)),1;if(Be=0,se=se===""?".":se+":",B(ie))for(var He=0;He<ie.length;He++){Le=ie[He];var et=se+he(Le,He);Be+=ge(Le,we,ze,et,fe)}else if(et=C(ie),typeof et=="function")for(ie=et.call(ie),He=0;!(Le=ie.next()).done;)Le=Le.value,et=se+he(Le,He++),Be+=ge(Le,we,ze,et,fe);else if(Le==="object")throw we=String(ie),Error("Objects are not valid as a React child (found: "+(we==="[object Object]"?"object with keys {"+Object.keys(ie).join(", ")+"}":we)+"). If you meant to render a collection of children, use an array instead.");return Be}function Ae(ie,we,ze){if(ie==null)return ie;var se=[],fe=0;return ge(ie,se,"","",function(Le){return we.call(ze,Le,fe++)}),se}function me(ie){if(ie._status===-1){var we=ie._result;we=we(),we.then(function(ze){(ie._status===0||ie._status===-1)&&(ie._status=1,ie._result=ze)},function(ze){(ie._status===0||ie._status===-1)&&(ie._status=2,ie._result=ze)}),ie._status===-1&&(ie._status=0,ie._result=we)}if(ie._status===1)return ie._result.default;throw ie._result}var Ie={current:null},ae={transition:null},ye={ReactCurrentDispatcher:Ie,ReactCurrentBatchConfig:ae,ReactCurrentOwner:X};function de(){throw Error("act(...) is not supported in production builds of React.")}return Wn.Children={map:Ae,forEach:function(ie,we,ze){Ae(ie,function(){we.apply(this,arguments)},ze)},count:function(ie){var we=0;return Ae(ie,function(){we++}),we},toArray:function(ie){return Ae(ie,function(we){return we})||[]},only:function(ie){if(!H(ie))throw Error("React.Children.only expected to receive a single React element child.");return ie}},Wn.Component=P,Wn.Fragment=t,Wn.Profiler=o,Wn.PureComponent=U,Wn.StrictMode=i,Wn.Suspense=v,Wn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ye,Wn.act=de,Wn.cloneElement=function(ie,we,ze){if(ie==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ie+".");var se=z({},ie.props),fe=ie.key,Le=ie.ref,Be=ie._owner;if(we!=null){if(we.ref!==void 0&&(Le=we.ref,Be=X.current),we.key!==void 0&&(fe=""+we.key),ie.type&&ie.type.defaultProps)var He=ie.type.defaultProps;for(et in we)$.call(we,et)&&!Q.hasOwnProperty(et)&&(se[et]=we[et]===void 0&&He!==void 0?He[et]:we[et])}var et=arguments.length-2;if(et===1)se.children=ze;else if(1<et){He=Array(et);for(var pt=0;pt<et;pt++)He[pt]=arguments[pt+2];se.children=He}return{$$typeof:r,type:ie.type,key:fe,ref:Le,props:se,_owner:Be}},Wn.createContext=function(ie){return ie={$$typeof:f,_currentValue:ie,_currentValue2:ie,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ie.Provider={$$typeof:l,_context:ie},ie.Consumer=ie},Wn.createElement=te,Wn.createFactory=function(ie){var we=te.bind(null,ie);return we.type=ie,we},Wn.createRef=function(){return{current:null}},Wn.forwardRef=function(ie){return{$$typeof:d,render:ie}},Wn.isValidElement=H,Wn.lazy=function(ie){return{$$typeof:b,_payload:{_status:-1,_result:ie},_init:me}},Wn.memo=function(ie,we){return{$$typeof:_,type:ie,compare:we===void 0?null:we}},Wn.startTransition=function(ie){var we=ae.transition;ae.transition={};try{ie()}finally{ae.transition=we}},Wn.unstable_act=de,Wn.useCallback=function(ie,we){return Ie.current.useCallback(ie,we)},Wn.useContext=function(ie){return Ie.current.useContext(ie)},Wn.useDebugValue=function(){},Wn.useDeferredValue=function(ie){return Ie.current.useDeferredValue(ie)},Wn.useEffect=function(ie,we){return Ie.current.useEffect(ie,we)},Wn.useId=function(){return Ie.current.useId()},Wn.useImperativeHandle=function(ie,we,ze){return Ie.current.useImperativeHandle(ie,we,ze)},Wn.useInsertionEffect=function(ie,we){return Ie.current.useInsertionEffect(ie,we)},Wn.useLayoutEffect=function(ie,we){return Ie.current.useLayoutEffect(ie,we)},Wn.useMemo=function(ie,we){return Ie.current.useMemo(ie,we)},Wn.useReducer=function(ie,we,ze){return Ie.current.useReducer(ie,we,ze)},Wn.useRef=function(ie){return Ie.current.useRef(ie)},Wn.useState=function(ie){return Ie.current.useState(ie)},Wn.useSyncExternalStore=function(ie,we,ze){return Ie.current.useSyncExternalStore(ie,we,ze)},Wn.useTransition=function(){return Ie.current.useTransition()},Wn.version="18.3.1",Wn}var qw;function hw(){return qw||(qw=1,Iy.exports=WM()),Iy.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $w;function jM(){if($w)return Tv;$w=1;var r=hw(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function f(d,v,_){var b,w={},C=null,R=null;_!==void 0&&(C=""+_),v.key!==void 0&&(C=""+v.key),v.ref!==void 0&&(R=v.ref);for(b in v)i.call(v,b)&&!l.hasOwnProperty(b)&&(w[b]=v[b]);if(d&&d.defaultProps)for(b in v=d.defaultProps,v)w[b]===void 0&&(w[b]=v[b]);return{$$typeof:e,type:d,key:C,ref:R,props:w,_owner:o.current}}return Tv.Fragment=t,Tv.jsx=f,Tv.jsxs=f,Tv}var Yw;function XM(){return Yw||(Yw=1,Ry.exports=jM()),Ry.exports}var qe=XM(),Tg={},Dy={exports:{}},xl={},Ly={exports:{}},ky={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kw;function qM(){return Kw||(Kw=1,function(r){function e(ae,ye){var de=ae.length;ae.push(ye);e:for(;0<de;){var ie=de-1>>>1,we=ae[ie];if(0<o(we,ye))ae[ie]=ye,ae[de]=we,de=ie;else break e}}function t(ae){return ae.length===0?null:ae[0]}function i(ae){if(ae.length===0)return null;var ye=ae[0],de=ae.pop();if(de!==ye){ae[0]=de;e:for(var ie=0,we=ae.length,ze=we>>>1;ie<ze;){var se=2*(ie+1)-1,fe=ae[se],Le=se+1,Be=ae[Le];if(0>o(fe,de))Le<we&&0>o(Be,fe)?(ae[ie]=Be,ae[Le]=de,ie=Le):(ae[ie]=fe,ae[se]=de,ie=se);else if(Le<we&&0>o(Be,de))ae[ie]=Be,ae[Le]=de,ie=Le;else break e}}return ye}function o(ae,ye){var de=ae.sortIndex-ye.sortIndex;return de!==0?de:ae.id-ye.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;r.unstable_now=function(){return l.now()}}else{var f=Date,d=f.now();r.unstable_now=function(){return f.now()-d}}var v=[],_=[],b=1,w=null,C=3,R=!1,z=!1,O=!1,P=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function L(ae){for(var ye=t(_);ye!==null;){if(ye.callback===null)i(_);else if(ye.startTime<=ae)i(_),ye.sortIndex=ye.expirationTime,e(v,ye);else break;ye=t(_)}}function B(ae){if(O=!1,L(ae),!z)if(t(v)!==null)z=!0,me($);else{var ye=t(_);ye!==null&&Ie(B,ye.startTime-ae)}}function $(ae,ye){z=!1,O&&(O=!1,M(te),te=-1),R=!0;var de=C;try{for(L(ye),w=t(v);w!==null&&(!(w.expirationTime>ye)||ae&&!J());){var ie=w.callback;if(typeof ie=="function"){w.callback=null,C=w.priorityLevel;var we=ie(w.expirationTime<=ye);ye=r.unstable_now(),typeof we=="function"?w.callback=we:w===t(v)&&i(v),L(ye)}else i(v);w=t(v)}if(w!==null)var ze=!0;else{var se=t(_);se!==null&&Ie(B,se.startTime-ye),ze=!1}return ze}finally{w=null,C=de,R=!1}}var X=!1,Q=null,te=-1,V=5,H=-1;function J(){return!(r.unstable_now()-H<V)}function ce(){if(Q!==null){var ae=r.unstable_now();H=ae;var ye=!0;try{ye=Q(!0,ae)}finally{ye?he():(X=!1,Q=null)}}else X=!1}var he;if(typeof U=="function")he=function(){U(ce)};else if(typeof MessageChannel<"u"){var ge=new MessageChannel,Ae=ge.port2;ge.port1.onmessage=ce,he=function(){Ae.postMessage(null)}}else he=function(){P(ce,0)};function me(ae){Q=ae,X||(X=!0,he())}function Ie(ae,ye){te=P(function(){ae(r.unstable_now())},ye)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(ae){ae.callback=null},r.unstable_continueExecution=function(){z||R||(z=!0,me($))},r.unstable_forceFrameRate=function(ae){0>ae||125<ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):V=0<ae?Math.floor(1e3/ae):5},r.unstable_getCurrentPriorityLevel=function(){return C},r.unstable_getFirstCallbackNode=function(){return t(v)},r.unstable_next=function(ae){switch(C){case 1:case 2:case 3:var ye=3;break;default:ye=C}var de=C;C=ye;try{return ae()}finally{C=de}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(ae,ye){switch(ae){case 1:case 2:case 3:case 4:case 5:break;default:ae=3}var de=C;C=ae;try{return ye()}finally{C=de}},r.unstable_scheduleCallback=function(ae,ye,de){var ie=r.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?ie+de:ie):de=ie,ae){case 1:var we=-1;break;case 2:we=250;break;case 5:we=1073741823;break;case 4:we=1e4;break;default:we=5e3}return we=de+we,ae={id:b++,callback:ye,priorityLevel:ae,startTime:de,expirationTime:we,sortIndex:-1},de>ie?(ae.sortIndex=de,e(_,ae),t(v)===null&&ae===t(_)&&(O?(M(te),te=-1):O=!0,Ie(B,de-ie))):(ae.sortIndex=we,e(v,ae),z||R||(z=!0,me($))),ae},r.unstable_shouldYield=J,r.unstable_wrapCallback=function(ae){var ye=C;return function(){var de=C;C=ye;try{return ae.apply(this,arguments)}finally{C=de}}}}(ky)),ky}var Zw;function $M(){return Zw||(Zw=1,Ly.exports=qM()),Ly.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jw;function YM(){if(Jw)return xl;Jw=1;var r=hw(),e=$M();function t(a){for(var u="https://reactjs.org/docs/error-decoder.html?invariant="+a,p=1;p<arguments.length;p++)u+="&args[]="+encodeURIComponent(arguments[p]);return"Minified React error #"+a+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,o={};function l(a,u){f(a,u),f(a+"Capture",u)}function f(a,u){for(o[a]=u,a=0;a<u.length;a++)i.add(u[a])}var d=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,b={},w={};function C(a){return v.call(w,a)?!0:v.call(b,a)?!1:_.test(a)?w[a]=!0:(b[a]=!0,!1)}function R(a,u,p,x){if(p!==null&&p.type===0)return!1;switch(typeof u){case"function":case"symbol":return!0;case"boolean":return x?!1:p!==null?!p.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function z(a,u,p,x){if(u===null||typeof u>"u"||R(a,u,p,x))return!0;if(x)return!1;if(p!==null)switch(p.type){case 3:return!u;case 4:return u===!1;case 5:return isNaN(u);case 6:return isNaN(u)||1>u}return!1}function O(a,u,p,x,A,N,ee){this.acceptsBooleans=u===2||u===3||u===4,this.attributeName=x,this.attributeNamespace=A,this.mustUseProperty=p,this.propertyName=a,this.type=u,this.sanitizeURL=N,this.removeEmptyString=ee}var P={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){P[a]=new O(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var u=a[0];P[u]=new O(u,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){P[a]=new O(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){P[a]=new O(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){P[a]=new O(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){P[a]=new O(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){P[a]=new O(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){P[a]=new O(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){P[a]=new O(a,5,!1,a.toLowerCase(),null,!1,!1)});var M=/[\-:]([a-z])/g;function U(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var u=a.replace(M,U);P[u]=new O(u,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var u=a.replace(M,U);P[u]=new O(u,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var u=a.replace(M,U);P[u]=new O(u,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){P[a]=new O(a,1,!1,a.toLowerCase(),null,!1,!1)}),P.xlinkHref=new O("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){P[a]=new O(a,1,!1,a.toLowerCase(),null,!0,!0)});function L(a,u,p,x){var A=P.hasOwnProperty(u)?P[u]:null;(A!==null?A.type!==0:x||!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(z(u,p,A,x)&&(p=null),x||A===null?C(u)&&(p===null?a.removeAttribute(u):a.setAttribute(u,""+p)):A.mustUseProperty?a[A.propertyName]=p===null?A.type===3?!1:"":p:(u=A.attributeName,x=A.attributeNamespace,p===null?a.removeAttribute(u):(A=A.type,p=A===3||A===4&&p===!0?"":""+p,x?a.setAttributeNS(x,u,p):a.setAttribute(u,p))))}var B=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$=Symbol.for("react.element"),X=Symbol.for("react.portal"),Q=Symbol.for("react.fragment"),te=Symbol.for("react.strict_mode"),V=Symbol.for("react.profiler"),H=Symbol.for("react.provider"),J=Symbol.for("react.context"),ce=Symbol.for("react.forward_ref"),he=Symbol.for("react.suspense"),ge=Symbol.for("react.suspense_list"),Ae=Symbol.for("react.memo"),me=Symbol.for("react.lazy"),Ie=Symbol.for("react.offscreen"),ae=Symbol.iterator;function ye(a){return a===null||typeof a!="object"?null:(a=ae&&a[ae]||a["@@iterator"],typeof a=="function"?a:null)}var de=Object.assign,ie;function we(a){if(ie===void 0)try{throw Error()}catch(p){var u=p.stack.trim().match(/\n( *(at )?)/);ie=u&&u[1]||""}return`
`+ie+a}var ze=!1;function se(a,u){if(!a||ze)return"";ze=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(u)if(u=function(){throw Error()},Object.defineProperty(u.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(u,[])}catch(Ge){var x=Ge}Reflect.construct(a,[],u)}else{try{u.call()}catch(Ge){x=Ge}a.call(u.prototype)}else{try{throw Error()}catch(Ge){x=Ge}a()}}catch(Ge){if(Ge&&x&&typeof Ge.stack=="string"){for(var A=Ge.stack.split(`
`),N=x.stack.split(`
`),ee=A.length-1,pe=N.length-1;1<=ee&&0<=pe&&A[ee]!==N[pe];)pe--;for(;1<=ee&&0<=pe;ee--,pe--)if(A[ee]!==N[pe]){if(ee!==1||pe!==1)do if(ee--,pe--,0>pe||A[ee]!==N[pe]){var Ce=`
`+A[ee].replace(" at new "," at ");return a.displayName&&Ce.includes("<anonymous>")&&(Ce=Ce.replace("<anonymous>",a.displayName)),Ce}while(1<=ee&&0<=pe);break}}}finally{ze=!1,Error.prepareStackTrace=p}return(a=a?a.displayName||a.name:"")?we(a):""}function fe(a){switch(a.tag){case 5:return we(a.type);case 16:return we("Lazy");case 13:return we("Suspense");case 19:return we("SuspenseList");case 0:case 2:case 15:return a=se(a.type,!1),a;case 11:return a=se(a.type.render,!1),a;case 1:return a=se(a.type,!0),a;default:return""}}function Le(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case Q:return"Fragment";case X:return"Portal";case V:return"Profiler";case te:return"StrictMode";case he:return"Suspense";case ge:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case J:return(a.displayName||"Context")+".Consumer";case H:return(a._context.displayName||"Context")+".Provider";case ce:var u=a.render;return a=a.displayName,a||(a=u.displayName||u.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Ae:return u=a.displayName||null,u!==null?u:Le(a.type)||"Memo";case me:u=a._payload,a=a._init;try{return Le(a(u))}catch{}}return null}function Be(a){var u=a.type;switch(a.tag){case 24:return"Cache";case 9:return(u.displayName||"Context")+".Consumer";case 10:return(u._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=u.render,a=a.displayName||a.name||"",u.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return u;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Le(u);case 8:return u===te?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u}return null}function He(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function et(a){var u=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function pt(a){var u=et(a)?"checked":"value",p=Object.getOwnPropertyDescriptor(a.constructor.prototype,u),x=""+a[u];if(!a.hasOwnProperty(u)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var A=p.get,N=p.set;return Object.defineProperty(a,u,{configurable:!0,get:function(){return A.call(this)},set:function(ee){x=""+ee,N.call(this,ee)}}),Object.defineProperty(a,u,{enumerable:p.enumerable}),{getValue:function(){return x},setValue:function(ee){x=""+ee},stopTracking:function(){a._valueTracker=null,delete a[u]}}}}function Wt(a){a._valueTracker||(a._valueTracker=pt(a))}function zt(a){if(!a)return!1;var u=a._valueTracker;if(!u)return!0;var p=u.getValue(),x="";return a&&(x=et(a)?a.checked?"true":"false":a.value),a=x,a!==p?(u.setValue(a),!0):!1}function bn(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function _e(a,u){var p=u.checked;return de({},u,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:p??a._wrapperState.initialChecked})}function Ln(a,u){var p=u.defaultValue==null?"":u.defaultValue,x=u.checked!=null?u.checked:u.defaultChecked;p=He(u.value!=null?u.value:p),a._wrapperState={initialChecked:x,initialValue:p,controlled:u.type==="checkbox"||u.type==="radio"?u.checked!=null:u.value!=null}}function on(a,u){u=u.checked,u!=null&&L(a,"checked",u,!1)}function Nt(a,u){on(a,u);var p=He(u.value),x=u.type;if(p!=null)x==="number"?(p===0&&a.value===""||a.value!=p)&&(a.value=""+p):a.value!==""+p&&(a.value=""+p);else if(x==="submit"||x==="reset"){a.removeAttribute("value");return}u.hasOwnProperty("value")?Mn(a,u.type,p):u.hasOwnProperty("defaultValue")&&Mn(a,u.type,He(u.defaultValue)),u.checked==null&&u.defaultChecked!=null&&(a.defaultChecked=!!u.defaultChecked)}function Vt(a,u,p){if(u.hasOwnProperty("value")||u.hasOwnProperty("defaultValue")){var x=u.type;if(!(x!=="submit"&&x!=="reset"||u.value!==void 0&&u.value!==null))return;u=""+a._wrapperState.initialValue,p||u===a.value||(a.value=u),a.defaultValue=u}p=a.name,p!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,p!==""&&(a.name=p)}function Mn(a,u,p){(u!=="number"||bn(a.ownerDocument)!==a)&&(p==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+p&&(a.defaultValue=""+p))}var Dt=Array.isArray;function le(a,u,p,x){if(a=a.options,u){u={};for(var A=0;A<p.length;A++)u["$"+p[A]]=!0;for(p=0;p<a.length;p++)A=u.hasOwnProperty("$"+a[p].value),a[p].selected!==A&&(a[p].selected=A),A&&x&&(a[p].defaultSelected=!0)}else{for(p=""+He(p),u=null,A=0;A<a.length;A++){if(a[A].value===p){a[A].selected=!0,x&&(a[A].defaultSelected=!0);return}u!==null||a[A].disabled||(u=a[A])}u!==null&&(u.selected=!0)}}function ne(a,u){if(u.dangerouslySetInnerHTML!=null)throw Error(t(91));return de({},u,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Oe(a,u){var p=u.value;if(p==null){if(p=u.children,u=u.defaultValue,p!=null){if(u!=null)throw Error(t(92));if(Dt(p)){if(1<p.length)throw Error(t(93));p=p[0]}u=p}u==null&&(u=""),p=u}a._wrapperState={initialValue:He(p)}}function Ze(a,u){var p=He(u.value),x=He(u.defaultValue);p!=null&&(p=""+p,p!==a.value&&(a.value=p),u.defaultValue==null&&a.defaultValue!==p&&(a.defaultValue=p)),x!=null&&(a.defaultValue=""+x)}function Je(a){var u=a.textContent;u===a._wrapperState.initialValue&&u!==""&&u!==null&&(a.value=u)}function Ye(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pt(a,u){return a==null||a==="http://www.w3.org/1999/xhtml"?Ye(u):a==="http://www.w3.org/2000/svg"&&u==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var ht,_t=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(u,p,x,A){MSApp.execUnsafeLocalFunction(function(){return a(u,p,x,A)})}:a}(function(a,u){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=u;else{for(ht=ht||document.createElement("div"),ht.innerHTML="<svg>"+u.valueOf().toString()+"</svg>",u=ht.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;u.firstChild;)a.appendChild(u.firstChild)}});function fn(a,u){if(u){var p=a.firstChild;if(p&&p===a.lastChild&&p.nodeType===3){p.nodeValue=u;return}}a.textContent=u}var it={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},St=["Webkit","ms","Moz","O"];Object.keys(it).forEach(function(a){St.forEach(function(u){u=u+a.charAt(0).toUpperCase()+a.substring(1),it[u]=it[a]})});function jt(a,u,p){return u==null||typeof u=="boolean"||u===""?"":p||typeof u!="number"||u===0||it.hasOwnProperty(a)&&it[a]?(""+u).trim():u+"px"}function tn(a,u){a=a.style;for(var p in u)if(u.hasOwnProperty(p)){var x=p.indexOf("--")===0,A=jt(p,u[p],x);p==="float"&&(p="cssFloat"),x?a.setProperty(p,A):a[p]=A}}var xt=de({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pn(a,u){if(u){if(xt[a]&&(u.children!=null||u.dangerouslySetInnerHTML!=null))throw Error(t(137,a));if(u.dangerouslySetInnerHTML!=null){if(u.children!=null)throw Error(t(60));if(typeof u.dangerouslySetInnerHTML!="object"||!("__html"in u.dangerouslySetInnerHTML))throw Error(t(61))}if(u.style!=null&&typeof u.style!="object")throw Error(t(62))}}function nn(a,u){if(a.indexOf("-")===-1)return typeof u.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vn=null;function Re(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var gt=null,je=null,Ke=null;function Mt(a){if(a=mi(a)){if(typeof gt!="function")throw Error(t(280));var u=a.stateNode;u&&(u=Qc(u),gt(a.stateNode,a.type,u))}}function Et(a){je?Ke?Ke.push(a):Ke=[a]:je=a}function mn(){if(je){var a=je,u=Ke;if(Ke=je=null,Mt(a),u)for(a=0;a<u.length;a++)Mt(u[a])}}function Bn(a,u){return a(u)}function Ti(){}var vn=!1;function yr(a,u,p){if(vn)return a(u,p);vn=!0;try{return Bn(a,u,p)}finally{vn=!1,(je!==null||Ke!==null)&&(Ti(),mn())}}function _i(a,u){var p=a.stateNode;if(p===null)return null;var x=Qc(p);if(x===null)return null;p=x[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(a=a.type,x=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!x;break e;default:a=!1}if(a)return null;if(p&&typeof p!="function")throw Error(t(231,u,typeof p));return p}var Ds=!1;if(d)try{var hs={};Object.defineProperty(hs,"passive",{get:function(){Ds=!0}}),window.addEventListener("test",hs,hs),window.removeEventListener("test",hs,hs)}catch{Ds=!1}function zr(a,u,p,x,A,N,ee,pe,Ce){var Ge=Array.prototype.slice.call(arguments,3);try{u.apply(p,Ge)}catch(nt){this.onError(nt)}}var fs=!1,mo=null,vo=!1,Ho=null,du={onError:function(a){fs=!0,mo=a}};function tl(a,u,p,x,A,N,ee,pe,Ce){fs=!1,mo=null,zr.apply(du,arguments)}function pu(a,u,p,x,A,N,ee,pe,Ce){if(tl.apply(this,arguments),fs){if(fs){var Ge=mo;fs=!1,mo=null}else throw Error(t(198));vo||(vo=!0,Ho=Ge)}}function ds(a){var u=a,p=a;if(a.alternate)for(;u.return;)u=u.return;else{a=u;do u=a,u.flags&4098&&(p=u.return),a=u.return;while(a)}return u.tag===3?p:null}function nl(a){if(a.tag===13){var u=a.memoizedState;if(u===null&&(a=a.alternate,a!==null&&(u=a.memoizedState)),u!==null)return u.dehydrated}return null}function mu(a){if(ds(a)!==a)throw Error(t(188))}function xa(a){var u=a.alternate;if(!u){if(u=ds(a),u===null)throw Error(t(188));return u!==a?null:a}for(var p=a,x=u;;){var A=p.return;if(A===null)break;var N=A.alternate;if(N===null){if(x=A.return,x!==null){p=x;continue}break}if(A.child===N.child){for(N=A.child;N;){if(N===p)return mu(A),a;if(N===x)return mu(A),u;N=N.sibling}throw Error(t(188))}if(p.return!==x.return)p=A,x=N;else{for(var ee=!1,pe=A.child;pe;){if(pe===p){ee=!0,p=A,x=N;break}if(pe===x){ee=!0,x=A,p=N;break}pe=pe.sibling}if(!ee){for(pe=N.child;pe;){if(pe===p){ee=!0,p=N,x=A;break}if(pe===x){ee=!0,x=N,p=A;break}pe=pe.sibling}if(!ee)throw Error(t(189))}}if(p.alternate!==x)throw Error(t(190))}if(p.tag!==3)throw Error(t(188));return p.stateNode.current===p?a:u}function Rl(a){return a=xa(a),a!==null?vu(a):null}function vu(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var u=vu(a);if(u!==null)return u;a=a.sibling}return null}var oe=e.unstable_scheduleCallback,De=e.unstable_cancelCallback,Ue=e.unstable_shouldYield,Ve=e.unstable_requestPaint,Te=e.unstable_now,ot=e.unstable_getCurrentPriorityLevel,dt=e.unstable_ImmediatePriority,Rt=e.unstable_UserBlockingPriority,ft=e.unstable_NormalPriority,un=e.unstable_LowPriority,rn=e.unstable_IdlePriority,Yt=null,gn=null;function kn(a){if(gn&&typeof gn.onCommitFiberRoot=="function")try{gn.onCommitFiberRoot(Yt,a,void 0,(a.current.flags&128)===128)}catch{}}var Fn=Math.clz32?Math.clz32:Xt,ui=Math.log,xn=Math.LN2;function Xt(a){return a>>>=0,a===0?32:31-(ui(a)/xn|0)|0}var Gn=64,Cn=4194304;function Zi(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function sr(a,u){var p=a.pendingLanes;if(p===0)return 0;var x=0,A=a.suspendedLanes,N=a.pingedLanes,ee=p&268435455;if(ee!==0){var pe=ee&~A;pe!==0?x=Zi(pe):(N&=ee,N!==0&&(x=Zi(N)))}else ee=p&~A,ee!==0?x=Zi(ee):N!==0&&(x=Zi(N));if(x===0)return 0;if(u!==0&&u!==x&&!(u&A)&&(A=x&-x,N=u&-u,A>=N||A===16&&(N&4194240)!==0))return u;if(x&4&&(x|=p&16),u=a.entangledLanes,u!==0)for(a=a.entanglements,u&=x;0<u;)p=31-Fn(u),A=1<<p,x|=a[p],u&=~A;return x}function Ji(a,u){switch(a){case 1:case 2:case 4:return u+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ks(a,u){for(var p=a.suspendedLanes,x=a.pingedLanes,A=a.expirationTimes,N=a.pendingLanes;0<N;){var ee=31-Fn(N),pe=1<<ee,Ce=A[ee];Ce===-1?(!(pe&p)||pe&x)&&(A[ee]=Ji(pe,u)):Ce<=u&&(a.expiredLanes|=pe),N&=~pe}}function cn(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function or(){var a=Gn;return Gn<<=1,!(Gn&4194240)&&(Gn=64),a}function fi(a){for(var u=[],p=0;31>p;p++)u.push(a);return u}function Nn(a,u,p){a.pendingLanes|=u,u!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,u=31-Fn(u),a[u]=p}function ar(a,u){var p=a.pendingLanes&~u;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=u,a.mutableReadLanes&=u,a.entangledLanes&=u,u=a.entanglements;var x=a.eventTimes;for(a=a.expirationTimes;0<p;){var A=31-Fn(p),N=1<<A;u[A]=0,x[A]=-1,a[A]=-1,p&=~N}}function Tr(a,u){var p=a.entangledLanes|=u;for(a=a.entanglements;p;){var x=31-Fn(p),A=1<<x;A&u|a[x]&u&&(a[x]|=u),p&=~A}}var an=0;function fr(a){return a&=-a,1<a?4<a?a&268435455?16:536870912:4:1}var Wo,wa,Il,go,Dl,_o=!1,Sa=[],jo=null,yo=null,bo=null,Ea=new Map,Xo=new Map,qo=[],Hc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ju(a,u){switch(a){case"focusin":case"focusout":jo=null;break;case"dragenter":case"dragleave":yo=null;break;case"mouseover":case"mouseout":bo=null;break;case"pointerover":case"pointerout":Ea.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xo.delete(u.pointerId)}}function xo(a,u,p,x,A,N){return a===null||a.nativeEvent!==N?(a={blockedOn:u,domEventName:p,eventSystemFlags:x,nativeEvent:N,targetContainers:[A]},u!==null&&(u=mi(u),u!==null&&wa(u)),a):(a.eventSystemFlags|=x,u=a.targetContainers,A!==null&&u.indexOf(A)===-1&&u.push(A),a)}function Th(a,u,p,x,A){switch(u){case"focusin":return jo=xo(jo,a,u,p,x,A),!0;case"dragenter":return yo=xo(yo,a,u,p,x,A),!0;case"mouseover":return bo=xo(bo,a,u,p,x,A),!0;case"pointerover":var N=A.pointerId;return Ea.set(N,xo(Ea.get(N)||null,a,u,p,x,A)),!0;case"gotpointercapture":return N=A.pointerId,Xo.set(N,xo(Xo.get(N)||null,a,u,p,x,A)),!0}return!1}function Wc(a){var u=ws(a.target);if(u!==null){var p=ds(u);if(p!==null){if(u=p.tag,u===13){if(u=nl(p),u!==null){a.blockedOn=u,Dl(a.priority,function(){Il(p)});return}}else if(u===3&&p.stateNode.current.memoizedState.isDehydrated){a.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Ll(a){if(a.blockedOn!==null)return!1;for(var u=a.targetContainers;0<u.length;){var p=Fl(a.domEventName,a.eventSystemFlags,u[0],a.nativeEvent);if(p===null){p=a.nativeEvent;var x=new p.constructor(p.type,p);Vn=x,p.target.dispatchEvent(x),Vn=null}else return u=mi(p),u!==null&&wa(u),a.blockedOn=p,!1;u.shift()}return!0}function jc(a,u,p){Ll(a)&&p.delete(u)}function Qu(){_o=!1,jo!==null&&Ll(jo)&&(jo=null),yo!==null&&Ll(yo)&&(yo=null),bo!==null&&Ll(bo)&&(bo=null),Ea.forEach(jc),Xo.forEach(jc)}function $t(a,u){a.blockedOn===u&&(a.blockedOn=null,_o||(_o=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Qu)))}function Qt(a){function u(A){return $t(A,a)}if(0<Sa.length){$t(Sa[0],a);for(var p=1;p<Sa.length;p++){var x=Sa[p];x.blockedOn===a&&(x.blockedOn=null)}}for(jo!==null&&$t(jo,a),yo!==null&&$t(yo,a),bo!==null&&$t(bo,a),Ea.forEach(u),Xo.forEach(u),p=0;p<qo.length;p++)x=qo[p],x.blockedOn===a&&(x.blockedOn=null);for(;0<qo.length&&(p=qo[0],p.blockedOn===null);)Wc(p),p.blockedOn===null&&qo.shift()}var Zs=B.ReactCurrentBatchConfig,gu=!0;function Js(a,u,p,x){var A=an,N=Zs.transition;Zs.transition=null;try{an=1,ec(a,u,p,x)}finally{an=A,Zs.transition=N}}function Xc(a,u,p,x){var A=an,N=Zs.transition;Zs.transition=null;try{an=4,ec(a,u,p,x)}finally{an=A,Zs.transition=N}}function ec(a,u,p,x){if(gu){var A=Fl(a,u,p,x);if(A===null)Zc(a,u,x,kl,p),Ju(a,x);else if(Th(A,a,u,p,x))x.stopPropagation();else if(Ju(a,x),u&4&&-1<Hc.indexOf(a)){for(;A!==null;){var N=mi(A);if(N!==null&&Wo(N),N=Fl(a,u,p,x),N===null&&Zc(a,u,x,kl,p),N===A)break;A=N}A!==null&&x.stopPropagation()}else Zc(a,u,x,null,p)}}var kl=null;function Fl(a,u,p,x){if(kl=null,a=Re(x),a=ws(a),a!==null)if(u=ds(a),u===null)a=null;else if(p=u.tag,p===13){if(a=nl(u),a!==null)return a;a=null}else if(p===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;a=null}else u!==a&&(a=null);return kl=a,null}function tc(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ot()){case dt:return 1;case Rt:return 4;case ft:case un:return 16;case rn:return 536870912;default:return 16}default:return 16}}var yn=null,Ca=null,dr=null;function Mr(){if(dr)return dr;var a,u=Ca,p=u.length,x,A="value"in yn?yn.value:yn.textContent,N=A.length;for(a=0;a<p&&u[a]===A[a];a++);var ee=p-a;for(x=1;x<=ee&&u[p-x]===A[N-x];x++);return dr=A.slice(a,1<x?1-x:void 0)}function $o(a){var u=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&u===13&&(a=13)):a=u,a===10&&(a=13),32<=a||a===13?a:0}function ci(){return!0}function il(){return!1}function Ar(a){function u(p,x,A,N,ee){this._reactName=p,this._targetInst=A,this.type=x,this.nativeEvent=N,this.target=ee,this.currentTarget=null;for(var pe in a)a.hasOwnProperty(pe)&&(p=a[pe],this[pe]=p?p(N):N[pe]);return this.isDefaultPrevented=(N.defaultPrevented!=null?N.defaultPrevented:N.returnValue===!1)?ci:il,this.isPropagationStopped=il,this}return de(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=ci)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=ci)},persist:function(){},isPersistent:ci}),u}var Pr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ta=Ar(Pr),Ma=de({},Pr,{view:0,detail:0}),Ol=Ar(Ma),si,wo,Qn,Aa=de({},Ma,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zl,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Qn&&(Qn&&a.type==="mousemove"?(si=a.screenX-Qn.screenX,wo=a.screenY-Qn.screenY):wo=si=0,Qn=a),si)},movementY:function(a){return"movementY"in a?a.movementY:wo}}),Nl=Ar(Aa),yi=de({},Aa,{dataTransfer:0}),Rr=Ar(yi),Ul=de({},Ma,{relatedTarget:0}),Ft=Ar(Ul),br=de({},Pr,{animationName:0,elapsedTime:0,pseudoElement:0}),So=Ar(br),nc=de({},Pr,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),ps=Ar(nc),rl=de({},Pr,{data:0}),pr=Ar(rl),Bl={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ms={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Yo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vr(a){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(a):(a=Yo[a])?!!u[a]:!1}function zl(){return Vr}var Eo=de({},Ma,{key:function(a){if(a.key){var u=Bl[a.key]||a.key;if(u!=="Unidentified")return u}return a.type==="keypress"?(a=$o(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?ms[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zl,charCode:function(a){return a.type==="keypress"?$o(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?$o(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),oi=Ar(Eo),Pa=de({},Aa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),di=Ar(Pa),Ko=de({},Ma,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zl}),rs=Ar(Ko),Ra=de({},Pr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Co=Ar(Ra),ic=de({},Aa,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Ir=Ar(ic),ai=[9,13,27,32],Ls=d&&"CompositionEvent"in window,Dr=null;d&&"documentMode"in document&&(Dr=document.documentMode);var sl=d&&"TextEvent"in window&&!Dr,Gr=d&&(!Ls||Dr&&8<Dr&&11>=Dr),ol=" ",_u=!1;function Qs(a,u){switch(a){case"keyup":return ai.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rc(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Zo=!1;function ks(a,u){switch(a){case"compositionend":return rc(u);case"keypress":return u.which!==32?null:(_u=!0,ol);case"textInput":return a=u.data,a===ol&&_u?null:a;default:return null}}function yu(a,u){if(Zo)return a==="compositionend"||!Ls&&Qs(a,u)?(a=Mr(),dr=Ca=yn=null,Zo=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return Gr&&u.locale!=="ko"?null:u.data;default:return null}}var Ia={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vs(a){var u=a&&a.nodeName&&a.nodeName.toLowerCase();return u==="input"?!!Ia[a.type]:u==="textarea"}function Jo(a,u,p,x){Et(x),u=uc(u,"onChange"),0<u.length&&(p=new Ta("onChange","change",null,p,x),a.push({event:p,listeners:u}))}var Mi=null,gs=null;function qc(a){gf(a,0)}function Da(a){var u=wt(a);if(zt(u))return a}function La(a,u){if(a==="change")return u}var Hr=!1;if(d){var Ai;if(d){var Vl="oninput"in document;if(!Vl){var $c=document.createElement("div");$c.setAttribute("oninput","return;"),Vl=typeof $c.oninput=="function"}Ai=Vl}else Ai=!1;Hr=Ai&&(!document.documentMode||9<document.documentMode)}function sc(){Mi&&(Mi.detachEvent("onpropertychange",G),gs=Mi=null)}function G(a){if(a.propertyName==="value"&&Da(gs)){var u=[];Jo(u,gs,a,Re(a)),yr(qc,u)}}function S(a,u,p){a==="focusin"?(sc(),Mi=u,gs=p,Mi.attachEvent("onpropertychange",G)):a==="focusout"&&sc()}function D(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Da(gs)}function j(a,u){if(a==="click")return Da(u)}function k(a,u){if(a==="input"||a==="change")return Da(u)}function Y(a,u){return a===u&&(a!==0||1/a===1/u)||a!==a&&u!==u}var K=typeof Object.is=="function"?Object.is:Y;function Se(a,u){if(K(a,u))return!0;if(typeof a!="object"||a===null||typeof u!="object"||u===null)return!1;var p=Object.keys(a),x=Object.keys(u);if(p.length!==x.length)return!1;for(x=0;x<p.length;x++){var A=p[x];if(!v.call(u,A)||!K(a[A],u[A]))return!1}return!0}function Xe(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Ct(a,u){var p=Xe(a);a=0;for(var x;p;){if(p.nodeType===3){if(x=a+p.textContent.length,a<=u&&x>=u)return{node:p,offset:u-a};a=x}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=Xe(p)}}function hn(a,u){return a&&u?a===u?!0:a&&a.nodeType===3?!1:u&&u.nodeType===3?hn(a,u.parentNode):"contains"in a?a.contains(u):a.compareDocumentPosition?!!(a.compareDocumentPosition(u)&16):!1:!1}function ut(){for(var a=window,u=bn();u instanceof a.HTMLIFrameElement;){try{var p=typeof u.contentWindow.location.href=="string"}catch{p=!1}if(p)a=u.contentWindow;else break;u=bn(a.document)}return u}function Wr(a){var u=a&&a.nodeName&&a.nodeName.toLowerCase();return u&&(u==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||u==="textarea"||a.contentEditable==="true")}function Mh(a){var u=ut(),p=a.focusedElem,x=a.selectionRange;if(u!==p&&p&&p.ownerDocument&&hn(p.ownerDocument.documentElement,p)){if(x!==null&&Wr(p)){if(u=x.start,a=x.end,a===void 0&&(a=u),"selectionStart"in p)p.selectionStart=u,p.selectionEnd=Math.min(a,p.value.length);else if(a=(u=p.ownerDocument||document)&&u.defaultView||window,a.getSelection){a=a.getSelection();var A=p.textContent.length,N=Math.min(x.start,A);x=x.end===void 0?N:Math.min(x.end,A),!a.extend&&N>x&&(A=x,x=N,N=A),A=Ct(p,N);var ee=Ct(p,x);A&&ee&&(a.rangeCount!==1||a.anchorNode!==A.node||a.anchorOffset!==A.offset||a.focusNode!==ee.node||a.focusOffset!==ee.offset)&&(u=u.createRange(),u.setStart(A.node,A.offset),a.removeAllRanges(),N>x?(a.addRange(u),a.extend(ee.node,ee.offset)):(u.setEnd(ee.node,ee.offset),a.addRange(u)))}}for(u=[],a=p;a=a.parentNode;)a.nodeType===1&&u.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof p.focus=="function"&&p.focus(),p=0;p<u.length;p++)a=u[p],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Ui=d&&"documentMode"in document&&11>=document.documentMode,_s=null,ka=null,Qi=null,Fa=!1;function mr(a,u,p){var x=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;Fa||_s==null||_s!==bn(x)||(x=_s,"selectionStart"in x&&Wr(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),Qi&&Se(Qi,x)||(Qi=x,x=uc(ka,"onSelect"),0<x.length&&(u=new Ta("onSelect","select",null,u,p),a.push({event:u,listeners:x}),u.target=_s)))}function Kt(a,u){var p={};return p[a.toLowerCase()]=u.toLowerCase(),p["Webkit"+a]="webkit"+u,p["Moz"+a]="moz"+u,p}var Gl={animationend:Kt("Animation","AnimationEnd"),animationiteration:Kt("Animation","AnimationIteration"),animationstart:Kt("Animation","AnimationStart"),transitionend:Kt("Transition","TransitionEnd")},bu={},Oa={};d&&(Oa=document.createElement("div").style,"AnimationEvent"in window||(delete Gl.animationend.animation,delete Gl.animationiteration.animation,delete Gl.animationstart.animation),"TransitionEvent"in window||delete Gl.transitionend.transition);function oc(a){if(bu[a])return bu[a];if(!Gl[a])return a;var u=Gl[a],p;for(p in u)if(u.hasOwnProperty(p)&&p in Oa)return bu[a]=u[p];return a}var Ah=oc("animationend"),Ph=oc("animationiteration"),Na=oc("animationstart"),Lr=oc("transitionend"),Ua=new Map,ac="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ys(a,u){Ua.set(a,u),l(u,[a])}for(var xu=0;xu<ac.length;xu++){var lc=ac[xu],al=lc.toLowerCase(),Yc=lc[0].toUpperCase()+lc.slice(1);ys(al,"on"+Yc)}ys(Ah,"onAnimationEnd"),ys(Ph,"onAnimationIteration"),ys(Na,"onAnimationStart"),ys("dblclick","onDoubleClick"),ys("focusin","onFocus"),ys("focusout","onBlur"),ys(Lr,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xs=new Set("cancel close invalid load scroll toggle".split(" ").concat(bs));function ll(a,u,p){var x=a.type||"unknown-event";a.currentTarget=p,pu(x,u,void 0,a),a.currentTarget=null}function gf(a,u){u=(u&4)!==0;for(var p=0;p<a.length;p++){var x=a[p],A=x.event;x=x.listeners;e:{var N=void 0;if(u)for(var ee=x.length-1;0<=ee;ee--){var pe=x[ee],Ce=pe.instance,Ge=pe.currentTarget;if(pe=pe.listener,Ce!==N&&A.isPropagationStopped())break e;ll(A,pe,Ge),N=Ce}else for(ee=0;ee<x.length;ee++){if(pe=x[ee],Ce=pe.instance,Ge=pe.currentTarget,pe=pe.listener,Ce!==N&&A.isPropagationStopped())break e;ll(A,pe,Ge),N=Ce}}}if(vo)throw a=Ho,vo=!1,Ho=null,a}function pi(a,u){var p=u[cc];p===void 0&&(p=u[cc]=new Set);var x=a+"__bubble";p.has(x)||(Hl(u,a,2,!1),p.add(x))}function Kc(a,u,p){var x=0;u&&(x|=4),Hl(p,a,x,u)}var Qo="_reactListening"+Math.random().toString(36).slice(2);function Fs(a){if(!a[Qo]){a[Qo]=!0,i.forEach(function(p){p!=="selectionchange"&&(xs.has(p)||Kc(p,!1,a),Kc(p,!0,a))});var u=a.nodeType===9?a:a.ownerDocument;u===null||u[Qo]||(u[Qo]=!0,Kc("selectionchange",!1,u))}}function Hl(a,u,p,x){switch(tc(u)){case 1:var A=Js;break;case 4:A=Xc;break;default:A=ec}p=A.bind(null,u,p,a),A=void 0,!Ds||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(A=!0),x?A!==void 0?a.addEventListener(u,p,{capture:!0,passive:A}):a.addEventListener(u,p,!0):A!==void 0?a.addEventListener(u,p,{passive:A}):a.addEventListener(u,p,!1)}function Zc(a,u,p,x,A){var N=x;if(!(u&1)&&!(u&2)&&x!==null)e:for(;;){if(x===null)return;var ee=x.tag;if(ee===3||ee===4){var pe=x.stateNode.containerInfo;if(pe===A||pe.nodeType===8&&pe.parentNode===A)break;if(ee===4)for(ee=x.return;ee!==null;){var Ce=ee.tag;if((Ce===3||Ce===4)&&(Ce=ee.stateNode.containerInfo,Ce===A||Ce.nodeType===8&&Ce.parentNode===A))return;ee=ee.return}for(;pe!==null;){if(ee=ws(pe),ee===null)return;if(Ce=ee.tag,Ce===5||Ce===6){x=N=ee;continue e}pe=pe.parentNode}}x=x.return}yr(function(){var Ge=N,nt=Re(p),st=[];e:{var tt=Ua.get(a);if(tt!==void 0){var It=Ta,Gt=a;switch(a){case"keypress":if($o(p)===0)break e;case"keydown":case"keyup":It=oi;break;case"focusin":Gt="focus",It=Ft;break;case"focusout":Gt="blur",It=Ft;break;case"beforeblur":case"afterblur":It=Ft;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":It=Nl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":It=Rr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":It=rs;break;case Ah:case Ph:case Na:It=So;break;case Lr:It=Co;break;case"scroll":It=Ol;break;case"wheel":It=Ir;break;case"copy":case"cut":case"paste":It=ps;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":It=di}var qt=(u&4)!==0,gr=!qt&&a==="scroll",Fe=qt?tt!==null?tt+"Capture":null:tt;qt=[];for(var Pe=Ge,Ne;Pe!==null;){Ne=Pe;var ct=Ne.stateNode;if(Ne.tag===5&&ct!==null&&(Ne=ct,Fe!==null&&(ct=_i(Pe,Fe),ct!=null&&qt.push(Ba(Pe,ct,Ne)))),gr)break;Pe=Pe.return}0<qt.length&&(tt=new It(tt,Gt,null,p,nt),st.push({event:tt,listeners:qt}))}}if(!(u&7)){e:{if(tt=a==="mouseover"||a==="pointerover",It=a==="mouseout"||a==="pointerout",tt&&p!==Vn&&(Gt=p.relatedTarget||p.fromElement)&&(ws(Gt)||Gt[vr]))break e;if((It||tt)&&(tt=nt.window===nt?nt:(tt=nt.ownerDocument)?tt.defaultView||tt.parentWindow:window,It?(Gt=p.relatedTarget||p.toElement,It=Ge,Gt=Gt?ws(Gt):null,Gt!==null&&(gr=ds(Gt),Gt!==gr||Gt.tag!==5&&Gt.tag!==6)&&(Gt=null)):(It=null,Gt=Ge),It!==Gt)){if(qt=Nl,ct="onMouseLeave",Fe="onMouseEnter",Pe="mouse",(a==="pointerout"||a==="pointerover")&&(qt=di,ct="onPointerLeave",Fe="onPointerEnter",Pe="pointer"),gr=It==null?tt:wt(It),Ne=Gt==null?tt:wt(Gt),tt=new qt(ct,Pe+"leave",It,p,nt),tt.target=gr,tt.relatedTarget=Ne,ct=null,ws(nt)===Ge&&(qt=new qt(Fe,Pe+"enter",Gt,p,nt),qt.target=Ne,qt.relatedTarget=gr,ct=qt),gr=ct,It&&Gt)t:{for(qt=It,Fe=Gt,Pe=0,Ne=qt;Ne;Ne=wu(Ne))Pe++;for(Ne=0,ct=Fe;ct;ct=wu(ct))Ne++;for(;0<Pe-Ne;)qt=wu(qt),Pe--;for(;0<Ne-Pe;)Fe=wu(Fe),Ne--;for(;Pe--;){if(qt===Fe||Fe!==null&&qt===Fe.alternate)break t;qt=wu(qt),Fe=wu(Fe)}qt=null}else qt=null;It!==null&&wn(st,tt,It,qt,!1),Gt!==null&&gr!==null&&wn(st,gr,Gt,qt,!0)}}e:{if(tt=Ge?wt(Ge):window,It=tt.nodeName&&tt.nodeName.toLowerCase(),It==="select"||It==="input"&&tt.type==="file")var Jt=La;else if(vs(tt))if(Hr)Jt=k;else{Jt=D;var dn=S}else(It=tt.nodeName)&&It.toLowerCase()==="input"&&(tt.type==="checkbox"||tt.type==="radio")&&(Jt=j);if(Jt&&(Jt=Jt(a,Ge))){Jo(st,Jt,p,nt);break e}dn&&dn(a,tt,Ge),a==="focusout"&&(dn=tt._wrapperState)&&dn.controlled&&tt.type==="number"&&Mn(tt,"number",tt.value)}switch(dn=Ge?wt(Ge):window,a){case"focusin":(vs(dn)||dn.contentEditable==="true")&&(_s=dn,ka=Ge,Qi=null);break;case"focusout":Qi=ka=_s=null;break;case"mousedown":Fa=!0;break;case"contextmenu":case"mouseup":case"dragend":Fa=!1,mr(st,p,nt);break;case"selectionchange":if(Ui)break;case"keydown":case"keyup":mr(st,p,nt)}var sn;if(Ls)e:{switch(a){case"compositionstart":var _n="onCompositionStart";break e;case"compositionend":_n="onCompositionEnd";break e;case"compositionupdate":_n="onCompositionUpdate";break e}_n=void 0}else Zo?Qs(a,p)&&(_n="onCompositionEnd"):a==="keydown"&&p.keyCode===229&&(_n="onCompositionStart");_n&&(Gr&&p.locale!=="ko"&&(Zo||_n!=="onCompositionStart"?_n==="onCompositionEnd"&&Zo&&(sn=Mr()):(yn=nt,Ca="value"in yn?yn.value:yn.textContent,Zo=!0)),dn=uc(Ge,_n),0<dn.length&&(_n=new pr(_n,a,null,p,nt),st.push({event:_n,listeners:dn}),sn?_n.data=sn:(sn=rc(p),sn!==null&&(_n.data=sn)))),(sn=sl?ks(a,p):yu(a,p))&&(Ge=uc(Ge,"onBeforeInput"),0<Ge.length&&(nt=new pr("onBeforeInput","beforeinput",null,p,nt),st.push({event:nt,listeners:Ge}),nt.data=sn))}gf(st,u)})}function Ba(a,u,p){return{instance:a,listener:u,currentTarget:p}}function uc(a,u){for(var p=u+"Capture",x=[];a!==null;){var A=a,N=A.stateNode;A.tag===5&&N!==null&&(A=N,N=_i(a,p),N!=null&&x.unshift(Ba(a,N,A)),N=_i(a,u),N!=null&&x.push(Ba(a,N,A))),a=a.return}return x}function wu(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function wn(a,u,p,x,A){for(var N=u._reactName,ee=[];p!==null&&p!==x;){var pe=p,Ce=pe.alternate,Ge=pe.stateNode;if(Ce!==null&&Ce===x)break;pe.tag===5&&Ge!==null&&(pe=Ge,A?(Ce=_i(p,N),Ce!=null&&ee.unshift(Ba(p,Ce,pe))):A||(Ce=_i(p,N),Ce!=null&&ee.push(Ba(p,Ce,pe)))),p=p.return}ee.length!==0&&a.push({event:u,listeners:ee})}var $n=/\r\n?/g,md=/\u0000|\uFFFD/g;function _f(a){return(typeof a=="string"?a:""+a).replace($n,`
`).replace(md,"")}function Wl(a,u,p){if(u=_f(u),_f(a)!==u&&p)throw Error(t(425))}function Jc(){}var ul=null,To=null;function jl(a,u){return a==="textarea"||a==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var ss=typeof setTimeout=="function"?setTimeout:void 0,Os=typeof clearTimeout=="function"?clearTimeout:void 0,ea=typeof Promise=="function"?Promise:void 0,Xl=typeof queueMicrotask=="function"?queueMicrotask:typeof ea<"u"?function(a){return ea.resolve(null).then(a).catch(jr)}:ss;function jr(a){setTimeout(function(){throw a})}function Rh(a,u){var p=u,x=0;do{var A=p.nextSibling;if(a.removeChild(p),A&&A.nodeType===8)if(p=A.data,p==="/$"){if(x===0){a.removeChild(A),Qt(u);return}x--}else p!=="$"&&p!=="$?"&&p!=="$!"||x++;p=A}while(p);Qt(u)}function cl(a){for(;a!=null;a=a.nextSibling){var u=a.nodeType;if(u===1||u===3)break;if(u===8){if(u=a.data,u==="$"||u==="$!"||u==="$?")break;if(u==="/$")return null}}return a}function yf(a){a=a.previousSibling;for(var u=0;a;){if(a.nodeType===8){var p=a.data;if(p==="$"||p==="$!"||p==="$?"){if(u===0)return a;u--}else p==="/$"&&u++}a=a.previousSibling}return null}var Su=Math.random().toString(36).slice(2),eo="__reactFiber$"+Su,Mo="__reactProps$"+Su,vr="__reactContainer$"+Su,cc="__reactEvents$"+Su,I="__reactListeners$"+Su,Ns="__reactHandles$"+Su;function ws(a){var u=a[eo];if(u)return u;for(var p=a.parentNode;p;){if(u=p[vr]||p[eo]){if(p=u.alternate,u.child!==null||p!==null&&p.child!==null)for(a=yf(a);a!==null;){if(p=a[eo])return p;a=yf(a)}return u}a=p,p=a.parentNode}return null}function mi(a){return a=a[eo]||a[vr],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function wt(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(t(33))}function Qc(a){return a[Mo]||null}var hc=[],Eu=-1;function lr(a){return{current:a}}function vi(a){0>Eu||(a.current=hc[Eu],hc[Eu]=null,Eu--)}function bi(a,u){Eu++,hc[Eu]=a.current,a.current=u}var hl={},Xr=lr(hl),Ss=lr(!1),Bi=hl;function Cu(a,u){var p=a.type.contextTypes;if(!p)return hl;var x=a.stateNode;if(x&&x.__reactInternalMemoizedUnmaskedChildContext===u)return x.__reactInternalMemoizedMaskedChildContext;var A={},N;for(N in p)A[N]=u[N];return x&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=u,a.__reactInternalMemoizedMaskedChildContext=A),A}function Es(a){return a=a.childContextTypes,a!=null}function eh(){vi(Ss),vi(Xr)}function bf(a,u,p){if(Xr.current!==hl)throw Error(t(168));bi(Xr,u),bi(Ss,p)}function xf(a,u,p){var x=a.stateNode;if(u=u.childContextTypes,typeof x.getChildContext!="function")return p;x=x.getChildContext();for(var A in x)if(!(A in u))throw Error(t(108,Be(a)||"Unknown",A));return de({},p,x)}function ur(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||hl,Bi=Xr.current,bi(Xr,a),bi(Ss,Ss.current),!0}function wf(a,u,p){var x=a.stateNode;if(!x)throw Error(t(169));p?(a=xf(a,u,Bi),x.__reactInternalMemoizedMergedChildContext=a,vi(Ss),vi(Xr),bi(Xr,a)):vi(Ss),bi(Ss,p)}var Ao=null,th=!1,Ih=!1;function Sf(a){Ao===null?Ao=[a]:Ao.push(a)}function Us(a){th=!0,Sf(a)}function fl(){if(!Ih&&Ao!==null){Ih=!0;var a=0,u=an;try{var p=Ao;for(an=1;a<p.length;a++){var x=p[a];do x=x(!0);while(x!==null)}Ao=null,th=!1}catch(A){throw Ao!==null&&(Ao=Ao.slice(a+1)),oe(dt,fl),A}finally{an=u,Ih=!1}}return null}var Tu=[],xi=0,nh=null,Po=0,Bs=[],to=0,ql=null,zs=1,no="";function dl(a,u){Tu[xi++]=Po,Tu[xi++]=nh,nh=a,Po=u}function Ef(a,u,p){Bs[to++]=zs,Bs[to++]=no,Bs[to++]=ql,ql=a;var x=zs;a=no;var A=32-Fn(x)-1;x&=~(1<<A),p+=1;var N=32-Fn(u)+A;if(30<N){var ee=A-A%5;N=(x&(1<<ee)-1).toString(32),x>>=ee,A-=ee,zs=1<<32-Fn(u)+A|p<<A|x,no=N+a}else zs=1<<N|p<<A|x,no=a}function $l(a){a.return!==null&&(dl(a,1),Ef(a,1,0))}function Ro(a){for(;a===nh;)nh=Tu[--xi],Tu[xi]=null,Po=Tu[--xi],Tu[xi]=null;for(;a===ql;)ql=Bs[--to],Bs[to]=null,no=Bs[--to],Bs[to]=null,zs=Bs[--to],Bs[to]=null}var wi=null,Cs=null,Yn=!1,Io=null;function Pi(a,u){var p=ma(5,null,null,0);p.elementType="DELETED",p.stateNode=u,p.return=a,u=a.deletions,u===null?(a.deletions=[p],a.flags|=16):u.push(p)}function Mu(a,u){switch(a.tag){case 5:var p=a.type;return u=u.nodeType!==1||p.toLowerCase()!==u.nodeName.toLowerCase()?null:u,u!==null?(a.stateNode=u,wi=a,Cs=cl(u.firstChild),!0):!1;case 6:return u=a.pendingProps===""||u.nodeType!==3?null:u,u!==null?(a.stateNode=u,wi=a,Cs=null,!0):!1;case 13:return u=u.nodeType!==8?null:u,u!==null?(p=ql!==null?{id:zs,overflow:no}:null,a.memoizedState={dehydrated:u,treeContext:p,retryLane:1073741824},p=ma(18,null,null,0),p.stateNode=u,p.return=a,a.child=p,wi=a,Cs=null,!0):!1;default:return!1}}function qr(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Ri(a){if(Yn){var u=Cs;if(u){var p=u;if(!Mu(a,u)){if(qr(a))throw Error(t(418));u=cl(p.nextSibling);var x=wi;u&&Mu(a,u)?Pi(x,p):(a.flags=a.flags&-4097|2,Yn=!1,wi=a)}}else{if(qr(a))throw Error(t(418));a.flags=a.flags&-4097|2,Yn=!1,wi=a}}}function Cf(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;wi=a}function Do(a){if(a!==wi)return!1;if(!Yn)return Cf(a),Yn=!0,!1;var u;if((u=a.tag!==3)&&!(u=a.tag!==5)&&(u=a.type,u=u!=="head"&&u!=="body"&&!jl(a.type,a.memoizedProps)),u&&(u=Cs)){if(qr(a))throw fc(),Error(t(418));for(;u;)Pi(a,u),u=cl(u.nextSibling)}if(Cf(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(t(317));e:{for(a=a.nextSibling,u=0;a;){if(a.nodeType===8){var p=a.data;if(p==="/$"){if(u===0){Cs=cl(a.nextSibling);break e}u--}else p!=="$"&&p!=="$!"&&p!=="$?"||u++}a=a.nextSibling}Cs=null}}else Cs=wi?cl(a.stateNode.nextSibling):null;return!0}function fc(){for(var a=Cs;a;)a=cl(a.nextSibling)}function Ts(){Cs=wi=null,Yn=!1}function kr(a){Io===null?Io=[a]:Io.push(a)}var Dh=B.ReactCurrentBatchConfig;function Yl(a,u,p){if(a=p.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(p._owner){if(p=p._owner,p){if(p.tag!==1)throw Error(t(309));var x=p.stateNode}if(!x)throw Error(t(147,a));var A=x,N=""+a;return u!==null&&u.ref!==null&&typeof u.ref=="function"&&u.ref._stringRef===N?u.ref:(u=function(ee){var pe=A.refs;ee===null?delete pe[N]:pe[N]=ee},u._stringRef=N,u)}if(typeof a!="string")throw Error(t(284));if(!p._owner)throw Error(t(290,a))}return a}function ta(a,u){throw a=Object.prototype.toString.call(u),Error(t(31,a==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":a))}function Kl(a){var u=a._init;return u(a._payload)}function dc(a){function u(Fe,Pe){if(a){var Ne=Fe.deletions;Ne===null?(Fe.deletions=[Pe],Fe.flags|=16):Ne.push(Pe)}}function p(Fe,Pe){if(!a)return null;for(;Pe!==null;)u(Fe,Pe),Pe=Pe.sibling;return null}function x(Fe,Pe){for(Fe=new Map;Pe!==null;)Pe.key!==null?Fe.set(Pe.key,Pe):Fe.set(Pe.index,Pe),Pe=Pe.sibling;return Fe}function A(Fe,Pe){return Fe=co(Fe,Pe),Fe.index=0,Fe.sibling=null,Fe}function N(Fe,Pe,Ne){return Fe.index=Ne,a?(Ne=Fe.alternate,Ne!==null?(Ne=Ne.index,Ne<Pe?(Fe.flags|=2,Pe):Ne):(Fe.flags|=2,Pe)):(Fe.flags|=1048576,Pe)}function ee(Fe){return a&&Fe.alternate===null&&(Fe.flags|=2),Fe}function pe(Fe,Pe,Ne,ct){return Pe===null||Pe.tag!==6?(Pe=Fd(Ne,Fe.mode,ct),Pe.return=Fe,Pe):(Pe=A(Pe,Ne),Pe.return=Fe,Pe)}function Ce(Fe,Pe,Ne,ct){var Jt=Ne.type;return Jt===Q?nt(Fe,Pe,Ne.props.children,ct,Ne.key):Pe!==null&&(Pe.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===me&&Kl(Jt)===Pe.type)?(ct=A(Pe,Ne.props),ct.ref=Yl(Fe,Pe,Ne),ct.return=Fe,ct):(ct=Kf(Ne.type,Ne.key,Ne.props,null,Fe.mode,ct),ct.ref=Yl(Fe,Pe,Ne),ct.return=Fe,ct)}function Ge(Fe,Pe,Ne,ct){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==Ne.containerInfo||Pe.stateNode.implementation!==Ne.implementation?(Pe=Od(Ne,Fe.mode,ct),Pe.return=Fe,Pe):(Pe=A(Pe,Ne.children||[]),Pe.return=Fe,Pe)}function nt(Fe,Pe,Ne,ct,Jt){return Pe===null||Pe.tag!==7?(Pe=Dc(Ne,Fe.mode,ct,Jt),Pe.return=Fe,Pe):(Pe=A(Pe,Ne),Pe.return=Fe,Pe)}function st(Fe,Pe,Ne){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return Pe=Fd(""+Pe,Fe.mode,Ne),Pe.return=Fe,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case $:return Ne=Kf(Pe.type,Pe.key,Pe.props,null,Fe.mode,Ne),Ne.ref=Yl(Fe,null,Pe),Ne.return=Fe,Ne;case X:return Pe=Od(Pe,Fe.mode,Ne),Pe.return=Fe,Pe;case me:var ct=Pe._init;return st(Fe,ct(Pe._payload),Ne)}if(Dt(Pe)||ye(Pe))return Pe=Dc(Pe,Fe.mode,Ne,null),Pe.return=Fe,Pe;ta(Fe,Pe)}return null}function tt(Fe,Pe,Ne,ct){var Jt=Pe!==null?Pe.key:null;if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return Jt!==null?null:pe(Fe,Pe,""+Ne,ct);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case $:return Ne.key===Jt?Ce(Fe,Pe,Ne,ct):null;case X:return Ne.key===Jt?Ge(Fe,Pe,Ne,ct):null;case me:return Jt=Ne._init,tt(Fe,Pe,Jt(Ne._payload),ct)}if(Dt(Ne)||ye(Ne))return Jt!==null?null:nt(Fe,Pe,Ne,ct,null);ta(Fe,Ne)}return null}function It(Fe,Pe,Ne,ct,Jt){if(typeof ct=="string"&&ct!==""||typeof ct=="number")return Fe=Fe.get(Ne)||null,pe(Pe,Fe,""+ct,Jt);if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case $:return Fe=Fe.get(ct.key===null?Ne:ct.key)||null,Ce(Pe,Fe,ct,Jt);case X:return Fe=Fe.get(ct.key===null?Ne:ct.key)||null,Ge(Pe,Fe,ct,Jt);case me:var dn=ct._init;return It(Fe,Pe,Ne,dn(ct._payload),Jt)}if(Dt(ct)||ye(ct))return Fe=Fe.get(Ne)||null,nt(Pe,Fe,ct,Jt,null);ta(Pe,ct)}return null}function Gt(Fe,Pe,Ne,ct){for(var Jt=null,dn=null,sn=Pe,_n=Pe=0,es=null;sn!==null&&_n<Ne.length;_n++){sn.index>_n?(es=sn,sn=null):es=sn.sibling;var ni=tt(Fe,sn,Ne[_n],ct);if(ni===null){sn===null&&(sn=es);break}a&&sn&&ni.alternate===null&&u(Fe,sn),Pe=N(ni,Pe,_n),dn===null?Jt=ni:dn.sibling=ni,dn=ni,sn=es}if(_n===Ne.length)return p(Fe,sn),Yn&&dl(Fe,_n),Jt;if(sn===null){for(;_n<Ne.length;_n++)sn=st(Fe,Ne[_n],ct),sn!==null&&(Pe=N(sn,Pe,_n),dn===null?Jt=sn:dn.sibling=sn,dn=sn);return Yn&&dl(Fe,_n),Jt}for(sn=x(Fe,sn);_n<Ne.length;_n++)es=It(sn,Fe,_n,Ne[_n],ct),es!==null&&(a&&es.alternate!==null&&sn.delete(es.key===null?_n:es.key),Pe=N(es,Pe,_n),dn===null?Jt=es:dn.sibling=es,dn=es);return a&&sn.forEach(function(zu){return u(Fe,zu)}),Yn&&dl(Fe,_n),Jt}function qt(Fe,Pe,Ne,ct){var Jt=ye(Ne);if(typeof Jt!="function")throw Error(t(150));if(Ne=Jt.call(Ne),Ne==null)throw Error(t(151));for(var dn=Jt=null,sn=Pe,_n=Pe=0,es=null,ni=Ne.next();sn!==null&&!ni.done;_n++,ni=Ne.next()){sn.index>_n?(es=sn,sn=null):es=sn.sibling;var zu=tt(Fe,sn,ni.value,ct);if(zu===null){sn===null&&(sn=es);break}a&&sn&&zu.alternate===null&&u(Fe,sn),Pe=N(zu,Pe,_n),dn===null?Jt=zu:dn.sibling=zu,dn=zu,sn=es}if(ni.done)return p(Fe,sn),Yn&&dl(Fe,_n),Jt;if(sn===null){for(;!ni.done;_n++,ni=Ne.next())ni=st(Fe,ni.value,ct),ni!==null&&(Pe=N(ni,Pe,_n),dn===null?Jt=ni:dn.sibling=ni,dn=ni);return Yn&&dl(Fe,_n),Jt}for(sn=x(Fe,sn);!ni.done;_n++,ni=Ne.next())ni=It(sn,Fe,_n,ni.value,ct),ni!==null&&(a&&ni.alternate!==null&&sn.delete(ni.key===null?_n:ni.key),Pe=N(ni,Pe,_n),dn===null?Jt=ni:dn.sibling=ni,dn=ni);return a&&sn.forEach(function(av){return u(Fe,av)}),Yn&&dl(Fe,_n),Jt}function gr(Fe,Pe,Ne,ct){if(typeof Ne=="object"&&Ne!==null&&Ne.type===Q&&Ne.key===null&&(Ne=Ne.props.children),typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case $:e:{for(var Jt=Ne.key,dn=Pe;dn!==null;){if(dn.key===Jt){if(Jt=Ne.type,Jt===Q){if(dn.tag===7){p(Fe,dn.sibling),Pe=A(dn,Ne.props.children),Pe.return=Fe,Fe=Pe;break e}}else if(dn.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===me&&Kl(Jt)===dn.type){p(Fe,dn.sibling),Pe=A(dn,Ne.props),Pe.ref=Yl(Fe,dn,Ne),Pe.return=Fe,Fe=Pe;break e}p(Fe,dn);break}else u(Fe,dn);dn=dn.sibling}Ne.type===Q?(Pe=Dc(Ne.props.children,Fe.mode,ct,Ne.key),Pe.return=Fe,Fe=Pe):(ct=Kf(Ne.type,Ne.key,Ne.props,null,Fe.mode,ct),ct.ref=Yl(Fe,Pe,Ne),ct.return=Fe,Fe=ct)}return ee(Fe);case X:e:{for(dn=Ne.key;Pe!==null;){if(Pe.key===dn)if(Pe.tag===4&&Pe.stateNode.containerInfo===Ne.containerInfo&&Pe.stateNode.implementation===Ne.implementation){p(Fe,Pe.sibling),Pe=A(Pe,Ne.children||[]),Pe.return=Fe,Fe=Pe;break e}else{p(Fe,Pe);break}else u(Fe,Pe);Pe=Pe.sibling}Pe=Od(Ne,Fe.mode,ct),Pe.return=Fe,Fe=Pe}return ee(Fe);case me:return dn=Ne._init,gr(Fe,Pe,dn(Ne._payload),ct)}if(Dt(Ne))return Gt(Fe,Pe,Ne,ct);if(ye(Ne))return qt(Fe,Pe,Ne,ct);ta(Fe,Ne)}return typeof Ne=="string"&&Ne!==""||typeof Ne=="number"?(Ne=""+Ne,Pe!==null&&Pe.tag===6?(p(Fe,Pe.sibling),Pe=A(Pe,Ne),Pe.return=Fe,Fe=Pe):(p(Fe,Pe),Pe=Fd(Ne,Fe.mode,ct),Pe.return=Fe,Fe=Pe),ee(Fe)):p(Fe,Pe)}return gr}var An=dc(!0),Au=dc(!1),Pu=lr(null),qi=null,na=null,za=null;function os(){za=na=qi=null}function Va(a){var u=Pu.current;vi(Pu),a._currentValue=u}function Hn(a,u,p){for(;a!==null;){var x=a.alternate;if((a.childLanes&u)!==u?(a.childLanes|=u,x!==null&&(x.childLanes|=u)):x!==null&&(x.childLanes&u)!==u&&(x.childLanes|=u),a===p)break;a=a.return}}function ia(a,u){qi=a,za=na=null,a=a.dependencies,a!==null&&a.firstContext!==null&&(a.lanes&u&&(Ps=!0),a.firstContext=null)}function Ms(a){var u=a._currentValue;if(za!==a)if(a={context:a,memoizedValue:u,next:null},na===null){if(qi===null)throw Error(t(308));na=a,qi.dependencies={lanes:0,firstContext:a}}else na=na.next=a;return u}var pl=null;function Lh(a){pl===null?pl=[a]:pl.push(a)}function ml(a,u,p,x){var A=u.interleaved;return A===null?(p.next=p,Lh(u)):(p.next=A.next,A.next=p),u.interleaved=p,Ga(a,x)}function Ga(a,u){a.lanes|=u;var p=a.alternate;for(p!==null&&(p.lanes|=u),p=a,a=a.return;a!==null;)a.childLanes|=u,p=a.alternate,p!==null&&(p.childLanes|=u),p=a,a=a.return;return p.tag===3?p.stateNode:null}var zi=!1;function pc(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Tf(a,u){a=a.updateQueue,u.updateQueue===a&&(u.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Lo(a,u){return{eventTime:a,lane:u,tag:0,payload:null,callback:null,next:null}}function $r(a,u,p){var x=a.updateQueue;if(x===null)return null;if(x=x.shared,Kn&2){var A=x.pending;return A===null?u.next=u:(u.next=A.next,A.next=u),x.pending=u,Ga(a,p)}return A=x.interleaved,A===null?(u.next=u,Lh(x)):(u.next=A.next,A.next=u),x.interleaved=u,Ga(a,p)}function ih(a,u,p){if(u=u.updateQueue,u!==null&&(u=u.shared,(p&4194240)!==0)){var x=u.lanes;x&=a.pendingLanes,p|=x,u.lanes=p,Tr(a,p)}}function kh(a,u){var p=a.updateQueue,x=a.alternate;if(x!==null&&(x=x.updateQueue,p===x)){var A=null,N=null;if(p=p.firstBaseUpdate,p!==null){do{var ee={eventTime:p.eventTime,lane:p.lane,tag:p.tag,payload:p.payload,callback:p.callback,next:null};N===null?A=N=ee:N=N.next=ee,p=p.next}while(p!==null);N===null?A=N=u:N=N.next=u}else A=N=u;p={baseState:x.baseState,firstBaseUpdate:A,lastBaseUpdate:N,shared:x.shared,effects:x.effects},a.updateQueue=p;return}a=p.lastBaseUpdate,a===null?p.firstBaseUpdate=u:a.next=u,p.lastBaseUpdate=u}function vl(a,u,p,x){var A=a.updateQueue;zi=!1;var N=A.firstBaseUpdate,ee=A.lastBaseUpdate,pe=A.shared.pending;if(pe!==null){A.shared.pending=null;var Ce=pe,Ge=Ce.next;Ce.next=null,ee===null?N=Ge:ee.next=Ge,ee=Ce;var nt=a.alternate;nt!==null&&(nt=nt.updateQueue,pe=nt.lastBaseUpdate,pe!==ee&&(pe===null?nt.firstBaseUpdate=Ge:pe.next=Ge,nt.lastBaseUpdate=Ce))}if(N!==null){var st=A.baseState;ee=0,nt=Ge=Ce=null,pe=N;do{var tt=pe.lane,It=pe.eventTime;if((x&tt)===tt){nt!==null&&(nt=nt.next={eventTime:It,lane:0,tag:pe.tag,payload:pe.payload,callback:pe.callback,next:null});e:{var Gt=a,qt=pe;switch(tt=u,It=p,qt.tag){case 1:if(Gt=qt.payload,typeof Gt=="function"){st=Gt.call(It,st,tt);break e}st=Gt;break e;case 3:Gt.flags=Gt.flags&-65537|128;case 0:if(Gt=qt.payload,tt=typeof Gt=="function"?Gt.call(It,st,tt):Gt,tt==null)break e;st=de({},st,tt);break e;case 2:zi=!0}}pe.callback!==null&&pe.lane!==0&&(a.flags|=64,tt=A.effects,tt===null?A.effects=[pe]:tt.push(pe))}else It={eventTime:It,lane:tt,tag:pe.tag,payload:pe.payload,callback:pe.callback,next:null},nt===null?(Ge=nt=It,Ce=st):nt=nt.next=It,ee|=tt;if(pe=pe.next,pe===null){if(pe=A.shared.pending,pe===null)break;tt=pe,pe=tt.next,tt.next=null,A.lastBaseUpdate=tt,A.shared.pending=null}}while(!0);if(nt===null&&(Ce=st),A.baseState=Ce,A.firstBaseUpdate=Ge,A.lastBaseUpdate=nt,u=A.shared.interleaved,u!==null){A=u;do ee|=A.lane,A=A.next;while(A!==u)}else N===null&&(A.shared.lanes=0);eu|=ee,a.lanes=ee,a.memoizedState=st}}function rh(a,u,p){if(a=u.effects,u.effects=null,a!==null)for(u=0;u<a.length;u++){var x=a[u],A=x.callback;if(A!==null){if(x.callback=null,x=p,typeof A!="function")throw Error(t(191,A));A.call(x)}}}var mc={},ra=lr(mc),vc=lr(mc),Zl=lr(mc);function ko(a){if(a===mc)throw Error(t(174));return a}function Fh(a,u){switch(bi(Zl,u),bi(vc,a),bi(ra,mc),a=u.nodeType,a){case 9:case 11:u=(u=u.documentElement)?u.namespaceURI:Pt(null,"");break;default:a=a===8?u.parentNode:u,u=a.namespaceURI||null,a=a.tagName,u=Pt(u,a)}vi(ra),bi(ra,u)}function sa(){vi(ra),vi(vc),vi(Zl)}function io(a){ko(Zl.current);var u=ko(ra.current),p=Pt(u,a.type);u!==p&&(bi(vc,a),bi(ra,p))}function gc(a){vc.current===a&&(vi(ra),vi(vc))}var Si=lr(0);function oa(a){for(var u=a;u!==null;){if(u.tag===13){var p=u.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||p.data==="$!"))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if(u.flags&128)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}var sh=[];function _c(){for(var a=0;a<sh.length;a++)sh[a]._workInProgressVersionPrimary=null;sh.length=0}var Ru=B.ReactCurrentDispatcher,oh=B.ReactCurrentBatchConfig,aa=0,Fi=null,Vi=null,cr=null,gl=!1,yc=!1,Ha=0,yt=0;function Yr(){throw Error(t(321))}function Oh(a,u){if(u===null)return!1;for(var p=0;p<u.length&&p<a.length;p++)if(!K(a[p],u[p]))return!1;return!0}function ro(a,u,p,x,A,N){if(aa=N,Fi=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,Ru.current=a===null||a.memoizedState===null?Gm:wc,a=p(x,A),yc){N=0;do{if(yc=!1,Ha=0,25<=N)throw Error(t(301));N+=1,cr=Vi=null,u.updateQueue=null,Ru.current=Wa,a=p(x,A)}while(yc)}if(Ru.current=If,u=Vi!==null&&Vi.next!==null,aa=0,cr=Vi=Fi=null,gl=!1,u)throw Error(t(300));return a}function bc(){var a=Ha!==0;return Ha=0,a}function la(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cr===null?Fi.memoizedState=cr=a:cr=cr.next=a,cr}function y(){if(Vi===null){var a=Fi.alternate;a=a!==null?a.memoizedState:null}else a=Vi.next;var u=cr===null?Fi.memoizedState:cr.next;if(u!==null)cr=u,Vi=a;else{if(a===null)throw Error(t(310));Vi=a,a={memoizedState:Vi.memoizedState,baseState:Vi.baseState,baseQueue:Vi.baseQueue,queue:Vi.queue,next:null},cr===null?Fi.memoizedState=cr=a:cr=cr.next=a}return cr}function h(a,u){return typeof u=="function"?u(a):u}function m(a){var u=y(),p=u.queue;if(p===null)throw Error(t(311));p.lastRenderedReducer=a;var x=Vi,A=x.baseQueue,N=p.pending;if(N!==null){if(A!==null){var ee=A.next;A.next=N.next,N.next=ee}x.baseQueue=A=N,p.pending=null}if(A!==null){N=A.next,x=x.baseState;var pe=ee=null,Ce=null,Ge=N;do{var nt=Ge.lane;if((aa&nt)===nt)Ce!==null&&(Ce=Ce.next={lane:0,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null}),x=Ge.hasEagerState?Ge.eagerState:a(x,Ge.action);else{var st={lane:nt,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null};Ce===null?(pe=Ce=st,ee=x):Ce=Ce.next=st,Fi.lanes|=nt,eu|=nt}Ge=Ge.next}while(Ge!==null&&Ge!==N);Ce===null?ee=x:Ce.next=pe,K(x,u.memoizedState)||(Ps=!0),u.memoizedState=x,u.baseState=ee,u.baseQueue=Ce,p.lastRenderedState=x}if(a=p.interleaved,a!==null){A=a;do N=A.lane,Fi.lanes|=N,eu|=N,A=A.next;while(A!==a)}else A===null&&(p.lanes=0);return[u.memoizedState,p.dispatch]}function T(a){var u=y(),p=u.queue;if(p===null)throw Error(t(311));p.lastRenderedReducer=a;var x=p.dispatch,A=p.pending,N=u.memoizedState;if(A!==null){p.pending=null;var ee=A=A.next;do N=a(N,ee.action),ee=ee.next;while(ee!==A);K(N,u.memoizedState)||(Ps=!0),u.memoizedState=N,u.baseQueue===null&&(u.baseState=N),p.lastRenderedState=N}return[N,x]}function q(){}function ve(a,u){var p=Fi,x=y(),A=u(),N=!K(x.memoizedState,A);if(N&&(x.memoizedState=A,Ps=!0),x=x.queue,as(Ut.bind(null,p,x,a),[a]),x.getSnapshot!==u||N||cr!==null&&cr.memoizedState.tag&1){if(p.flags|=2048,Vs(9,$e.bind(null,p,x,A,u),void 0,null),Qr===null)throw Error(t(349));aa&30||ke(p,u,A)}return A}function ke(a,u,p){a.flags|=16384,a={getSnapshot:u,value:p},u=Fi.updateQueue,u===null?(u={lastEffect:null,stores:null},Fi.updateQueue=u,u.stores=[a]):(p=u.stores,p===null?u.stores=[a]:p.push(a))}function $e(a,u,p,x){u.value=p,u.getSnapshot=x,ln(u)&&On(a)}function Ut(a,u,p){return p(function(){ln(u)&&On(a)})}function ln(a){var u=a.getSnapshot;a=a.value;try{var p=u();return!K(a,p)}catch{return!0}}function On(a){var u=Ga(a,1);u!==null&&Xa(u,a,1,-1)}function Pn(a){var u=la();return typeof a=="function"&&(a=a()),u.memoizedState=u.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:a},u.queue=a,a=a.dispatch=gd.bind(null,Fi,a),[u.memoizedState,a]}function Vs(a,u,p,x){return a={tag:a,create:u,destroy:p,deps:x,next:null},u=Fi.updateQueue,u===null?(u={lastEffect:null,stores:null},Fi.updateQueue=u,u.lastEffect=a.next=a):(p=u.lastEffect,p===null?u.lastEffect=a.next=a:(x=p.next,p.next=a,a.next=x,u.lastEffect=a)),a}function ua(){return y().memoizedState}function ca(a,u,p,x){var A=la();Fi.flags|=a,A.memoizedState=Vs(1|u,p,void 0,x===void 0?null:x)}function Fo(a,u,p,x){var A=y();x=x===void 0?null:x;var N=void 0;if(Vi!==null){var ee=Vi.memoizedState;if(N=ee.destroy,x!==null&&Oh(x,ee.deps)){A.memoizedState=Vs(u,p,N,x);return}}Fi.flags|=a,A.memoizedState=Vs(1|u,p,N,x)}function ah(a,u){return ca(8390656,8,a,u)}function as(a,u){return Fo(2048,8,a,u)}function Ep(a,u){return Fo(4,2,a,u)}function As(a,u){return Fo(4,4,a,u)}function Mf(a,u){if(typeof u=="function")return a=a(),u(a),function(){u(null)};if(u!=null)return a=a(),u.current=a,function(){u.current=null}}function Af(a,u,p){return p=p!=null?p.concat([a]):null,Fo(4,4,Mf.bind(null,u,a),p)}function xc(){}function Cp(a,u){var p=y();u=u===void 0?null:u;var x=p.memoizedState;return x!==null&&u!==null&&Oh(u,x[1])?x[0]:(p.memoizedState=[a,u],a)}function Tp(a,u){var p=y();u=u===void 0?null:u;var x=p.memoizedState;return x!==null&&u!==null&&Oh(u,x[1])?x[0]:(a=a(),p.memoizedState=[a,u],a)}function Mp(a,u,p){return aa&21?(K(p,u)||(p=or(),Fi.lanes|=p,eu|=p,a.baseState=!0),u):(a.baseState&&(a.baseState=!1,Ps=!0),a.memoizedState=p)}function vd(a,u){var p=an;an=p!==0&&4>p?p:4,a(!0);var x=oh.transition;oh.transition={};try{a(!1),u()}finally{an=p,oh.transition=x}}function Pf(){return y().memoizedState}function Vm(a,u,p){var x=Uu(a);if(p={lane:x,action:p,hasEagerState:!1,eagerState:null,next:null},Rf(a))Ei(u,p);else if(p=ml(a,u,p,x),p!==null){var A=Hs();Xa(p,a,x,A),xr(p,u,x)}}function gd(a,u,p){var x=Uu(a),A={lane:x,action:p,hasEagerState:!1,eagerState:null,next:null};if(Rf(a))Ei(u,A);else{var N=a.alternate;if(a.lanes===0&&(N===null||N.lanes===0)&&(N=u.lastRenderedReducer,N!==null))try{var ee=u.lastRenderedState,pe=N(ee,p);if(A.hasEagerState=!0,A.eagerState=pe,K(pe,ee)){var Ce=u.interleaved;Ce===null?(A.next=A,Lh(u)):(A.next=Ce.next,Ce.next=A),u.interleaved=A;return}}catch{}finally{}p=ml(a,u,A,x),p!==null&&(A=Hs(),Xa(p,a,x,A),xr(p,u,x))}}function Rf(a){var u=a.alternate;return a===Fi||u!==null&&u===Fi}function Ei(a,u){yc=gl=!0;var p=a.pending;p===null?u.next=u:(u.next=p.next,p.next=u),a.pending=u}function xr(a,u,p){if(p&4194240){var x=u.lanes;x&=a.pendingLanes,p|=x,u.lanes=p,Tr(a,p)}}var If={readContext:Ms,useCallback:Yr,useContext:Yr,useEffect:Yr,useImperativeHandle:Yr,useInsertionEffect:Yr,useLayoutEffect:Yr,useMemo:Yr,useReducer:Yr,useRef:Yr,useState:Yr,useDebugValue:Yr,useDeferredValue:Yr,useTransition:Yr,useMutableSource:Yr,useSyncExternalStore:Yr,useId:Yr,unstable_isNewReconciler:!1},Gm={readContext:Ms,useCallback:function(a,u){return la().memoizedState=[a,u===void 0?null:u],a},useContext:Ms,useEffect:ah,useImperativeHandle:function(a,u,p){return p=p!=null?p.concat([a]):null,ca(4194308,4,Mf.bind(null,u,a),p)},useLayoutEffect:function(a,u){return ca(4194308,4,a,u)},useInsertionEffect:function(a,u){return ca(4,2,a,u)},useMemo:function(a,u){var p=la();return u=u===void 0?null:u,a=a(),p.memoizedState=[a,u],a},useReducer:function(a,u,p){var x=la();return u=p!==void 0?p(u):u,x.memoizedState=x.baseState=u,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:u},x.queue=a,a=a.dispatch=Vm.bind(null,Fi,a),[x.memoizedState,a]},useRef:function(a){var u=la();return a={current:a},u.memoizedState=a},useState:Pn,useDebugValue:xc,useDeferredValue:function(a){return la().memoizedState=a},useTransition:function(){var a=Pn(!1),u=a[0];return a=vd.bind(null,a[1]),la().memoizedState=a,[u,a]},useMutableSource:function(){},useSyncExternalStore:function(a,u,p){var x=Fi,A=la();if(Yn){if(p===void 0)throw Error(t(407));p=p()}else{if(p=u(),Qr===null)throw Error(t(349));aa&30||ke(x,u,p)}A.memoizedState=p;var N={value:p,getSnapshot:u};return A.queue=N,ah(Ut.bind(null,x,N,a),[a]),x.flags|=2048,Vs(9,$e.bind(null,x,N,p,u),void 0,null),p},useId:function(){var a=la(),u=Qr.identifierPrefix;if(Yn){var p=no,x=zs;p=(x&~(1<<32-Fn(x)-1)).toString(32)+p,u=":"+u+"R"+p,p=Ha++,0<p&&(u+="H"+p.toString(32)),u+=":"}else p=yt++,u=":"+u+"r"+p.toString(32)+":";return a.memoizedState=u},unstable_isNewReconciler:!1},wc={readContext:Ms,useCallback:Cp,useContext:Ms,useEffect:as,useImperativeHandle:Af,useInsertionEffect:Ep,useLayoutEffect:As,useMemo:Tp,useReducer:m,useRef:ua,useState:function(){return m(h)},useDebugValue:xc,useDeferredValue:function(a){var u=y();return Mp(u,Vi.memoizedState,a)},useTransition:function(){var a=m(h)[0],u=y().memoizedState;return[a,u]},useMutableSource:q,useSyncExternalStore:ve,useId:Pf,unstable_isNewReconciler:!1},Wa={readContext:Ms,useCallback:Cp,useContext:Ms,useEffect:as,useImperativeHandle:Af,useInsertionEffect:Ep,useLayoutEffect:As,useMemo:Tp,useReducer:T,useRef:ua,useState:function(){return T(h)},useDebugValue:xc,useDeferredValue:function(a){var u=y();return Vi===null?u.memoizedState=a:Mp(u,Vi.memoizedState,a)},useTransition:function(){var a=T(h)[0],u=y().memoizedState;return[a,u]},useMutableSource:q,useSyncExternalStore:ve,useId:Pf,unstable_isNewReconciler:!1};function Oo(a,u){if(a&&a.defaultProps){u=de({},u),a=a.defaultProps;for(var p in a)u[p]===void 0&&(u[p]=a[p]);return u}return u}function Nh(a,u,p,x){u=a.memoizedState,p=p(x,u),p=p==null?u:de({},u,p),a.memoizedState=p,a.lanes===0&&(a.updateQueue.baseState=p)}var Df={isMounted:function(a){return(a=a._reactInternals)?ds(a)===a:!1},enqueueSetState:function(a,u,p){a=a._reactInternals;var x=Hs(),A=Uu(a),N=Lo(x,A);N.payload=u,p!=null&&(N.callback=p),u=$r(a,N,A),u!==null&&(Xa(u,a,A,x),ih(u,a,A))},enqueueReplaceState:function(a,u,p){a=a._reactInternals;var x=Hs(),A=Uu(a),N=Lo(x,A);N.tag=1,N.payload=u,p!=null&&(N.callback=p),u=$r(a,N,A),u!==null&&(Xa(u,a,A,x),ih(u,a,A))},enqueueForceUpdate:function(a,u){a=a._reactInternals;var p=Hs(),x=Uu(a),A=Lo(p,x);A.tag=2,u!=null&&(A.callback=u),u=$r(a,A,x),u!==null&&(Xa(u,a,x,p),ih(u,a,x))}};function Lf(a,u,p,x,A,N,ee){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(x,N,ee):u.prototype&&u.prototype.isPureReactComponent?!Se(p,x)||!Se(A,N):!0}function ha(a,u,p){var x=!1,A=hl,N=u.contextType;return typeof N=="object"&&N!==null?N=Ms(N):(A=Es(u)?Bi:Xr.current,x=u.contextTypes,N=(x=x!=null)?Cu(a,A):hl),u=new u(p,N),a.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=Df,a.stateNode=u,u._reactInternals=a,x&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=A,a.__reactInternalMemoizedMaskedChildContext=N),u}function _l(a,u,p,x){a=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(p,x),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(p,x),u.state!==a&&Df.enqueueReplaceState(u,u.state,null)}function _d(a,u,p,x){var A=a.stateNode;A.props=p,A.state=a.memoizedState,A.refs={},pc(a);var N=u.contextType;typeof N=="object"&&N!==null?A.context=Ms(N):(N=Es(u)?Bi:Xr.current,A.context=Cu(a,N)),A.state=a.memoizedState,N=u.getDerivedStateFromProps,typeof N=="function"&&(Nh(a,u,N,p),A.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof A.getSnapshotBeforeUpdate=="function"||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(u=A.state,typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount(),u!==A.state&&Df.enqueueReplaceState(A,A.state,null),vl(a,p,A,x),A.state=a.memoizedState),typeof A.componentDidMount=="function"&&(a.flags|=4194308)}function Iu(a,u){try{var p="",x=u;do p+=fe(x),x=x.return;while(x);var A=p}catch(N){A=`
Error generating stack: `+N.message+`
`+N.stack}return{value:a,source:u,stack:A,digest:null}}function Uh(a,u,p){return{value:a,source:null,stack:p??null,digest:u??null}}function Jl(a,u){try{console.error(u.value)}catch(p){setTimeout(function(){throw p})}}var yd=typeof WeakMap=="function"?WeakMap:Map;function Du(a,u,p){p=Lo(-1,p),p.tag=3,p.payload={element:null};var x=u.value;return p.callback=function(){Xf||(Xf=!0,Ad=x),Jl(a,u)},p}function lh(a,u,p){p=Lo(-1,p),p.tag=3;var x=a.type.getDerivedStateFromError;if(typeof x=="function"){var A=u.value;p.payload=function(){return x(A)},p.callback=function(){Jl(a,u)}}var N=a.stateNode;return N!==null&&typeof N.componentDidCatch=="function"&&(p.callback=function(){Jl(a,u),typeof x!="function"&&(Ou===null?Ou=new Set([this]):Ou.add(this));var ee=u.stack;this.componentDidCatch(u.value,{componentStack:ee!==null?ee:""})}),p}function Lu(a,u,p){var x=a.pingCache;if(x===null){x=a.pingCache=new yd;var A=new Set;x.set(u,A)}else A=x.get(u),A===void 0&&(A=new Set,x.set(u,A));A.has(p)||(A.add(p),a=Km.bind(null,a,u,p),u.then(a,a))}function Ap(a){do{var u;if((u=a.tag===13)&&(u=a.memoizedState,u=u!==null?u.dehydrated!==null:!0),u)return a;a=a.return}while(a!==null);return null}function kf(a,u,p,x,A){return a.mode&1?(a.flags|=65536,a.lanes=A,a):(a===u?a.flags|=65536:(a.flags|=128,p.flags|=131072,p.flags&=-52805,p.tag===1&&(p.alternate===null?p.tag=17:(u=Lo(-1,1),u.tag=2,$r(p,u,1))),p.lanes|=1),a)}var Sc=B.ReactCurrentOwner,Ps=!1;function Fr(a,u,p,x){u.child=a===null?Au(u,null,p,x):An(u,a.child,p,x)}function Pp(a,u,p,x,A){p=p.render;var N=u.ref;return ia(u,A),x=ro(a,u,p,x,N,A),p=bc(),a!==null&&!Ps?(u.updateQueue=a.updateQueue,u.flags&=-2053,a.lanes&=~A,No(a,u,A)):(Yn&&p&&$l(u),u.flags|=1,Fr(a,u,x,A),u.child)}function Ff(a,u,p,x,A){if(a===null){var N=p.type;return typeof N=="function"&&!Xh(N)&&N.defaultProps===void 0&&p.compare===null&&p.defaultProps===void 0?(u.tag=15,u.type=N,Kr(a,u,N,x,A)):(a=Kf(p.type,null,x,u,u.mode,A),a.ref=u.ref,a.return=u,u.child=a)}if(N=a.child,!(a.lanes&A)){var ee=N.memoizedProps;if(p=p.compare,p=p!==null?p:Se,p(ee,x)&&a.ref===u.ref)return No(a,u,A)}return u.flags|=1,a=co(N,x),a.ref=u.ref,a.return=u,u.child=a}function Kr(a,u,p,x,A){if(a!==null){var N=a.memoizedProps;if(Se(N,x)&&a.ref===u.ref)if(Ps=!1,u.pendingProps=x=N,(a.lanes&A)!==0)a.flags&131072&&(Ps=!0);else return u.lanes=a.lanes,No(a,u,A)}return bd(a,u,p,x,A)}function Of(a,u,p){var x=u.pendingProps,A=x.children,N=a!==null?a.memoizedState:null;if(x.mode==="hidden")if(!(u.mode&1))u.memoizedState={baseLanes:0,cachePool:null,transitions:null},bi(fh,Bo),Bo|=p;else{if(!(p&1073741824))return a=N!==null?N.baseLanes|p:p,u.lanes=u.childLanes=1073741824,u.memoizedState={baseLanes:a,cachePool:null,transitions:null},u.updateQueue=null,bi(fh,Bo),Bo|=a,null;u.memoizedState={baseLanes:0,cachePool:null,transitions:null},x=N!==null?N.baseLanes:p,bi(fh,Bo),Bo|=x}else N!==null?(x=N.baseLanes|p,u.memoizedState=null):x=p,bi(fh,Bo),Bo|=x;return Fr(a,u,A,p),u.child}function Nf(a,u){var p=u.ref;(a===null&&p!==null||a!==null&&a.ref!==p)&&(u.flags|=512,u.flags|=2097152)}function bd(a,u,p,x,A){var N=Es(p)?Bi:Xr.current;return N=Cu(u,N),ia(u,A),p=ro(a,u,p,x,N,A),x=bc(),a!==null&&!Ps?(u.updateQueue=a.updateQueue,u.flags&=-2053,a.lanes&=~A,No(a,u,A)):(Yn&&x&&$l(u),u.flags|=1,Fr(a,u,p,A),u.child)}function Uf(a,u,p,x,A){if(Es(p)){var N=!0;ur(u)}else N=!1;if(ia(u,A),u.stateNode===null)Bf(a,u),ha(u,p,x),_d(u,p,x,A),x=!0;else if(a===null){var ee=u.stateNode,pe=u.memoizedProps;ee.props=pe;var Ce=ee.context,Ge=p.contextType;typeof Ge=="object"&&Ge!==null?Ge=Ms(Ge):(Ge=Es(p)?Bi:Xr.current,Ge=Cu(u,Ge));var nt=p.getDerivedStateFromProps,st=typeof nt=="function"||typeof ee.getSnapshotBeforeUpdate=="function";st||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(pe!==x||Ce!==Ge)&&_l(u,ee,x,Ge),zi=!1;var tt=u.memoizedState;ee.state=tt,vl(u,x,ee,A),Ce=u.memoizedState,pe!==x||tt!==Ce||Ss.current||zi?(typeof nt=="function"&&(Nh(u,p,nt,x),Ce=u.memoizedState),(pe=zi||Lf(u,p,pe,x,tt,Ce,Ge))?(st||typeof ee.UNSAFE_componentWillMount!="function"&&typeof ee.componentWillMount!="function"||(typeof ee.componentWillMount=="function"&&ee.componentWillMount(),typeof ee.UNSAFE_componentWillMount=="function"&&ee.UNSAFE_componentWillMount()),typeof ee.componentDidMount=="function"&&(u.flags|=4194308)):(typeof ee.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=x,u.memoizedState=Ce),ee.props=x,ee.state=Ce,ee.context=Ge,x=pe):(typeof ee.componentDidMount=="function"&&(u.flags|=4194308),x=!1)}else{ee=u.stateNode,Tf(a,u),pe=u.memoizedProps,Ge=u.type===u.elementType?pe:Oo(u.type,pe),ee.props=Ge,st=u.pendingProps,tt=ee.context,Ce=p.contextType,typeof Ce=="object"&&Ce!==null?Ce=Ms(Ce):(Ce=Es(p)?Bi:Xr.current,Ce=Cu(u,Ce));var It=p.getDerivedStateFromProps;(nt=typeof It=="function"||typeof ee.getSnapshotBeforeUpdate=="function")||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(pe!==st||tt!==Ce)&&_l(u,ee,x,Ce),zi=!1,tt=u.memoizedState,ee.state=tt,vl(u,x,ee,A);var Gt=u.memoizedState;pe!==st||tt!==Gt||Ss.current||zi?(typeof It=="function"&&(Nh(u,p,It,x),Gt=u.memoizedState),(Ge=zi||Lf(u,p,Ge,x,tt,Gt,Ce)||!1)?(nt||typeof ee.UNSAFE_componentWillUpdate!="function"&&typeof ee.componentWillUpdate!="function"||(typeof ee.componentWillUpdate=="function"&&ee.componentWillUpdate(x,Gt,Ce),typeof ee.UNSAFE_componentWillUpdate=="function"&&ee.UNSAFE_componentWillUpdate(x,Gt,Ce)),typeof ee.componentDidUpdate=="function"&&(u.flags|=4),typeof ee.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof ee.componentDidUpdate!="function"||pe===a.memoizedProps&&tt===a.memoizedState||(u.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||pe===a.memoizedProps&&tt===a.memoizedState||(u.flags|=1024),u.memoizedProps=x,u.memoizedState=Gt),ee.props=x,ee.state=Gt,ee.context=Ce,x=Ge):(typeof ee.componentDidUpdate!="function"||pe===a.memoizedProps&&tt===a.memoizedState||(u.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||pe===a.memoizedProps&&tt===a.memoizedState||(u.flags|=1024),x=!1)}return xd(a,u,p,x,N,A)}function xd(a,u,p,x,A,N){Nf(a,u);var ee=(u.flags&128)!==0;if(!x&&!ee)return A&&wf(u,p,!1),No(a,u,N);x=u.stateNode,Sc.current=u;var pe=ee&&typeof p.getDerivedStateFromError!="function"?null:x.render();return u.flags|=1,a!==null&&ee?(u.child=An(u,a.child,null,N),u.child=An(u,null,pe,N)):Fr(a,u,pe,N),u.memoizedState=x.state,A&&wf(u,p,!0),u.child}function Rp(a){var u=a.stateNode;u.pendingContext?bf(a,u.pendingContext,u.pendingContext!==u.context):u.context&&bf(a,u.context,!1),Fh(a,u.containerInfo)}function Zr(a,u,p,x,A){return Ts(),kr(A),u.flags|=256,Fr(a,u,p,x),u.child}var Ec={dehydrated:null,treeContext:null,retryLane:0};function Cc(a){return{baseLanes:a,cachePool:null,transitions:null}}function uh(a,u,p){var x=u.pendingProps,A=Si.current,N=!1,ee=(u.flags&128)!==0,pe;if((pe=ee)||(pe=a!==null&&a.memoizedState===null?!1:(A&2)!==0),pe?(N=!0,u.flags&=-129):(a===null||a.memoizedState!==null)&&(A|=1),bi(Si,A&1),a===null)return Ri(u),a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?(u.mode&1?a.data==="$!"?u.lanes=8:u.lanes=1073741824:u.lanes=1,null):(ee=x.children,a=x.fallback,N?(x=u.mode,N=u.child,ee={mode:"hidden",children:ee},!(x&1)&&N!==null?(N.childLanes=0,N.pendingProps=ee):N=Zf(ee,x,0,null),a=Dc(a,x,p,null),N.return=u,a.return=u,N.sibling=a,u.child=N,u.child.memoizedState=Cc(p),u.memoizedState=Ec,a):Ql(u,ee));if(A=a.memoizedState,A!==null&&(pe=A.dehydrated,pe!==null))return rt(a,u,ee,x,pe,A,p);if(N){N=x.fallback,ee=u.mode,A=a.child,pe=A.sibling;var Ce={mode:"hidden",children:x.children};return!(ee&1)&&u.child!==A?(x=u.child,x.childLanes=0,x.pendingProps=Ce,u.deletions=null):(x=co(A,Ce),x.subtreeFlags=A.subtreeFlags&14680064),pe!==null?N=co(pe,N):(N=Dc(N,ee,p,null),N.flags|=2),N.return=u,x.return=u,x.sibling=N,u.child=x,x=N,N=u.child,ee=a.child.memoizedState,ee=ee===null?Cc(p):{baseLanes:ee.baseLanes|p,cachePool:null,transitions:ee.transitions},N.memoizedState=ee,N.childLanes=a.childLanes&~p,u.memoizedState=Ec,x}return N=a.child,a=N.sibling,x=co(N,{mode:"visible",children:x.children}),!(u.mode&1)&&(x.lanes=p),x.return=u,x.sibling=null,a!==null&&(p=u.deletions,p===null?(u.deletions=[a],u.flags|=16):p.push(a)),u.child=x,u.memoizedState=null,x}function Ql(a,u){return u=Zf({mode:"visible",children:u},a.mode,0,null),u.return=a,a.child=u}function so(a,u,p,x){return x!==null&&kr(x),An(u,a.child,null,p),a=Ql(u,u.pendingProps.children),a.flags|=2,u.memoizedState=null,a}function rt(a,u,p,x,A,N,ee){if(p)return u.flags&256?(u.flags&=-257,x=Uh(Error(t(422))),so(a,u,ee,x)):u.memoizedState!==null?(u.child=a.child,u.flags|=128,null):(N=x.fallback,A=u.mode,x=Zf({mode:"visible",children:x.children},A,0,null),N=Dc(N,A,ee,null),N.flags|=2,x.return=u,N.return=u,x.sibling=N,u.child=x,u.mode&1&&An(u,a.child,null,ee),u.child.memoizedState=Cc(ee),u.memoizedState=Ec,N);if(!(u.mode&1))return so(a,u,ee,null);if(A.data==="$!"){if(x=A.nextSibling&&A.nextSibling.dataset,x)var pe=x.dgst;return x=pe,N=Error(t(419)),x=Uh(N,x,void 0),so(a,u,ee,x)}if(pe=(ee&a.childLanes)!==0,Ps||pe){if(x=Qr,x!==null){switch(ee&-ee){case 4:A=2;break;case 16:A=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:A=32;break;case 536870912:A=268435456;break;default:A=0}A=A&(x.suspendedLanes|ee)?0:A,A!==0&&A!==N.retryLane&&(N.retryLane=A,Ga(a,A),Xa(x,a,A,-1))}return kd(),x=Uh(Error(t(421))),so(a,u,ee,x)}return A.data==="$?"?(u.flags|=128,u.child=a.child,u=Zm.bind(null,a),A._reactRetry=u,null):(a=N.treeContext,Cs=cl(A.nextSibling),wi=u,Yn=!0,Io=null,a!==null&&(Bs[to++]=zs,Bs[to++]=no,Bs[to++]=ql,zs=a.id,no=a.overflow,ql=u),u=Ql(u,x.children),u.flags|=4096,u)}function ku(a,u,p){a.lanes|=u;var x=a.alternate;x!==null&&(x.lanes|=u),Hn(a.return,u,p)}function Tc(a,u,p,x,A){var N=a.memoizedState;N===null?a.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:x,tail:p,tailMode:A}:(N.isBackwards=u,N.rendering=null,N.renderingStartTime=0,N.last=x,N.tail=p,N.tailMode=A)}function oo(a,u,p){var x=u.pendingProps,A=x.revealOrder,N=x.tail;if(Fr(a,u,x.children,p),x=Si.current,x&2)x=x&1|2,u.flags|=128;else{if(a!==null&&a.flags&128)e:for(a=u.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&ku(a,p,u);else if(a.tag===19)ku(a,p,u);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===u)break e;for(;a.sibling===null;){if(a.return===null||a.return===u)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}x&=1}if(bi(Si,x),!(u.mode&1))u.memoizedState=null;else switch(A){case"forwards":for(p=u.child,A=null;p!==null;)a=p.alternate,a!==null&&oa(a)===null&&(A=p),p=p.sibling;p=A,p===null?(A=u.child,u.child=null):(A=p.sibling,p.sibling=null),Tc(u,!1,A,p,N);break;case"backwards":for(p=null,A=u.child,u.child=null;A!==null;){if(a=A.alternate,a!==null&&oa(a)===null){u.child=A;break}a=A.sibling,A.sibling=p,p=A,A=a}Tc(u,!0,p,null,N);break;case"together":Tc(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function Bf(a,u){!(u.mode&1)&&a!==null&&(a.alternate=null,u.alternate=null,u.flags|=2)}function No(a,u,p){if(a!==null&&(u.dependencies=a.dependencies),eu|=u.lanes,!(p&u.childLanes))return null;if(a!==null&&u.child!==a.child)throw Error(t(153));if(u.child!==null){for(a=u.child,p=co(a,a.pendingProps),u.child=p,p.return=u;a.sibling!==null;)a=a.sibling,p=p.sibling=co(a,a.pendingProps),p.return=u;p.sibling=null}return u.child}function wd(a,u,p){switch(u.tag){case 3:Rp(u),Ts();break;case 5:io(u);break;case 1:Es(u.type)&&ur(u);break;case 4:Fh(u,u.stateNode.containerInfo);break;case 10:var x=u.type._context,A=u.memoizedProps.value;bi(Pu,x._currentValue),x._currentValue=A;break;case 13:if(x=u.memoizedState,x!==null)return x.dehydrated!==null?(bi(Si,Si.current&1),u.flags|=128,null):p&u.child.childLanes?uh(a,u,p):(bi(Si,Si.current&1),a=No(a,u,p),a!==null?a.sibling:null);bi(Si,Si.current&1);break;case 19:if(x=(p&u.childLanes)!==0,a.flags&128){if(x)return oo(a,u,p);u.flags|=128}if(A=u.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),bi(Si,Si.current),x)break;return null;case 22:case 23:return u.lanes=0,Of(a,u,p)}return No(a,u,p)}var ei,Sd,Ip,zf;ei=function(a,u){for(var p=u.child;p!==null;){if(p.tag===5||p.tag===6)a.appendChild(p.stateNode);else if(p.tag!==4&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===u)break;for(;p.sibling===null;){if(p.return===null||p.return===u)return;p=p.return}p.sibling.return=p.return,p=p.sibling}},Sd=function(){},Ip=function(a,u,p,x){var A=a.memoizedProps;if(A!==x){a=u.stateNode,ko(ra.current);var N=null;switch(p){case"input":A=_e(a,A),x=_e(a,x),N=[];break;case"select":A=de({},A,{value:void 0}),x=de({},x,{value:void 0}),N=[];break;case"textarea":A=ne(a,A),x=ne(a,x),N=[];break;default:typeof A.onClick!="function"&&typeof x.onClick=="function"&&(a.onclick=Jc)}pn(p,x);var ee;p=null;for(Ge in A)if(!x.hasOwnProperty(Ge)&&A.hasOwnProperty(Ge)&&A[Ge]!=null)if(Ge==="style"){var pe=A[Ge];for(ee in pe)pe.hasOwnProperty(ee)&&(p||(p={}),p[ee]="")}else Ge!=="dangerouslySetInnerHTML"&&Ge!=="children"&&Ge!=="suppressContentEditableWarning"&&Ge!=="suppressHydrationWarning"&&Ge!=="autoFocus"&&(o.hasOwnProperty(Ge)?N||(N=[]):(N=N||[]).push(Ge,null));for(Ge in x){var Ce=x[Ge];if(pe=A!=null?A[Ge]:void 0,x.hasOwnProperty(Ge)&&Ce!==pe&&(Ce!=null||pe!=null))if(Ge==="style")if(pe){for(ee in pe)!pe.hasOwnProperty(ee)||Ce&&Ce.hasOwnProperty(ee)||(p||(p={}),p[ee]="");for(ee in Ce)Ce.hasOwnProperty(ee)&&pe[ee]!==Ce[ee]&&(p||(p={}),p[ee]=Ce[ee])}else p||(N||(N=[]),N.push(Ge,p)),p=Ce;else Ge==="dangerouslySetInnerHTML"?(Ce=Ce?Ce.__html:void 0,pe=pe?pe.__html:void 0,Ce!=null&&pe!==Ce&&(N=N||[]).push(Ge,Ce)):Ge==="children"?typeof Ce!="string"&&typeof Ce!="number"||(N=N||[]).push(Ge,""+Ce):Ge!=="suppressContentEditableWarning"&&Ge!=="suppressHydrationWarning"&&(o.hasOwnProperty(Ge)?(Ce!=null&&Ge==="onScroll"&&pi("scroll",a),N||pe===Ce||(N=[])):(N=N||[]).push(Ge,Ce))}p&&(N=N||[]).push("style",p);var Ge=N;(u.updateQueue=Ge)&&(u.flags|=4)}},zf=function(a,u,p,x){p!==x&&(u.flags|=4)};function Bh(a,u){if(!Yn)switch(a.tailMode){case"hidden":u=a.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?a.tail=null:p.sibling=null;break;case"collapsed":p=a.tail;for(var x=null;p!==null;)p.alternate!==null&&(x=p),p=p.sibling;x===null?u||a.tail===null?a.tail=null:a.tail.sibling=null:x.sibling=null}}function Jr(a){var u=a.alternate!==null&&a.alternate.child===a.child,p=0,x=0;if(u)for(var A=a.child;A!==null;)p|=A.lanes|A.childLanes,x|=A.subtreeFlags&14680064,x|=A.flags&14680064,A.return=a,A=A.sibling;else for(A=a.child;A!==null;)p|=A.lanes|A.childLanes,x|=A.subtreeFlags,x|=A.flags,A.return=a,A=A.sibling;return a.subtreeFlags|=x,a.childLanes=p,u}function Hm(a,u,p){var x=u.pendingProps;switch(Ro(u),u.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jr(u),null;case 1:return Es(u.type)&&eh(),Jr(u),null;case 3:return x=u.stateNode,sa(),vi(Ss),vi(Xr),_c(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(a===null||a.child===null)&&(Do(u)?u.flags|=4:a===null||a.memoizedState.isDehydrated&&!(u.flags&256)||(u.flags|=1024,Io!==null&&(Id(Io),Io=null))),Sd(a,u),Jr(u),null;case 5:gc(u);var A=ko(Zl.current);if(p=u.type,a!==null&&u.stateNode!=null)Ip(a,u,p,x,A),a.ref!==u.ref&&(u.flags|=512,u.flags|=2097152);else{if(!x){if(u.stateNode===null)throw Error(t(166));return Jr(u),null}if(a=ko(ra.current),Do(u)){x=u.stateNode,p=u.type;var N=u.memoizedProps;switch(x[eo]=u,x[Mo]=N,a=(u.mode&1)!==0,p){case"dialog":pi("cancel",x),pi("close",x);break;case"iframe":case"object":case"embed":pi("load",x);break;case"video":case"audio":for(A=0;A<bs.length;A++)pi(bs[A],x);break;case"source":pi("error",x);break;case"img":case"image":case"link":pi("error",x),pi("load",x);break;case"details":pi("toggle",x);break;case"input":Ln(x,N),pi("invalid",x);break;case"select":x._wrapperState={wasMultiple:!!N.multiple},pi("invalid",x);break;case"textarea":Oe(x,N),pi("invalid",x)}pn(p,N),A=null;for(var ee in N)if(N.hasOwnProperty(ee)){var pe=N[ee];ee==="children"?typeof pe=="string"?x.textContent!==pe&&(N.suppressHydrationWarning!==!0&&Wl(x.textContent,pe,a),A=["children",pe]):typeof pe=="number"&&x.textContent!==""+pe&&(N.suppressHydrationWarning!==!0&&Wl(x.textContent,pe,a),A=["children",""+pe]):o.hasOwnProperty(ee)&&pe!=null&&ee==="onScroll"&&pi("scroll",x)}switch(p){case"input":Wt(x),Vt(x,N,!0);break;case"textarea":Wt(x),Je(x);break;case"select":case"option":break;default:typeof N.onClick=="function"&&(x.onclick=Jc)}x=A,u.updateQueue=x,x!==null&&(u.flags|=4)}else{ee=A.nodeType===9?A:A.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=Ye(p)),a==="http://www.w3.org/1999/xhtml"?p==="script"?(a=ee.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof x.is=="string"?a=ee.createElement(p,{is:x.is}):(a=ee.createElement(p),p==="select"&&(ee=a,x.multiple?ee.multiple=!0:x.size&&(ee.size=x.size))):a=ee.createElementNS(a,p),a[eo]=u,a[Mo]=x,ei(a,u,!1,!1),u.stateNode=a;e:{switch(ee=nn(p,x),p){case"dialog":pi("cancel",a),pi("close",a),A=x;break;case"iframe":case"object":case"embed":pi("load",a),A=x;break;case"video":case"audio":for(A=0;A<bs.length;A++)pi(bs[A],a);A=x;break;case"source":pi("error",a),A=x;break;case"img":case"image":case"link":pi("error",a),pi("load",a),A=x;break;case"details":pi("toggle",a),A=x;break;case"input":Ln(a,x),A=_e(a,x),pi("invalid",a);break;case"option":A=x;break;case"select":a._wrapperState={wasMultiple:!!x.multiple},A=de({},x,{value:void 0}),pi("invalid",a);break;case"textarea":Oe(a,x),A=ne(a,x),pi("invalid",a);break;default:A=x}pn(p,A),pe=A;for(N in pe)if(pe.hasOwnProperty(N)){var Ce=pe[N];N==="style"?tn(a,Ce):N==="dangerouslySetInnerHTML"?(Ce=Ce?Ce.__html:void 0,Ce!=null&&_t(a,Ce)):N==="children"?typeof Ce=="string"?(p!=="textarea"||Ce!=="")&&fn(a,Ce):typeof Ce=="number"&&fn(a,""+Ce):N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&N!=="autoFocus"&&(o.hasOwnProperty(N)?Ce!=null&&N==="onScroll"&&pi("scroll",a):Ce!=null&&L(a,N,Ce,ee))}switch(p){case"input":Wt(a),Vt(a,x,!1);break;case"textarea":Wt(a),Je(a);break;case"option":x.value!=null&&a.setAttribute("value",""+He(x.value));break;case"select":a.multiple=!!x.multiple,N=x.value,N!=null?le(a,!!x.multiple,N,!1):x.defaultValue!=null&&le(a,!!x.multiple,x.defaultValue,!0);break;default:typeof A.onClick=="function"&&(a.onclick=Jc)}switch(p){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}}x&&(u.flags|=4)}u.ref!==null&&(u.flags|=512,u.flags|=2097152)}return Jr(u),null;case 6:if(a&&u.stateNode!=null)zf(a,u,a.memoizedProps,x);else{if(typeof x!="string"&&u.stateNode===null)throw Error(t(166));if(p=ko(Zl.current),ko(ra.current),Do(u)){if(x=u.stateNode,p=u.memoizedProps,x[eo]=u,(N=x.nodeValue!==p)&&(a=wi,a!==null))switch(a.tag){case 3:Wl(x.nodeValue,p,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Wl(x.nodeValue,p,(a.mode&1)!==0)}N&&(u.flags|=4)}else x=(p.nodeType===9?p:p.ownerDocument).createTextNode(x),x[eo]=u,u.stateNode=x}return Jr(u),null;case 13:if(vi(Si),x=u.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(Yn&&Cs!==null&&u.mode&1&&!(u.flags&128))fc(),Ts(),u.flags|=98560,N=!1;else if(N=Do(u),x!==null&&x.dehydrated!==null){if(a===null){if(!N)throw Error(t(318));if(N=u.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(t(317));N[eo]=u}else Ts(),!(u.flags&128)&&(u.memoizedState=null),u.flags|=4;Jr(u),N=!1}else Io!==null&&(Id(Io),Io=null),N=!0;if(!N)return u.flags&65536?u:null}return u.flags&128?(u.lanes=p,u):(x=x!==null,x!==(a!==null&&a.memoizedState!==null)&&x&&(u.child.flags|=8192,u.mode&1&&(a===null||Si.current&1?Nr===0&&(Nr=3):kd())),u.updateQueue!==null&&(u.flags|=4),Jr(u),null);case 4:return sa(),Sd(a,u),a===null&&Fs(u.stateNode.containerInfo),Jr(u),null;case 10:return Va(u.type._context),Jr(u),null;case 17:return Es(u.type)&&eh(),Jr(u),null;case 19:if(vi(Si),N=u.memoizedState,N===null)return Jr(u),null;if(x=(u.flags&128)!==0,ee=N.rendering,ee===null)if(x)Bh(N,!1);else{if(Nr!==0||a!==null&&a.flags&128)for(a=u.child;a!==null;){if(ee=oa(a),ee!==null){for(u.flags|=128,Bh(N,!1),x=ee.updateQueue,x!==null&&(u.updateQueue=x,u.flags|=4),u.subtreeFlags=0,x=p,p=u.child;p!==null;)N=p,a=x,N.flags&=14680066,ee=N.alternate,ee===null?(N.childLanes=0,N.lanes=a,N.child=null,N.subtreeFlags=0,N.memoizedProps=null,N.memoizedState=null,N.updateQueue=null,N.dependencies=null,N.stateNode=null):(N.childLanes=ee.childLanes,N.lanes=ee.lanes,N.child=ee.child,N.subtreeFlags=0,N.deletions=null,N.memoizedProps=ee.memoizedProps,N.memoizedState=ee.memoizedState,N.updateQueue=ee.updateQueue,N.type=ee.type,a=ee.dependencies,N.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),p=p.sibling;return bi(Si,Si.current&1|2),u.child}a=a.sibling}N.tail!==null&&Te()>Fu&&(u.flags|=128,x=!0,Bh(N,!1),u.lanes=4194304)}else{if(!x)if(a=oa(ee),a!==null){if(u.flags|=128,x=!0,p=a.updateQueue,p!==null&&(u.updateQueue=p,u.flags|=4),Bh(N,!0),N.tail===null&&N.tailMode==="hidden"&&!ee.alternate&&!Yn)return Jr(u),null}else 2*Te()-N.renderingStartTime>Fu&&p!==1073741824&&(u.flags|=128,x=!0,Bh(N,!1),u.lanes=4194304);N.isBackwards?(ee.sibling=u.child,u.child=ee):(p=N.last,p!==null?p.sibling=ee:u.child=ee,N.last=ee)}return N.tail!==null?(u=N.tail,N.rendering=u,N.tail=u.sibling,N.renderingStartTime=Te(),u.sibling=null,p=Si.current,bi(Si,x?p&1|2:p&1),u):(Jr(u),null);case 22:case 23:return Ld(),x=u.memoizedState!==null,a!==null&&a.memoizedState!==null!==x&&(u.flags|=8192),x&&u.mode&1?Bo&1073741824&&(Jr(u),u.subtreeFlags&6&&(u.flags|=8192)):Jr(u),null;case 24:return null;case 25:return null}throw Error(t(156,u.tag))}function Wm(a,u){switch(Ro(u),u.tag){case 1:return Es(u.type)&&eh(),a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 3:return sa(),vi(Ss),vi(Xr),_c(),a=u.flags,a&65536&&!(a&128)?(u.flags=a&-65537|128,u):null;case 5:return gc(u),null;case 13:if(vi(Si),a=u.memoizedState,a!==null&&a.dehydrated!==null){if(u.alternate===null)throw Error(t(340));Ts()}return a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 19:return vi(Si),null;case 4:return sa(),null;case 10:return Va(u.type._context),null;case 22:case 23:return Ld(),null;case 24:return null;default:return null}}var Vf=!1,ti=!1,gi=typeof WeakSet=="function"?WeakSet:Set,Ot=null;function ch(a,u){var p=a.ref;if(p!==null)if(typeof p=="function")try{p(null)}catch(x){$i(a,u,x)}else p.current=null}function Mc(a,u,p){try{p()}catch(x){$i(a,u,x)}}var Dp=!1;function jm(a,u){if(ul=gu,a=ut(),Wr(a)){if("selectionStart"in a)var p={start:a.selectionStart,end:a.selectionEnd};else e:{p=(p=a.ownerDocument)&&p.defaultView||window;var x=p.getSelection&&p.getSelection();if(x&&x.rangeCount!==0){p=x.anchorNode;var A=x.anchorOffset,N=x.focusNode;x=x.focusOffset;try{p.nodeType,N.nodeType}catch{p=null;break e}var ee=0,pe=-1,Ce=-1,Ge=0,nt=0,st=a,tt=null;t:for(;;){for(var It;st!==p||A!==0&&st.nodeType!==3||(pe=ee+A),st!==N||x!==0&&st.nodeType!==3||(Ce=ee+x),st.nodeType===3&&(ee+=st.nodeValue.length),(It=st.firstChild)!==null;)tt=st,st=It;for(;;){if(st===a)break t;if(tt===p&&++Ge===A&&(pe=ee),tt===N&&++nt===x&&(Ce=ee),(It=st.nextSibling)!==null)break;st=tt,tt=st.parentNode}st=It}p=pe===-1||Ce===-1?null:{start:pe,end:Ce}}else p=null}p=p||{start:0,end:0}}else p=null;for(To={focusedElem:a,selectionRange:p},gu=!1,Ot=u;Ot!==null;)if(u=Ot,a=u.child,(u.subtreeFlags&1028)!==0&&a!==null)a.return=u,Ot=a;else for(;Ot!==null;){u=Ot;try{var Gt=u.alternate;if(u.flags&1024)switch(u.tag){case 0:case 11:case 15:break;case 1:if(Gt!==null){var qt=Gt.memoizedProps,gr=Gt.memoizedState,Fe=u.stateNode,Pe=Fe.getSnapshotBeforeUpdate(u.elementType===u.type?qt:Oo(u.type,qt),gr);Fe.__reactInternalSnapshotBeforeUpdate=Pe}break;case 3:var Ne=u.stateNode.containerInfo;Ne.nodeType===1?Ne.textContent="":Ne.nodeType===9&&Ne.documentElement&&Ne.removeChild(Ne.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(ct){$i(u,u.return,ct)}if(a=u.sibling,a!==null){a.return=u.return,Ot=a;break}Ot=u.return}return Gt=Dp,Dp=!1,Gt}function Uo(a,u,p){var x=u.updateQueue;if(x=x!==null?x.lastEffect:null,x!==null){var A=x=x.next;do{if((A.tag&a)===a){var N=A.destroy;A.destroy=void 0,N!==void 0&&Mc(u,p,N)}A=A.next}while(A!==x)}}function hh(a,u){if(u=u.updateQueue,u=u!==null?u.lastEffect:null,u!==null){var p=u=u.next;do{if((p.tag&a)===a){var x=p.create;p.destroy=x()}p=p.next}while(p!==u)}}function zh(a){var u=a.ref;if(u!==null){var p=a.stateNode;switch(a.tag){case 5:a=p;break;default:a=p}typeof u=="function"?u(a):u.current=a}}function Lp(a){var u=a.alternate;u!==null&&(a.alternate=null,Lp(u)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(u=a.stateNode,u!==null&&(delete u[eo],delete u[Mo],delete u[cc],delete u[I],delete u[Ns])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function kp(a){return a.tag===5||a.tag===3||a.tag===4}function Fp(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||kp(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Ed(a,u,p){var x=a.tag;if(x===5||x===6)a=a.stateNode,u?p.nodeType===8?p.parentNode.insertBefore(a,u):p.insertBefore(a,u):(p.nodeType===8?(u=p.parentNode,u.insertBefore(a,p)):(u=p,u.appendChild(a)),p=p._reactRootContainer,p!=null||u.onclick!==null||(u.onclick=Jc));else if(x!==4&&(a=a.child,a!==null))for(Ed(a,u,p),a=a.sibling;a!==null;)Ed(a,u,p),a=a.sibling}function Vh(a,u,p){var x=a.tag;if(x===5||x===6)a=a.stateNode,u?p.insertBefore(a,u):p.appendChild(a);else if(x!==4&&(a=a.child,a!==null))for(Vh(a,u,p),a=a.sibling;a!==null;)Vh(a,u,p),a=a.sibling}var Or=null,ja=!1;function fa(a,u,p){for(p=p.child;p!==null;)Gf(a,u,p),p=p.sibling}function Gf(a,u,p){if(gn&&typeof gn.onCommitFiberUnmount=="function")try{gn.onCommitFiberUnmount(Yt,p)}catch{}switch(p.tag){case 5:ti||ch(p,u);case 6:var x=Or,A=ja;Or=null,fa(a,u,p),Or=x,ja=A,Or!==null&&(ja?(a=Or,p=p.stateNode,a.nodeType===8?a.parentNode.removeChild(p):a.removeChild(p)):Or.removeChild(p.stateNode));break;case 18:Or!==null&&(ja?(a=Or,p=p.stateNode,a.nodeType===8?Rh(a.parentNode,p):a.nodeType===1&&Rh(a,p),Qt(a)):Rh(Or,p.stateNode));break;case 4:x=Or,A=ja,Or=p.stateNode.containerInfo,ja=!0,fa(a,u,p),Or=x,ja=A;break;case 0:case 11:case 14:case 15:if(!ti&&(x=p.updateQueue,x!==null&&(x=x.lastEffect,x!==null))){A=x=x.next;do{var N=A,ee=N.destroy;N=N.tag,ee!==void 0&&(N&2||N&4)&&Mc(p,u,ee),A=A.next}while(A!==x)}fa(a,u,p);break;case 1:if(!ti&&(ch(p,u),x=p.stateNode,typeof x.componentWillUnmount=="function"))try{x.props=p.memoizedProps,x.state=p.memoizedState,x.componentWillUnmount()}catch(pe){$i(p,u,pe)}fa(a,u,p);break;case 21:fa(a,u,p);break;case 22:p.mode&1?(ti=(x=ti)||p.memoizedState!==null,fa(a,u,p),ti=x):fa(a,u,p);break;default:fa(a,u,p)}}function yl(a){var u=a.updateQueue;if(u!==null){a.updateQueue=null;var p=a.stateNode;p===null&&(p=a.stateNode=new gi),u.forEach(function(x){var A=Jm.bind(null,a,x);p.has(x)||(p.add(x),x.then(A,A))})}}function Gs(a,u){var p=u.deletions;if(p!==null)for(var x=0;x<p.length;x++){var A=p[x];try{var N=a,ee=u,pe=ee;e:for(;pe!==null;){switch(pe.tag){case 5:Or=pe.stateNode,ja=!1;break e;case 3:Or=pe.stateNode.containerInfo,ja=!0;break e;case 4:Or=pe.stateNode.containerInfo,ja=!0;break e}pe=pe.return}if(Or===null)throw Error(t(160));Gf(N,ee,A),Or=null,ja=!1;var Ce=A.alternate;Ce!==null&&(Ce.return=null),A.return=null}catch(Ge){$i(A,u,Ge)}}if(u.subtreeFlags&12854)for(u=u.child;u!==null;)Hf(u,a),u=u.sibling}function Hf(a,u){var p=a.alternate,x=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Gs(u,a),da(a),x&4){try{Uo(3,a,a.return),hh(3,a)}catch(qt){$i(a,a.return,qt)}try{Uo(5,a,a.return)}catch(qt){$i(a,a.return,qt)}}break;case 1:Gs(u,a),da(a),x&512&&p!==null&&ch(p,p.return);break;case 5:if(Gs(u,a),da(a),x&512&&p!==null&&ch(p,p.return),a.flags&32){var A=a.stateNode;try{fn(A,"")}catch(qt){$i(a,a.return,qt)}}if(x&4&&(A=a.stateNode,A!=null)){var N=a.memoizedProps,ee=p!==null?p.memoizedProps:N,pe=a.type,Ce=a.updateQueue;if(a.updateQueue=null,Ce!==null)try{pe==="input"&&N.type==="radio"&&N.name!=null&&on(A,N),nn(pe,ee);var Ge=nn(pe,N);for(ee=0;ee<Ce.length;ee+=2){var nt=Ce[ee],st=Ce[ee+1];nt==="style"?tn(A,st):nt==="dangerouslySetInnerHTML"?_t(A,st):nt==="children"?fn(A,st):L(A,nt,st,Ge)}switch(pe){case"input":Nt(A,N);break;case"textarea":Ze(A,N);break;case"select":var tt=A._wrapperState.wasMultiple;A._wrapperState.wasMultiple=!!N.multiple;var It=N.value;It!=null?le(A,!!N.multiple,It,!1):tt!==!!N.multiple&&(N.defaultValue!=null?le(A,!!N.multiple,N.defaultValue,!0):le(A,!!N.multiple,N.multiple?[]:"",!1))}A[Mo]=N}catch(qt){$i(a,a.return,qt)}}break;case 6:if(Gs(u,a),da(a),x&4){if(a.stateNode===null)throw Error(t(162));A=a.stateNode,N=a.memoizedProps;try{A.nodeValue=N}catch(qt){$i(a,a.return,qt)}}break;case 3:if(Gs(u,a),da(a),x&4&&p!==null&&p.memoizedState.isDehydrated)try{Qt(u.containerInfo)}catch(qt){$i(a,a.return,qt)}break;case 4:Gs(u,a),da(a);break;case 13:Gs(u,a),da(a),A=a.child,A.flags&8192&&(N=A.memoizedState!==null,A.stateNode.isHidden=N,!N||A.alternate!==null&&A.alternate.memoizedState!==null||(Md=Te())),x&4&&yl(a);break;case 22:if(nt=p!==null&&p.memoizedState!==null,a.mode&1?(ti=(Ge=ti)||nt,Gs(u,a),ti=Ge):Gs(u,a),da(a),x&8192){if(Ge=a.memoizedState!==null,(a.stateNode.isHidden=Ge)&&!nt&&a.mode&1)for(Ot=a,nt=a.child;nt!==null;){for(st=Ot=nt;Ot!==null;){switch(tt=Ot,It=tt.child,tt.tag){case 0:case 11:case 14:case 15:Uo(4,tt,tt.return);break;case 1:ch(tt,tt.return);var Gt=tt.stateNode;if(typeof Gt.componentWillUnmount=="function"){x=tt,p=tt.return;try{u=x,Gt.props=u.memoizedProps,Gt.state=u.memoizedState,Gt.componentWillUnmount()}catch(qt){$i(x,p,qt)}}break;case 5:ch(tt,tt.return);break;case 22:if(tt.memoizedState!==null){ao(st);continue}}It!==null?(It.return=tt,Ot=It):ao(st)}nt=nt.sibling}e:for(nt=null,st=a;;){if(st.tag===5){if(nt===null){nt=st;try{A=st.stateNode,Ge?(N=A.style,typeof N.setProperty=="function"?N.setProperty("display","none","important"):N.display="none"):(pe=st.stateNode,Ce=st.memoizedProps.style,ee=Ce!=null&&Ce.hasOwnProperty("display")?Ce.display:null,pe.style.display=jt("display",ee))}catch(qt){$i(a,a.return,qt)}}}else if(st.tag===6){if(nt===null)try{st.stateNode.nodeValue=Ge?"":st.memoizedProps}catch(qt){$i(a,a.return,qt)}}else if((st.tag!==22&&st.tag!==23||st.memoizedState===null||st===a)&&st.child!==null){st.child.return=st,st=st.child;continue}if(st===a)break e;for(;st.sibling===null;){if(st.return===null||st.return===a)break e;nt===st&&(nt=null),st=st.return}nt===st&&(nt=null),st.sibling.return=st.return,st=st.sibling}}break;case 19:Gs(u,a),da(a),x&4&&yl(a);break;case 21:break;default:Gs(u,a),da(a)}}function da(a){var u=a.flags;if(u&2){try{e:{for(var p=a.return;p!==null;){if(kp(p)){var x=p;break e}p=p.return}throw Error(t(160))}switch(x.tag){case 5:var A=x.stateNode;x.flags&32&&(fn(A,""),x.flags&=-33);var N=Fp(a);Vh(a,N,A);break;case 3:case 4:var ee=x.stateNode.containerInfo,pe=Fp(a);Ed(a,pe,ee);break;default:throw Error(t(161))}}catch(Ce){$i(a,a.return,Ce)}a.flags&=-3}u&4096&&(a.flags&=-4097)}function Ac(a,u,p){Ot=a,Wf(a)}function Wf(a,u,p){for(var x=(a.mode&1)!==0;Ot!==null;){var A=Ot,N=A.child;if(A.tag===22&&x){var ee=A.memoizedState!==null||Vf;if(!ee){var pe=A.alternate,Ce=pe!==null&&pe.memoizedState!==null||ti;pe=Vf;var Ge=ti;if(Vf=ee,(ti=Ce)&&!Ge)for(Ot=A;Ot!==null;)ee=Ot,Ce=ee.child,ee.tag===22&&ee.memoizedState!==null?Op(A):Ce!==null?(Ce.return=ee,Ot=Ce):Op(A);for(;N!==null;)Ot=N,Wf(N),N=N.sibling;Ot=A,Vf=pe,ti=Ge}wr(a)}else A.subtreeFlags&8772&&N!==null?(N.return=A,Ot=N):wr(a)}}function wr(a){for(;Ot!==null;){var u=Ot;if(u.flags&8772){var p=u.alternate;try{if(u.flags&8772)switch(u.tag){case 0:case 11:case 15:ti||hh(5,u);break;case 1:var x=u.stateNode;if(u.flags&4&&!ti)if(p===null)x.componentDidMount();else{var A=u.elementType===u.type?p.memoizedProps:Oo(u.type,p.memoizedProps);x.componentDidUpdate(A,p.memoizedState,x.__reactInternalSnapshotBeforeUpdate)}var N=u.updateQueue;N!==null&&rh(u,N,x);break;case 3:var ee=u.updateQueue;if(ee!==null){if(p=null,u.child!==null)switch(u.child.tag){case 5:p=u.child.stateNode;break;case 1:p=u.child.stateNode}rh(u,ee,p)}break;case 5:var pe=u.stateNode;if(p===null&&u.flags&4){p=pe;var Ce=u.memoizedProps;switch(u.type){case"button":case"input":case"select":case"textarea":Ce.autoFocus&&p.focus();break;case"img":Ce.src&&(p.src=Ce.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(u.memoizedState===null){var Ge=u.alternate;if(Ge!==null){var nt=Ge.memoizedState;if(nt!==null){var st=nt.dehydrated;st!==null&&Qt(st)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}ti||u.flags&512&&zh(u)}catch(tt){$i(u,u.return,tt)}}if(u===a){Ot=null;break}if(p=u.sibling,p!==null){p.return=u.return,Ot=p;break}Ot=u.return}}function ao(a){for(;Ot!==null;){var u=Ot;if(u===a){Ot=null;break}var p=u.sibling;if(p!==null){p.return=u.return,Ot=p;break}Ot=u.return}}function Op(a){for(;Ot!==null;){var u=Ot;try{switch(u.tag){case 0:case 11:case 15:var p=u.return;try{hh(4,u)}catch(Ce){$i(u,p,Ce)}break;case 1:var x=u.stateNode;if(typeof x.componentDidMount=="function"){var A=u.return;try{x.componentDidMount()}catch(Ce){$i(u,A,Ce)}}var N=u.return;try{zh(u)}catch(Ce){$i(u,N,Ce)}break;case 5:var ee=u.return;try{zh(u)}catch(Ce){$i(u,ee,Ce)}}}catch(Ce){$i(u,u.return,Ce)}if(u===a){Ot=null;break}var pe=u.sibling;if(pe!==null){pe.return=u.return,Ot=pe;break}Ot=u.return}}var Cd=Math.ceil,jf=B.ReactCurrentDispatcher,Td=B.ReactCurrentOwner,pa=B.ReactCurrentBatchConfig,Kn=0,Qr=null,Sr=null,ls=0,Bo=0,fh=lr(0),Nr=0,Gh=null,eu=0,dh=0,Hh=0,Wh=null,lo=null,Md=0,Fu=1/0,tu=null,Xf=!1,Ad=null,Ou=null,qf=!1,Nu=null,Oi=0,jh=0,Pd=null,$f=-1,ph=0;function Hs(){return Kn&6?Te():$f!==-1?$f:$f=Te()}function Uu(a){return a.mode&1?Kn&2&&ls!==0?ls&-ls:Dh.transition!==null?(ph===0&&(ph=or()),ph):(a=an,a!==0||(a=window.event,a=a===void 0?16:tc(a.type)),a):1}function Xa(a,u,p,x){if(50<jh)throw jh=0,Pd=null,Error(t(185));Nn(a,p,x),(!(Kn&2)||a!==Qr)&&(a===Qr&&(!(Kn&2)&&(dh|=p),Nr===4&&Bu(a,ls)),uo(a,x),p===1&&Kn===0&&!(u.mode&1)&&(Fu=Te()+500,th&&fl()))}function uo(a,u){var p=a.callbackNode;Ks(a,u);var x=sr(a,a===Qr?ls:0);if(x===0)p!==null&&De(p),a.callbackNode=null,a.callbackPriority=0;else if(u=x&-x,a.callbackPriority!==u){if(p!=null&&De(p),u===1)a.tag===0?Us(Np.bind(null,a)):Sf(Np.bind(null,a)),Xl(function(){!(Kn&6)&&fl()}),p=null;else{switch(fr(x)){case 1:p=dt;break;case 4:p=Rt;break;case 16:p=ft;break;case 536870912:p=rn;break;default:p=ft}p=Wp(p,mh.bind(null,a))}a.callbackPriority=u,a.callbackNode=p}}function mh(a,u){if($f=-1,ph=0,Kn&6)throw Error(t(327));var p=a.callbackNode;if(vh()&&a.callbackNode!==p)return null;var x=sr(a,a===Qr?ls:0);if(x===0)return null;if(x&30||x&a.expiredLanes||u)u=Yf(a,x);else{u=x;var A=Kn;Kn|=2;var N=Bp();(Qr!==a||ls!==u)&&(tu=null,Fu=Te()+500,Rc(a,u));do try{$m();break}catch(pe){Up(a,pe)}while(!0);os(),jf.current=N,Kn=A,Sr!==null?u=0:(Qr=null,ls=0,u=Nr)}if(u!==0){if(u===2&&(A=cn(a),A!==0&&(x=A,u=Rd(a,A))),u===1)throw p=Gh,Rc(a,0),Bu(a,x),uo(a,Te()),p;if(u===6)Bu(a,x);else{if(A=a.current.alternate,!(x&30)&&!Xm(A)&&(u=Yf(a,x),u===2&&(N=cn(a),N!==0&&(x=N,u=Rd(a,N))),u===1))throw p=Gh,Rc(a,0),Bu(a,x),uo(a,Te()),p;switch(a.finishedWork=A,a.finishedLanes=x,u){case 0:case 1:throw Error(t(345));case 2:Ic(a,lo,tu);break;case 3:if(Bu(a,x),(x&130023424)===x&&(u=Md+500-Te(),10<u)){if(sr(a,0)!==0)break;if(A=a.suspendedLanes,(A&x)!==x){Hs(),a.pingedLanes|=a.suspendedLanes&A;break}a.timeoutHandle=ss(Ic.bind(null,a,lo,tu),u);break}Ic(a,lo,tu);break;case 4:if(Bu(a,x),(x&4194240)===x)break;for(u=a.eventTimes,A=-1;0<x;){var ee=31-Fn(x);N=1<<ee,ee=u[ee],ee>A&&(A=ee),x&=~N}if(x=A,x=Te()-x,x=(120>x?120:480>x?480:1080>x?1080:1920>x?1920:3e3>x?3e3:4320>x?4320:1960*Cd(x/1960))-x,10<x){a.timeoutHandle=ss(Ic.bind(null,a,lo,tu),x);break}Ic(a,lo,tu);break;case 5:Ic(a,lo,tu);break;default:throw Error(t(329))}}}return uo(a,Te()),a.callbackNode===p?mh.bind(null,a):null}function Rd(a,u){var p=Wh;return a.current.memoizedState.isDehydrated&&(Rc(a,u).flags|=256),a=Yf(a,u),a!==2&&(u=lo,lo=p,u!==null&&Id(u)),a}function Id(a){lo===null?lo=a:lo.push.apply(lo,a)}function Xm(a){for(var u=a;;){if(u.flags&16384){var p=u.updateQueue;if(p!==null&&(p=p.stores,p!==null))for(var x=0;x<p.length;x++){var A=p[x],N=A.getSnapshot;A=A.value;try{if(!K(N(),A))return!1}catch{return!1}}}if(p=u.child,u.subtreeFlags&16384&&p!==null)p.return=u,u=p;else{if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function Bu(a,u){for(u&=~Hh,u&=~dh,a.suspendedLanes|=u,a.pingedLanes&=~u,a=a.expirationTimes;0<u;){var p=31-Fn(u),x=1<<p;a[p]=-1,u&=~x}}function Np(a){if(Kn&6)throw Error(t(327));vh();var u=sr(a,0);if(!(u&1))return uo(a,Te()),null;var p=Yf(a,u);if(a.tag!==0&&p===2){var x=cn(a);x!==0&&(u=x,p=Rd(a,x))}if(p===1)throw p=Gh,Rc(a,0),Bu(a,u),uo(a,Te()),p;if(p===6)throw Error(t(345));return a.finishedWork=a.current.alternate,a.finishedLanes=u,Ic(a,lo,tu),uo(a,Te()),null}function Dd(a,u){var p=Kn;Kn|=1;try{return a(u)}finally{Kn=p,Kn===0&&(Fu=Te()+500,th&&fl())}}function Pc(a){Nu!==null&&Nu.tag===0&&!(Kn&6)&&vh();var u=Kn;Kn|=1;var p=pa.transition,x=an;try{if(pa.transition=null,an=1,a)return a()}finally{an=x,pa.transition=p,Kn=u,!(Kn&6)&&fl()}}function Ld(){Bo=fh.current,vi(fh)}function Rc(a,u){a.finishedWork=null,a.finishedLanes=0;var p=a.timeoutHandle;if(p!==-1&&(a.timeoutHandle=-1,Os(p)),Sr!==null)for(p=Sr.return;p!==null;){var x=p;switch(Ro(x),x.tag){case 1:x=x.type.childContextTypes,x!=null&&eh();break;case 3:sa(),vi(Ss),vi(Xr),_c();break;case 5:gc(x);break;case 4:sa();break;case 13:vi(Si);break;case 19:vi(Si);break;case 10:Va(x.type._context);break;case 22:case 23:Ld()}p=p.return}if(Qr=a,Sr=a=co(a.current,null),ls=Bo=u,Nr=0,Gh=null,Hh=dh=eu=0,lo=Wh=null,pl!==null){for(u=0;u<pl.length;u++)if(p=pl[u],x=p.interleaved,x!==null){p.interleaved=null;var A=x.next,N=p.pending;if(N!==null){var ee=N.next;N.next=A,x.next=ee}p.pending=x}pl=null}return a}function Up(a,u){do{var p=Sr;try{if(os(),Ru.current=If,gl){for(var x=Fi.memoizedState;x!==null;){var A=x.queue;A!==null&&(A.pending=null),x=x.next}gl=!1}if(aa=0,cr=Vi=Fi=null,yc=!1,Ha=0,Td.current=null,p===null||p.return===null){Nr=1,Gh=u,Sr=null;break}e:{var N=a,ee=p.return,pe=p,Ce=u;if(u=ls,pe.flags|=32768,Ce!==null&&typeof Ce=="object"&&typeof Ce.then=="function"){var Ge=Ce,nt=pe,st=nt.tag;if(!(nt.mode&1)&&(st===0||st===11||st===15)){var tt=nt.alternate;tt?(nt.updateQueue=tt.updateQueue,nt.memoizedState=tt.memoizedState,nt.lanes=tt.lanes):(nt.updateQueue=null,nt.memoizedState=null)}var It=Ap(ee);if(It!==null){It.flags&=-257,kf(It,ee,pe,N,u),It.mode&1&&Lu(N,Ge,u),u=It,Ce=Ge;var Gt=u.updateQueue;if(Gt===null){var qt=new Set;qt.add(Ce),u.updateQueue=qt}else Gt.add(Ce);break e}else{if(!(u&1)){Lu(N,Ge,u),kd();break e}Ce=Error(t(426))}}else if(Yn&&pe.mode&1){var gr=Ap(ee);if(gr!==null){!(gr.flags&65536)&&(gr.flags|=256),kf(gr,ee,pe,N,u),kr(Iu(Ce,pe));break e}}N=Ce=Iu(Ce,pe),Nr!==4&&(Nr=2),Wh===null?Wh=[N]:Wh.push(N),N=ee;do{switch(N.tag){case 3:N.flags|=65536,u&=-u,N.lanes|=u;var Fe=Du(N,Ce,u);kh(N,Fe);break e;case 1:pe=Ce;var Pe=N.type,Ne=N.stateNode;if(!(N.flags&128)&&(typeof Pe.getDerivedStateFromError=="function"||Ne!==null&&typeof Ne.componentDidCatch=="function"&&(Ou===null||!Ou.has(Ne)))){N.flags|=65536,u&=-u,N.lanes|=u;var ct=lh(N,pe,u);kh(N,ct);break e}}N=N.return}while(N!==null)}Vp(p)}catch(Jt){u=Jt,Sr===p&&p!==null&&(Sr=p=p.return);continue}break}while(!0)}function Bp(){var a=jf.current;return jf.current=If,a===null?If:a}function kd(){(Nr===0||Nr===3||Nr===2)&&(Nr=4),Qr===null||!(eu&268435455)&&!(dh&268435455)||Bu(Qr,ls)}function Yf(a,u){var p=Kn;Kn|=2;var x=Bp();(Qr!==a||ls!==u)&&(tu=null,Rc(a,u));do try{qm();break}catch(A){Up(a,A)}while(!0);if(os(),Kn=p,jf.current=x,Sr!==null)throw Error(t(261));return Qr=null,ls=0,Nr}function qm(){for(;Sr!==null;)zp(Sr)}function $m(){for(;Sr!==null&&!Ue();)zp(Sr)}function zp(a){var u=Hp(a.alternate,a,Bo);a.memoizedProps=a.pendingProps,u===null?Vp(a):Sr=u,Td.current=null}function Vp(a){var u=a;do{var p=u.alternate;if(a=u.return,u.flags&32768){if(p=Wm(p,u),p!==null){p.flags&=32767,Sr=p;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Nr=6,Sr=null;return}}else if(p=Hm(p,u,Bo),p!==null){Sr=p;return}if(u=u.sibling,u!==null){Sr=u;return}Sr=u=a}while(u!==null);Nr===0&&(Nr=5)}function Ic(a,u,p){var x=an,A=pa.transition;try{pa.transition=null,an=1,Ym(a,u,p,x)}finally{pa.transition=A,an=x}return null}function Ym(a,u,p,x){do vh();while(Nu!==null);if(Kn&6)throw Error(t(327));p=a.finishedWork;var A=a.finishedLanes;if(p===null)return null;if(a.finishedWork=null,a.finishedLanes=0,p===a.current)throw Error(t(177));a.callbackNode=null,a.callbackPriority=0;var N=p.lanes|p.childLanes;if(ar(a,N),a===Qr&&(Sr=Qr=null,ls=0),!(p.subtreeFlags&2064)&&!(p.flags&2064)||qf||(qf=!0,Wp(ft,function(){return vh(),null})),N=(p.flags&15990)!==0,p.subtreeFlags&15990||N){N=pa.transition,pa.transition=null;var ee=an;an=1;var pe=Kn;Kn|=4,Td.current=null,jm(a,p),Hf(p,a),Mh(To),gu=!!ul,To=ul=null,a.current=p,Ac(p),Ve(),Kn=pe,an=ee,pa.transition=N}else a.current=p;if(qf&&(qf=!1,Nu=a,Oi=A),N=a.pendingLanes,N===0&&(Ou=null),kn(p.stateNode),uo(a,Te()),u!==null)for(x=a.onRecoverableError,p=0;p<u.length;p++)A=u[p],x(A.value,{componentStack:A.stack,digest:A.digest});if(Xf)throw Xf=!1,a=Ad,Ad=null,a;return Oi&1&&a.tag!==0&&vh(),N=a.pendingLanes,N&1?a===Pd?jh++:(jh=0,Pd=a):jh=0,fl(),null}function vh(){if(Nu!==null){var a=fr(Oi),u=pa.transition,p=an;try{if(pa.transition=null,an=16>a?16:a,Nu===null)var x=!1;else{if(a=Nu,Nu=null,Oi=0,Kn&6)throw Error(t(331));var A=Kn;for(Kn|=4,Ot=a.current;Ot!==null;){var N=Ot,ee=N.child;if(Ot.flags&16){var pe=N.deletions;if(pe!==null){for(var Ce=0;Ce<pe.length;Ce++){var Ge=pe[Ce];for(Ot=Ge;Ot!==null;){var nt=Ot;switch(nt.tag){case 0:case 11:case 15:Uo(8,nt,N)}var st=nt.child;if(st!==null)st.return=nt,Ot=st;else for(;Ot!==null;){nt=Ot;var tt=nt.sibling,It=nt.return;if(Lp(nt),nt===Ge){Ot=null;break}if(tt!==null){tt.return=It,Ot=tt;break}Ot=It}}}var Gt=N.alternate;if(Gt!==null){var qt=Gt.child;if(qt!==null){Gt.child=null;do{var gr=qt.sibling;qt.sibling=null,qt=gr}while(qt!==null)}}Ot=N}}if(N.subtreeFlags&2064&&ee!==null)ee.return=N,Ot=ee;else e:for(;Ot!==null;){if(N=Ot,N.flags&2048)switch(N.tag){case 0:case 11:case 15:Uo(9,N,N.return)}var Fe=N.sibling;if(Fe!==null){Fe.return=N.return,Ot=Fe;break e}Ot=N.return}}var Pe=a.current;for(Ot=Pe;Ot!==null;){ee=Ot;var Ne=ee.child;if(ee.subtreeFlags&2064&&Ne!==null)Ne.return=ee,Ot=Ne;else e:for(ee=Pe;Ot!==null;){if(pe=Ot,pe.flags&2048)try{switch(pe.tag){case 0:case 11:case 15:hh(9,pe)}}catch(Jt){$i(pe,pe.return,Jt)}if(pe===ee){Ot=null;break e}var ct=pe.sibling;if(ct!==null){ct.return=pe.return,Ot=ct;break e}Ot=pe.return}}if(Kn=A,fl(),gn&&typeof gn.onPostCommitFiberRoot=="function")try{gn.onPostCommitFiberRoot(Yt,a)}catch{}x=!0}return x}finally{an=p,pa.transition=u}}return!1}function gh(a,u,p){u=Iu(p,u),u=Du(a,u,1),a=$r(a,u,1),u=Hs(),a!==null&&(Nn(a,1,u),uo(a,u))}function $i(a,u,p){if(a.tag===3)gh(a,a,p);else for(;u!==null;){if(u.tag===3){gh(u,a,p);break}else if(u.tag===1){var x=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Ou===null||!Ou.has(x))){a=Iu(p,a),a=lh(u,a,1),u=$r(u,a,1),a=Hs(),u!==null&&(Nn(u,1,a),uo(u,a));break}}u=u.return}}function Km(a,u,p){var x=a.pingCache;x!==null&&x.delete(u),u=Hs(),a.pingedLanes|=a.suspendedLanes&p,Qr===a&&(ls&p)===p&&(Nr===4||Nr===3&&(ls&130023424)===ls&&500>Te()-Md?Rc(a,0):Hh|=p),uo(a,u)}function Gp(a,u){u===0&&(a.mode&1?(u=Cn,Cn<<=1,!(Cn&130023424)&&(Cn=4194304)):u=1);var p=Hs();a=Ga(a,u),a!==null&&(Nn(a,u,p),uo(a,p))}function Zm(a){var u=a.memoizedState,p=0;u!==null&&(p=u.retryLane),Gp(a,p)}function Jm(a,u){var p=0;switch(a.tag){case 13:var x=a.stateNode,A=a.memoizedState;A!==null&&(p=A.retryLane);break;case 19:x=a.stateNode;break;default:throw Error(t(314))}x!==null&&x.delete(u),Gp(a,p)}var Hp;Hp=function(a,u,p){if(a!==null)if(a.memoizedProps!==u.pendingProps||Ss.current)Ps=!0;else{if(!(a.lanes&p)&&!(u.flags&128))return Ps=!1,wd(a,u,p);Ps=!!(a.flags&131072)}else Ps=!1,Yn&&u.flags&1048576&&Ef(u,Po,u.index);switch(u.lanes=0,u.tag){case 2:var x=u.type;Bf(a,u),a=u.pendingProps;var A=Cu(u,Xr.current);ia(u,p),A=ro(null,u,x,a,A,p);var N=bc();return u.flags|=1,typeof A=="object"&&A!==null&&typeof A.render=="function"&&A.$$typeof===void 0?(u.tag=1,u.memoizedState=null,u.updateQueue=null,Es(x)?(N=!0,ur(u)):N=!1,u.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,pc(u),A.updater=Df,u.stateNode=A,A._reactInternals=u,_d(u,x,a,p),u=xd(null,u,x,!0,N,p)):(u.tag=0,Yn&&N&&$l(u),Fr(null,u,A,p),u=u.child),u;case 16:x=u.elementType;e:{switch(Bf(a,u),a=u.pendingProps,A=x._init,x=A(x._payload),u.type=x,A=u.tag=ev(x),a=Oo(x,a),A){case 0:u=bd(null,u,x,a,p);break e;case 1:u=Uf(null,u,x,a,p);break e;case 11:u=Pp(null,u,x,a,p);break e;case 14:u=Ff(null,u,x,Oo(x.type,a),p);break e}throw Error(t(306,x,""))}return u;case 0:return x=u.type,A=u.pendingProps,A=u.elementType===x?A:Oo(x,A),bd(a,u,x,A,p);case 1:return x=u.type,A=u.pendingProps,A=u.elementType===x?A:Oo(x,A),Uf(a,u,x,A,p);case 3:e:{if(Rp(u),a===null)throw Error(t(387));x=u.pendingProps,N=u.memoizedState,A=N.element,Tf(a,u),vl(u,x,null,p);var ee=u.memoizedState;if(x=ee.element,N.isDehydrated)if(N={element:x,isDehydrated:!1,cache:ee.cache,pendingSuspenseBoundaries:ee.pendingSuspenseBoundaries,transitions:ee.transitions},u.updateQueue.baseState=N,u.memoizedState=N,u.flags&256){A=Iu(Error(t(423)),u),u=Zr(a,u,x,p,A);break e}else if(x!==A){A=Iu(Error(t(424)),u),u=Zr(a,u,x,p,A);break e}else for(Cs=cl(u.stateNode.containerInfo.firstChild),wi=u,Yn=!0,Io=null,p=Au(u,null,x,p),u.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling;else{if(Ts(),x===A){u=No(a,u,p);break e}Fr(a,u,x,p)}u=u.child}return u;case 5:return io(u),a===null&&Ri(u),x=u.type,A=u.pendingProps,N=a!==null?a.memoizedProps:null,ee=A.children,jl(x,A)?ee=null:N!==null&&jl(x,N)&&(u.flags|=32),Nf(a,u),Fr(a,u,ee,p),u.child;case 6:return a===null&&Ri(u),null;case 13:return uh(a,u,p);case 4:return Fh(u,u.stateNode.containerInfo),x=u.pendingProps,a===null?u.child=An(u,null,x,p):Fr(a,u,x,p),u.child;case 11:return x=u.type,A=u.pendingProps,A=u.elementType===x?A:Oo(x,A),Pp(a,u,x,A,p);case 7:return Fr(a,u,u.pendingProps,p),u.child;case 8:return Fr(a,u,u.pendingProps.children,p),u.child;case 12:return Fr(a,u,u.pendingProps.children,p),u.child;case 10:e:{if(x=u.type._context,A=u.pendingProps,N=u.memoizedProps,ee=A.value,bi(Pu,x._currentValue),x._currentValue=ee,N!==null)if(K(N.value,ee)){if(N.children===A.children&&!Ss.current){u=No(a,u,p);break e}}else for(N=u.child,N!==null&&(N.return=u);N!==null;){var pe=N.dependencies;if(pe!==null){ee=N.child;for(var Ce=pe.firstContext;Ce!==null;){if(Ce.context===x){if(N.tag===1){Ce=Lo(-1,p&-p),Ce.tag=2;var Ge=N.updateQueue;if(Ge!==null){Ge=Ge.shared;var nt=Ge.pending;nt===null?Ce.next=Ce:(Ce.next=nt.next,nt.next=Ce),Ge.pending=Ce}}N.lanes|=p,Ce=N.alternate,Ce!==null&&(Ce.lanes|=p),Hn(N.return,p,u),pe.lanes|=p;break}Ce=Ce.next}}else if(N.tag===10)ee=N.type===u.type?null:N.child;else if(N.tag===18){if(ee=N.return,ee===null)throw Error(t(341));ee.lanes|=p,pe=ee.alternate,pe!==null&&(pe.lanes|=p),Hn(ee,p,u),ee=N.sibling}else ee=N.child;if(ee!==null)ee.return=N;else for(ee=N;ee!==null;){if(ee===u){ee=null;break}if(N=ee.sibling,N!==null){N.return=ee.return,ee=N;break}ee=ee.return}N=ee}Fr(a,u,A.children,p),u=u.child}return u;case 9:return A=u.type,x=u.pendingProps.children,ia(u,p),A=Ms(A),x=x(A),u.flags|=1,Fr(a,u,x,p),u.child;case 14:return x=u.type,A=Oo(x,u.pendingProps),A=Oo(x.type,A),Ff(a,u,x,A,p);case 15:return Kr(a,u,u.type,u.pendingProps,p);case 17:return x=u.type,A=u.pendingProps,A=u.elementType===x?A:Oo(x,A),Bf(a,u),u.tag=1,Es(x)?(a=!0,ur(u)):a=!1,ia(u,p),ha(u,x,A),_d(u,x,A,p),xd(null,u,x,!0,a,p);case 19:return oo(a,u,p);case 22:return Of(a,u,p)}throw Error(t(156,u.tag))};function Wp(a,u){return oe(a,u)}function Qm(a,u,p,x){this.tag=a,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ma(a,u,p,x){return new Qm(a,u,p,x)}function Xh(a){return a=a.prototype,!(!a||!a.isReactComponent)}function ev(a){if(typeof a=="function")return Xh(a)?1:0;if(a!=null){if(a=a.$$typeof,a===ce)return 11;if(a===Ae)return 14}return 2}function co(a,u){var p=a.alternate;return p===null?(p=ma(a.tag,u,a.key,a.mode),p.elementType=a.elementType,p.type=a.type,p.stateNode=a.stateNode,p.alternate=a,a.alternate=p):(p.pendingProps=u,p.type=a.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=a.flags&14680064,p.childLanes=a.childLanes,p.lanes=a.lanes,p.child=a.child,p.memoizedProps=a.memoizedProps,p.memoizedState=a.memoizedState,p.updateQueue=a.updateQueue,u=a.dependencies,p.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},p.sibling=a.sibling,p.index=a.index,p.ref=a.ref,p}function Kf(a,u,p,x,A,N){var ee=2;if(x=a,typeof a=="function")Xh(a)&&(ee=1);else if(typeof a=="string")ee=5;else e:switch(a){case Q:return Dc(p.children,A,N,u);case te:ee=8,A|=8;break;case V:return a=ma(12,p,u,A|2),a.elementType=V,a.lanes=N,a;case he:return a=ma(13,p,u,A),a.elementType=he,a.lanes=N,a;case ge:return a=ma(19,p,u,A),a.elementType=ge,a.lanes=N,a;case Ie:return Zf(p,A,N,u);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case H:ee=10;break e;case J:ee=9;break e;case ce:ee=11;break e;case Ae:ee=14;break e;case me:ee=16,x=null;break e}throw Error(t(130,a==null?a:typeof a,""))}return u=ma(ee,p,u,A),u.elementType=a,u.type=x,u.lanes=N,u}function Dc(a,u,p,x){return a=ma(7,a,x,u),a.lanes=p,a}function Zf(a,u,p,x){return a=ma(22,a,x,u),a.elementType=Ie,a.lanes=p,a.stateNode={isHidden:!1},a}function Fd(a,u,p){return a=ma(6,a,null,u),a.lanes=p,a}function Od(a,u,p){return u=ma(4,a.children!==null?a.children:[],a.key,u),u.lanes=p,u.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},u}function tv(a,u,p,x,A){this.tag=u,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fi(0),this.expirationTimes=fi(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fi(0),this.identifierPrefix=x,this.onRecoverableError=A,this.mutableSourceEagerHydrationData=null}function Nd(a,u,p,x,A,N,ee,pe,Ce){return a=new tv(a,u,p,pe,Ce),u===1?(u=1,N===!0&&(u|=8)):u=0,N=ma(3,null,null,u),a.current=N,N.stateNode=a,N.memoizedState={element:x,isDehydrated:p,cache:null,transitions:null,pendingSuspenseBoundaries:null},pc(N),a}function nv(a,u,p){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:X,key:x==null?null:""+x,children:a,containerInfo:u,implementation:p}}function jp(a){if(!a)return hl;a=a._reactInternals;e:{if(ds(a)!==a||a.tag!==1)throw Error(t(170));var u=a;do{switch(u.tag){case 3:u=u.stateNode.context;break e;case 1:if(Es(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break e}}u=u.return}while(u!==null);throw Error(t(171))}if(a.tag===1){var p=a.type;if(Es(p))return xf(a,p,u)}return u}function Xp(a,u,p,x,A,N,ee,pe,Ce){return a=Nd(p,x,!0,a,A,N,ee,pe,Ce),a.context=jp(null),p=a.current,x=Hs(),A=Uu(p),N=Lo(x,A),N.callback=u??null,$r(p,N,A),a.current.lanes=A,Nn(a,A,x),uo(a,x),a}function Jf(a,u,p,x){var A=u.current,N=Hs(),ee=Uu(A);return p=jp(p),u.context===null?u.context=p:u.pendingContext=p,u=Lo(N,ee),u.payload={element:a},x=x===void 0?null:x,x!==null&&(u.callback=x),a=$r(A,u,ee),a!==null&&(Xa(a,A,ee,N),ih(a,A,ee)),ee}function Qf(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function qp(a,u){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var p=a.retryLane;a.retryLane=p!==0&&p<u?p:u}}function Ud(a,u){qp(a,u),(a=a.alternate)&&qp(a,u)}function iv(){return null}var $p=typeof reportError=="function"?reportError:function(a){console.error(a)};function qh(a){this._internalRoot=a}_h.prototype.render=qh.prototype.render=function(a){var u=this._internalRoot;if(u===null)throw Error(t(409));Jf(a,u,null,null)},_h.prototype.unmount=qh.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var u=a.containerInfo;Pc(function(){Jf(null,a,null,null)}),u[vr]=null}};function _h(a){this._internalRoot=a}_h.prototype.unstable_scheduleHydration=function(a){if(a){var u=go();a={blockedOn:null,target:a,priority:u};for(var p=0;p<qo.length&&u!==0&&u<qo[p].priority;p++);qo.splice(p,0,a),p===0&&Wc(a)}};function Bd(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function ed(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Yp(){}function rv(a,u,p,x,A){if(A){if(typeof x=="function"){var N=x;x=function(){var Ge=Qf(ee);N.call(Ge)}}var ee=Xp(u,x,a,0,null,!1,!1,"",Yp);return a._reactRootContainer=ee,a[vr]=ee.current,Fs(a.nodeType===8?a.parentNode:a),Pc(),ee}for(;A=a.lastChild;)a.removeChild(A);if(typeof x=="function"){var pe=x;x=function(){var Ge=Qf(Ce);pe.call(Ge)}}var Ce=Nd(a,0,!1,null,null,!1,!1,"",Yp);return a._reactRootContainer=Ce,a[vr]=Ce.current,Fs(a.nodeType===8?a.parentNode:a),Pc(function(){Jf(u,Ce,p,x)}),Ce}function bl(a,u,p,x,A){var N=p._reactRootContainer;if(N){var ee=N;if(typeof A=="function"){var pe=A;A=function(){var Ce=Qf(ee);pe.call(Ce)}}Jf(u,ee,a,A)}else ee=rv(p,u,a,A,x);return Qf(ee)}Wo=function(a){switch(a.tag){case 3:var u=a.stateNode;if(u.current.memoizedState.isDehydrated){var p=Zi(u.pendingLanes);p!==0&&(Tr(u,p|1),uo(u,Te()),!(Kn&6)&&(Fu=Te()+500,fl()))}break;case 13:Pc(function(){var x=Ga(a,1);if(x!==null){var A=Hs();Xa(x,a,1,A)}}),Ud(a,1)}},wa=function(a){if(a.tag===13){var u=Ga(a,134217728);if(u!==null){var p=Hs();Xa(u,a,134217728,p)}Ud(a,134217728)}},Il=function(a){if(a.tag===13){var u=Uu(a),p=Ga(a,u);if(p!==null){var x=Hs();Xa(p,a,u,x)}Ud(a,u)}},go=function(){return an},Dl=function(a,u){var p=an;try{return an=a,u()}finally{an=p}},gt=function(a,u,p){switch(u){case"input":if(Nt(a,p),u=p.name,p.type==="radio"&&u!=null){for(p=a;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll("input[name="+JSON.stringify(""+u)+'][type="radio"]'),u=0;u<p.length;u++){var x=p[u];if(x!==a&&x.form===a.form){var A=Qc(x);if(!A)throw Error(t(90));zt(x),Nt(x,A)}}}break;case"textarea":Ze(a,p);break;case"select":u=p.value,u!=null&&le(a,!!p.multiple,u,!1)}},Bn=Dd,Ti=Pc;var sv={usingClientEntryPoint:!1,Events:[mi,wt,Qc,Et,mn,Dd]},$h={findFiberByHostInstance:ws,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ov={bundleType:$h.bundleType,version:$h.version,rendererPackageName:$h.rendererPackageName,rendererConfig:$h.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:B.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Rl(a),a===null?null:a.stateNode},findFiberByHostInstance:$h.findFiberByHostInstance||iv,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var td=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!td.isDisabled&&td.supportsFiber)try{Yt=td.inject(ov),gn=td}catch{}}return xl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sv,xl.createPortal=function(a,u){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bd(u))throw Error(t(200));return nv(a,u,null,p)},xl.createRoot=function(a,u){if(!Bd(a))throw Error(t(299));var p=!1,x="",A=$p;return u!=null&&(u.unstable_strictMode===!0&&(p=!0),u.identifierPrefix!==void 0&&(x=u.identifierPrefix),u.onRecoverableError!==void 0&&(A=u.onRecoverableError)),u=Nd(a,1,!1,null,null,p,!1,x,A),a[vr]=u.current,Fs(a.nodeType===8?a.parentNode:a),new qh(u)},xl.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var u=a._reactInternals;if(u===void 0)throw typeof a.render=="function"?Error(t(188)):(a=Object.keys(a).join(","),Error(t(268,a)));return a=Rl(u),a=a===null?null:a.stateNode,a},xl.flushSync=function(a){return Pc(a)},xl.hydrate=function(a,u,p){if(!ed(u))throw Error(t(200));return bl(null,a,u,!0,p)},xl.hydrateRoot=function(a,u,p){if(!Bd(a))throw Error(t(405));var x=p!=null&&p.hydratedSources||null,A=!1,N="",ee=$p;if(p!=null&&(p.unstable_strictMode===!0&&(A=!0),p.identifierPrefix!==void 0&&(N=p.identifierPrefix),p.onRecoverableError!==void 0&&(ee=p.onRecoverableError)),u=Xp(u,null,a,1,p??null,A,!1,N,ee),a[vr]=u.current,Fs(a),x)for(a=0;a<x.length;a++)p=x[a],A=p._getVersion,A=A(p._source),u.mutableSourceEagerHydrationData==null?u.mutableSourceEagerHydrationData=[p,A]:u.mutableSourceEagerHydrationData.push(p,A);return new _h(u)},xl.render=function(a,u,p){if(!ed(u))throw Error(t(200));return bl(null,a,u,!1,p)},xl.unmountComponentAtNode=function(a){if(!ed(a))throw Error(t(40));return a._reactRootContainer?(Pc(function(){bl(null,null,a,!1,function(){a._reactRootContainer=null,a[vr]=null})}),!0):!1},xl.unstable_batchedUpdates=Dd,xl.unstable_renderSubtreeIntoContainer=function(a,u,p,x){if(!ed(p))throw Error(t(200));if(a==null||a._reactInternals===void 0)throw Error(t(38));return bl(a,u,p,!1,x)},xl.version="18.3.1-next-f1338f8080-20240426",xl}var Qw;function KM(){if(Qw)return Dy.exports;Qw=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Dy.exports=YM(),Dy.exports}var eS;function ZM(){if(eS)return Tg;eS=1;var r=KM();return Tg.createRoot=r.createRoot,Tg.hydrateRoot=r.hydrateRoot,Tg}var JM=ZM(),ts=hw();const ug=Fm(ts);var Hv={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var QM=Hv.exports,tS;function eA(){return tS||(tS=1,function(r,e){(function(){var t,i="4.17.21",o=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",d="Invalid `variable` option passed into `_.template`",v="__lodash_hash_undefined__",_=500,b="__lodash_placeholder__",w=1,C=2,R=4,z=1,O=2,P=1,M=2,U=4,L=8,B=16,$=32,X=64,Q=128,te=256,V=512,H=30,J="...",ce=800,he=16,ge=1,Ae=2,me=3,Ie=1/0,ae=9007199254740991,ye=17976931348623157e292,de=NaN,ie=4294967295,we=ie-1,ze=ie>>>1,se=[["ary",Q],["bind",P],["bindKey",M],["curry",L],["curryRight",B],["flip",V],["partial",$],["partialRight",X],["rearg",te]],fe="[object Arguments]",Le="[object Array]",Be="[object AsyncFunction]",He="[object Boolean]",et="[object Date]",pt="[object DOMException]",Wt="[object Error]",zt="[object Function]",bn="[object GeneratorFunction]",_e="[object Map]",Ln="[object Number]",on="[object Null]",Nt="[object Object]",Vt="[object Promise]",Mn="[object Proxy]",Dt="[object RegExp]",le="[object Set]",ne="[object String]",Oe="[object Symbol]",Ze="[object Undefined]",Je="[object WeakMap]",Ye="[object WeakSet]",Pt="[object ArrayBuffer]",ht="[object DataView]",_t="[object Float32Array]",fn="[object Float64Array]",it="[object Int8Array]",St="[object Int16Array]",jt="[object Int32Array]",tn="[object Uint8Array]",xt="[object Uint8ClampedArray]",pn="[object Uint16Array]",nn="[object Uint32Array]",Vn=/\b__p \+= '';/g,Re=/\b(__p \+=) '' \+/g,gt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,je=/&(?:amp|lt|gt|quot|#39);/g,Ke=/[&<>"']/g,Mt=RegExp(je.source),Et=RegExp(Ke.source),mn=/<%-([\s\S]+?)%>/g,Bn=/<%([\s\S]+?)%>/g,Ti=/<%=([\s\S]+?)%>/g,vn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,yr=/^\w*$/,_i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ds=/[\\^$.*+?()[\]{}|]/g,hs=RegExp(Ds.source),zr=/^\s+/,fs=/\s/,mo=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,vo=/\{\n\/\* \[wrapped with (.+)\] \*/,Ho=/,? & /,du=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,tl=/[()=,{}\[\]\/\s]/,pu=/\\(\\)?/g,ds=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,nl=/\w*$/,mu=/^[-+]0x[0-9a-f]+$/i,xa=/^0b[01]+$/i,Rl=/^\[object .+?Constructor\]$/,vu=/^0o[0-7]+$/i,oe=/^(?:0|[1-9]\d*)$/,De=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ue=/($^)/,Ve=/['\n\r\u2028\u2029\\]/g,Te="\\ud800-\\udfff",ot="\\u0300-\\u036f",dt="\\ufe20-\\ufe2f",Rt="\\u20d0-\\u20ff",ft=ot+dt+Rt,un="\\u2700-\\u27bf",rn="a-z\\xdf-\\xf6\\xf8-\\xff",Yt="\\xac\\xb1\\xd7\\xf7",gn="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",kn="\\u2000-\\u206f",Fn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ui="A-Z\\xc0-\\xd6\\xd8-\\xde",xn="\\ufe0e\\ufe0f",Xt=Yt+gn+kn+Fn,Gn="[']",Cn="["+Te+"]",Zi="["+Xt+"]",sr="["+ft+"]",Ji="\\d+",Ks="["+un+"]",cn="["+rn+"]",or="[^"+Te+Xt+Ji+un+rn+ui+"]",fi="\\ud83c[\\udffb-\\udfff]",Nn="(?:"+sr+"|"+fi+")",ar="[^"+Te+"]",Tr="(?:\\ud83c[\\udde6-\\uddff]){2}",an="[\\ud800-\\udbff][\\udc00-\\udfff]",fr="["+ui+"]",Wo="\\u200d",wa="(?:"+cn+"|"+or+")",Il="(?:"+fr+"|"+or+")",go="(?:"+Gn+"(?:d|ll|m|re|s|t|ve))?",Dl="(?:"+Gn+"(?:D|LL|M|RE|S|T|VE))?",_o=Nn+"?",Sa="["+xn+"]?",jo="(?:"+Wo+"(?:"+[ar,Tr,an].join("|")+")"+Sa+_o+")*",yo="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",bo="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ea=Sa+_o+jo,Xo="(?:"+[Ks,Tr,an].join("|")+")"+Ea,qo="(?:"+[ar+sr+"?",sr,Tr,an,Cn].join("|")+")",Hc=RegExp(Gn,"g"),Ju=RegExp(sr,"g"),xo=RegExp(fi+"(?="+fi+")|"+qo+Ea,"g"),Th=RegExp([fr+"?"+cn+"+"+go+"(?="+[Zi,fr,"$"].join("|")+")",Il+"+"+Dl+"(?="+[Zi,fr+wa,"$"].join("|")+")",fr+"?"+wa+"+"+go,fr+"+"+Dl,bo,yo,Ji,Xo].join("|"),"g"),Wc=RegExp("["+Wo+Te+ft+xn+"]"),Ll=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,jc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Qu=-1,$t={};$t[_t]=$t[fn]=$t[it]=$t[St]=$t[jt]=$t[tn]=$t[xt]=$t[pn]=$t[nn]=!0,$t[fe]=$t[Le]=$t[Pt]=$t[He]=$t[ht]=$t[et]=$t[Wt]=$t[zt]=$t[_e]=$t[Ln]=$t[Nt]=$t[Dt]=$t[le]=$t[ne]=$t[Je]=!1;var Qt={};Qt[fe]=Qt[Le]=Qt[Pt]=Qt[ht]=Qt[He]=Qt[et]=Qt[_t]=Qt[fn]=Qt[it]=Qt[St]=Qt[jt]=Qt[_e]=Qt[Ln]=Qt[Nt]=Qt[Dt]=Qt[le]=Qt[ne]=Qt[Oe]=Qt[tn]=Qt[xt]=Qt[pn]=Qt[nn]=!0,Qt[Wt]=Qt[zt]=Qt[Je]=!1;var Zs={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},gu={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Js={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Xc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ec=parseFloat,kl=parseInt,Fl=typeof cd=="object"&&cd&&cd.Object===Object&&cd,tc=typeof self=="object"&&self&&self.Object===Object&&self,yn=Fl||tc||Function("return this")(),Ca=e&&!e.nodeType&&e,dr=Ca&&!0&&r&&!r.nodeType&&r,Mr=dr&&dr.exports===Ca,$o=Mr&&Fl.process,ci=function(){try{var k=dr&&dr.require&&dr.require("util").types;return k||$o&&$o.binding&&$o.binding("util")}catch{}}(),il=ci&&ci.isArrayBuffer,Ar=ci&&ci.isDate,Pr=ci&&ci.isMap,Ta=ci&&ci.isRegExp,Ma=ci&&ci.isSet,Ol=ci&&ci.isTypedArray;function si(k,Y,K){switch(K.length){case 0:return k.call(Y);case 1:return k.call(Y,K[0]);case 2:return k.call(Y,K[0],K[1]);case 3:return k.call(Y,K[0],K[1],K[2])}return k.apply(Y,K)}function wo(k,Y,K,Se){for(var Xe=-1,Ct=k==null?0:k.length;++Xe<Ct;){var hn=k[Xe];Y(Se,hn,K(hn),k)}return Se}function Qn(k,Y){for(var K=-1,Se=k==null?0:k.length;++K<Se&&Y(k[K],K,k)!==!1;);return k}function Aa(k,Y){for(var K=k==null?0:k.length;K--&&Y(k[K],K,k)!==!1;);return k}function Nl(k,Y){for(var K=-1,Se=k==null?0:k.length;++K<Se;)if(!Y(k[K],K,k))return!1;return!0}function yi(k,Y){for(var K=-1,Se=k==null?0:k.length,Xe=0,Ct=[];++K<Se;){var hn=k[K];Y(hn,K,k)&&(Ct[Xe++]=hn)}return Ct}function Rr(k,Y){var K=k==null?0:k.length;return!!K&&Vr(k,Y,0)>-1}function Ul(k,Y,K){for(var Se=-1,Xe=k==null?0:k.length;++Se<Xe;)if(K(Y,k[Se]))return!0;return!1}function Ft(k,Y){for(var K=-1,Se=k==null?0:k.length,Xe=Array(Se);++K<Se;)Xe[K]=Y(k[K],K,k);return Xe}function br(k,Y){for(var K=-1,Se=Y.length,Xe=k.length;++K<Se;)k[Xe+K]=Y[K];return k}function So(k,Y,K,Se){var Xe=-1,Ct=k==null?0:k.length;for(Se&&Ct&&(K=k[++Xe]);++Xe<Ct;)K=Y(K,k[Xe],Xe,k);return K}function nc(k,Y,K,Se){var Xe=k==null?0:k.length;for(Se&&Xe&&(K=k[--Xe]);Xe--;)K=Y(K,k[Xe],Xe,k);return K}function ps(k,Y){for(var K=-1,Se=k==null?0:k.length;++K<Se;)if(Y(k[K],K,k))return!0;return!1}var rl=Pa("length");function pr(k){return k.split("")}function Bl(k){return k.match(du)||[]}function ms(k,Y,K){var Se;return K(k,function(Xe,Ct,hn){if(Y(Xe,Ct,hn))return Se=Ct,!1}),Se}function Yo(k,Y,K,Se){for(var Xe=k.length,Ct=K+(Se?1:-1);Se?Ct--:++Ct<Xe;)if(Y(k[Ct],Ct,k))return Ct;return-1}function Vr(k,Y,K){return Y===Y?Da(k,Y,K):Yo(k,Eo,K)}function zl(k,Y,K,Se){for(var Xe=K-1,Ct=k.length;++Xe<Ct;)if(Se(k[Xe],Y))return Xe;return-1}function Eo(k){return k!==k}function oi(k,Y){var K=k==null?0:k.length;return K?Ra(k,Y)/K:de}function Pa(k){return function(Y){return Y==null?t:Y[k]}}function di(k){return function(Y){return k==null?t:k[Y]}}function Ko(k,Y,K,Se,Xe){return Xe(k,function(Ct,hn,ut){K=Se?(Se=!1,Ct):Y(K,Ct,hn,ut)}),K}function rs(k,Y){var K=k.length;for(k.sort(Y);K--;)k[K]=k[K].value;return k}function Ra(k,Y){for(var K,Se=-1,Xe=k.length;++Se<Xe;){var Ct=Y(k[Se]);Ct!==t&&(K=K===t?Ct:K+Ct)}return K}function Co(k,Y){for(var K=-1,Se=Array(k);++K<k;)Se[K]=Y(K);return Se}function ic(k,Y){return Ft(Y,function(K){return[K,k[K]]})}function Ir(k){return k&&k.slice(0,Vl(k)+1).replace(zr,"")}function ai(k){return function(Y){return k(Y)}}function Ls(k,Y){return Ft(Y,function(K){return k[K]})}function Dr(k,Y){return k.has(Y)}function sl(k,Y){for(var K=-1,Se=k.length;++K<Se&&Vr(Y,k[K],0)>-1;);return K}function Gr(k,Y){for(var K=k.length;K--&&Vr(Y,k[K],0)>-1;);return K}function ol(k,Y){for(var K=k.length,Se=0;K--;)k[K]===Y&&++Se;return Se}var _u=di(Zs),Qs=di(gu);function rc(k){return"\\"+Xc[k]}function Zo(k,Y){return k==null?t:k[Y]}function ks(k){return Wc.test(k)}function yu(k){return Ll.test(k)}function Ia(k){for(var Y,K=[];!(Y=k.next()).done;)K.push(Y.value);return K}function vs(k){var Y=-1,K=Array(k.size);return k.forEach(function(Se,Xe){K[++Y]=[Xe,Se]}),K}function Jo(k,Y){return function(K){return k(Y(K))}}function Mi(k,Y){for(var K=-1,Se=k.length,Xe=0,Ct=[];++K<Se;){var hn=k[K];(hn===Y||hn===b)&&(k[K]=b,Ct[Xe++]=K)}return Ct}function gs(k){var Y=-1,K=Array(k.size);return k.forEach(function(Se){K[++Y]=Se}),K}function qc(k){var Y=-1,K=Array(k.size);return k.forEach(function(Se){K[++Y]=[Se,Se]}),K}function Da(k,Y,K){for(var Se=K-1,Xe=k.length;++Se<Xe;)if(k[Se]===Y)return Se;return-1}function La(k,Y,K){for(var Se=K+1;Se--;)if(k[Se]===Y)return Se;return Se}function Hr(k){return ks(k)?sc(k):rl(k)}function Ai(k){return ks(k)?G(k):pr(k)}function Vl(k){for(var Y=k.length;Y--&&fs.test(k.charAt(Y)););return Y}var $c=di(Js);function sc(k){for(var Y=xo.lastIndex=0;xo.test(k);)++Y;return Y}function G(k){return k.match(xo)||[]}function S(k){return k.match(Th)||[]}var D=function k(Y){Y=Y==null?yn:j.defaults(yn.Object(),Y,j.pick(yn,jc));var K=Y.Array,Se=Y.Date,Xe=Y.Error,Ct=Y.Function,hn=Y.Math,ut=Y.Object,Wr=Y.RegExp,Mh=Y.String,Ui=Y.TypeError,_s=K.prototype,ka=Ct.prototype,Qi=ut.prototype,Fa=Y["__core-js_shared__"],mr=ka.toString,Kt=Qi.hasOwnProperty,Gl=0,bu=function(){var n=/[^.]+$/.exec(Fa&&Fa.keys&&Fa.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),Oa=Qi.toString,oc=mr.call(ut),Ah=yn._,Ph=Wr("^"+mr.call(Kt).replace(Ds,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Na=Mr?Y.Buffer:t,Lr=Y.Symbol,Ua=Y.Uint8Array,ac=Na?Na.allocUnsafe:t,ys=Jo(ut.getPrototypeOf,ut),xu=ut.create,lc=Qi.propertyIsEnumerable,al=_s.splice,Yc=Lr?Lr.isConcatSpreadable:t,bs=Lr?Lr.iterator:t,xs=Lr?Lr.toStringTag:t,ll=function(){try{var n=oo(ut,"defineProperty");return n({},"",{}),n}catch{}}(),gf=Y.clearTimeout!==yn.clearTimeout&&Y.clearTimeout,pi=Se&&Se.now!==yn.Date.now&&Se.now,Kc=Y.setTimeout!==yn.setTimeout&&Y.setTimeout,Qo=hn.ceil,Fs=hn.floor,Hl=ut.getOwnPropertySymbols,Zc=Na?Na.isBuffer:t,Ba=Y.isFinite,uc=_s.join,wu=Jo(ut.keys,ut),wn=hn.max,$n=hn.min,md=Se.now,_f=Y.parseInt,Wl=hn.random,Jc=_s.reverse,ul=oo(Y,"DataView"),To=oo(Y,"Map"),jl=oo(Y,"Promise"),ss=oo(Y,"Set"),Os=oo(Y,"WeakMap"),ea=oo(ut,"create"),Xl=Os&&new Os,jr={},Rh=ao(ul),cl=ao(To),yf=ao(jl),Su=ao(ss),eo=ao(Os),Mo=Lr?Lr.prototype:t,vr=Mo?Mo.valueOf:t,cc=Mo?Mo.toString:t;function I(n){if(Tn(n)&&!mt(n)&&!(n instanceof wt)){if(n instanceof mi)return n;if(Kt.call(n,"__wrapped__"))return Cd(n)}return new mi(n)}var Ns=function(){function n(){}return function(s){if(!Sn(s))return{};if(xu)return xu(s);n.prototype=s;var c=new n;return n.prototype=t,c}}();function ws(){}function mi(n,s){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!s,this.__index__=0,this.__values__=t}I.templateSettings={escape:mn,evaluate:Bn,interpolate:Ti,variable:"",imports:{_:I}},I.prototype=ws.prototype,I.prototype.constructor=I,mi.prototype=Ns(ws.prototype),mi.prototype.constructor=mi;function wt(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ie,this.__views__=[]}function Qc(){var n=new wt(this.__wrapped__);return n.__actions__=Ei(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=Ei(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=Ei(this.__views__),n}function hc(){if(this.__filtered__){var n=new wt(this);n.__dir__=-1,n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function Eu(){var n=this.__wrapped__.value(),s=this.__dir__,c=mt(n),g=s<0,E=c?n.length:0,F=Sd(0,E,this.__views__),W=F.start,Z=F.end,re=Z-W,xe=g?Z:W-1,Ee=this.__iteratees__,Me=Ee.length,We=0,Qe=$n(re,this.__takeCount__);if(!c||!g&&E==re&&Qe==re)return Vs(n,this.__actions__);var at=[];e:for(;re--&&We<Qe;){xe+=s;for(var Tt=-1,lt=n[xe];++Tt<Me;){var Lt=Ee[Tt],Bt=Lt.iteratee,tr=Lt.type,Ii=Bt(lt);if(tr==Ae)lt=Ii;else if(!Ii){if(tr==ge)continue e;break e}}at[We++]=lt}return at}wt.prototype=Ns(ws.prototype),wt.prototype.constructor=wt;function lr(n){var s=-1,c=n==null?0:n.length;for(this.clear();++s<c;){var g=n[s];this.set(g[0],g[1])}}function vi(){this.__data__=ea?ea(null):{},this.size=0}function bi(n){var s=this.has(n)&&delete this.__data__[n];return this.size-=s?1:0,s}function hl(n){var s=this.__data__;if(ea){var c=s[n];return c===v?t:c}return Kt.call(s,n)?s[n]:t}function Xr(n){var s=this.__data__;return ea?s[n]!==t:Kt.call(s,n)}function Ss(n,s){var c=this.__data__;return this.size+=this.has(n)?0:1,c[n]=ea&&s===t?v:s,this}lr.prototype.clear=vi,lr.prototype.delete=bi,lr.prototype.get=hl,lr.prototype.has=Xr,lr.prototype.set=Ss;function Bi(n){var s=-1,c=n==null?0:n.length;for(this.clear();++s<c;){var g=n[s];this.set(g[0],g[1])}}function Cu(){this.__data__=[],this.size=0}function Es(n){var s=this.__data__,c=wi(s,n);if(c<0)return!1;var g=s.length-1;return c==g?s.pop():al.call(s,c,1),--this.size,!0}function eh(n){var s=this.__data__,c=wi(s,n);return c<0?t:s[c][1]}function bf(n){return wi(this.__data__,n)>-1}function xf(n,s){var c=this.__data__,g=wi(c,n);return g<0?(++this.size,c.push([n,s])):c[g][1]=s,this}Bi.prototype.clear=Cu,Bi.prototype.delete=Es,Bi.prototype.get=eh,Bi.prototype.has=bf,Bi.prototype.set=xf;function ur(n){var s=-1,c=n==null?0:n.length;for(this.clear();++s<c;){var g=n[s];this.set(g[0],g[1])}}function wf(){this.size=0,this.__data__={hash:new lr,map:new(To||Bi),string:new lr}}function Ao(n){var s=ku(this,n).delete(n);return this.size-=s?1:0,s}function th(n){return ku(this,n).get(n)}function Ih(n){return ku(this,n).has(n)}function Sf(n,s){var c=ku(this,n),g=c.size;return c.set(n,s),this.size+=c.size==g?0:1,this}ur.prototype.clear=wf,ur.prototype.delete=Ao,ur.prototype.get=th,ur.prototype.has=Ih,ur.prototype.set=Sf;function Us(n){var s=-1,c=n==null?0:n.length;for(this.__data__=new ur;++s<c;)this.add(n[s])}function fl(n){return this.__data__.set(n,v),this}function Tu(n){return this.__data__.has(n)}Us.prototype.add=Us.prototype.push=fl,Us.prototype.has=Tu;function xi(n){var s=this.__data__=new Bi(n);this.size=s.size}function nh(){this.__data__=new Bi,this.size=0}function Po(n){var s=this.__data__,c=s.delete(n);return this.size=s.size,c}function Bs(n){return this.__data__.get(n)}function to(n){return this.__data__.has(n)}function ql(n,s){var c=this.__data__;if(c instanceof Bi){var g=c.__data__;if(!To||g.length<o-1)return g.push([n,s]),this.size=++c.size,this;c=this.__data__=new ur(g)}return c.set(n,s),this.size=c.size,this}xi.prototype.clear=nh,xi.prototype.delete=Po,xi.prototype.get=Bs,xi.prototype.has=to,xi.prototype.set=ql;function zs(n,s){var c=mt(n),g=!c&&qa(n),E=!c&&!g&&zo(n),F=!c&&!g&&!E&&nu(n),W=c||g||E||F,Z=W?Co(n.length,Mh):[],re=Z.length;for(var xe in n)(s||Kt.call(n,xe))&&!(W&&(xe=="length"||E&&(xe=="offset"||xe=="parent")||F&&(xe=="buffer"||xe=="byteLength"||xe=="byteOffset")||ti(xe,re)))&&Z.push(xe);return Z}function no(n){var s=n.length;return s?n[gl(0,s-1)]:t}function dl(n,s){return Ac(Ei(n),qr(s,0,n.length))}function Ef(n){return Ac(Ei(n))}function $l(n,s,c){(c!==t&&!Ur(n[s],c)||c===t&&!(s in n))&&Pi(n,s,c)}function Ro(n,s,c){var g=n[s];(!(Kt.call(n,s)&&Ur(g,c))||c===t&&!(s in n))&&Pi(n,s,c)}function wi(n,s){for(var c=n.length;c--;)if(Ur(n[c][0],s))return c;return-1}function Cs(n,s,c,g){return kr(n,function(E,F,W){s(g,E,c(E),W)}),g}function Yn(n,s){return n&&xr(s,Zn(s),n)}function Io(n,s){return n&&xr(s,Hi(s),n)}function Pi(n,s,c){s=="__proto__"&&ll?ll(n,s,{configurable:!0,enumerable:!0,value:c,writable:!0}):n[s]=c}function Mu(n,s){for(var c=-1,g=s.length,E=K(g),F=n==null;++c<g;)E[c]=F?t:Gd(n,s[c]);return E}function qr(n,s,c){return n===n&&(c!==t&&(n=n<=c?n:c),s!==t&&(n=n>=s?n:s)),n}function Ri(n,s,c,g,E,F){var W,Z=s&w,re=s&C,xe=s&R;if(c&&(W=E?c(n,g,E,F):c(n)),W!==t)return W;if(!Sn(n))return n;var Ee=mt(n);if(Ee){if(W=Bh(n),!Z)return Ei(n,W)}else{var Me=ei(n),We=Me==zt||Me==bn;if(zo(n))return Af(n,Z);if(Me==Nt||Me==fe||We&&!E){if(W=re||We?{}:Jr(n),!Z)return re?Gm(n,Io(W,n)):If(n,Yn(W,n))}else{if(!Qt[Me])return E?n:{};W=Hm(n,Me,Z)}}F||(F=new xi);var Qe=F.get(n);if(Qe)return Qe;F.set(n,W),hv(n)?n.forEach(function(lt){W.add(Ri(lt,s,c,lt,n,F))}):uv(n)&&n.forEach(function(lt,Lt){W.set(Lt,Ri(lt,s,c,Lt,n,F))});var at=xe?re?Cc:Ec:re?Hi:Zn,Tt=Ee?t:at(n);return Qn(Tt||n,function(lt,Lt){Tt&&(Lt=lt,lt=n[Lt]),Ro(W,Lt,Ri(lt,s,c,Lt,n,F))}),W}function Cf(n){var s=Zn(n);return function(c){return Do(c,n,s)}}function Do(n,s,c){var g=c.length;if(n==null)return!g;for(n=ut(n);g--;){var E=c[g],F=s[E],W=n[E];if(W===t&&!(E in n)||!F(W))return!1}return!0}function fc(n,s,c){if(typeof n!="function")throw new Ui(f);return yl(function(){n.apply(t,c)},s)}function Ts(n,s,c,g){var E=-1,F=Rr,W=!0,Z=n.length,re=[],xe=s.length;if(!Z)return re;c&&(s=Ft(s,ai(c))),g?(F=Ul,W=!1):s.length>=o&&(F=Dr,W=!1,s=new Us(s));e:for(;++E<Z;){var Ee=n[E],Me=c==null?Ee:c(Ee);if(Ee=g||Ee!==0?Ee:0,W&&Me===Me){for(var We=xe;We--;)if(s[We]===Me)continue e;re.push(Ee)}else F(s,Me,g)||re.push(Ee)}return re}var kr=Oo(qi),Dh=Oo(na,!0);function Yl(n,s){var c=!0;return kr(n,function(g,E,F){return c=!!s(g,E,F),c}),c}function ta(n,s,c){for(var g=-1,E=n.length;++g<E;){var F=n[g],W=s(F);if(W!=null&&(Z===t?W===W&&!er(W):c(W,Z)))var Z=W,re=F}return re}function Kl(n,s,c,g){var E=n.length;for(c=bt(c),c<0&&(c=-c>E?0:E+c),g=g===t||g>E?E:bt(g),g<0&&(g+=E),g=c>g?0:dv(g);c<g;)n[c++]=s;return n}function dc(n,s){var c=[];return kr(n,function(g,E,F){s(g,E,F)&&c.push(g)}),c}function An(n,s,c,g,E){var F=-1,W=n.length;for(c||(c=Vf),E||(E=[]);++F<W;){var Z=n[F];s>0&&c(Z)?s>1?An(Z,s-1,c,g,E):br(E,Z):g||(E[E.length]=Z)}return E}var Au=Nh(),Pu=Nh(!0);function qi(n,s){return n&&Au(n,s,Zn)}function na(n,s){return n&&Pu(n,s,Zn)}function za(n,s){return yi(s,function(c){return Ws(n[c])})}function os(n,s){s=as(s,n);for(var c=0,g=s.length;n!=null&&c<g;)n=n[wr(s[c++])];return c&&c==g?n:t}function Va(n,s,c){var g=s(n);return mt(n)?g:br(g,c(n))}function Hn(n){return n==null?n===t?Ze:on:xs&&xs in ut(n)?Bf(n):Ed(n)}function ia(n,s){return n>s}function Ms(n,s){return n!=null&&Kt.call(n,s)}function pl(n,s){return n!=null&&s in ut(n)}function Lh(n,s,c){return n>=$n(s,c)&&n<wn(s,c)}function ml(n,s,c){for(var g=c?Ul:Rr,E=n[0].length,F=n.length,W=F,Z=K(F),re=1/0,xe=[];W--;){var Ee=n[W];W&&s&&(Ee=Ft(Ee,ai(s))),re=$n(Ee.length,re),Z[W]=!c&&(s||E>=120&&Ee.length>=120)?new Us(W&&Ee):t}Ee=n[0];var Me=-1,We=Z[0];e:for(;++Me<E&&xe.length<re;){var Qe=Ee[Me],at=s?s(Qe):Qe;if(Qe=c||Qe!==0?Qe:0,!(We?Dr(We,at):g(xe,at,c))){for(W=F;--W;){var Tt=Z[W];if(!(Tt?Dr(Tt,at):g(n[W],at,c)))continue e}We&&We.push(at),xe.push(Qe)}}return xe}function Ga(n,s,c,g){return qi(n,function(E,F,W){s(g,c(E),F,W)}),g}function zi(n,s,c){s=as(s,n),n=Or(n,s);var g=n==null?n:n[wr(Oi(s))];return g==null?t:si(g,n,c)}function pc(n){return Tn(n)&&Hn(n)==fe}function Tf(n){return Tn(n)&&Hn(n)==Pt}function Lo(n){return Tn(n)&&Hn(n)==et}function $r(n,s,c,g,E){return n===s?!0:n==null||s==null||!Tn(n)&&!Tn(s)?n!==n&&s!==s:ih(n,s,c,g,$r,E)}function ih(n,s,c,g,E,F){var W=mt(n),Z=mt(s),re=W?Le:ei(n),xe=Z?Le:ei(s);re=re==fe?Nt:re,xe=xe==fe?Nt:xe;var Ee=re==Nt,Me=xe==Nt,We=re==xe;if(We&&zo(n)){if(!zo(s))return!1;W=!0,Ee=!1}if(We&&!Ee)return F||(F=new xi),W||nu(n)?Uf(n,s,c,g,E,F):xd(n,s,re,c,g,E,F);if(!(c&z)){var Qe=Ee&&Kt.call(n,"__wrapped__"),at=Me&&Kt.call(s,"__wrapped__");if(Qe||at){var Tt=Qe?n.value():n,lt=at?s.value():s;return F||(F=new xi),E(Tt,lt,c,g,F)}}return We?(F||(F=new xi),Rp(n,s,c,g,E,F)):!1}function kh(n){return Tn(n)&&ei(n)==_e}function vl(n,s,c,g){var E=c.length,F=E,W=!g;if(n==null)return!F;for(n=ut(n);E--;){var Z=c[E];if(W&&Z[2]?Z[1]!==n[Z[0]]:!(Z[0]in n))return!1}for(;++E<F;){Z=c[E];var re=Z[0],xe=n[re],Ee=Z[1];if(W&&Z[2]){if(xe===t&&!(re in n))return!1}else{var Me=new xi;if(g)var We=g(xe,Ee,re,n,s,Me);if(!(We===t?$r(Ee,xe,z|O,g,Me):We))return!1}}return!0}function rh(n){if(!Sn(n)||Dp(n))return!1;var s=Ws(n)?Ph:Rl;return s.test(ao(n))}function mc(n){return Tn(n)&&Hn(n)==Dt}function ra(n){return Tn(n)&&ei(n)==le}function vc(n){return Tn(n)&&Yh(n.length)&&!!$t[Hn(n)]}function Zl(n){return typeof n=="function"?n:n==null?Wi:typeof n=="object"?mt(n)?Si(n[0],n[1]):gc(n):Ev(n)}function ko(n){if(!Uo(n))return wu(n);var s=[];for(var c in ut(n))Kt.call(n,c)&&c!="constructor"&&s.push(c);return s}function Fh(n){if(!Sn(n))return Fp(n);var s=Uo(n),c=[];for(var g in n)g=="constructor"&&(s||!Kt.call(n,g))||c.push(g);return c}function sa(n,s){return n<s}function io(n,s){var c=-1,g=Gi(n)?K(n.length):[];return kr(n,function(E,F,W){g[++c]=s(E,F,W)}),g}function gc(n){var s=Tc(n);return s.length==1&&s[0][2]?zh(s[0][0],s[0][1]):function(c){return c===n||vl(c,n,s)}}function Si(n,s){return Ot(n)&&hh(s)?zh(wr(n),s):function(c){var g=Gd(c,n);return g===t&&g===s?Hd(c,n):$r(s,g,z|O)}}function oa(n,s,c,g,E){n!==s&&Au(s,function(F,W){if(E||(E=new xi),Sn(F))sh(n,s,W,c,oa,g,E);else{var Z=g?g(fa(n,W),F,W+"",n,s,E):t;Z===t&&(Z=F),$l(n,W,Z)}},Hi)}function sh(n,s,c,g,E,F,W){var Z=fa(n,c),re=fa(s,c),xe=W.get(re);if(xe){$l(n,c,xe);return}var Ee=F?F(Z,re,c+"",n,s,W):t,Me=Ee===t;if(Me){var We=mt(re),Qe=!We&&zo(re),at=!We&&!Qe&&nu(re);Ee=re,We||Qe||at?mt(Z)?Ee=Z:Rn(Z)?Ee=Ei(Z):Qe?(Me=!1,Ee=Af(re,!0)):at?(Me=!1,Ee=vd(re,!0)):Ee=[]:Lc(re)||qa(re)?(Ee=Z,qa(Z)?Ee=pv(Z):(!Sn(Z)||Ws(Z))&&(Ee=Jr(re))):Me=!1}Me&&(W.set(re,Ee),E(Ee,re,g,F,W),W.delete(re)),$l(n,c,Ee)}function _c(n,s){var c=n.length;if(c)return s+=s<0?c:0,ti(s,c)?n[s]:t}function Ru(n,s,c){s.length?s=Ft(s,function(F){return mt(F)?function(W){return os(W,F.length===1?F[0]:F)}:F}):s=[Wi];var g=-1;s=Ft(s,ai(rt()));var E=io(n,function(F,W,Z){var re=Ft(s,function(xe){return xe(F)});return{criteria:re,index:++g,value:F}});return rs(E,function(F,W){return Vm(F,W,c)})}function oh(n,s){return aa(n,s,function(c,g){return Hd(n,g)})}function aa(n,s,c){for(var g=-1,E=s.length,F={};++g<E;){var W=s[g],Z=os(n,W);c(Z,W)&&ro(F,as(W,n),Z)}return F}function Fi(n){return function(s){return os(s,n)}}function Vi(n,s,c,g){var E=g?zl:Vr,F=-1,W=s.length,Z=n;for(n===s&&(s=Ei(s)),c&&(Z=Ft(n,ai(c)));++F<W;)for(var re=0,xe=s[F],Ee=c?c(xe):xe;(re=E(Z,Ee,re,g))>-1;)Z!==n&&al.call(Z,re,1),al.call(n,re,1);return n}function cr(n,s){for(var c=n?s.length:0,g=c-1;c--;){var E=s[c];if(c==g||E!==F){var F=E;ti(E)?al.call(n,E,1):ln(n,E)}}return n}function gl(n,s){return n+Fs(Wl()*(s-n+1))}function yc(n,s,c,g){for(var E=-1,F=wn(Qo((s-n)/(c||1)),0),W=K(F);F--;)W[g?F:++E]=n,n+=c;return W}function Ha(n,s){var c="";if(!n||s<1||s>ae)return c;do s%2&&(c+=n),s=Fs(s/2),s&&(n+=n);while(s);return c}function yt(n,s){return Gs(Vh(n,s,Wi),n+"")}function Yr(n){return no(iu(n))}function Oh(n,s){var c=iu(n);return Ac(c,qr(s,0,c.length))}function ro(n,s,c,g){if(!Sn(n))return n;s=as(s,n);for(var E=-1,F=s.length,W=F-1,Z=n;Z!=null&&++E<F;){var re=wr(s[E]),xe=c;if(re==="__proto__"||re==="constructor"||re==="prototype")return n;if(E!=W){var Ee=Z[re];xe=g?g(Ee,re,Z):t,xe===t&&(xe=Sn(Ee)?Ee:ti(s[E+1])?[]:{})}Ro(Z,re,xe),Z=Z[re]}return n}var bc=Xl?function(n,s){return Xl.set(n,s),n}:Wi,la=ll?function(n,s){return ll(n,"toString",{configurable:!0,enumerable:!1,value:jd(s),writable:!0})}:Wi;function y(n){return Ac(iu(n))}function h(n,s,c){var g=-1,E=n.length;s<0&&(s=-s>E?0:E+s),c=c>E?E:c,c<0&&(c+=E),E=s>c?0:c-s>>>0,s>>>=0;for(var F=K(E);++g<E;)F[g]=n[g+s];return F}function m(n,s){var c;return kr(n,function(g,E,F){return c=s(g,E,F),!c}),!!c}function T(n,s,c){var g=0,E=n==null?g:n.length;if(typeof s=="number"&&s===s&&E<=ze){for(;g<E;){var F=g+E>>>1,W=n[F];W!==null&&!er(W)&&(c?W<=s:W<s)?g=F+1:E=F}return E}return q(n,s,Wi,c)}function q(n,s,c,g){var E=0,F=n==null?0:n.length;if(F===0)return 0;s=c(s);for(var W=s!==s,Z=s===null,re=er(s),xe=s===t;E<F;){var Ee=Fs((E+F)/2),Me=c(n[Ee]),We=Me!==t,Qe=Me===null,at=Me===Me,Tt=er(Me);if(W)var lt=g||at;else xe?lt=at&&(g||We):Z?lt=at&&We&&(g||!Qe):re?lt=at&&We&&!Qe&&(g||!Tt):Qe||Tt?lt=!1:lt=g?Me<=s:Me<s;lt?E=Ee+1:F=Ee}return $n(F,we)}function ve(n,s){for(var c=-1,g=n.length,E=0,F=[];++c<g;){var W=n[c],Z=s?s(W):W;if(!c||!Ur(Z,re)){var re=Z;F[E++]=W===0?0:W}}return F}function ke(n){return typeof n=="number"?n:er(n)?de:+n}function $e(n){if(typeof n=="string")return n;if(mt(n))return Ft(n,$e)+"";if(er(n))return cc?cc.call(n):"";var s=n+"";return s=="0"&&1/n==-1/0?"-0":s}function Ut(n,s,c){var g=-1,E=Rr,F=n.length,W=!0,Z=[],re=Z;if(c)W=!1,E=Ul;else if(F>=o){var xe=s?null:Pp(n);if(xe)return gs(xe);W=!1,E=Dr,re=new Us}else re=s?[]:Z;e:for(;++g<F;){var Ee=n[g],Me=s?s(Ee):Ee;if(Ee=c||Ee!==0?Ee:0,W&&Me===Me){for(var We=re.length;We--;)if(re[We]===Me)continue e;s&&re.push(Me),Z.push(Ee)}else E(re,Me,c)||(re!==Z&&re.push(Me),Z.push(Ee))}return Z}function ln(n,s){return s=as(s,n),n=Or(n,s),n==null||delete n[wr(Oi(s))]}function On(n,s,c,g){return ro(n,s,c(os(n,s)),g)}function Pn(n,s,c,g){for(var E=n.length,F=g?E:-1;(g?F--:++F<E)&&s(n[F],F,n););return c?h(n,g?0:F,g?F+1:E):h(n,g?F+1:0,g?E:F)}function Vs(n,s){var c=n;return c instanceof wt&&(c=c.value()),So(s,function(g,E){return E.func.apply(E.thisArg,br([g],E.args))},c)}function ua(n,s,c){var g=n.length;if(g<2)return g?Ut(n[0]):[];for(var E=-1,F=K(g);++E<g;)for(var W=n[E],Z=-1;++Z<g;)Z!=E&&(F[E]=Ts(F[E]||W,n[Z],s,c));return Ut(An(F,1),s,c)}function ca(n,s,c){for(var g=-1,E=n.length,F=s.length,W={};++g<E;){var Z=g<F?s[g]:t;c(W,n[g],Z)}return W}function Fo(n){return Rn(n)?n:[]}function ah(n){return typeof n=="function"?n:Wi}function as(n,s){return mt(n)?n:Ot(n,s)?[n]:Wf(en(n))}var Ep=yt;function As(n,s,c){var g=n.length;return c=c===t?g:c,!s&&c>=g?n:h(n,s,c)}var Mf=gf||function(n){return yn.clearTimeout(n)};function Af(n,s){if(s)return n.slice();var c=n.length,g=ac?ac(c):new n.constructor(c);return n.copy(g),g}function xc(n){var s=new n.constructor(n.byteLength);return new Ua(s).set(new Ua(n)),s}function Cp(n,s){var c=s?xc(n.buffer):n.buffer;return new n.constructor(c,n.byteOffset,n.byteLength)}function Tp(n){var s=new n.constructor(n.source,nl.exec(n));return s.lastIndex=n.lastIndex,s}function Mp(n){return vr?ut(vr.call(n)):{}}function vd(n,s){var c=s?xc(n.buffer):n.buffer;return new n.constructor(c,n.byteOffset,n.length)}function Pf(n,s){if(n!==s){var c=n!==t,g=n===null,E=n===n,F=er(n),W=s!==t,Z=s===null,re=s===s,xe=er(s);if(!Z&&!xe&&!F&&n>s||F&&W&&re&&!Z&&!xe||g&&W&&re||!c&&re||!E)return 1;if(!g&&!F&&!xe&&n<s||xe&&c&&E&&!g&&!F||Z&&c&&E||!W&&E||!re)return-1}return 0}function Vm(n,s,c){for(var g=-1,E=n.criteria,F=s.criteria,W=E.length,Z=c.length;++g<W;){var re=Pf(E[g],F[g]);if(re){if(g>=Z)return re;var xe=c[g];return re*(xe=="desc"?-1:1)}}return n.index-s.index}function gd(n,s,c,g){for(var E=-1,F=n.length,W=c.length,Z=-1,re=s.length,xe=wn(F-W,0),Ee=K(re+xe),Me=!g;++Z<re;)Ee[Z]=s[Z];for(;++E<W;)(Me||E<F)&&(Ee[c[E]]=n[E]);for(;xe--;)Ee[Z++]=n[E++];return Ee}function Rf(n,s,c,g){for(var E=-1,F=n.length,W=-1,Z=c.length,re=-1,xe=s.length,Ee=wn(F-Z,0),Me=K(Ee+xe),We=!g;++E<Ee;)Me[E]=n[E];for(var Qe=E;++re<xe;)Me[Qe+re]=s[re];for(;++W<Z;)(We||E<F)&&(Me[Qe+c[W]]=n[E++]);return Me}function Ei(n,s){var c=-1,g=n.length;for(s||(s=K(g));++c<g;)s[c]=n[c];return s}function xr(n,s,c,g){var E=!c;c||(c={});for(var F=-1,W=s.length;++F<W;){var Z=s[F],re=g?g(c[Z],n[Z],Z,c,n):t;re===t&&(re=n[Z]),E?Pi(c,Z,re):Ro(c,Z,re)}return c}function If(n,s){return xr(n,No(n),s)}function Gm(n,s){return xr(n,wd(n),s)}function wc(n,s){return function(c,g){var E=mt(c)?wo:Cs,F=s?s():{};return E(c,n,rt(g,2),F)}}function Wa(n){return yt(function(s,c){var g=-1,E=c.length,F=E>1?c[E-1]:t,W=E>2?c[2]:t;for(F=n.length>3&&typeof F=="function"?(E--,F):t,W&&gi(c[0],c[1],W)&&(F=E<3?t:F,E=1),s=ut(s);++g<E;){var Z=c[g];Z&&n(s,Z,g,F)}return s})}function Oo(n,s){return function(c,g){if(c==null)return c;if(!Gi(c))return n(c,g);for(var E=c.length,F=s?E:-1,W=ut(c);(s?F--:++F<E)&&g(W[F],F,W)!==!1;);return c}}function Nh(n){return function(s,c,g){for(var E=-1,F=ut(s),W=g(s),Z=W.length;Z--;){var re=W[n?Z:++E];if(c(F[re],re,F)===!1)break}return s}}function Df(n,s,c){var g=s&P,E=_l(n);function F(){var W=this&&this!==yn&&this instanceof F?E:n;return W.apply(g?c:this,arguments)}return F}function Lf(n){return function(s){s=en(s);var c=ks(s)?Ai(s):t,g=c?c[0]:s.charAt(0),E=c?As(c,1).join(""):s.slice(1);return g[n]()+E}}function ha(n){return function(s){return So(wv(xv(s).replace(Hc,"")),n,"")}}function _l(n){return function(){var s=arguments;switch(s.length){case 0:return new n;case 1:return new n(s[0]);case 2:return new n(s[0],s[1]);case 3:return new n(s[0],s[1],s[2]);case 4:return new n(s[0],s[1],s[2],s[3]);case 5:return new n(s[0],s[1],s[2],s[3],s[4]);case 6:return new n(s[0],s[1],s[2],s[3],s[4],s[5]);case 7:return new n(s[0],s[1],s[2],s[3],s[4],s[5],s[6])}var c=Ns(n.prototype),g=n.apply(c,s);return Sn(g)?g:c}}function _d(n,s,c){var g=_l(n);function E(){for(var F=arguments.length,W=K(F),Z=F,re=so(E);Z--;)W[Z]=arguments[Z];var xe=F<3&&W[0]!==re&&W[F-1]!==re?[]:Mi(W,re);if(F-=xe.length,F<c)return Ps(n,s,Jl,E.placeholder,t,W,xe,t,t,c-F);var Ee=this&&this!==yn&&this instanceof E?g:n;return si(Ee,this,W)}return E}function Iu(n){return function(s,c,g){var E=ut(s);if(!Gi(s)){var F=rt(c,3);s=Zn(s),c=function(Z){return F(E[Z],Z,E)}}var W=n(s,c,g);return W>-1?E[F?s[W]:W]:t}}function Uh(n){return Zr(function(s){var c=s.length,g=c,E=mi.prototype.thru;for(n&&s.reverse();g--;){var F=s[g];if(typeof F!="function")throw new Ui(f);if(E&&!W&&Ql(F)=="wrapper")var W=new mi([],!0)}for(g=W?g:c;++g<c;){F=s[g];var Z=Ql(F),re=Z=="wrapper"?uh(F):t;re&&Mc(re[0])&&re[1]==(Q|L|$|te)&&!re[4].length&&re[9]==1?W=W[Ql(re[0])].apply(W,re[3]):W=F.length==1&&Mc(F)?W[Z]():W.thru(F)}return function(){var xe=arguments,Ee=xe[0];if(W&&xe.length==1&&mt(Ee))return W.plant(Ee).value();for(var Me=0,We=c?s[Me].apply(this,xe):Ee;++Me<c;)We=s[Me].call(this,We);return We}})}function Jl(n,s,c,g,E,F,W,Z,re,xe){var Ee=s&Q,Me=s&P,We=s&M,Qe=s&(L|B),at=s&V,Tt=We?t:_l(n);function lt(){for(var Lt=arguments.length,Bt=K(Lt),tr=Lt;tr--;)Bt[tr]=arguments[tr];if(Qe)var Ii=so(lt),nr=ol(Bt,Ii);if(g&&(Bt=gd(Bt,g,E,Qe)),F&&(Bt=Rf(Bt,F,W,Qe)),Lt-=nr,Qe&&Lt<xe){var In=Mi(Bt,Ii);return Ps(n,s,Jl,lt.placeholder,c,Bt,In,Z,re,xe-Lt)}var Br=Me?c:this,Xs=We?Br[n]:n;return Lt=Bt.length,Z?Bt=ja(Bt,Z):at&&Lt>1&&Bt.reverse(),Ee&&re<Lt&&(Bt.length=re),this&&this!==yn&&this instanceof lt&&(Xs=Tt||_l(Xs)),Xs.apply(Br,Bt)}return lt}function yd(n,s){return function(c,g){return Ga(c,n,s(g),{})}}function Du(n,s){return function(c,g){var E;if(c===t&&g===t)return s;if(c!==t&&(E=c),g!==t){if(E===t)return g;typeof c=="string"||typeof g=="string"?(c=$e(c),g=$e(g)):(c=ke(c),g=ke(g)),E=n(c,g)}return E}}function lh(n){return Zr(function(s){return s=Ft(s,ai(rt())),yt(function(c){var g=this;return n(s,function(E){return si(E,g,c)})})})}function Lu(n,s){s=s===t?" ":$e(s);var c=s.length;if(c<2)return c?Ha(s,n):s;var g=Ha(s,Qo(n/Hr(s)));return ks(s)?As(Ai(g),0,n).join(""):g.slice(0,n)}function Ap(n,s,c,g){var E=s&P,F=_l(n);function W(){for(var Z=-1,re=arguments.length,xe=-1,Ee=g.length,Me=K(Ee+re),We=this&&this!==yn&&this instanceof W?F:n;++xe<Ee;)Me[xe]=g[xe];for(;re--;)Me[xe++]=arguments[++Z];return si(We,E?c:this,Me)}return W}function kf(n){return function(s,c,g){return g&&typeof g!="number"&&gi(s,c,g)&&(c=g=t),s=js(s),c===t?(c=s,s=0):c=js(c),g=g===t?s<c?1:-1:js(g),yc(s,c,g,n)}}function Sc(n){return function(s,c){return typeof s=="string"&&typeof c=="string"||(s=_r(s),c=_r(c)),n(s,c)}}function Ps(n,s,c,g,E,F,W,Z,re,xe){var Ee=s&L,Me=Ee?W:t,We=Ee?t:W,Qe=Ee?F:t,at=Ee?t:F;s|=Ee?$:X,s&=~(Ee?X:$),s&U||(s&=-4);var Tt=[n,s,E,Qe,Me,at,We,Z,re,xe],lt=c.apply(t,Tt);return Mc(n)&&Gf(lt,Tt),lt.placeholder=g,Hf(lt,n,s)}function Fr(n){var s=hn[n];return function(c,g){if(c=_r(c),g=g==null?0:$n(bt(g),292),g&&Ba(c)){var E=(en(c)+"e").split("e"),F=s(E[0]+"e"+(+E[1]+g));return E=(en(F)+"e").split("e"),+(E[0]+"e"+(+E[1]-g))}return s(c)}}var Pp=ss&&1/gs(new ss([,-0]))[1]==Ie?function(n){return new ss(n)}:$d;function Ff(n){return function(s){var c=ei(s);return c==_e?vs(s):c==le?qc(s):ic(s,n(s))}}function Kr(n,s,c,g,E,F,W,Z){var re=s&M;if(!re&&typeof n!="function")throw new Ui(f);var xe=g?g.length:0;if(xe||(s&=-97,g=E=t),W=W===t?W:wn(bt(W),0),Z=Z===t?Z:bt(Z),xe-=E?E.length:0,s&X){var Ee=g,Me=E;g=E=t}var We=re?t:uh(n),Qe=[n,s,c,g,E,Ee,Me,F,W,Z];if(We&&kp(Qe,We),n=Qe[0],s=Qe[1],c=Qe[2],g=Qe[3],E=Qe[4],Z=Qe[9]=Qe[9]===t?re?0:n.length:wn(Qe[9]-xe,0),!Z&&s&(L|B)&&(s&=-25),!s||s==P)var at=Df(n,s,c);else s==L||s==B?at=_d(n,s,Z):(s==$||s==(P|$))&&!E.length?at=Ap(n,s,c,g):at=Jl.apply(t,Qe);var Tt=We?bc:Gf;return Hf(Tt(at,Qe),n,s)}function Of(n,s,c,g){return n===t||Ur(n,Qi[c])&&!Kt.call(g,c)?s:n}function Nf(n,s,c,g,E,F){return Sn(n)&&Sn(s)&&(F.set(s,n),oa(n,s,t,Nf,F),F.delete(s)),n}function bd(n){return Lc(n)?t:n}function Uf(n,s,c,g,E,F){var W=c&z,Z=n.length,re=s.length;if(Z!=re&&!(W&&re>Z))return!1;var xe=F.get(n),Ee=F.get(s);if(xe&&Ee)return xe==s&&Ee==n;var Me=-1,We=!0,Qe=c&O?new Us:t;for(F.set(n,s),F.set(s,n);++Me<Z;){var at=n[Me],Tt=s[Me];if(g)var lt=W?g(Tt,at,Me,s,n,F):g(at,Tt,Me,n,s,F);if(lt!==t){if(lt)continue;We=!1;break}if(Qe){if(!ps(s,function(Lt,Bt){if(!Dr(Qe,Bt)&&(at===Lt||E(at,Lt,c,g,F)))return Qe.push(Bt)})){We=!1;break}}else if(!(at===Tt||E(at,Tt,c,g,F))){We=!1;break}}return F.delete(n),F.delete(s),We}function xd(n,s,c,g,E,F,W){switch(c){case ht:if(n.byteLength!=s.byteLength||n.byteOffset!=s.byteOffset)return!1;n=n.buffer,s=s.buffer;case Pt:return!(n.byteLength!=s.byteLength||!F(new Ua(n),new Ua(s)));case He:case et:case Ln:return Ur(+n,+s);case Wt:return n.name==s.name&&n.message==s.message;case Dt:case ne:return n==s+"";case _e:var Z=vs;case le:var re=g&z;if(Z||(Z=gs),n.size!=s.size&&!re)return!1;var xe=W.get(n);if(xe)return xe==s;g|=O,W.set(n,s);var Ee=Uf(Z(n),Z(s),g,E,F,W);return W.delete(n),Ee;case Oe:if(vr)return vr.call(n)==vr.call(s)}return!1}function Rp(n,s,c,g,E,F){var W=c&z,Z=Ec(n),re=Z.length,xe=Ec(s),Ee=xe.length;if(re!=Ee&&!W)return!1;for(var Me=re;Me--;){var We=Z[Me];if(!(W?We in s:Kt.call(s,We)))return!1}var Qe=F.get(n),at=F.get(s);if(Qe&&at)return Qe==s&&at==n;var Tt=!0;F.set(n,s),F.set(s,n);for(var lt=W;++Me<re;){We=Z[Me];var Lt=n[We],Bt=s[We];if(g)var tr=W?g(Bt,Lt,We,s,n,F):g(Lt,Bt,We,n,s,F);if(!(tr===t?Lt===Bt||E(Lt,Bt,c,g,F):tr)){Tt=!1;break}lt||(lt=We=="constructor")}if(Tt&&!lt){var Ii=n.constructor,nr=s.constructor;Ii!=nr&&"constructor"in n&&"constructor"in s&&!(typeof Ii=="function"&&Ii instanceof Ii&&typeof nr=="function"&&nr instanceof nr)&&(Tt=!1)}return F.delete(n),F.delete(s),Tt}function Zr(n){return Gs(Vh(n,t,Hh),n+"")}function Ec(n){return Va(n,Zn,No)}function Cc(n){return Va(n,Hi,wd)}var uh=Xl?function(n){return Xl.get(n)}:$d;function Ql(n){for(var s=n.name+"",c=jr[s],g=Kt.call(jr,s)?c.length:0;g--;){var E=c[g],F=E.func;if(F==null||F==n)return E.name}return s}function so(n){var s=Kt.call(I,"placeholder")?I:n;return s.placeholder}function rt(){var n=I.iteratee||Xd;return n=n===Xd?Zl:n,arguments.length?n(arguments[0],arguments[1]):n}function ku(n,s){var c=n.__data__;return ch(s)?c[typeof s=="string"?"string":"hash"]:c.map}function Tc(n){for(var s=Zn(n),c=s.length;c--;){var g=s[c],E=n[g];s[c]=[g,E,hh(E)]}return s}function oo(n,s){var c=Zo(n,s);return rh(c)?c:t}function Bf(n){var s=Kt.call(n,xs),c=n[xs];try{n[xs]=t;var g=!0}catch{}var E=Oa.call(n);return g&&(s?n[xs]=c:delete n[xs]),E}var No=Hl?function(n){return n==null?[]:(n=ut(n),yi(Hl(n),function(s){return lc.call(n,s)}))}:Yd,wd=Hl?function(n){for(var s=[];n;)br(s,No(n)),n=ys(n);return s}:Yd,ei=Hn;(ul&&ei(new ul(new ArrayBuffer(1)))!=ht||To&&ei(new To)!=_e||jl&&ei(jl.resolve())!=Vt||ss&&ei(new ss)!=le||Os&&ei(new Os)!=Je)&&(ei=function(n){var s=Hn(n),c=s==Nt?n.constructor:t,g=c?ao(c):"";if(g)switch(g){case Rh:return ht;case cl:return _e;case yf:return Vt;case Su:return le;case eo:return Je}return s});function Sd(n,s,c){for(var g=-1,E=c.length;++g<E;){var F=c[g],W=F.size;switch(F.type){case"drop":n+=W;break;case"dropRight":s-=W;break;case"take":s=$n(s,n+W);break;case"takeRight":n=wn(n,s-W);break}}return{start:n,end:s}}function Ip(n){var s=n.match(vo);return s?s[1].split(Ho):[]}function zf(n,s,c){s=as(s,n);for(var g=-1,E=s.length,F=!1;++g<E;){var W=wr(s[g]);if(!(F=n!=null&&c(n,W)))break;n=n[W]}return F||++g!=E?F:(E=n==null?0:n.length,!!E&&Yh(E)&&ti(W,E)&&(mt(n)||qa(n)))}function Bh(n){var s=n.length,c=new n.constructor(s);return s&&typeof n[0]=="string"&&Kt.call(n,"index")&&(c.index=n.index,c.input=n.input),c}function Jr(n){return typeof n.constructor=="function"&&!Uo(n)?Ns(ys(n)):{}}function Hm(n,s,c){var g=n.constructor;switch(s){case Pt:return xc(n);case He:case et:return new g(+n);case ht:return Cp(n,c);case _t:case fn:case it:case St:case jt:case tn:case xt:case pn:case nn:return vd(n,c);case _e:return new g;case Ln:case ne:return new g(n);case Dt:return Tp(n);case le:return new g;case Oe:return Mp(n)}}function Wm(n,s){var c=s.length;if(!c)return n;var g=c-1;return s[g]=(c>1?"& ":"")+s[g],s=s.join(c>2?", ":" "),n.replace(mo,`{
/* [wrapped with `+s+`] */
`)}function Vf(n){return mt(n)||qa(n)||!!(Yc&&n&&n[Yc])}function ti(n,s){var c=typeof n;return s=s??ae,!!s&&(c=="number"||c!="symbol"&&oe.test(n))&&n>-1&&n%1==0&&n<s}function gi(n,s,c){if(!Sn(c))return!1;var g=typeof s;return(g=="number"?Gi(c)&&ti(s,c.length):g=="string"&&s in c)?Ur(c[s],n):!1}function Ot(n,s){if(mt(n))return!1;var c=typeof n;return c=="number"||c=="symbol"||c=="boolean"||n==null||er(n)?!0:yr.test(n)||!vn.test(n)||s!=null&&n in ut(s)}function ch(n){var s=typeof n;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?n!=="__proto__":n===null}function Mc(n){var s=Ql(n),c=I[s];if(typeof c!="function"||!(s in wt.prototype))return!1;if(n===c)return!0;var g=uh(c);return!!g&&n===g[0]}function Dp(n){return!!bu&&bu in n}var jm=Fa?Ws:Kd;function Uo(n){var s=n&&n.constructor,c=typeof s=="function"&&s.prototype||Qi;return n===c}function hh(n){return n===n&&!Sn(n)}function zh(n,s){return function(c){return c==null?!1:c[n]===s&&(s!==t||n in ut(c))}}function Lp(n){var s=Ne(n,function(g){return c.size===_&&c.clear(),g}),c=s.cache;return s}function kp(n,s){var c=n[1],g=s[1],E=c|g,F=E<(P|M|Q),W=g==Q&&c==L||g==Q&&c==te&&n[7].length<=s[8]||g==(Q|te)&&s[7].length<=s[8]&&c==L;if(!(F||W))return n;g&P&&(n[2]=s[2],E|=c&P?0:U);var Z=s[3];if(Z){var re=n[3];n[3]=re?gd(re,Z,s[4]):Z,n[4]=re?Mi(n[3],b):s[4]}return Z=s[5],Z&&(re=n[5],n[5]=re?Rf(re,Z,s[6]):Z,n[6]=re?Mi(n[5],b):s[6]),Z=s[7],Z&&(n[7]=Z),g&Q&&(n[8]=n[8]==null?s[8]:$n(n[8],s[8])),n[9]==null&&(n[9]=s[9]),n[0]=s[0],n[1]=E,n}function Fp(n){var s=[];if(n!=null)for(var c in ut(n))s.push(c);return s}function Ed(n){return Oa.call(n)}function Vh(n,s,c){return s=wn(s===t?n.length-1:s,0),function(){for(var g=arguments,E=-1,F=wn(g.length-s,0),W=K(F);++E<F;)W[E]=g[s+E];E=-1;for(var Z=K(s+1);++E<s;)Z[E]=g[E];return Z[s]=c(W),si(n,this,Z)}}function Or(n,s){return s.length<2?n:os(n,h(s,0,-1))}function ja(n,s){for(var c=n.length,g=$n(s.length,c),E=Ei(n);g--;){var F=s[g];n[g]=ti(F,c)?E[F]:t}return n}function fa(n,s){if(!(s==="constructor"&&typeof n[s]=="function")&&s!="__proto__")return n[s]}var Gf=da(bc),yl=Kc||function(n,s){return yn.setTimeout(n,s)},Gs=da(la);function Hf(n,s,c){var g=s+"";return Gs(n,Wm(g,Op(Ip(g),c)))}function da(n){var s=0,c=0;return function(){var g=md(),E=he-(g-c);if(c=g,E>0){if(++s>=ce)return arguments[0]}else s=0;return n.apply(t,arguments)}}function Ac(n,s){var c=-1,g=n.length,E=g-1;for(s=s===t?g:s;++c<s;){var F=gl(c,E),W=n[F];n[F]=n[c],n[c]=W}return n.length=s,n}var Wf=Lp(function(n){var s=[];return n.charCodeAt(0)===46&&s.push(""),n.replace(_i,function(c,g,E,F){s.push(E?F.replace(pu,"$1"):g||c)}),s});function wr(n){if(typeof n=="string"||er(n))return n;var s=n+"";return s=="0"&&1/n==-1/0?"-0":s}function ao(n){if(n!=null){try{return mr.call(n)}catch{}try{return n+""}catch{}}return""}function Op(n,s){return Qn(se,function(c){var g="_."+c[0];s&c[1]&&!Rr(n,g)&&n.push(g)}),n.sort()}function Cd(n){if(n instanceof wt)return n.clone();var s=new mi(n.__wrapped__,n.__chain__);return s.__actions__=Ei(n.__actions__),s.__index__=n.__index__,s.__values__=n.__values__,s}function jf(n,s,c){(c?gi(n,s,c):s===t)?s=1:s=wn(bt(s),0);var g=n==null?0:n.length;if(!g||s<1)return[];for(var E=0,F=0,W=K(Qo(g/s));E<g;)W[F++]=h(n,E,E+=s);return W}function Td(n){for(var s=-1,c=n==null?0:n.length,g=0,E=[];++s<c;){var F=n[s];F&&(E[g++]=F)}return E}function pa(){var n=arguments.length;if(!n)return[];for(var s=K(n-1),c=arguments[0],g=n;g--;)s[g-1]=arguments[g];return br(mt(c)?Ei(c):[c],An(s,1))}var Kn=yt(function(n,s){return Rn(n)?Ts(n,An(s,1,Rn,!0)):[]}),Qr=yt(function(n,s){var c=Oi(s);return Rn(c)&&(c=t),Rn(n)?Ts(n,An(s,1,Rn,!0),rt(c,2)):[]}),Sr=yt(function(n,s){var c=Oi(s);return Rn(c)&&(c=t),Rn(n)?Ts(n,An(s,1,Rn,!0),t,c):[]});function ls(n,s,c){var g=n==null?0:n.length;return g?(s=c||s===t?1:bt(s),h(n,s<0?0:s,g)):[]}function Bo(n,s,c){var g=n==null?0:n.length;return g?(s=c||s===t?1:bt(s),s=g-s,h(n,0,s<0?0:s)):[]}function fh(n,s){return n&&n.length?Pn(n,rt(s,3),!0,!0):[]}function Nr(n,s){return n&&n.length?Pn(n,rt(s,3),!0):[]}function Gh(n,s,c,g){var E=n==null?0:n.length;return E?(c&&typeof c!="number"&&gi(n,s,c)&&(c=0,g=E),Kl(n,s,c,g)):[]}function eu(n,s,c){var g=n==null?0:n.length;if(!g)return-1;var E=c==null?0:bt(c);return E<0&&(E=wn(g+E,0)),Yo(n,rt(s,3),E)}function dh(n,s,c){var g=n==null?0:n.length;if(!g)return-1;var E=g-1;return c!==t&&(E=bt(c),E=c<0?wn(g+E,0):$n(E,g-1)),Yo(n,rt(s,3),E,!0)}function Hh(n){var s=n==null?0:n.length;return s?An(n,1):[]}function Wh(n){var s=n==null?0:n.length;return s?An(n,Ie):[]}function lo(n,s){var c=n==null?0:n.length;return c?(s=s===t?1:bt(s),An(n,s)):[]}function Md(n){for(var s=-1,c=n==null?0:n.length,g={};++s<c;){var E=n[s];g[E[0]]=E[1]}return g}function Fu(n){return n&&n.length?n[0]:t}function tu(n,s,c){var g=n==null?0:n.length;if(!g)return-1;var E=c==null?0:bt(c);return E<0&&(E=wn(g+E,0)),Vr(n,s,E)}function Xf(n){var s=n==null?0:n.length;return s?h(n,0,-1):[]}var Ad=yt(function(n){var s=Ft(n,Fo);return s.length&&s[0]===n[0]?ml(s):[]}),Ou=yt(function(n){var s=Oi(n),c=Ft(n,Fo);return s===Oi(c)?s=t:c.pop(),c.length&&c[0]===n[0]?ml(c,rt(s,2)):[]}),qf=yt(function(n){var s=Oi(n),c=Ft(n,Fo);return s=typeof s=="function"?s:t,s&&c.pop(),c.length&&c[0]===n[0]?ml(c,t,s):[]});function Nu(n,s){return n==null?"":uc.call(n,s)}function Oi(n){var s=n==null?0:n.length;return s?n[s-1]:t}function jh(n,s,c){var g=n==null?0:n.length;if(!g)return-1;var E=g;return c!==t&&(E=bt(c),E=E<0?wn(g+E,0):$n(E,g-1)),s===s?La(n,s,E):Yo(n,Eo,E,!0)}function Pd(n,s){return n&&n.length?_c(n,bt(s)):t}var $f=yt(ph);function ph(n,s){return n&&n.length&&s&&s.length?Vi(n,s):n}function Hs(n,s,c){return n&&n.length&&s&&s.length?Vi(n,s,rt(c,2)):n}function Uu(n,s,c){return n&&n.length&&s&&s.length?Vi(n,s,t,c):n}var Xa=Zr(function(n,s){var c=n==null?0:n.length,g=Mu(n,s);return cr(n,Ft(s,function(E){return ti(E,c)?+E:E}).sort(Pf)),g});function uo(n,s){var c=[];if(!(n&&n.length))return c;var g=-1,E=[],F=n.length;for(s=rt(s,3);++g<F;){var W=n[g];s(W,g,n)&&(c.push(W),E.push(g))}return cr(n,E),c}function mh(n){return n==null?n:Jc.call(n)}function Rd(n,s,c){var g=n==null?0:n.length;return g?(c&&typeof c!="number"&&gi(n,s,c)?(s=0,c=g):(s=s==null?0:bt(s),c=c===t?g:bt(c)),h(n,s,c)):[]}function Id(n,s){return T(n,s)}function Xm(n,s,c){return q(n,s,rt(c,2))}function Bu(n,s){var c=n==null?0:n.length;if(c){var g=T(n,s);if(g<c&&Ur(n[g],s))return g}return-1}function Np(n,s){return T(n,s,!0)}function Dd(n,s,c){return q(n,s,rt(c,2),!0)}function Pc(n,s){var c=n==null?0:n.length;if(c){var g=T(n,s,!0)-1;if(Ur(n[g],s))return g}return-1}function Ld(n){return n&&n.length?ve(n):[]}function Rc(n,s){return n&&n.length?ve(n,rt(s,2)):[]}function Up(n){var s=n==null?0:n.length;return s?h(n,1,s):[]}function Bp(n,s,c){return n&&n.length?(s=c||s===t?1:bt(s),h(n,0,s<0?0:s)):[]}function kd(n,s,c){var g=n==null?0:n.length;return g?(s=c||s===t?1:bt(s),s=g-s,h(n,s<0?0:s,g)):[]}function Yf(n,s){return n&&n.length?Pn(n,rt(s,3),!1,!0):[]}function qm(n,s){return n&&n.length?Pn(n,rt(s,3)):[]}var $m=yt(function(n){return Ut(An(n,1,Rn,!0))}),zp=yt(function(n){var s=Oi(n);return Rn(s)&&(s=t),Ut(An(n,1,Rn,!0),rt(s,2))}),Vp=yt(function(n){var s=Oi(n);return s=typeof s=="function"?s:t,Ut(An(n,1,Rn,!0),t,s)});function Ic(n){return n&&n.length?Ut(n):[]}function Ym(n,s){return n&&n.length?Ut(n,rt(s,2)):[]}function vh(n,s){return s=typeof s=="function"?s:t,n&&n.length?Ut(n,t,s):[]}function gh(n){if(!(n&&n.length))return[];var s=0;return n=yi(n,function(c){if(Rn(c))return s=wn(c.length,s),!0}),Co(s,function(c){return Ft(n,Pa(c))})}function $i(n,s){if(!(n&&n.length))return[];var c=gh(n);return s==null?c:Ft(c,function(g){return si(s,t,g)})}var Km=yt(function(n,s){return Rn(n)?Ts(n,s):[]}),Gp=yt(function(n){return ua(yi(n,Rn))}),Zm=yt(function(n){var s=Oi(n);return Rn(s)&&(s=t),ua(yi(n,Rn),rt(s,2))}),Jm=yt(function(n){var s=Oi(n);return s=typeof s=="function"?s:t,ua(yi(n,Rn),t,s)}),Hp=yt(gh);function Wp(n,s){return ca(n||[],s||[],Ro)}function Qm(n,s){return ca(n||[],s||[],ro)}var ma=yt(function(n){var s=n.length,c=s>1?n[s-1]:t;return c=typeof c=="function"?(n.pop(),c):t,$i(n,c)});function Xh(n){var s=I(n);return s.__chain__=!0,s}function ev(n,s){return s(n),n}function co(n,s){return s(n)}var Kf=Zr(function(n){var s=n.length,c=s?n[0]:0,g=this.__wrapped__,E=function(F){return Mu(F,n)};return s>1||this.__actions__.length||!(g instanceof wt)||!ti(c)?this.thru(E):(g=g.slice(c,+c+(s?1:0)),g.__actions__.push({func:co,args:[E],thisArg:t}),new mi(g,this.__chain__).thru(function(F){return s&&!F.length&&F.push(t),F}))});function Dc(){return Xh(this)}function Zf(){return new mi(this.value(),this.__chain__)}function Fd(){this.__values__===t&&(this.__values__=fv(this.value()));var n=this.__index__>=this.__values__.length,s=n?t:this.__values__[this.__index__++];return{done:n,value:s}}function Od(){return this}function tv(n){for(var s,c=this;c instanceof ws;){var g=Cd(c);g.__index__=0,g.__values__=t,s?E.__wrapped__=g:s=g;var E=g;c=c.__wrapped__}return E.__wrapped__=n,s}function Nd(){var n=this.__wrapped__;if(n instanceof wt){var s=n;return this.__actions__.length&&(s=new wt(this)),s=s.reverse(),s.__actions__.push({func:co,args:[mh],thisArg:t}),new mi(s,this.__chain__)}return this.thru(mh)}function nv(){return Vs(this.__wrapped__,this.__actions__)}var jp=wc(function(n,s,c){Kt.call(n,c)?++n[c]:Pi(n,c,1)});function Xp(n,s,c){var g=mt(n)?Nl:Yl;return c&&gi(n,s,c)&&(s=t),g(n,rt(s,3))}function Jf(n,s){var c=mt(n)?yi:dc;return c(n,rt(s,3))}var Qf=Iu(eu),qp=Iu(dh);function Ud(n,s){return An(bl(n,s),1)}function iv(n,s){return An(bl(n,s),Ie)}function $p(n,s,c){return c=c===t?1:bt(c),An(bl(n,s),c)}function qh(n,s){var c=mt(n)?Qn:kr;return c(n,rt(s,3))}function _h(n,s){var c=mt(n)?Aa:Dh;return c(n,rt(s,3))}var Bd=wc(function(n,s,c){Kt.call(n,c)?n[c].push(s):Pi(n,c,[s])});function ed(n,s,c,g){n=Gi(n)?n:iu(n),c=c&&!g?bt(c):0;var E=n.length;return c<0&&(c=wn(E+c,0)),Kh(n)?c<=E&&n.indexOf(s,c)>-1:!!E&&Vr(n,s,c)>-1}var Yp=yt(function(n,s,c){var g=-1,E=typeof s=="function",F=Gi(n)?K(n.length):[];return kr(n,function(W){F[++g]=E?si(s,W,c):zi(W,s,c)}),F}),rv=wc(function(n,s,c){Pi(n,c,s)});function bl(n,s){var c=mt(n)?Ft:io;return c(n,rt(s,3))}function sv(n,s,c,g){return n==null?[]:(mt(s)||(s=s==null?[]:[s]),c=g?t:c,mt(c)||(c=c==null?[]:[c]),Ru(n,s,c))}var $h=wc(function(n,s,c){n[c?0:1].push(s)},function(){return[[],[]]});function ov(n,s,c){var g=mt(n)?So:Ko,E=arguments.length<3;return g(n,rt(s,4),c,E,kr)}function td(n,s,c){var g=mt(n)?nc:Ko,E=arguments.length<3;return g(n,rt(s,4),c,E,Dh)}function a(n,s){var c=mt(n)?yi:dc;return c(n,ct(rt(s,3)))}function u(n){var s=mt(n)?no:Yr;return s(n)}function p(n,s,c){(c?gi(n,s,c):s===t)?s=1:s=bt(s);var g=mt(n)?dl:Oh;return g(n,s)}function x(n){var s=mt(n)?Ef:y;return s(n)}function A(n){if(n==null)return 0;if(Gi(n))return Kh(n)?Hr(n):n.length;var s=ei(n);return s==_e||s==le?n.size:ko(n).length}function N(n,s,c){var g=mt(n)?ps:m;return c&&gi(n,s,c)&&(s=t),g(n,rt(s,3))}var ee=yt(function(n,s){if(n==null)return[];var c=s.length;return c>1&&gi(n,s[0],s[1])?s=[]:c>2&&gi(s[0],s[1],s[2])&&(s=[s[0]]),Ru(n,An(s,1),[])}),pe=pi||function(){return yn.Date.now()};function Ce(n,s){if(typeof s!="function")throw new Ui(f);return n=bt(n),function(){if(--n<1)return s.apply(this,arguments)}}function Ge(n,s,c){return s=c?t:s,s=n&&s==null?n.length:s,Kr(n,Q,t,t,t,t,s)}function nt(n,s){var c;if(typeof s!="function")throw new Ui(f);return n=bt(n),function(){return--n>0&&(c=s.apply(this,arguments)),n<=1&&(s=t),c}}var st=yt(function(n,s,c){var g=P;if(c.length){var E=Mi(c,so(st));g|=$}return Kr(n,g,s,c,E)}),tt=yt(function(n,s,c){var g=P|M;if(c.length){var E=Mi(c,so(tt));g|=$}return Kr(s,g,n,c,E)});function It(n,s,c){s=c?t:s;var g=Kr(n,L,t,t,t,t,t,s);return g.placeholder=It.placeholder,g}function Gt(n,s,c){s=c?t:s;var g=Kr(n,B,t,t,t,t,t,s);return g.placeholder=Gt.placeholder,g}function qt(n,s,c){var g,E,F,W,Z,re,xe=0,Ee=!1,Me=!1,We=!0;if(typeof n!="function")throw new Ui(f);s=_r(s)||0,Sn(c)&&(Ee=!!c.leading,Me="maxWait"in c,F=Me?wn(_r(c.maxWait)||0,s):F,We="trailing"in c?!!c.trailing:We);function Qe(In){var Br=g,Xs=E;return g=E=t,xe=In,W=n.apply(Xs,Br),W}function at(In){return xe=In,Z=yl(Lt,s),Ee?Qe(In):W}function Tt(In){var Br=In-re,Xs=In-xe,Cv=s-Br;return Me?$n(Cv,F-Xs):Cv}function lt(In){var Br=In-re,Xs=In-xe;return re===t||Br>=s||Br<0||Me&&Xs>=F}function Lt(){var In=pe();if(lt(In))return Bt(In);Z=yl(Lt,Tt(In))}function Bt(In){return Z=t,We&&g?Qe(In):(g=E=t,W)}function tr(){Z!==t&&Mf(Z),xe=0,g=re=E=Z=t}function Ii(){return Z===t?W:Bt(pe())}function nr(){var In=pe(),Br=lt(In);if(g=arguments,E=this,re=In,Br){if(Z===t)return at(re);if(Me)return Mf(Z),Z=yl(Lt,s),Qe(re)}return Z===t&&(Z=yl(Lt,s)),W}return nr.cancel=tr,nr.flush=Ii,nr}var gr=yt(function(n,s){return fc(n,1,s)}),Fe=yt(function(n,s,c){return fc(n,_r(s)||0,c)});function Pe(n){return Kr(n,V)}function Ne(n,s){if(typeof n!="function"||s!=null&&typeof s!="function")throw new Ui(f);var c=function(){var g=arguments,E=s?s.apply(this,g):g[0],F=c.cache;if(F.has(E))return F.get(E);var W=n.apply(this,g);return c.cache=F.set(E,W)||F,W};return c.cache=new(Ne.Cache||ur),c}Ne.Cache=ur;function ct(n){if(typeof n!="function")throw new Ui(f);return function(){var s=arguments;switch(s.length){case 0:return!n.call(this);case 1:return!n.call(this,s[0]);case 2:return!n.call(this,s[0],s[1]);case 3:return!n.call(this,s[0],s[1],s[2])}return!n.apply(this,s)}}function Jt(n){return nt(2,n)}var dn=Ep(function(n,s){s=s.length==1&&mt(s[0])?Ft(s[0],ai(rt())):Ft(An(s,1),ai(rt()));var c=s.length;return yt(function(g){for(var E=-1,F=$n(g.length,c);++E<F;)g[E]=s[E].call(this,g[E]);return si(n,this,g)})}),sn=yt(function(n,s){var c=Mi(s,so(sn));return Kr(n,$,t,s,c)}),_n=yt(function(n,s){var c=Mi(s,so(_n));return Kr(n,X,t,s,c)}),es=Zr(function(n,s){return Kr(n,te,t,t,t,s)});function ni(n,s){if(typeof n!="function")throw new Ui(f);return s=s===t?s:bt(s),yt(n,s)}function zu(n,s){if(typeof n!="function")throw new Ui(f);return s=s==null?0:wn(bt(s),0),yt(function(c){var g=c[s],E=As(c,0,s);return g&&br(E,g),si(n,this,E)})}function av(n,s,c){var g=!0,E=!0;if(typeof n!="function")throw new Ui(f);return Sn(c)&&(g="leading"in c?!!c.leading:g,E="trailing"in c?!!c.trailing:E),qt(n,s,{leading:g,maxWait:s,trailing:E})}function a_(n){return Ge(n,1)}function l_(n,s){return sn(ah(s),n)}function u_(){if(!arguments.length)return[];var n=arguments[0];return mt(n)?n:[n]}function c_(n){return Ri(n,R)}function h_(n,s){return s=typeof s=="function"?s:t,Ri(n,R,s)}function f_(n){return Ri(n,w|R)}function d_(n,s){return s=typeof s=="function"?s:t,Ri(n,w|R,s)}function p_(n,s){return s==null||Do(n,s,Zn(s))}function Ur(n,s){return n===s||n!==n&&s!==s}var m_=Sc(ia),v_=Sc(function(n,s){return n>=s}),qa=pc(function(){return arguments}())?pc:function(n){return Tn(n)&&Kt.call(n,"callee")&&!lc.call(n,"callee")},mt=K.isArray,g_=il?ai(il):Tf;function Gi(n){return n!=null&&Yh(n.length)&&!Ws(n)}function Rn(n){return Tn(n)&&Gi(n)}function __(n){return n===!0||n===!1||Tn(n)&&Hn(n)==He}var zo=Zc||Kd,y_=Ar?ai(Ar):Lo;function b_(n){return Tn(n)&&n.nodeType===1&&!Lc(n)}function x_(n){if(n==null)return!0;if(Gi(n)&&(mt(n)||typeof n=="string"||typeof n.splice=="function"||zo(n)||nu(n)||qa(n)))return!n.length;var s=ei(n);if(s==_e||s==le)return!n.size;if(Uo(n))return!ko(n).length;for(var c in n)if(Kt.call(n,c))return!1;return!0}function w_(n,s){return $r(n,s)}function S_(n,s,c){c=typeof c=="function"?c:t;var g=c?c(n,s):t;return g===t?$r(n,s,t,c):!!g}function zd(n){if(!Tn(n))return!1;var s=Hn(n);return s==Wt||s==pt||typeof n.message=="string"&&typeof n.name=="string"&&!Lc(n)}function E_(n){return typeof n=="number"&&Ba(n)}function Ws(n){if(!Sn(n))return!1;var s=Hn(n);return s==zt||s==bn||s==Be||s==Mn}function lv(n){return typeof n=="number"&&n==bt(n)}function Yh(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=ae}function Sn(n){var s=typeof n;return n!=null&&(s=="object"||s=="function")}function Tn(n){return n!=null&&typeof n=="object"}var uv=Pr?ai(Pr):kh;function C_(n,s){return n===s||vl(n,s,Tc(s))}function T_(n,s,c){return c=typeof c=="function"?c:t,vl(n,s,Tc(s),c)}function M_(n){return cv(n)&&n!=+n}function A_(n){if(jm(n))throw new Xe(l);return rh(n)}function P_(n){return n===null}function R_(n){return n==null}function cv(n){return typeof n=="number"||Tn(n)&&Hn(n)==Ln}function Lc(n){if(!Tn(n)||Hn(n)!=Nt)return!1;var s=ys(n);if(s===null)return!0;var c=Kt.call(s,"constructor")&&s.constructor;return typeof c=="function"&&c instanceof c&&mr.call(c)==oc}var Vd=Ta?ai(Ta):mc;function I_(n){return lv(n)&&n>=-9007199254740991&&n<=ae}var hv=Ma?ai(Ma):ra;function Kh(n){return typeof n=="string"||!mt(n)&&Tn(n)&&Hn(n)==ne}function er(n){return typeof n=="symbol"||Tn(n)&&Hn(n)==Oe}var nu=Ol?ai(Ol):vc;function D_(n){return n===t}function L_(n){return Tn(n)&&ei(n)==Je}function k_(n){return Tn(n)&&Hn(n)==Ye}var F_=Sc(sa),O_=Sc(function(n,s){return n<=s});function fv(n){if(!n)return[];if(Gi(n))return Kh(n)?Ai(n):Ei(n);if(bs&&n[bs])return Ia(n[bs]());var s=ei(n),c=s==_e?vs:s==le?gs:iu;return c(n)}function js(n){if(!n)return n===0?n:0;if(n=_r(n),n===Ie||n===-1/0){var s=n<0?-1:1;return s*ye}return n===n?n:0}function bt(n){var s=js(n),c=s%1;return s===s?c?s-c:s:0}function dv(n){return n?qr(bt(n),0,ie):0}function _r(n){if(typeof n=="number")return n;if(er(n))return de;if(Sn(n)){var s=typeof n.valueOf=="function"?n.valueOf():n;n=Sn(s)?s+"":s}if(typeof n!="string")return n===0?n:+n;n=Ir(n);var c=xa.test(n);return c||vu.test(n)?kl(n.slice(2),c?2:8):mu.test(n)?de:+n}function pv(n){return xr(n,Hi(n))}function N_(n){return n?qr(bt(n),-9007199254740991,ae):n===0?n:0}function en(n){return n==null?"":$e(n)}var U_=Wa(function(n,s){if(Uo(s)||Gi(s)){xr(s,Zn(s),n);return}for(var c in s)Kt.call(s,c)&&Ro(n,c,s[c])}),mv=Wa(function(n,s){xr(s,Hi(s),n)}),Zh=Wa(function(n,s,c,g){xr(s,Hi(s),n,g)}),B_=Wa(function(n,s,c,g){xr(s,Zn(s),n,g)}),z_=Zr(Mu);function V_(n,s){var c=Ns(n);return s==null?c:Yn(c,s)}var G_=yt(function(n,s){n=ut(n);var c=-1,g=s.length,E=g>2?s[2]:t;for(E&&gi(s[0],s[1],E)&&(g=1);++c<g;)for(var F=s[c],W=Hi(F),Z=-1,re=W.length;++Z<re;){var xe=W[Z],Ee=n[xe];(Ee===t||Ur(Ee,Qi[xe])&&!Kt.call(n,xe))&&(n[xe]=F[xe])}return n}),H_=yt(function(n){return n.push(t,Nf),si(vv,t,n)});function W_(n,s){return ms(n,rt(s,3),qi)}function j_(n,s){return ms(n,rt(s,3),na)}function X_(n,s){return n==null?n:Au(n,rt(s,3),Hi)}function q_(n,s){return n==null?n:Pu(n,rt(s,3),Hi)}function $_(n,s){return n&&qi(n,rt(s,3))}function Y_(n,s){return n&&na(n,rt(s,3))}function K_(n){return n==null?[]:za(n,Zn(n))}function Z_(n){return n==null?[]:za(n,Hi(n))}function Gd(n,s,c){var g=n==null?t:os(n,s);return g===t?c:g}function J_(n,s){return n!=null&&zf(n,s,Ms)}function Hd(n,s){return n!=null&&zf(n,s,pl)}var Q_=yd(function(n,s,c){s!=null&&typeof s.toString!="function"&&(s=Oa.call(s)),n[s]=c},jd(Wi)),e1=yd(function(n,s,c){s!=null&&typeof s.toString!="function"&&(s=Oa.call(s)),Kt.call(n,s)?n[s].push(c):n[s]=[c]},rt),t1=yt(zi);function Zn(n){return Gi(n)?zs(n):ko(n)}function Hi(n){return Gi(n)?zs(n,!0):Fh(n)}function n1(n,s){var c={};return s=rt(s,3),qi(n,function(g,E,F){Pi(c,s(g,E,F),g)}),c}function i1(n,s){var c={};return s=rt(s,3),qi(n,function(g,E,F){Pi(c,E,s(g,E,F))}),c}var r1=Wa(function(n,s,c){oa(n,s,c)}),vv=Wa(function(n,s,c,g){oa(n,s,c,g)}),s1=Zr(function(n,s){var c={};if(n==null)return c;var g=!1;s=Ft(s,function(F){return F=as(F,n),g||(g=F.length>1),F}),xr(n,Cc(n),c),g&&(c=Ri(c,w|C|R,bd));for(var E=s.length;E--;)ln(c,s[E]);return c});function o1(n,s){return gv(n,ct(rt(s)))}var a1=Zr(function(n,s){return n==null?{}:oh(n,s)});function gv(n,s){if(n==null)return{};var c=Ft(Cc(n),function(g){return[g]});return s=rt(s),aa(n,c,function(g,E){return s(g,E[0])})}function l1(n,s,c){s=as(s,n);var g=-1,E=s.length;for(E||(E=1,n=t);++g<E;){var F=n==null?t:n[wr(s[g])];F===t&&(g=E,F=c),n=Ws(F)?F.call(n):F}return n}function u1(n,s,c){return n==null?n:ro(n,s,c)}function c1(n,s,c,g){return g=typeof g=="function"?g:t,n==null?n:ro(n,s,c,g)}var _v=Ff(Zn),yv=Ff(Hi);function h1(n,s,c){var g=mt(n),E=g||zo(n)||nu(n);if(s=rt(s,4),c==null){var F=n&&n.constructor;E?c=g?new F:[]:Sn(n)?c=Ws(F)?Ns(ys(n)):{}:c={}}return(E?Qn:qi)(n,function(W,Z,re){return s(c,W,Z,re)}),c}function f1(n,s){return n==null?!0:ln(n,s)}function d1(n,s,c){return n==null?n:On(n,s,ah(c))}function p1(n,s,c,g){return g=typeof g=="function"?g:t,n==null?n:On(n,s,ah(c),g)}function iu(n){return n==null?[]:Ls(n,Zn(n))}function m1(n){return n==null?[]:Ls(n,Hi(n))}function v1(n,s,c){return c===t&&(c=s,s=t),c!==t&&(c=_r(c),c=c===c?c:0),s!==t&&(s=_r(s),s=s===s?s:0),qr(_r(n),s,c)}function g1(n,s,c){return s=js(s),c===t?(c=s,s=0):c=js(c),n=_r(n),Lh(n,s,c)}function _1(n,s,c){if(c&&typeof c!="boolean"&&gi(n,s,c)&&(s=c=t),c===t&&(typeof s=="boolean"?(c=s,s=t):typeof n=="boolean"&&(c=n,n=t)),n===t&&s===t?(n=0,s=1):(n=js(n),s===t?(s=n,n=0):s=js(s)),n>s){var g=n;n=s,s=g}if(c||n%1||s%1){var E=Wl();return $n(n+E*(s-n+ec("1e-"+((E+"").length-1))),s)}return gl(n,s)}var y1=ha(function(n,s,c){return s=s.toLowerCase(),n+(c?bv(s):s)});function bv(n){return Wd(en(n).toLowerCase())}function xv(n){return n=en(n),n&&n.replace(De,_u).replace(Ju,"")}function b1(n,s,c){n=en(n),s=$e(s);var g=n.length;c=c===t?g:qr(bt(c),0,g);var E=c;return c-=s.length,c>=0&&n.slice(c,E)==s}function x1(n){return n=en(n),n&&Et.test(n)?n.replace(Ke,Qs):n}function w1(n){return n=en(n),n&&hs.test(n)?n.replace(Ds,"\\$&"):n}var S1=ha(function(n,s,c){return n+(c?"-":"")+s.toLowerCase()}),E1=ha(function(n,s,c){return n+(c?" ":"")+s.toLowerCase()}),C1=Lf("toLowerCase");function T1(n,s,c){n=en(n),s=bt(s);var g=s?Hr(n):0;if(!s||g>=s)return n;var E=(s-g)/2;return Lu(Fs(E),c)+n+Lu(Qo(E),c)}function M1(n,s,c){n=en(n),s=bt(s);var g=s?Hr(n):0;return s&&g<s?n+Lu(s-g,c):n}function A1(n,s,c){n=en(n),s=bt(s);var g=s?Hr(n):0;return s&&g<s?Lu(s-g,c)+n:n}function P1(n,s,c){return c||s==null?s=0:s&&(s=+s),_f(en(n).replace(zr,""),s||0)}function R1(n,s,c){return(c?gi(n,s,c):s===t)?s=1:s=bt(s),Ha(en(n),s)}function I1(){var n=arguments,s=en(n[0]);return n.length<3?s:s.replace(n[1],n[2])}var D1=ha(function(n,s,c){return n+(c?"_":"")+s.toLowerCase()});function L1(n,s,c){return c&&typeof c!="number"&&gi(n,s,c)&&(s=c=t),c=c===t?ie:c>>>0,c?(n=en(n),n&&(typeof s=="string"||s!=null&&!Vd(s))&&(s=$e(s),!s&&ks(n))?As(Ai(n),0,c):n.split(s,c)):[]}var k1=ha(function(n,s,c){return n+(c?" ":"")+Wd(s)});function F1(n,s,c){return n=en(n),c=c==null?0:qr(bt(c),0,n.length),s=$e(s),n.slice(c,c+s.length)==s}function O1(n,s,c){var g=I.templateSettings;c&&gi(n,s,c)&&(s=t),n=en(n),s=Zh({},s,g,Of);var E=Zh({},s.imports,g.imports,Of),F=Zn(E),W=Ls(E,F),Z,re,xe=0,Ee=s.interpolate||Ue,Me="__p += '",We=Wr((s.escape||Ue).source+"|"+Ee.source+"|"+(Ee===Ti?ds:Ue).source+"|"+(s.evaluate||Ue).source+"|$","g"),Qe="//# sourceURL="+(Kt.call(s,"sourceURL")?(s.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Qu+"]")+`
`;n.replace(We,function(lt,Lt,Bt,tr,Ii,nr){return Bt||(Bt=tr),Me+=n.slice(xe,nr).replace(Ve,rc),Lt&&(Z=!0,Me+=`' +
__e(`+Lt+`) +
'`),Ii&&(re=!0,Me+=`';
`+Ii+`;
__p += '`),Bt&&(Me+=`' +
((__t = (`+Bt+`)) == null ? '' : __t) +
'`),xe=nr+lt.length,lt}),Me+=`';
`;var at=Kt.call(s,"variable")&&s.variable;if(!at)Me=`with (obj) {
`+Me+`
}
`;else if(tl.test(at))throw new Xe(d);Me=(re?Me.replace(Vn,""):Me).replace(Re,"$1").replace(gt,"$1;"),Me="function("+(at||"obj")+`) {
`+(at?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Z?", __e = _.escape":"")+(re?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Me+`return __p
}`;var Tt=Sv(function(){return Ct(F,Qe+"return "+Me).apply(t,W)});if(Tt.source=Me,zd(Tt))throw Tt;return Tt}function N1(n){return en(n).toLowerCase()}function U1(n){return en(n).toUpperCase()}function B1(n,s,c){if(n=en(n),n&&(c||s===t))return Ir(n);if(!n||!(s=$e(s)))return n;var g=Ai(n),E=Ai(s),F=sl(g,E),W=Gr(g,E)+1;return As(g,F,W).join("")}function z1(n,s,c){if(n=en(n),n&&(c||s===t))return n.slice(0,Vl(n)+1);if(!n||!(s=$e(s)))return n;var g=Ai(n),E=Gr(g,Ai(s))+1;return As(g,0,E).join("")}function V1(n,s,c){if(n=en(n),n&&(c||s===t))return n.replace(zr,"");if(!n||!(s=$e(s)))return n;var g=Ai(n),E=sl(g,Ai(s));return As(g,E).join("")}function G1(n,s){var c=H,g=J;if(Sn(s)){var E="separator"in s?s.separator:E;c="length"in s?bt(s.length):c,g="omission"in s?$e(s.omission):g}n=en(n);var F=n.length;if(ks(n)){var W=Ai(n);F=W.length}if(c>=F)return n;var Z=c-Hr(g);if(Z<1)return g;var re=W?As(W,0,Z).join(""):n.slice(0,Z);if(E===t)return re+g;if(W&&(Z+=re.length-Z),Vd(E)){if(n.slice(Z).search(E)){var xe,Ee=re;for(E.global||(E=Wr(E.source,en(nl.exec(E))+"g")),E.lastIndex=0;xe=E.exec(Ee);)var Me=xe.index;re=re.slice(0,Me===t?Z:Me)}}else if(n.indexOf($e(E),Z)!=Z){var We=re.lastIndexOf(E);We>-1&&(re=re.slice(0,We))}return re+g}function H1(n){return n=en(n),n&&Mt.test(n)?n.replace(je,$c):n}var W1=ha(function(n,s,c){return n+(c?" ":"")+s.toUpperCase()}),Wd=Lf("toUpperCase");function wv(n,s,c){return n=en(n),s=c?t:s,s===t?yu(n)?S(n):Bl(n):n.match(s)||[]}var Sv=yt(function(n,s){try{return si(n,t,s)}catch(c){return zd(c)?c:new Xe(c)}}),j1=Zr(function(n,s){return Qn(s,function(c){c=wr(c),Pi(n,c,st(n[c],n))}),n});function X1(n){var s=n==null?0:n.length,c=rt();return n=s?Ft(n,function(g){if(typeof g[1]!="function")throw new Ui(f);return[c(g[0]),g[1]]}):[],yt(function(g){for(var E=-1;++E<s;){var F=n[E];if(si(F[0],this,g))return si(F[1],this,g)}})}function q1(n){return Cf(Ri(n,w))}function jd(n){return function(){return n}}function $1(n,s){return n==null||n!==n?s:n}var Y1=Uh(),K1=Uh(!0);function Wi(n){return n}function Xd(n){return Zl(typeof n=="function"?n:Ri(n,w))}function Z1(n){return gc(Ri(n,w))}function J1(n,s){return Si(n,Ri(s,w))}var Q1=yt(function(n,s){return function(c){return zi(c,n,s)}}),ey=yt(function(n,s){return function(c){return zi(n,c,s)}});function qd(n,s,c){var g=Zn(s),E=za(s,g);c==null&&!(Sn(s)&&(E.length||!g.length))&&(c=s,s=n,n=this,E=za(s,Zn(s)));var F=!(Sn(c)&&"chain"in c)||!!c.chain,W=Ws(n);return Qn(E,function(Z){var re=s[Z];n[Z]=re,W&&(n.prototype[Z]=function(){var xe=this.__chain__;if(F||xe){var Ee=n(this.__wrapped__),Me=Ee.__actions__=Ei(this.__actions__);return Me.push({func:re,args:arguments,thisArg:n}),Ee.__chain__=xe,Ee}return re.apply(n,br([this.value()],arguments))})}),n}function ty(){return yn._===this&&(yn._=Ah),this}function $d(){}function ny(n){return n=bt(n),yt(function(s){return _c(s,n)})}var iy=lh(Ft),ry=lh(Nl),sy=lh(ps);function Ev(n){return Ot(n)?Pa(wr(n)):Fi(n)}function oy(n){return function(s){return n==null?t:os(n,s)}}var ay=kf(),ly=kf(!0);function Yd(){return[]}function Kd(){return!1}function uy(){return{}}function cy(){return""}function hy(){return!0}function fy(n,s){if(n=bt(n),n<1||n>ae)return[];var c=ie,g=$n(n,ie);s=rt(s),n-=ie;for(var E=Co(g,s);++c<n;)s(c);return E}function dy(n){return mt(n)?Ft(n,wr):er(n)?[n]:Ei(Wf(en(n)))}function py(n){var s=++Gl;return en(n)+s}var my=Du(function(n,s){return n+s},0),vy=Fr("ceil"),gy=Du(function(n,s){return n/s},1),_y=Fr("floor");function yy(n){return n&&n.length?ta(n,Wi,ia):t}function by(n,s){return n&&n.length?ta(n,rt(s,2),ia):t}function xy(n){return oi(n,Wi)}function wy(n,s){return oi(n,rt(s,2))}function Sy(n){return n&&n.length?ta(n,Wi,sa):t}function Ey(n,s){return n&&n.length?ta(n,rt(s,2),sa):t}var Cy=Du(function(n,s){return n*s},1),Ty=Fr("round"),My=Du(function(n,s){return n-s},0);function Ay(n){return n&&n.length?Ra(n,Wi):0}function Py(n,s){return n&&n.length?Ra(n,rt(s,2)):0}return I.after=Ce,I.ary=Ge,I.assign=U_,I.assignIn=mv,I.assignInWith=Zh,I.assignWith=B_,I.at=z_,I.before=nt,I.bind=st,I.bindAll=j1,I.bindKey=tt,I.castArray=u_,I.chain=Xh,I.chunk=jf,I.compact=Td,I.concat=pa,I.cond=X1,I.conforms=q1,I.constant=jd,I.countBy=jp,I.create=V_,I.curry=It,I.curryRight=Gt,I.debounce=qt,I.defaults=G_,I.defaultsDeep=H_,I.defer=gr,I.delay=Fe,I.difference=Kn,I.differenceBy=Qr,I.differenceWith=Sr,I.drop=ls,I.dropRight=Bo,I.dropRightWhile=fh,I.dropWhile=Nr,I.fill=Gh,I.filter=Jf,I.flatMap=Ud,I.flatMapDeep=iv,I.flatMapDepth=$p,I.flatten=Hh,I.flattenDeep=Wh,I.flattenDepth=lo,I.flip=Pe,I.flow=Y1,I.flowRight=K1,I.fromPairs=Md,I.functions=K_,I.functionsIn=Z_,I.groupBy=Bd,I.initial=Xf,I.intersection=Ad,I.intersectionBy=Ou,I.intersectionWith=qf,I.invert=Q_,I.invertBy=e1,I.invokeMap=Yp,I.iteratee=Xd,I.keyBy=rv,I.keys=Zn,I.keysIn=Hi,I.map=bl,I.mapKeys=n1,I.mapValues=i1,I.matches=Z1,I.matchesProperty=J1,I.memoize=Ne,I.merge=r1,I.mergeWith=vv,I.method=Q1,I.methodOf=ey,I.mixin=qd,I.negate=ct,I.nthArg=ny,I.omit=s1,I.omitBy=o1,I.once=Jt,I.orderBy=sv,I.over=iy,I.overArgs=dn,I.overEvery=ry,I.overSome=sy,I.partial=sn,I.partialRight=_n,I.partition=$h,I.pick=a1,I.pickBy=gv,I.property=Ev,I.propertyOf=oy,I.pull=$f,I.pullAll=ph,I.pullAllBy=Hs,I.pullAllWith=Uu,I.pullAt=Xa,I.range=ay,I.rangeRight=ly,I.rearg=es,I.reject=a,I.remove=uo,I.rest=ni,I.reverse=mh,I.sampleSize=p,I.set=u1,I.setWith=c1,I.shuffle=x,I.slice=Rd,I.sortBy=ee,I.sortedUniq=Ld,I.sortedUniqBy=Rc,I.split=L1,I.spread=zu,I.tail=Up,I.take=Bp,I.takeRight=kd,I.takeRightWhile=Yf,I.takeWhile=qm,I.tap=ev,I.throttle=av,I.thru=co,I.toArray=fv,I.toPairs=_v,I.toPairsIn=yv,I.toPath=dy,I.toPlainObject=pv,I.transform=h1,I.unary=a_,I.union=$m,I.unionBy=zp,I.unionWith=Vp,I.uniq=Ic,I.uniqBy=Ym,I.uniqWith=vh,I.unset=f1,I.unzip=gh,I.unzipWith=$i,I.update=d1,I.updateWith=p1,I.values=iu,I.valuesIn=m1,I.without=Km,I.words=wv,I.wrap=l_,I.xor=Gp,I.xorBy=Zm,I.xorWith=Jm,I.zip=Hp,I.zipObject=Wp,I.zipObjectDeep=Qm,I.zipWith=ma,I.entries=_v,I.entriesIn=yv,I.extend=mv,I.extendWith=Zh,qd(I,I),I.add=my,I.attempt=Sv,I.camelCase=y1,I.capitalize=bv,I.ceil=vy,I.clamp=v1,I.clone=c_,I.cloneDeep=f_,I.cloneDeepWith=d_,I.cloneWith=h_,I.conformsTo=p_,I.deburr=xv,I.defaultTo=$1,I.divide=gy,I.endsWith=b1,I.eq=Ur,I.escape=x1,I.escapeRegExp=w1,I.every=Xp,I.find=Qf,I.findIndex=eu,I.findKey=W_,I.findLast=qp,I.findLastIndex=dh,I.findLastKey=j_,I.floor=_y,I.forEach=qh,I.forEachRight=_h,I.forIn=X_,I.forInRight=q_,I.forOwn=$_,I.forOwnRight=Y_,I.get=Gd,I.gt=m_,I.gte=v_,I.has=J_,I.hasIn=Hd,I.head=Fu,I.identity=Wi,I.includes=ed,I.indexOf=tu,I.inRange=g1,I.invoke=t1,I.isArguments=qa,I.isArray=mt,I.isArrayBuffer=g_,I.isArrayLike=Gi,I.isArrayLikeObject=Rn,I.isBoolean=__,I.isBuffer=zo,I.isDate=y_,I.isElement=b_,I.isEmpty=x_,I.isEqual=w_,I.isEqualWith=S_,I.isError=zd,I.isFinite=E_,I.isFunction=Ws,I.isInteger=lv,I.isLength=Yh,I.isMap=uv,I.isMatch=C_,I.isMatchWith=T_,I.isNaN=M_,I.isNative=A_,I.isNil=R_,I.isNull=P_,I.isNumber=cv,I.isObject=Sn,I.isObjectLike=Tn,I.isPlainObject=Lc,I.isRegExp=Vd,I.isSafeInteger=I_,I.isSet=hv,I.isString=Kh,I.isSymbol=er,I.isTypedArray=nu,I.isUndefined=D_,I.isWeakMap=L_,I.isWeakSet=k_,I.join=Nu,I.kebabCase=S1,I.last=Oi,I.lastIndexOf=jh,I.lowerCase=E1,I.lowerFirst=C1,I.lt=F_,I.lte=O_,I.max=yy,I.maxBy=by,I.mean=xy,I.meanBy=wy,I.min=Sy,I.minBy=Ey,I.stubArray=Yd,I.stubFalse=Kd,I.stubObject=uy,I.stubString=cy,I.stubTrue=hy,I.multiply=Cy,I.nth=Pd,I.noConflict=ty,I.noop=$d,I.now=pe,I.pad=T1,I.padEnd=M1,I.padStart=A1,I.parseInt=P1,I.random=_1,I.reduce=ov,I.reduceRight=td,I.repeat=R1,I.replace=I1,I.result=l1,I.round=Ty,I.runInContext=k,I.sample=u,I.size=A,I.snakeCase=D1,I.some=N,I.sortedIndex=Id,I.sortedIndexBy=Xm,I.sortedIndexOf=Bu,I.sortedLastIndex=Np,I.sortedLastIndexBy=Dd,I.sortedLastIndexOf=Pc,I.startCase=k1,I.startsWith=F1,I.subtract=My,I.sum=Ay,I.sumBy=Py,I.template=O1,I.times=fy,I.toFinite=js,I.toInteger=bt,I.toLength=dv,I.toLower=N1,I.toNumber=_r,I.toSafeInteger=N_,I.toString=en,I.toUpper=U1,I.trim=B1,I.trimEnd=z1,I.trimStart=V1,I.truncate=G1,I.unescape=H1,I.uniqueId=py,I.upperCase=W1,I.upperFirst=Wd,I.each=qh,I.eachRight=_h,I.first=Fu,qd(I,function(){var n={};return qi(I,function(s,c){Kt.call(I.prototype,c)||(n[c]=s)}),n}(),{chain:!1}),I.VERSION=i,Qn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){I[n].placeholder=I}),Qn(["drop","take"],function(n,s){wt.prototype[n]=function(c){c=c===t?1:wn(bt(c),0);var g=this.__filtered__&&!s?new wt(this):this.clone();return g.__filtered__?g.__takeCount__=$n(c,g.__takeCount__):g.__views__.push({size:$n(c,ie),type:n+(g.__dir__<0?"Right":"")}),g},wt.prototype[n+"Right"]=function(c){return this.reverse()[n](c).reverse()}}),Qn(["filter","map","takeWhile"],function(n,s){var c=s+1,g=c==ge||c==me;wt.prototype[n]=function(E){var F=this.clone();return F.__iteratees__.push({iteratee:rt(E,3),type:c}),F.__filtered__=F.__filtered__||g,F}}),Qn(["head","last"],function(n,s){var c="take"+(s?"Right":"");wt.prototype[n]=function(){return this[c](1).value()[0]}}),Qn(["initial","tail"],function(n,s){var c="drop"+(s?"":"Right");wt.prototype[n]=function(){return this.__filtered__?new wt(this):this[c](1)}}),wt.prototype.compact=function(){return this.filter(Wi)},wt.prototype.find=function(n){return this.filter(n).head()},wt.prototype.findLast=function(n){return this.reverse().find(n)},wt.prototype.invokeMap=yt(function(n,s){return typeof n=="function"?new wt(this):this.map(function(c){return zi(c,n,s)})}),wt.prototype.reject=function(n){return this.filter(ct(rt(n)))},wt.prototype.slice=function(n,s){n=bt(n);var c=this;return c.__filtered__&&(n>0||s<0)?new wt(c):(n<0?c=c.takeRight(-n):n&&(c=c.drop(n)),s!==t&&(s=bt(s),c=s<0?c.dropRight(-s):c.take(s-n)),c)},wt.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},wt.prototype.toArray=function(){return this.take(ie)},qi(wt.prototype,function(n,s){var c=/^(?:filter|find|map|reject)|While$/.test(s),g=/^(?:head|last)$/.test(s),E=I[g?"take"+(s=="last"?"Right":""):s],F=g||/^find/.test(s);E&&(I.prototype[s]=function(){var W=this.__wrapped__,Z=g?[1]:arguments,re=W instanceof wt,xe=Z[0],Ee=re||mt(W),Me=function(Lt){var Bt=E.apply(I,br([Lt],Z));return g&&We?Bt[0]:Bt};Ee&&c&&typeof xe=="function"&&xe.length!=1&&(re=Ee=!1);var We=this.__chain__,Qe=!!this.__actions__.length,at=F&&!We,Tt=re&&!Qe;if(!F&&Ee){W=Tt?W:new wt(this);var lt=n.apply(W,Z);return lt.__actions__.push({func:co,args:[Me],thisArg:t}),new mi(lt,We)}return at&&Tt?n.apply(this,Z):(lt=this.thru(Me),at?g?lt.value()[0]:lt.value():lt)})}),Qn(["pop","push","shift","sort","splice","unshift"],function(n){var s=_s[n],c=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",g=/^(?:pop|shift)$/.test(n);I.prototype[n]=function(){var E=arguments;if(g&&!this.__chain__){var F=this.value();return s.apply(mt(F)?F:[],E)}return this[c](function(W){return s.apply(mt(W)?W:[],E)})}}),qi(wt.prototype,function(n,s){var c=I[s];if(c){var g=c.name+"";Kt.call(jr,g)||(jr[g]=[]),jr[g].push({name:s,func:c})}}),jr[Jl(t,M).name]=[{name:"wrapper",func:t}],wt.prototype.clone=Qc,wt.prototype.reverse=hc,wt.prototype.value=Eu,I.prototype.at=Kf,I.prototype.chain=Dc,I.prototype.commit=Zf,I.prototype.next=Fd,I.prototype.plant=tv,I.prototype.reverse=Nd,I.prototype.toJSON=I.prototype.valueOf=I.prototype.value=nv,I.prototype.first=I.prototype.head,bs&&(I.prototype[bs]=Od),I},j=D();dr?((dr.exports=j)._=j,Ca._=j):yn._=j}).call(QM)}(Hv,Hv.exports)),Hv.exports}var lu=eA(),Mg,tA=new Uint8Array(16);function nA(){if(!Mg&&(Mg=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Mg))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Mg(tA)}const iA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function rA(r){return typeof r=="string"&&iA.test(r)}var Vo=[];for(var Fy=0;Fy<256;++Fy)Vo.push((Fy+256).toString(16).substr(1));function sA(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Vo[r[e+0]]+Vo[r[e+1]]+Vo[r[e+2]]+Vo[r[e+3]]+"-"+Vo[r[e+4]]+Vo[r[e+5]]+"-"+Vo[r[e+6]]+Vo[r[e+7]]+"-"+Vo[r[e+8]]+Vo[r[e+9]]+"-"+Vo[r[e+10]]+Vo[r[e+11]]+Vo[r[e+12]]+Vo[r[e+13]]+Vo[r[e+14]]+Vo[r[e+15]]).toLowerCase();if(!rA(t))throw TypeError("Stringified UUID is invalid");return t}function nS(r,e,t){r=r||{};var i=r.random||(r.rng||nA)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,sA(i)}function Xn(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Tm(r){"@babel/helpers - typeof";return Tm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tm(r)}function oA(r,e){if(Tm(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Tm(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function XC(r){var e=oA(r,"string");return Tm(e)=="symbol"?e:e+""}function iS(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,XC(i.key),i)}}function qn(r,e,t){return e&&iS(r.prototype,e),t&&iS(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function aA(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function qC(r,e){if(e&&(Tm(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aA(r)}function bp(r){return bp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},bp(r)}function cg(r,e){return cg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},cg(r,e)}function $C(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&cg(r,e)}function ue(r,e,t){return(e=XC(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var h0={exports:{}};/*!
 * js-logger - http://github.com/jonnyreeves/js-logger
 * Jonny Reeves, http://jonnyreeves.co.uk/
 * js-logger may be freely distributed under the MIT license.
 */var lA=h0.exports,rS;function uA(){return rS||(rS=1,function(r){(function(e){var t={};t.VERSION="1.6.1";var i,o={},l=function(b,w){return function(){return w.apply(b,arguments)}},f=function(){var b=arguments,w=b[0],C,R;for(R=1;R<b.length;R++)for(C in b[R])!(C in w)&&b[R].hasOwnProperty(C)&&(w[C]=b[R][C]);return w},d=function(b,w){return{value:b,name:w}};t.TRACE=d(1,"TRACE"),t.DEBUG=d(2,"DEBUG"),t.INFO=d(3,"INFO"),t.TIME=d(4,"TIME"),t.WARN=d(5,"WARN"),t.ERROR=d(8,"ERROR"),t.OFF=d(99,"OFF");var v=function(b){this.context=b,this.setLevel(b.filterLevel),this.log=this.info};v.prototype={setLevel:function(b){b&&"value"in b&&(this.context.filterLevel=b)},getLevel:function(){return this.context.filterLevel},enabledFor:function(b){var w=this.context.filterLevel;return b.value>=w.value},trace:function(){this.invoke(t.TRACE,arguments)},debug:function(){this.invoke(t.DEBUG,arguments)},info:function(){this.invoke(t.INFO,arguments)},warn:function(){this.invoke(t.WARN,arguments)},error:function(){this.invoke(t.ERROR,arguments)},time:function(b){typeof b=="string"&&b.length>0&&this.invoke(t.TIME,[b,"start"])},timeEnd:function(b){typeof b=="string"&&b.length>0&&this.invoke(t.TIME,[b,"end"])},invoke:function(b,w){i&&this.enabledFor(b)&&i(w,f({level:b},this.context))}};var _=new v({filterLevel:t.OFF});(function(){var b=t;b.enabledFor=l(_,_.enabledFor),b.trace=l(_,_.trace),b.debug=l(_,_.debug),b.time=l(_,_.time),b.timeEnd=l(_,_.timeEnd),b.info=l(_,_.info),b.warn=l(_,_.warn),b.error=l(_,_.error),b.log=b.info})(),t.setHandler=function(b){i=b},t.setLevel=function(b){_.setLevel(b);for(var w in o)o.hasOwnProperty(w)&&o[w].setLevel(b)},t.getLevel=function(){return _.getLevel()},t.get=function(b){return o[b]||(o[b]=new v(f({name:b},_.context)))},t.createDefaultHandler=function(b){b=b||{},b.formatter=b.formatter||function(z,O){O.name&&z.unshift("["+O.name+"]")};var w={},C=function(R,z){Function.prototype.apply.call(R,console,z)};return typeof console>"u"?function(){}:function(R,z){R=Array.prototype.slice.call(R);var O=console.log,P;z.level===t.TIME?(P=(z.name?"["+z.name+"] ":"")+R[0],R[1]==="start"?console.time?console.time(P):w[P]=new Date().getTime():console.timeEnd?console.timeEnd(P):C(O,[P+": "+(new Date().getTime()-w[P])+"ms"])):(z.level===t.WARN&&console.warn?O=console.warn:z.level===t.ERROR&&console.error?O=console.error:z.level===t.INFO&&console.info?O=console.info:z.level===t.DEBUG&&console.debug?O=console.debug:z.level===t.TRACE&&console.trace&&(O=console.trace),b.formatter(R,z),C(O,R))}},t.useDefaults=function(b){t.setLevel(b&&b.defaultLevel||t.DEBUG),t.setHandler(t.createDefaultHandler(b))},t.setDefaults=t.useDefaults,r.exports?r.exports=t:(t._prevLogger=e.Logger,t.noConflict=function(){return e.Logger=t._prevLogger,t},e.Logger=t)})(lA)}(h0)),h0.exports}var cA=uA();const Al=Fm(cA);var Zv=function(){var r=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(b){b.preventDefault(),i(++r%e.children.length)},!1);function t(b){return e.appendChild(b.dom),b}function i(b){for(var w=0;w<e.children.length;w++)e.children[w].style.display=w===b?"block":"none";r=b}var o=(performance||Date).now(),l=o,f=0,d=t(new Zv.Panel("FPS","#0ff","#002")),v=t(new Zv.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var _=t(new Zv.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:t,showPanel:i,begin:function(){o=(performance||Date).now()},end:function(){f++;var b=(performance||Date).now();if(v.update(b-o,200),b>=l+1e3&&(d.update(f*1e3/(b-l),100),l=b,f=0,_)){var w=performance.memory;_.update(w.usedJSHeapSize/1048576,w.jsHeapSizeLimit/1048576)}return b},update:function(){o=this.end()},domElement:e,setMode:i}};Zv.Panel=function(r,e,t){var i=1/0,o=0,l=Math.round,f=l(window.devicePixelRatio||1),d=80*f,v=48*f,_=3*f,b=2*f,w=3*f,C=15*f,R=74*f,z=30*f,O=document.createElement("canvas");O.width=d,O.height=v,O.style.cssText="width:80px;height:48px";var P=O.getContext("2d");return P.font="bold "+9*f+"px Helvetica,Arial,sans-serif",P.textBaseline="top",P.fillStyle=t,P.fillRect(0,0,d,v),P.fillStyle=e,P.fillText(r,_,b),P.fillRect(w,C,R,z),P.fillStyle=t,P.globalAlpha=.9,P.fillRect(w,C,R,z),{dom:O,update:function(M,U){i=Math.min(i,M),o=Math.max(o,M),P.fillStyle=t,P.globalAlpha=1,P.fillRect(0,0,d,C),P.fillStyle=e,P.fillText(l(M)+" "+r+" ("+l(i)+"-"+l(o)+")",_,b),P.drawImage(O,w+f,C,R-f,z,w,C,R-f,z),P.fillRect(w+R-f,C,f,z),P.fillStyle=t,P.globalAlpha=.9,P.fillRect(w+R-f,C,f,l((1-M/U)*z))}}};/*!
 * Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 */function Jv(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Jv=function(e){return typeof e}:Jv=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jv(r)}function hA(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function fA(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,i.key,i)}}function dA(r,e,t){return e&&fA(r.prototype,e),r}function pA(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ki(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),i.forEach(function(o){pA(r,o,t[o])})}return r}function YC(r,e){return mA(r)||vA(r,e)||gA()}function mA(r){if(Array.isArray(r))return r}function vA(r,e){var t=[],i=!0,o=!1,l=void 0;try{for(var f=r[Symbol.iterator](),d;!(i=(d=f.next()).done)&&(t.push(d.value),!(e&&t.length===e));i=!0);}catch(v){o=!0,l=v}finally{try{!i&&f.return!=null&&f.return()}finally{if(o)throw l}}return t}function gA(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var sS=function(){},fw={},KC={},_A=null,ZC={mark:sS,measure:sS};try{typeof window<"u"&&(fw=window),typeof document<"u"&&(KC=document),typeof MutationObserver<"u"&&(_A=MutationObserver),typeof performance<"u"&&(ZC=performance)}catch{}var yA=fw.navigator||{},oS=yA.userAgent,aS=oS===void 0?"":oS,J0=fw,Ja=KC,Ag=ZC;J0.document;var dw=!!Ja.documentElement&&!!Ja.head&&typeof Ja.addEventListener=="function"&&typeof Ja.createElement=="function";~aS.indexOf("MSIE")||~aS.indexOf("Trident/");var hf="___FONT_AWESOME___",JC="fa",QC="svg-inline--fa",bA="data-fa-i2svg";(function(){try{return!0}catch{return!1}})();var Oy={GROUP:"group",PRIMARY:"primary",SECONDARY:"secondary"},eT=J0.FontAwesomeConfig||{};function xA(r){var e=Ja.querySelector("script["+r+"]");if(e)return e.getAttribute(r)}function wA(r){return r===""?!0:r==="false"?!1:r==="true"?!0:r}if(Ja&&typeof Ja.querySelector=="function"){var SA=[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]];SA.forEach(function(r){var e=YC(r,2),t=e[0],i=e[1],o=wA(xA(t));o!=null&&(eT[i]=o)})}var EA={familyPrefix:JC,replacementClass:QC,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},Xb=ki({},EA,eT);Xb.autoReplaceSvg||(Xb.observeMutations=!1);var hu=ki({},Xb);J0.FontAwesomeConfig=hu;var ff=J0||{};ff[hf]||(ff[hf]={});ff[hf].styles||(ff[hf].styles={});ff[hf].hooks||(ff[hf].hooks={});ff[hf].shims||(ff[hf].shims=[]);var wh=ff[hf],CA=[],TA=function r(){Ja.removeEventListener("DOMContentLoaded",r),qb=1,CA.map(function(e){return e()})},qb=!1;dw&&(qb=(Ja.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Ja.readyState),qb||Ja.addEventListener("DOMContentLoaded",TA));var pw="pending",tT="settled",R0="fulfilled",I0="rejected",MA=function(){},nT=typeof global<"u"&&typeof global.process<"u"&&typeof global.process.emit=="function",AA=typeof setImmediate>"u"?setTimeout:setImmediate,Wv=[],$b;function PA(){for(var r=0;r<Wv.length;r++)Wv[r][0](Wv[r][1]);Wv=[],$b=!1}function D0(r,e){Wv.push([r,e]),$b||($b=!0,AA(PA,0))}function RA(r,e){function t(o){mw(e,o)}function i(o){hg(e,o)}try{r(t,i)}catch(o){i(o)}}function iT(r){var e=r.owner,t=e._state,i=e._data,o=r[t],l=r.then;if(typeof o=="function"){t=R0;try{i=o(i)}catch(f){hg(l,f)}}rT(l,i)||(t===R0&&mw(l,i),t===I0&&hg(l,i))}function rT(r,e){var t;try{if(r===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&(typeof e=="function"||Jv(e)==="object")){var i=e.then;if(typeof i=="function")return i.call(e,function(o){t||(t=!0,e===o?sT(r,o):mw(r,o))},function(o){t||(t=!0,hg(r,o))}),!0}}catch(o){return t||hg(r,o),!0}return!1}function mw(r,e){(r===e||!rT(r,e))&&sT(r,e)}function sT(r,e){r._state===pw&&(r._state=tT,r._data=e,D0(IA,r))}function hg(r,e){r._state===pw&&(r._state=tT,r._data=e,D0(DA,r))}function oT(r){r._then=r._then.forEach(iT)}function IA(r){r._state=R0,oT(r)}function DA(r){r._state=I0,oT(r),!r._handled&&nT&&global.process.emit("unhandledRejection",r._data,r)}function LA(r){global.process.emit("rejectionHandled",r)}function Yu(r){if(typeof r!="function")throw new TypeError("Promise resolver "+r+" is not a function");if(!(this instanceof Yu))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],RA(r,this)}Yu.prototype={constructor:Yu,_state:pw,_then:null,_data:void 0,_handled:!1,then:function(e,t){var i={owner:this,then:new this.constructor(MA),fulfilled:e,rejected:t};return(t||e)&&!this._handled&&(this._handled=!0,this._state===I0&&nT&&D0(LA,this)),this._state===R0||this._state===I0?D0(iT,i):this._then.push(i),i.then},catch:function(e){return this.then(null,e)}};Yu.all=function(r){if(!Array.isArray(r))throw new TypeError("You must pass an array to Promise.all().");return new Yu(function(e,t){var i=[],o=0;function l(v){return o++,function(_){i[v]=_,--o||e(i)}}for(var f=0,d;f<r.length;f++)d=r[f],d&&typeof d.then=="function"?d.then(l(f),t):i[f]=d;o||e(i)})};Yu.race=function(r){if(!Array.isArray(r))throw new TypeError("You must pass an array to Promise.race().");return new Yu(function(e,t){for(var i=0,o;i<r.length;i++)o=r[i],o&&typeof o.then=="function"?o.then(e,t):e(o)})};Yu.resolve=function(r){return r&&Jv(r)==="object"&&r.constructor===Yu?r:new Yu(function(e){e(r)})};Yu.reject=function(r){return new Yu(function(e,t){t(r)})};var gm={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function kA(r){if(!(!r||!dw)){var e=Ja.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=r;for(var t=Ja.head.childNodes,i=null,o=t.length-1;o>-1;o--){var l=t[o],f=(l.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(f)>-1&&(i=l)}return Ja.head.insertBefore(e,i),r}}var FA="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function L0(){for(var r=12,e="";r-- >0;)e+=FA[Math.random()*62|0];return e}function aT(r){return"".concat(r).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function OA(r){return Object.keys(r||{}).reduce(function(e,t){return e+"".concat(t,'="').concat(aT(r[t]),'" ')},"").trim()}function lT(r){return Object.keys(r||{}).reduce(function(e,t){return e+"".concat(t,": ").concat(r[t],";")},"")}function uT(r){return r.size!==gm.size||r.x!==gm.x||r.y!==gm.y||r.rotate!==gm.rotate||r.flipX||r.flipY}function cT(r){var e=r.transform,t=r.containerWidth,i=r.iconWidth,o={transform:"translate(".concat(t/2," 256)")},l="translate(".concat(e.x*32,", ").concat(e.y*32,") "),f="scale(".concat(e.size/16*(e.flipX?-1:1),", ").concat(e.size/16*(e.flipY?-1:1),") "),d="rotate(".concat(e.rotate," 0 0)"),v={transform:"".concat(l," ").concat(f," ").concat(d)},_={transform:"translate(".concat(i/2*-1," -256)")};return{outer:o,inner:v,path:_}}var Ny={x:0,y:0,width:"100%",height:"100%"};function lS(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r.attributes&&(r.attributes.fill||e)&&(r.attributes.fill="black"),r}function NA(r){return r.tag==="g"?r.children:[r]}function UA(r){var e=r.children,t=r.attributes,i=r.main,o=r.mask,l=r.maskId,f=r.transform,d=i.width,v=i.icon,_=o.width,b=o.icon,w=cT({transform:f,containerWidth:_,iconWidth:d}),C={tag:"rect",attributes:ki({},Ny,{fill:"white"})},R=v.children?{children:v.children.map(lS)}:{},z={tag:"g",attributes:ki({},w.inner),children:[lS(ki({tag:v.tag,attributes:ki({},v.attributes,w.path)},R))]},O={tag:"g",attributes:ki({},w.outer),children:[z]},P="mask-".concat(l||L0()),M="clip-".concat(l||L0()),U={tag:"mask",attributes:ki({},Ny,{id:P,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[C,O]},L={tag:"defs",children:[{tag:"clipPath",attributes:{id:M},children:NA(b)},U]};return e.push(L,{tag:"rect",attributes:ki({fill:"currentColor","clip-path":"url(#".concat(M,")"),mask:"url(#".concat(P,")")},Ny)}),{children:e,attributes:t}}function BA(r){var e=r.children,t=r.attributes,i=r.main,o=r.transform,l=r.styles,f=lT(l);if(f.length>0&&(t.style=f),uT(o)){var d=cT({transform:o,containerWidth:i.width,iconWidth:i.width});e.push({tag:"g",attributes:ki({},d.outer),children:[{tag:"g",attributes:ki({},d.inner),children:[{tag:i.icon.tag,children:i.icon.children,attributes:ki({},i.icon.attributes,d.path)}]}]})}else e.push(i.icon);return{children:e,attributes:t}}function zA(r){var e=r.children,t=r.main,i=r.mask,o=r.attributes,l=r.styles,f=r.transform;if(uT(f)&&t.found&&!i.found){var d=t.width,v=t.height,_={x:d/v/2,y:.5};o.style=lT(ki({},l,{"transform-origin":"".concat(_.x+f.x/16,"em ").concat(_.y+f.y/16,"em")}))}return[{tag:"svg",attributes:o,children:e}]}function VA(r){var e=r.prefix,t=r.iconName,i=r.children,o=r.attributes,l=r.symbol,f=l===!0?"".concat(e,"-").concat(hu.familyPrefix,"-").concat(t):l;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:ki({},o,{id:f}),children:i}]}]}function GA(r){var e=r.icons,t=e.main,i=e.mask,o=r.prefix,l=r.iconName,f=r.transform,d=r.symbol,v=r.title,_=r.maskId,b=r.titleId,w=r.extra,C=r.watchable,R=C===void 0?!1:C,z=i.found?i:t,O=z.width,P=z.height,M=o==="fak",U=M?"":"fa-w-".concat(Math.ceil(O/P*16)),L=[hu.replacementClass,l?"".concat(hu.familyPrefix,"-").concat(l):"",U].filter(function(H){return w.classes.indexOf(H)===-1}).filter(function(H){return H!==""||!!H}).concat(w.classes).join(" "),B={children:[],attributes:ki({},w.attributes,{"data-prefix":o,"data-icon":l,class:L,role:w.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(O," ").concat(P)})},$=M&&!~w.classes.indexOf("fa-fw")?{width:"".concat(O/P*16*.0625,"em")}:{};R&&(B.attributes[bA]=""),v&&B.children.push({tag:"title",attributes:{id:B.attributes["aria-labelledby"]||"title-".concat(b||L0())},children:[v]});var X=ki({},B,{prefix:o,iconName:l,main:t,mask:i,maskId:_,transform:f,symbol:d,styles:ki({},$,w.styles)}),Q=i.found&&t.found?UA(X):BA(X),te=Q.children,V=Q.attributes;return X.children=te,X.attributes=V,d?VA(X):zA(X)}hu.measurePerformance&&Ag&&Ag.mark&&Ag.measure;var Uy=function(e,t,i,o){var l=Object.keys(e),f=l.length,d=t,v,_,b;for(i===void 0?(v=1,b=e[l[0]]):(v=0,b=i);v<f;v++)_=l[v],b=d(b,e[_],_,e);return b};function hT(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=t.skipHooks,o=i===void 0?!1:i,l=Object.keys(e).reduce(function(f,d){var v=e[d],_=!!v.icon;return _?f[v.iconName]=v.icon:f[d]=v,f},{});typeof wh.hooks.addPack=="function"&&!o?wh.hooks.addPack(r,l):wh.styles[r]=ki({},wh.styles[r]||{},l),r==="fas"&&hT("fa",e)}var uS=wh.styles,HA=wh.shims,fT=function(){var e=function(o){return Uy(uS,function(l,f,d){return l[d]=Uy(f,o,{}),l},{})};e(function(i,o,l){return o[3]&&(i[o[3]]=l),i}),e(function(i,o,l){var f=o[2];return i[l]=l,f.forEach(function(d){i[d]=l}),i});var t="far"in uS;Uy(HA,function(i,o){var l=o[0],f=o[1],d=o[2];return f==="far"&&!t&&(f="fas"),i[l]={prefix:f,iconName:d},i},{})};fT();wh.styles;function cS(r,e,t){if(r&&r[e]&&r[e][t])return{prefix:e,iconName:t,icon:r[e][t]}}function dT(r){var e=r.tag,t=r.attributes,i=t===void 0?{}:t,o=r.children,l=o===void 0?[]:o;return typeof r=="string"?aT(r):"<".concat(e," ").concat(OA(i),">").concat(l.map(dT).join(""),"</").concat(e,">")}var WA=function(e){var t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e?e.toLowerCase().split(" ").reduce(function(i,o){var l=o.toLowerCase().split("-"),f=l[0],d=l.slice(1).join("-");if(f&&d==="h")return i.flipX=!0,i;if(f&&d==="v")return i.flipY=!0,i;if(d=parseFloat(d),isNaN(d))return i;switch(f){case"grow":i.size=i.size+d;break;case"shrink":i.size=i.size-d;break;case"left":i.x=i.x-d;break;case"right":i.x=i.x+d;break;case"up":i.y=i.y-d;break;case"down":i.y=i.y+d;break;case"rotate":i.rotate=i.rotate+d;break}return i},t):t};function Yb(r){this.name="MissingIcon",this.message=r||"Icon unavailable",this.stack=new Error().stack}Yb.prototype=Object.create(Error.prototype);Yb.prototype.constructor=Yb;var Q0={fill:"currentColor"},pT={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};ki({},Q0,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"});var vw=ki({},pT,{attributeName:"opacity"});ki({},Q0,{cx:"256",cy:"364",r:"28"}),ki({},pT,{attributeName:"r",values:"28;14;28;28;14;28;"}),ki({},vw,{values:"1;0;1;1;0;1;"});ki({},Q0,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),ki({},vw,{values:"1;0;0;0;0;1;"});ki({},Q0,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),ki({},vw,{values:"0;0;1;1;0;0;"});wh.styles;function hS(r){var e=r[0],t=r[1],i=r.slice(4),o=YC(i,1),l=o[0],f=null;return Array.isArray(l)?f={tag:"g",attributes:{class:"".concat(hu.familyPrefix,"-").concat(Oy.GROUP)},children:[{tag:"path",attributes:{class:"".concat(hu.familyPrefix,"-").concat(Oy.SECONDARY),fill:"currentColor",d:l[0]}},{tag:"path",attributes:{class:"".concat(hu.familyPrefix,"-").concat(Oy.PRIMARY),fill:"currentColor",d:l[1]}}]}:f={tag:"path",attributes:{fill:"currentColor",d:l}},{found:!0,width:e,height:t,icon:f}}wh.styles;var jA=`svg:not(:root).svg-inline--fa {
  overflow: visible;
}

.svg-inline--fa {
  display: inline-block;
  font-size: inherit;
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.225em;
}
.svg-inline--fa.fa-w-1 {
  width: 0.0625em;
}
.svg-inline--fa.fa-w-2 {
  width: 0.125em;
}
.svg-inline--fa.fa-w-3 {
  width: 0.1875em;
}
.svg-inline--fa.fa-w-4 {
  width: 0.25em;
}
.svg-inline--fa.fa-w-5 {
  width: 0.3125em;
}
.svg-inline--fa.fa-w-6 {
  width: 0.375em;
}
.svg-inline--fa.fa-w-7 {
  width: 0.4375em;
}
.svg-inline--fa.fa-w-8 {
  width: 0.5em;
}
.svg-inline--fa.fa-w-9 {
  width: 0.5625em;
}
.svg-inline--fa.fa-w-10 {
  width: 0.625em;
}
.svg-inline--fa.fa-w-11 {
  width: 0.6875em;
}
.svg-inline--fa.fa-w-12 {
  width: 0.75em;
}
.svg-inline--fa.fa-w-13 {
  width: 0.8125em;
}
.svg-inline--fa.fa-w-14 {
  width: 0.875em;
}
.svg-inline--fa.fa-w-15 {
  width: 0.9375em;
}
.svg-inline--fa.fa-w-16 {
  width: 1em;
}
.svg-inline--fa.fa-w-17 {
  width: 1.0625em;
}
.svg-inline--fa.fa-w-18 {
  width: 1.125em;
}
.svg-inline--fa.fa-w-19 {
  width: 1.1875em;
}
.svg-inline--fa.fa-w-20 {
  width: 1.25em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-border {
  height: 1.5em;
}
.svg-inline--fa.fa-li {
  width: 2em;
}
.svg-inline--fa.fa-fw {
  width: 1.25em;
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: #ff253a;
  border-radius: 1em;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  color: #fff;
  height: 1.5em;
  line-height: 1;
  max-width: 5em;
  min-width: 1.5em;
  overflow: hidden;
  padding: 0.25em;
  right: 0;
  text-overflow: ellipsis;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: 0;
  right: 0;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: 0;
  left: 0;
  right: auto;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  right: 0;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: 0;
  right: auto;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-lg {
  font-size: 1.3333333333em;
  line-height: 0.75em;
  vertical-align: -0.0667em;
}

.fa-xs {
  font-size: 0.75em;
}

.fa-sm {
  font-size: 0.875em;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: 2.5em;
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: -2em;
  position: absolute;
  text-align: center;
  width: 2em;
  line-height: inherit;
}

.fa-border {
  border: solid 0.08em #eee;
  border-radius: 0.1em;
  padding: 0.2em 0.25em 0.15em;
}

.fa-pull-left {
  float: left;
}

.fa-pull-right {
  float: right;
}

.fa.fa-pull-left,
.fas.fa-pull-left,
.far.fa-pull-left,
.fal.fa-pull-left,
.fab.fa-pull-left {
  margin-right: 0.3em;
}
.fa.fa-pull-right,
.fas.fa-pull-right,
.far.fa-pull-right,
.fal.fa-pull-right,
.fab.fa-pull-right {
  margin-left: 0.3em;
}

.fa-spin {
  -webkit-animation: fa-spin 2s infinite linear;
          animation: fa-spin 2s infinite linear;
}

.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
          animation: fa-spin 1s infinite steps(8);
}

@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}

@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

:root .fa-rotate-90,
:root .fa-rotate-180,
:root .fa-rotate-270,
:root .fa-flip-horizontal,
:root .fa-flip-vertical,
:root .fa-flip-both {
  -webkit-filter: none;
          filter: none;
}

.fa-stack {
  display: inline-block;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: #fff;
}

.sr-only {
  border: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

.sr-only-focusable:active, .sr-only-focusable:focus {
  clip: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  position: static;
  width: auto;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse {
  color: #fff;
}`;function XA(){var r=JC,e=QC,t=hu.familyPrefix,i=hu.replacementClass,o=jA;if(t!==r||i!==e){var l=new RegExp("\\.".concat(r,"\\-"),"g"),f=new RegExp("\\--".concat(r,"\\-"),"g"),d=new RegExp("\\.".concat(e),"g");o=o.replace(l,".".concat(t,"-")).replace(f,"--".concat(t,"-")).replace(d,".".concat(i))}return o}var qA=function(){function r(){hA(this,r),this.definitions={}}return dA(r,[{key:"add",value:function(){for(var t=this,i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];var f=o.reduce(this._pullDefinitions,{});Object.keys(f).forEach(function(d){t.definitions[d]=ki({},t.definitions[d]||{},f[d]),hT(d,f[d]),fT()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(t,i){var o=i.prefix&&i.iconName&&i.icon?{0:i}:i;return Object.keys(o).map(function(l){var f=o[l],d=f.prefix,v=f.iconName,_=f.icon;t[d]||(t[d]={}),t[d][v]=_}),t}}]),r}();function $A(){hu.autoAddCss&&!dS&&(kA(XA()),dS=!0)}function YA(r,e){return Object.defineProperty(r,"abstract",{get:e}),Object.defineProperty(r,"html",{get:function(){return r.abstract.map(function(i){return dT(i)})}}),Object.defineProperty(r,"node",{get:function(){if(dw){var i=Ja.createElement("div");return i.innerHTML=r.html,i.children}}}),r}function fS(r){var e=r.prefix,t=e===void 0?"fa":e,i=r.iconName;if(i)return cS(ZA.definitions,t,i)||cS(wh.styles,t,i)}function KA(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=(e||{}).icon?e:fS(e||{}),o=t.mask;return o&&(o=(o||{}).icon?o:fS(o||{})),r(i,ki({},t,{mask:o}))}}var ZA=new qA,dS=!1,Kb={transform:function(e){return WA(e)}},JA=KA(function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.transform,i=t===void 0?gm:t,o=e.symbol,l=o===void 0?!1:o,f=e.mask,d=f===void 0?null:f,v=e.maskId,_=v===void 0?null:v,b=e.title,w=b===void 0?null:b,C=e.titleId,R=C===void 0?null:C,z=e.classes,O=z===void 0?[]:z,P=e.attributes,M=P===void 0?{}:P,U=e.styles,L=U===void 0?{}:U;if(r){var B=r.prefix,$=r.iconName,X=r.icon;return YA(ki({type:"icon"},r),function(){return $A(),hu.autoA11y&&(w?M["aria-labelledby"]="".concat(hu.replacementClass,"-title-").concat(R||L0()):(M["aria-hidden"]="true",M.focusable="false")),GA({icons:{main:hS(X),mask:d?hS(d.icon):{found:!1,width:null,height:null,icon:{}}},prefix:B,iconName:$,transform:ki({},gm,i),symbol:l,title:w,maskId:_,titleId:R,extra:{attributes:M,styles:L,classes:O}})})}}),By={exports:{}},zy,pS;function QA(){if(pS)return zy;pS=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return zy=r,zy}var Vy,mS;function eP(){if(mS)return Vy;mS=1;var r=QA();function e(){}function t(){}return t.resetWarningCache=e,Vy=function(){function i(f,d,v,_,b,w){if(w!==r){var C=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw C.name="Invariant Violation",C}}i.isRequired=i;function o(){return i}var l={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:o,element:i,elementType:i,instanceOf:o,node:i,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:t,resetWarningCache:e};return l.PropTypes=l,l},Vy}var vS;function tP(){return vS||(vS=1,By.exports=eP()()),By.exports}var nP=tP();const Jn=Fm(nP);function gS(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,i)}return t}function hd(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gS(Object(t),!0).forEach(function(i){_m(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):gS(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function k0(r){"@babel/helpers - typeof";return k0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k0(r)}function _m(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function iP(r,e){if(r==null)return{};var t={},i=Object.keys(r),o,l;for(l=0;l<i.length;l++)o=i[l],!(e.indexOf(o)>=0)&&(t[o]=r[o]);return t}function mT(r,e){if(r==null)return{};var t=iP(r,e),i,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);for(o=0;o<l.length;o++)i=l[o],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function Zb(r){return rP(r)||sP(r)||oP(r)||aP()}function rP(r){if(Array.isArray(r))return Jb(r)}function sP(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function oP(r,e){if(r){if(typeof r=="string")return Jb(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Jb(r,e)}}function Jb(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function aP(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lP(r){var e,t=r.beat,i=r.fade,o=r.beatFade,l=r.bounce,f=r.shake,d=r.flash,v=r.spin,_=r.spinPulse,b=r.spinReverse,w=r.pulse,C=r.fixedWidth,R=r.inverse,z=r.border,O=r.listItem,P=r.flip,M=r.size,U=r.rotation,L=r.pull,B=(e={"fa-beat":t,"fa-fade":i,"fa-beat-fade":o,"fa-bounce":l,"fa-shake":f,"fa-flash":d,"fa-spin":v,"fa-spin-reverse":b,"fa-spin-pulse":_,"fa-pulse":w,"fa-fw":C,"fa-inverse":R,"fa-border":z,"fa-li":O,"fa-flip":P===!0,"fa-flip-horizontal":P==="horizontal"||P==="both","fa-flip-vertical":P==="vertical"||P==="both"},_m(e,"fa-".concat(M),typeof M<"u"&&M!==null),_m(e,"fa-rotate-".concat(U),typeof U<"u"&&U!==null&&U!==0),_m(e,"fa-pull-".concat(L),typeof L<"u"&&L!==null),_m(e,"fa-swap-opacity",r.swapOpacity),e);return Object.keys(B).map(function($){return B[$]?$:null}).filter(function($){return $})}function uP(r){return r=r-0,r===r}function vT(r){return uP(r)?r:(r=r.replace(/[\-_\s]+(.)?/g,function(e,t){return t?t.toUpperCase():""}),r.substr(0,1).toLowerCase()+r.substr(1))}var cP=["style"];function hP(r){return r.charAt(0).toUpperCase()+r.slice(1)}function fP(r){return r.split(";").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){var i=t.indexOf(":"),o=vT(t.slice(0,i)),l=t.slice(i+1).trim();return o.startsWith("webkit")?e[hP(o)]=l:e[o]=l,e},{})}function gT(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof e=="string")return e;var i=(e.children||[]).map(function(v){return gT(r,v)}),o=Object.keys(e.attributes||{}).reduce(function(v,_){var b=e.attributes[_];switch(_){case"class":v.attrs.className=b,delete e.attributes.class;break;case"style":v.attrs.style=fP(b);break;default:_.indexOf("aria-")===0||_.indexOf("data-")===0?v.attrs[_.toLowerCase()]=b:v.attrs[vT(_)]=b}return v},{attrs:{}}),l=t.style,f=l===void 0?{}:l,d=mT(t,cP);return o.attrs.style=hd(hd({},o.attrs.style),f),r.apply(void 0,[e.tag,hd(hd({},o.attrs),d)].concat(Zb(i)))}var _T=!1;try{_T=!0}catch{}function dP(){if(!_T&&console&&typeof console.error=="function"){var r;(r=console).error.apply(r,arguments)}}function _S(r){if(r&&k0(r)==="object"&&r.prefix&&r.iconName&&r.icon)return r;if(Kb.icon)return Kb.icon(r);if(r===null)return null;if(r&&k0(r)==="object"&&r.prefix&&r.iconName)return r;if(Array.isArray(r)&&r.length===2)return{prefix:r[0],iconName:r[1]};if(typeof r=="string")return{prefix:"fas",iconName:r}}function Gy(r,e){return Array.isArray(e)&&e.length>0||!Array.isArray(e)&&e?_m({},r,e):{}}var pP=["forwardedRef"];function gg(r){var e=r.forwardedRef,t=mT(r,pP),i=t.icon,o=t.mask,l=t.symbol,f=t.className,d=t.title,v=t.titleId,_=t.maskId,b=_S(i),w=Gy("classes",[].concat(Zb(lP(t)),Zb(f.split(" ")))),C=Gy("transform",typeof t.transform=="string"?Kb.transform(t.transform):t.transform),R=Gy("mask",_S(o)),z=JA(b,hd(hd(hd(hd({},w),C),R),{},{symbol:l,title:d,titleId:v,maskId:_}));if(!z)return dP("Could not find icon",b),null;var O=z.abstract,P={ref:e};return Object.keys(t).forEach(function(M){gg.defaultProps.hasOwnProperty(M)||(P[M]=t[M])}),mP(O[0],P)}gg.displayName="FontAwesomeIcon";gg.propTypes={beat:Jn.bool,border:Jn.bool,beatFade:Jn.bool,bounce:Jn.bool,className:Jn.string,fade:Jn.bool,flash:Jn.bool,mask:Jn.oneOfType([Jn.object,Jn.array,Jn.string]),maskId:Jn.string,fixedWidth:Jn.bool,inverse:Jn.bool,flip:Jn.oneOf([!0,!1,"horizontal","vertical","both"]),icon:Jn.oneOfType([Jn.object,Jn.array,Jn.string]),listItem:Jn.bool,pull:Jn.oneOf(["right","left"]),pulse:Jn.bool,rotation:Jn.oneOf([0,90,180,270]),shake:Jn.bool,size:Jn.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:Jn.bool,spinPulse:Jn.bool,spinReverse:Jn.bool,symbol:Jn.oneOfType([Jn.bool,Jn.string]),title:Jn.string,titleId:Jn.string,transform:Jn.oneOfType([Jn.string,Jn.object]),swapOpacity:Jn.bool};gg.defaultProps={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1};var mP=gT.bind(null,ug.createElement);/*!
 * Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 */var vP={prefix:"fas",iconName:"sync-alt",icon:[512,512,[],"f2f1","M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"]},jv={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var gP=jv.exports,yS;function _P(){return yS||(yS=1,function(r,e){(function(){var t,i="4.17.21",o=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",d="Invalid `variable` option passed into `_.template`",v="__lodash_hash_undefined__",_=500,b="__lodash_placeholder__",w=1,C=2,R=4,z=1,O=2,P=1,M=2,U=4,L=8,B=16,$=32,X=64,Q=128,te=256,V=512,H=30,J="...",ce=800,he=16,ge=1,Ae=2,me=3,Ie=1/0,ae=9007199254740991,ye=17976931348623157e292,de=NaN,ie=4294967295,we=ie-1,ze=ie>>>1,se=[["ary",Q],["bind",P],["bindKey",M],["curry",L],["curryRight",B],["flip",V],["partial",$],["partialRight",X],["rearg",te]],fe="[object Arguments]",Le="[object Array]",Be="[object AsyncFunction]",He="[object Boolean]",et="[object Date]",pt="[object DOMException]",Wt="[object Error]",zt="[object Function]",bn="[object GeneratorFunction]",_e="[object Map]",Ln="[object Number]",on="[object Null]",Nt="[object Object]",Vt="[object Promise]",Mn="[object Proxy]",Dt="[object RegExp]",le="[object Set]",ne="[object String]",Oe="[object Symbol]",Ze="[object Undefined]",Je="[object WeakMap]",Ye="[object WeakSet]",Pt="[object ArrayBuffer]",ht="[object DataView]",_t="[object Float32Array]",fn="[object Float64Array]",it="[object Int8Array]",St="[object Int16Array]",jt="[object Int32Array]",tn="[object Uint8Array]",xt="[object Uint8ClampedArray]",pn="[object Uint16Array]",nn="[object Uint32Array]",Vn=/\b__p \+= '';/g,Re=/\b(__p \+=) '' \+/g,gt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,je=/&(?:amp|lt|gt|quot|#39);/g,Ke=/[&<>"']/g,Mt=RegExp(je.source),Et=RegExp(Ke.source),mn=/<%-([\s\S]+?)%>/g,Bn=/<%([\s\S]+?)%>/g,Ti=/<%=([\s\S]+?)%>/g,vn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,yr=/^\w*$/,_i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ds=/[\\^$.*+?()[\]{}|]/g,hs=RegExp(Ds.source),zr=/^\s+/,fs=/\s/,mo=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,vo=/\{\n\/\* \[wrapped with (.+)\] \*/,Ho=/,? & /,du=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,tl=/[()=,{}\[\]\/\s]/,pu=/\\(\\)?/g,ds=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,nl=/\w*$/,mu=/^[-+]0x[0-9a-f]+$/i,xa=/^0b[01]+$/i,Rl=/^\[object .+?Constructor\]$/,vu=/^0o[0-7]+$/i,oe=/^(?:0|[1-9]\d*)$/,De=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ue=/($^)/,Ve=/['\n\r\u2028\u2029\\]/g,Te="\\ud800-\\udfff",ot="\\u0300-\\u036f",dt="\\ufe20-\\ufe2f",Rt="\\u20d0-\\u20ff",ft=ot+dt+Rt,un="\\u2700-\\u27bf",rn="a-z\\xdf-\\xf6\\xf8-\\xff",Yt="\\xac\\xb1\\xd7\\xf7",gn="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",kn="\\u2000-\\u206f",Fn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ui="A-Z\\xc0-\\xd6\\xd8-\\xde",xn="\\ufe0e\\ufe0f",Xt=Yt+gn+kn+Fn,Gn="[']",Cn="["+Te+"]",Zi="["+Xt+"]",sr="["+ft+"]",Ji="\\d+",Ks="["+un+"]",cn="["+rn+"]",or="[^"+Te+Xt+Ji+un+rn+ui+"]",fi="\\ud83c[\\udffb-\\udfff]",Nn="(?:"+sr+"|"+fi+")",ar="[^"+Te+"]",Tr="(?:\\ud83c[\\udde6-\\uddff]){2}",an="[\\ud800-\\udbff][\\udc00-\\udfff]",fr="["+ui+"]",Wo="\\u200d",wa="(?:"+cn+"|"+or+")",Il="(?:"+fr+"|"+or+")",go="(?:"+Gn+"(?:d|ll|m|re|s|t|ve))?",Dl="(?:"+Gn+"(?:D|LL|M|RE|S|T|VE))?",_o=Nn+"?",Sa="["+xn+"]?",jo="(?:"+Wo+"(?:"+[ar,Tr,an].join("|")+")"+Sa+_o+")*",yo="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",bo="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ea=Sa+_o+jo,Xo="(?:"+[Ks,Tr,an].join("|")+")"+Ea,qo="(?:"+[ar+sr+"?",sr,Tr,an,Cn].join("|")+")",Hc=RegExp(Gn,"g"),Ju=RegExp(sr,"g"),xo=RegExp(fi+"(?="+fi+")|"+qo+Ea,"g"),Th=RegExp([fr+"?"+cn+"+"+go+"(?="+[Zi,fr,"$"].join("|")+")",Il+"+"+Dl+"(?="+[Zi,fr+wa,"$"].join("|")+")",fr+"?"+wa+"+"+go,fr+"+"+Dl,bo,yo,Ji,Xo].join("|"),"g"),Wc=RegExp("["+Wo+Te+ft+xn+"]"),Ll=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,jc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Qu=-1,$t={};$t[_t]=$t[fn]=$t[it]=$t[St]=$t[jt]=$t[tn]=$t[xt]=$t[pn]=$t[nn]=!0,$t[fe]=$t[Le]=$t[Pt]=$t[He]=$t[ht]=$t[et]=$t[Wt]=$t[zt]=$t[_e]=$t[Ln]=$t[Nt]=$t[Dt]=$t[le]=$t[ne]=$t[Je]=!1;var Qt={};Qt[fe]=Qt[Le]=Qt[Pt]=Qt[ht]=Qt[He]=Qt[et]=Qt[_t]=Qt[fn]=Qt[it]=Qt[St]=Qt[jt]=Qt[_e]=Qt[Ln]=Qt[Nt]=Qt[Dt]=Qt[le]=Qt[ne]=Qt[Oe]=Qt[tn]=Qt[xt]=Qt[pn]=Qt[nn]=!0,Qt[Wt]=Qt[zt]=Qt[Je]=!1;var Zs={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},gu={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Js={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Xc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ec=parseFloat,kl=parseInt,Fl=typeof cd=="object"&&cd&&cd.Object===Object&&cd,tc=typeof self=="object"&&self&&self.Object===Object&&self,yn=Fl||tc||Function("return this")(),Ca=e&&!e.nodeType&&e,dr=Ca&&!0&&r&&!r.nodeType&&r,Mr=dr&&dr.exports===Ca,$o=Mr&&Fl.process,ci=function(){try{var k=dr&&dr.require&&dr.require("util").types;return k||$o&&$o.binding&&$o.binding("util")}catch{}}(),il=ci&&ci.isArrayBuffer,Ar=ci&&ci.isDate,Pr=ci&&ci.isMap,Ta=ci&&ci.isRegExp,Ma=ci&&ci.isSet,Ol=ci&&ci.isTypedArray;function si(k,Y,K){switch(K.length){case 0:return k.call(Y);case 1:return k.call(Y,K[0]);case 2:return k.call(Y,K[0],K[1]);case 3:return k.call(Y,K[0],K[1],K[2])}return k.apply(Y,K)}function wo(k,Y,K,Se){for(var Xe=-1,Ct=k==null?0:k.length;++Xe<Ct;){var hn=k[Xe];Y(Se,hn,K(hn),k)}return Se}function Qn(k,Y){for(var K=-1,Se=k==null?0:k.length;++K<Se&&Y(k[K],K,k)!==!1;);return k}function Aa(k,Y){for(var K=k==null?0:k.length;K--&&Y(k[K],K,k)!==!1;);return k}function Nl(k,Y){for(var K=-1,Se=k==null?0:k.length;++K<Se;)if(!Y(k[K],K,k))return!1;return!0}function yi(k,Y){for(var K=-1,Se=k==null?0:k.length,Xe=0,Ct=[];++K<Se;){var hn=k[K];Y(hn,K,k)&&(Ct[Xe++]=hn)}return Ct}function Rr(k,Y){var K=k==null?0:k.length;return!!K&&Vr(k,Y,0)>-1}function Ul(k,Y,K){for(var Se=-1,Xe=k==null?0:k.length;++Se<Xe;)if(K(Y,k[Se]))return!0;return!1}function Ft(k,Y){for(var K=-1,Se=k==null?0:k.length,Xe=Array(Se);++K<Se;)Xe[K]=Y(k[K],K,k);return Xe}function br(k,Y){for(var K=-1,Se=Y.length,Xe=k.length;++K<Se;)k[Xe+K]=Y[K];return k}function So(k,Y,K,Se){var Xe=-1,Ct=k==null?0:k.length;for(Se&&Ct&&(K=k[++Xe]);++Xe<Ct;)K=Y(K,k[Xe],Xe,k);return K}function nc(k,Y,K,Se){var Xe=k==null?0:k.length;for(Se&&Xe&&(K=k[--Xe]);Xe--;)K=Y(K,k[Xe],Xe,k);return K}function ps(k,Y){for(var K=-1,Se=k==null?0:k.length;++K<Se;)if(Y(k[K],K,k))return!0;return!1}var rl=Pa("length");function pr(k){return k.split("")}function Bl(k){return k.match(du)||[]}function ms(k,Y,K){var Se;return K(k,function(Xe,Ct,hn){if(Y(Xe,Ct,hn))return Se=Ct,!1}),Se}function Yo(k,Y,K,Se){for(var Xe=k.length,Ct=K+(Se?1:-1);Se?Ct--:++Ct<Xe;)if(Y(k[Ct],Ct,k))return Ct;return-1}function Vr(k,Y,K){return Y===Y?Da(k,Y,K):Yo(k,Eo,K)}function zl(k,Y,K,Se){for(var Xe=K-1,Ct=k.length;++Xe<Ct;)if(Se(k[Xe],Y))return Xe;return-1}function Eo(k){return k!==k}function oi(k,Y){var K=k==null?0:k.length;return K?Ra(k,Y)/K:de}function Pa(k){return function(Y){return Y==null?t:Y[k]}}function di(k){return function(Y){return k==null?t:k[Y]}}function Ko(k,Y,K,Se,Xe){return Xe(k,function(Ct,hn,ut){K=Se?(Se=!1,Ct):Y(K,Ct,hn,ut)}),K}function rs(k,Y){var K=k.length;for(k.sort(Y);K--;)k[K]=k[K].value;return k}function Ra(k,Y){for(var K,Se=-1,Xe=k.length;++Se<Xe;){var Ct=Y(k[Se]);Ct!==t&&(K=K===t?Ct:K+Ct)}return K}function Co(k,Y){for(var K=-1,Se=Array(k);++K<k;)Se[K]=Y(K);return Se}function ic(k,Y){return Ft(Y,function(K){return[K,k[K]]})}function Ir(k){return k&&k.slice(0,Vl(k)+1).replace(zr,"")}function ai(k){return function(Y){return k(Y)}}function Ls(k,Y){return Ft(Y,function(K){return k[K]})}function Dr(k,Y){return k.has(Y)}function sl(k,Y){for(var K=-1,Se=k.length;++K<Se&&Vr(Y,k[K],0)>-1;);return K}function Gr(k,Y){for(var K=k.length;K--&&Vr(Y,k[K],0)>-1;);return K}function ol(k,Y){for(var K=k.length,Se=0;K--;)k[K]===Y&&++Se;return Se}var _u=di(Zs),Qs=di(gu);function rc(k){return"\\"+Xc[k]}function Zo(k,Y){return k==null?t:k[Y]}function ks(k){return Wc.test(k)}function yu(k){return Ll.test(k)}function Ia(k){for(var Y,K=[];!(Y=k.next()).done;)K.push(Y.value);return K}function vs(k){var Y=-1,K=Array(k.size);return k.forEach(function(Se,Xe){K[++Y]=[Xe,Se]}),K}function Jo(k,Y){return function(K){return k(Y(K))}}function Mi(k,Y){for(var K=-1,Se=k.length,Xe=0,Ct=[];++K<Se;){var hn=k[K];(hn===Y||hn===b)&&(k[K]=b,Ct[Xe++]=K)}return Ct}function gs(k){var Y=-1,K=Array(k.size);return k.forEach(function(Se){K[++Y]=Se}),K}function qc(k){var Y=-1,K=Array(k.size);return k.forEach(function(Se){K[++Y]=[Se,Se]}),K}function Da(k,Y,K){for(var Se=K-1,Xe=k.length;++Se<Xe;)if(k[Se]===Y)return Se;return-1}function La(k,Y,K){for(var Se=K+1;Se--;)if(k[Se]===Y)return Se;return Se}function Hr(k){return ks(k)?sc(k):rl(k)}function Ai(k){return ks(k)?G(k):pr(k)}function Vl(k){for(var Y=k.length;Y--&&fs.test(k.charAt(Y)););return Y}var $c=di(Js);function sc(k){for(var Y=xo.lastIndex=0;xo.test(k);)++Y;return Y}function G(k){return k.match(xo)||[]}function S(k){return k.match(Th)||[]}var D=function k(Y){Y=Y==null?yn:j.defaults(yn.Object(),Y,j.pick(yn,jc));var K=Y.Array,Se=Y.Date,Xe=Y.Error,Ct=Y.Function,hn=Y.Math,ut=Y.Object,Wr=Y.RegExp,Mh=Y.String,Ui=Y.TypeError,_s=K.prototype,ka=Ct.prototype,Qi=ut.prototype,Fa=Y["__core-js_shared__"],mr=ka.toString,Kt=Qi.hasOwnProperty,Gl=0,bu=function(){var n=/[^.]+$/.exec(Fa&&Fa.keys&&Fa.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),Oa=Qi.toString,oc=mr.call(ut),Ah=yn._,Ph=Wr("^"+mr.call(Kt).replace(Ds,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Na=Mr?Y.Buffer:t,Lr=Y.Symbol,Ua=Y.Uint8Array,ac=Na?Na.allocUnsafe:t,ys=Jo(ut.getPrototypeOf,ut),xu=ut.create,lc=Qi.propertyIsEnumerable,al=_s.splice,Yc=Lr?Lr.isConcatSpreadable:t,bs=Lr?Lr.iterator:t,xs=Lr?Lr.toStringTag:t,ll=function(){try{var n=oo(ut,"defineProperty");return n({},"",{}),n}catch{}}(),gf=Y.clearTimeout!==yn.clearTimeout&&Y.clearTimeout,pi=Se&&Se.now!==yn.Date.now&&Se.now,Kc=Y.setTimeout!==yn.setTimeout&&Y.setTimeout,Qo=hn.ceil,Fs=hn.floor,Hl=ut.getOwnPropertySymbols,Zc=Na?Na.isBuffer:t,Ba=Y.isFinite,uc=_s.join,wu=Jo(ut.keys,ut),wn=hn.max,$n=hn.min,md=Se.now,_f=Y.parseInt,Wl=hn.random,Jc=_s.reverse,ul=oo(Y,"DataView"),To=oo(Y,"Map"),jl=oo(Y,"Promise"),ss=oo(Y,"Set"),Os=oo(Y,"WeakMap"),ea=oo(ut,"create"),Xl=Os&&new Os,jr={},Rh=ao(ul),cl=ao(To),yf=ao(jl),Su=ao(ss),eo=ao(Os),Mo=Lr?Lr.prototype:t,vr=Mo?Mo.valueOf:t,cc=Mo?Mo.toString:t;function I(n){if(Tn(n)&&!mt(n)&&!(n instanceof wt)){if(n instanceof mi)return n;if(Kt.call(n,"__wrapped__"))return Cd(n)}return new mi(n)}var Ns=function(){function n(){}return function(s){if(!Sn(s))return{};if(xu)return xu(s);n.prototype=s;var c=new n;return n.prototype=t,c}}();function ws(){}function mi(n,s){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!s,this.__index__=0,this.__values__=t}I.templateSettings={escape:mn,evaluate:Bn,interpolate:Ti,variable:"",imports:{_:I}},I.prototype=ws.prototype,I.prototype.constructor=I,mi.prototype=Ns(ws.prototype),mi.prototype.constructor=mi;function wt(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ie,this.__views__=[]}function Qc(){var n=new wt(this.__wrapped__);return n.__actions__=Ei(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=Ei(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=Ei(this.__views__),n}function hc(){if(this.__filtered__){var n=new wt(this);n.__dir__=-1,n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function Eu(){var n=this.__wrapped__.value(),s=this.__dir__,c=mt(n),g=s<0,E=c?n.length:0,F=Sd(0,E,this.__views__),W=F.start,Z=F.end,re=Z-W,xe=g?Z:W-1,Ee=this.__iteratees__,Me=Ee.length,We=0,Qe=$n(re,this.__takeCount__);if(!c||!g&&E==re&&Qe==re)return Vs(n,this.__actions__);var at=[];e:for(;re--&&We<Qe;){xe+=s;for(var Tt=-1,lt=n[xe];++Tt<Me;){var Lt=Ee[Tt],Bt=Lt.iteratee,tr=Lt.type,Ii=Bt(lt);if(tr==Ae)lt=Ii;else if(!Ii){if(tr==ge)continue e;break e}}at[We++]=lt}return at}wt.prototype=Ns(ws.prototype),wt.prototype.constructor=wt;function lr(n){var s=-1,c=n==null?0:n.length;for(this.clear();++s<c;){var g=n[s];this.set(g[0],g[1])}}function vi(){this.__data__=ea?ea(null):{},this.size=0}function bi(n){var s=this.has(n)&&delete this.__data__[n];return this.size-=s?1:0,s}function hl(n){var s=this.__data__;if(ea){var c=s[n];return c===v?t:c}return Kt.call(s,n)?s[n]:t}function Xr(n){var s=this.__data__;return ea?s[n]!==t:Kt.call(s,n)}function Ss(n,s){var c=this.__data__;return this.size+=this.has(n)?0:1,c[n]=ea&&s===t?v:s,this}lr.prototype.clear=vi,lr.prototype.delete=bi,lr.prototype.get=hl,lr.prototype.has=Xr,lr.prototype.set=Ss;function Bi(n){var s=-1,c=n==null?0:n.length;for(this.clear();++s<c;){var g=n[s];this.set(g[0],g[1])}}function Cu(){this.__data__=[],this.size=0}function Es(n){var s=this.__data__,c=wi(s,n);if(c<0)return!1;var g=s.length-1;return c==g?s.pop():al.call(s,c,1),--this.size,!0}function eh(n){var s=this.__data__,c=wi(s,n);return c<0?t:s[c][1]}function bf(n){return wi(this.__data__,n)>-1}function xf(n,s){var c=this.__data__,g=wi(c,n);return g<0?(++this.size,c.push([n,s])):c[g][1]=s,this}Bi.prototype.clear=Cu,Bi.prototype.delete=Es,Bi.prototype.get=eh,Bi.prototype.has=bf,Bi.prototype.set=xf;function ur(n){var s=-1,c=n==null?0:n.length;for(this.clear();++s<c;){var g=n[s];this.set(g[0],g[1])}}function wf(){this.size=0,this.__data__={hash:new lr,map:new(To||Bi),string:new lr}}function Ao(n){var s=ku(this,n).delete(n);return this.size-=s?1:0,s}function th(n){return ku(this,n).get(n)}function Ih(n){return ku(this,n).has(n)}function Sf(n,s){var c=ku(this,n),g=c.size;return c.set(n,s),this.size+=c.size==g?0:1,this}ur.prototype.clear=wf,ur.prototype.delete=Ao,ur.prototype.get=th,ur.prototype.has=Ih,ur.prototype.set=Sf;function Us(n){var s=-1,c=n==null?0:n.length;for(this.__data__=new ur;++s<c;)this.add(n[s])}function fl(n){return this.__data__.set(n,v),this}function Tu(n){return this.__data__.has(n)}Us.prototype.add=Us.prototype.push=fl,Us.prototype.has=Tu;function xi(n){var s=this.__data__=new Bi(n);this.size=s.size}function nh(){this.__data__=new Bi,this.size=0}function Po(n){var s=this.__data__,c=s.delete(n);return this.size=s.size,c}function Bs(n){return this.__data__.get(n)}function to(n){return this.__data__.has(n)}function ql(n,s){var c=this.__data__;if(c instanceof Bi){var g=c.__data__;if(!To||g.length<o-1)return g.push([n,s]),this.size=++c.size,this;c=this.__data__=new ur(g)}return c.set(n,s),this.size=c.size,this}xi.prototype.clear=nh,xi.prototype.delete=Po,xi.prototype.get=Bs,xi.prototype.has=to,xi.prototype.set=ql;function zs(n,s){var c=mt(n),g=!c&&qa(n),E=!c&&!g&&zo(n),F=!c&&!g&&!E&&nu(n),W=c||g||E||F,Z=W?Co(n.length,Mh):[],re=Z.length;for(var xe in n)(s||Kt.call(n,xe))&&!(W&&(xe=="length"||E&&(xe=="offset"||xe=="parent")||F&&(xe=="buffer"||xe=="byteLength"||xe=="byteOffset")||ti(xe,re)))&&Z.push(xe);return Z}function no(n){var s=n.length;return s?n[gl(0,s-1)]:t}function dl(n,s){return Ac(Ei(n),qr(s,0,n.length))}function Ef(n){return Ac(Ei(n))}function $l(n,s,c){(c!==t&&!Ur(n[s],c)||c===t&&!(s in n))&&Pi(n,s,c)}function Ro(n,s,c){var g=n[s];(!(Kt.call(n,s)&&Ur(g,c))||c===t&&!(s in n))&&Pi(n,s,c)}function wi(n,s){for(var c=n.length;c--;)if(Ur(n[c][0],s))return c;return-1}function Cs(n,s,c,g){return kr(n,function(E,F,W){s(g,E,c(E),W)}),g}function Yn(n,s){return n&&xr(s,Zn(s),n)}function Io(n,s){return n&&xr(s,Hi(s),n)}function Pi(n,s,c){s=="__proto__"&&ll?ll(n,s,{configurable:!0,enumerable:!0,value:c,writable:!0}):n[s]=c}function Mu(n,s){for(var c=-1,g=s.length,E=K(g),F=n==null;++c<g;)E[c]=F?t:Gd(n,s[c]);return E}function qr(n,s,c){return n===n&&(c!==t&&(n=n<=c?n:c),s!==t&&(n=n>=s?n:s)),n}function Ri(n,s,c,g,E,F){var W,Z=s&w,re=s&C,xe=s&R;if(c&&(W=E?c(n,g,E,F):c(n)),W!==t)return W;if(!Sn(n))return n;var Ee=mt(n);if(Ee){if(W=Bh(n),!Z)return Ei(n,W)}else{var Me=ei(n),We=Me==zt||Me==bn;if(zo(n))return Af(n,Z);if(Me==Nt||Me==fe||We&&!E){if(W=re||We?{}:Jr(n),!Z)return re?Gm(n,Io(W,n)):If(n,Yn(W,n))}else{if(!Qt[Me])return E?n:{};W=Hm(n,Me,Z)}}F||(F=new xi);var Qe=F.get(n);if(Qe)return Qe;F.set(n,W),hv(n)?n.forEach(function(lt){W.add(Ri(lt,s,c,lt,n,F))}):uv(n)&&n.forEach(function(lt,Lt){W.set(Lt,Ri(lt,s,c,Lt,n,F))});var at=xe?re?Cc:Ec:re?Hi:Zn,Tt=Ee?t:at(n);return Qn(Tt||n,function(lt,Lt){Tt&&(Lt=lt,lt=n[Lt]),Ro(W,Lt,Ri(lt,s,c,Lt,n,F))}),W}function Cf(n){var s=Zn(n);return function(c){return Do(c,n,s)}}function Do(n,s,c){var g=c.length;if(n==null)return!g;for(n=ut(n);g--;){var E=c[g],F=s[E],W=n[E];if(W===t&&!(E in n)||!F(W))return!1}return!0}function fc(n,s,c){if(typeof n!="function")throw new Ui(f);return yl(function(){n.apply(t,c)},s)}function Ts(n,s,c,g){var E=-1,F=Rr,W=!0,Z=n.length,re=[],xe=s.length;if(!Z)return re;c&&(s=Ft(s,ai(c))),g?(F=Ul,W=!1):s.length>=o&&(F=Dr,W=!1,s=new Us(s));e:for(;++E<Z;){var Ee=n[E],Me=c==null?Ee:c(Ee);if(Ee=g||Ee!==0?Ee:0,W&&Me===Me){for(var We=xe;We--;)if(s[We]===Me)continue e;re.push(Ee)}else F(s,Me,g)||re.push(Ee)}return re}var kr=Oo(qi),Dh=Oo(na,!0);function Yl(n,s){var c=!0;return kr(n,function(g,E,F){return c=!!s(g,E,F),c}),c}function ta(n,s,c){for(var g=-1,E=n.length;++g<E;){var F=n[g],W=s(F);if(W!=null&&(Z===t?W===W&&!er(W):c(W,Z)))var Z=W,re=F}return re}function Kl(n,s,c,g){var E=n.length;for(c=bt(c),c<0&&(c=-c>E?0:E+c),g=g===t||g>E?E:bt(g),g<0&&(g+=E),g=c>g?0:dv(g);c<g;)n[c++]=s;return n}function dc(n,s){var c=[];return kr(n,function(g,E,F){s(g,E,F)&&c.push(g)}),c}function An(n,s,c,g,E){var F=-1,W=n.length;for(c||(c=Vf),E||(E=[]);++F<W;){var Z=n[F];s>0&&c(Z)?s>1?An(Z,s-1,c,g,E):br(E,Z):g||(E[E.length]=Z)}return E}var Au=Nh(),Pu=Nh(!0);function qi(n,s){return n&&Au(n,s,Zn)}function na(n,s){return n&&Pu(n,s,Zn)}function za(n,s){return yi(s,function(c){return Ws(n[c])})}function os(n,s){s=as(s,n);for(var c=0,g=s.length;n!=null&&c<g;)n=n[wr(s[c++])];return c&&c==g?n:t}function Va(n,s,c){var g=s(n);return mt(n)?g:br(g,c(n))}function Hn(n){return n==null?n===t?Ze:on:xs&&xs in ut(n)?Bf(n):Ed(n)}function ia(n,s){return n>s}function Ms(n,s){return n!=null&&Kt.call(n,s)}function pl(n,s){return n!=null&&s in ut(n)}function Lh(n,s,c){return n>=$n(s,c)&&n<wn(s,c)}function ml(n,s,c){for(var g=c?Ul:Rr,E=n[0].length,F=n.length,W=F,Z=K(F),re=1/0,xe=[];W--;){var Ee=n[W];W&&s&&(Ee=Ft(Ee,ai(s))),re=$n(Ee.length,re),Z[W]=!c&&(s||E>=120&&Ee.length>=120)?new Us(W&&Ee):t}Ee=n[0];var Me=-1,We=Z[0];e:for(;++Me<E&&xe.length<re;){var Qe=Ee[Me],at=s?s(Qe):Qe;if(Qe=c||Qe!==0?Qe:0,!(We?Dr(We,at):g(xe,at,c))){for(W=F;--W;){var Tt=Z[W];if(!(Tt?Dr(Tt,at):g(n[W],at,c)))continue e}We&&We.push(at),xe.push(Qe)}}return xe}function Ga(n,s,c,g){return qi(n,function(E,F,W){s(g,c(E),F,W)}),g}function zi(n,s,c){s=as(s,n),n=Or(n,s);var g=n==null?n:n[wr(Oi(s))];return g==null?t:si(g,n,c)}function pc(n){return Tn(n)&&Hn(n)==fe}function Tf(n){return Tn(n)&&Hn(n)==Pt}function Lo(n){return Tn(n)&&Hn(n)==et}function $r(n,s,c,g,E){return n===s?!0:n==null||s==null||!Tn(n)&&!Tn(s)?n!==n&&s!==s:ih(n,s,c,g,$r,E)}function ih(n,s,c,g,E,F){var W=mt(n),Z=mt(s),re=W?Le:ei(n),xe=Z?Le:ei(s);re=re==fe?Nt:re,xe=xe==fe?Nt:xe;var Ee=re==Nt,Me=xe==Nt,We=re==xe;if(We&&zo(n)){if(!zo(s))return!1;W=!0,Ee=!1}if(We&&!Ee)return F||(F=new xi),W||nu(n)?Uf(n,s,c,g,E,F):xd(n,s,re,c,g,E,F);if(!(c&z)){var Qe=Ee&&Kt.call(n,"__wrapped__"),at=Me&&Kt.call(s,"__wrapped__");if(Qe||at){var Tt=Qe?n.value():n,lt=at?s.value():s;return F||(F=new xi),E(Tt,lt,c,g,F)}}return We?(F||(F=new xi),Rp(n,s,c,g,E,F)):!1}function kh(n){return Tn(n)&&ei(n)==_e}function vl(n,s,c,g){var E=c.length,F=E,W=!g;if(n==null)return!F;for(n=ut(n);E--;){var Z=c[E];if(W&&Z[2]?Z[1]!==n[Z[0]]:!(Z[0]in n))return!1}for(;++E<F;){Z=c[E];var re=Z[0],xe=n[re],Ee=Z[1];if(W&&Z[2]){if(xe===t&&!(re in n))return!1}else{var Me=new xi;if(g)var We=g(xe,Ee,re,n,s,Me);if(!(We===t?$r(Ee,xe,z|O,g,Me):We))return!1}}return!0}function rh(n){if(!Sn(n)||Dp(n))return!1;var s=Ws(n)?Ph:Rl;return s.test(ao(n))}function mc(n){return Tn(n)&&Hn(n)==Dt}function ra(n){return Tn(n)&&ei(n)==le}function vc(n){return Tn(n)&&Yh(n.length)&&!!$t[Hn(n)]}function Zl(n){return typeof n=="function"?n:n==null?Wi:typeof n=="object"?mt(n)?Si(n[0],n[1]):gc(n):Ev(n)}function ko(n){if(!Uo(n))return wu(n);var s=[];for(var c in ut(n))Kt.call(n,c)&&c!="constructor"&&s.push(c);return s}function Fh(n){if(!Sn(n))return Fp(n);var s=Uo(n),c=[];for(var g in n)g=="constructor"&&(s||!Kt.call(n,g))||c.push(g);return c}function sa(n,s){return n<s}function io(n,s){var c=-1,g=Gi(n)?K(n.length):[];return kr(n,function(E,F,W){g[++c]=s(E,F,W)}),g}function gc(n){var s=Tc(n);return s.length==1&&s[0][2]?zh(s[0][0],s[0][1]):function(c){return c===n||vl(c,n,s)}}function Si(n,s){return Ot(n)&&hh(s)?zh(wr(n),s):function(c){var g=Gd(c,n);return g===t&&g===s?Hd(c,n):$r(s,g,z|O)}}function oa(n,s,c,g,E){n!==s&&Au(s,function(F,W){if(E||(E=new xi),Sn(F))sh(n,s,W,c,oa,g,E);else{var Z=g?g(fa(n,W),F,W+"",n,s,E):t;Z===t&&(Z=F),$l(n,W,Z)}},Hi)}function sh(n,s,c,g,E,F,W){var Z=fa(n,c),re=fa(s,c),xe=W.get(re);if(xe){$l(n,c,xe);return}var Ee=F?F(Z,re,c+"",n,s,W):t,Me=Ee===t;if(Me){var We=mt(re),Qe=!We&&zo(re),at=!We&&!Qe&&nu(re);Ee=re,We||Qe||at?mt(Z)?Ee=Z:Rn(Z)?Ee=Ei(Z):Qe?(Me=!1,Ee=Af(re,!0)):at?(Me=!1,Ee=vd(re,!0)):Ee=[]:Lc(re)||qa(re)?(Ee=Z,qa(Z)?Ee=pv(Z):(!Sn(Z)||Ws(Z))&&(Ee=Jr(re))):Me=!1}Me&&(W.set(re,Ee),E(Ee,re,g,F,W),W.delete(re)),$l(n,c,Ee)}function _c(n,s){var c=n.length;if(c)return s+=s<0?c:0,ti(s,c)?n[s]:t}function Ru(n,s,c){s.length?s=Ft(s,function(F){return mt(F)?function(W){return os(W,F.length===1?F[0]:F)}:F}):s=[Wi];var g=-1;s=Ft(s,ai(rt()));var E=io(n,function(F,W,Z){var re=Ft(s,function(xe){return xe(F)});return{criteria:re,index:++g,value:F}});return rs(E,function(F,W){return Vm(F,W,c)})}function oh(n,s){return aa(n,s,function(c,g){return Hd(n,g)})}function aa(n,s,c){for(var g=-1,E=s.length,F={};++g<E;){var W=s[g],Z=os(n,W);c(Z,W)&&ro(F,as(W,n),Z)}return F}function Fi(n){return function(s){return os(s,n)}}function Vi(n,s,c,g){var E=g?zl:Vr,F=-1,W=s.length,Z=n;for(n===s&&(s=Ei(s)),c&&(Z=Ft(n,ai(c)));++F<W;)for(var re=0,xe=s[F],Ee=c?c(xe):xe;(re=E(Z,Ee,re,g))>-1;)Z!==n&&al.call(Z,re,1),al.call(n,re,1);return n}function cr(n,s){for(var c=n?s.length:0,g=c-1;c--;){var E=s[c];if(c==g||E!==F){var F=E;ti(E)?al.call(n,E,1):ln(n,E)}}return n}function gl(n,s){return n+Fs(Wl()*(s-n+1))}function yc(n,s,c,g){for(var E=-1,F=wn(Qo((s-n)/(c||1)),0),W=K(F);F--;)W[g?F:++E]=n,n+=c;return W}function Ha(n,s){var c="";if(!n||s<1||s>ae)return c;do s%2&&(c+=n),s=Fs(s/2),s&&(n+=n);while(s);return c}function yt(n,s){return Gs(Vh(n,s,Wi),n+"")}function Yr(n){return no(iu(n))}function Oh(n,s){var c=iu(n);return Ac(c,qr(s,0,c.length))}function ro(n,s,c,g){if(!Sn(n))return n;s=as(s,n);for(var E=-1,F=s.length,W=F-1,Z=n;Z!=null&&++E<F;){var re=wr(s[E]),xe=c;if(re==="__proto__"||re==="constructor"||re==="prototype")return n;if(E!=W){var Ee=Z[re];xe=g?g(Ee,re,Z):t,xe===t&&(xe=Sn(Ee)?Ee:ti(s[E+1])?[]:{})}Ro(Z,re,xe),Z=Z[re]}return n}var bc=Xl?function(n,s){return Xl.set(n,s),n}:Wi,la=ll?function(n,s){return ll(n,"toString",{configurable:!0,enumerable:!1,value:jd(s),writable:!0})}:Wi;function y(n){return Ac(iu(n))}function h(n,s,c){var g=-1,E=n.length;s<0&&(s=-s>E?0:E+s),c=c>E?E:c,c<0&&(c+=E),E=s>c?0:c-s>>>0,s>>>=0;for(var F=K(E);++g<E;)F[g]=n[g+s];return F}function m(n,s){var c;return kr(n,function(g,E,F){return c=s(g,E,F),!c}),!!c}function T(n,s,c){var g=0,E=n==null?g:n.length;if(typeof s=="number"&&s===s&&E<=ze){for(;g<E;){var F=g+E>>>1,W=n[F];W!==null&&!er(W)&&(c?W<=s:W<s)?g=F+1:E=F}return E}return q(n,s,Wi,c)}function q(n,s,c,g){var E=0,F=n==null?0:n.length;if(F===0)return 0;s=c(s);for(var W=s!==s,Z=s===null,re=er(s),xe=s===t;E<F;){var Ee=Fs((E+F)/2),Me=c(n[Ee]),We=Me!==t,Qe=Me===null,at=Me===Me,Tt=er(Me);if(W)var lt=g||at;else xe?lt=at&&(g||We):Z?lt=at&&We&&(g||!Qe):re?lt=at&&We&&!Qe&&(g||!Tt):Qe||Tt?lt=!1:lt=g?Me<=s:Me<s;lt?E=Ee+1:F=Ee}return $n(F,we)}function ve(n,s){for(var c=-1,g=n.length,E=0,F=[];++c<g;){var W=n[c],Z=s?s(W):W;if(!c||!Ur(Z,re)){var re=Z;F[E++]=W===0?0:W}}return F}function ke(n){return typeof n=="number"?n:er(n)?de:+n}function $e(n){if(typeof n=="string")return n;if(mt(n))return Ft(n,$e)+"";if(er(n))return cc?cc.call(n):"";var s=n+"";return s=="0"&&1/n==-1/0?"-0":s}function Ut(n,s,c){var g=-1,E=Rr,F=n.length,W=!0,Z=[],re=Z;if(c)W=!1,E=Ul;else if(F>=o){var xe=s?null:Pp(n);if(xe)return gs(xe);W=!1,E=Dr,re=new Us}else re=s?[]:Z;e:for(;++g<F;){var Ee=n[g],Me=s?s(Ee):Ee;if(Ee=c||Ee!==0?Ee:0,W&&Me===Me){for(var We=re.length;We--;)if(re[We]===Me)continue e;s&&re.push(Me),Z.push(Ee)}else E(re,Me,c)||(re!==Z&&re.push(Me),Z.push(Ee))}return Z}function ln(n,s){return s=as(s,n),n=Or(n,s),n==null||delete n[wr(Oi(s))]}function On(n,s,c,g){return ro(n,s,c(os(n,s)),g)}function Pn(n,s,c,g){for(var E=n.length,F=g?E:-1;(g?F--:++F<E)&&s(n[F],F,n););return c?h(n,g?0:F,g?F+1:E):h(n,g?F+1:0,g?E:F)}function Vs(n,s){var c=n;return c instanceof wt&&(c=c.value()),So(s,function(g,E){return E.func.apply(E.thisArg,br([g],E.args))},c)}function ua(n,s,c){var g=n.length;if(g<2)return g?Ut(n[0]):[];for(var E=-1,F=K(g);++E<g;)for(var W=n[E],Z=-1;++Z<g;)Z!=E&&(F[E]=Ts(F[E]||W,n[Z],s,c));return Ut(An(F,1),s,c)}function ca(n,s,c){for(var g=-1,E=n.length,F=s.length,W={};++g<E;){var Z=g<F?s[g]:t;c(W,n[g],Z)}return W}function Fo(n){return Rn(n)?n:[]}function ah(n){return typeof n=="function"?n:Wi}function as(n,s){return mt(n)?n:Ot(n,s)?[n]:Wf(en(n))}var Ep=yt;function As(n,s,c){var g=n.length;return c=c===t?g:c,!s&&c>=g?n:h(n,s,c)}var Mf=gf||function(n){return yn.clearTimeout(n)};function Af(n,s){if(s)return n.slice();var c=n.length,g=ac?ac(c):new n.constructor(c);return n.copy(g),g}function xc(n){var s=new n.constructor(n.byteLength);return new Ua(s).set(new Ua(n)),s}function Cp(n,s){var c=s?xc(n.buffer):n.buffer;return new n.constructor(c,n.byteOffset,n.byteLength)}function Tp(n){var s=new n.constructor(n.source,nl.exec(n));return s.lastIndex=n.lastIndex,s}function Mp(n){return vr?ut(vr.call(n)):{}}function vd(n,s){var c=s?xc(n.buffer):n.buffer;return new n.constructor(c,n.byteOffset,n.length)}function Pf(n,s){if(n!==s){var c=n!==t,g=n===null,E=n===n,F=er(n),W=s!==t,Z=s===null,re=s===s,xe=er(s);if(!Z&&!xe&&!F&&n>s||F&&W&&re&&!Z&&!xe||g&&W&&re||!c&&re||!E)return 1;if(!g&&!F&&!xe&&n<s||xe&&c&&E&&!g&&!F||Z&&c&&E||!W&&E||!re)return-1}return 0}function Vm(n,s,c){for(var g=-1,E=n.criteria,F=s.criteria,W=E.length,Z=c.length;++g<W;){var re=Pf(E[g],F[g]);if(re){if(g>=Z)return re;var xe=c[g];return re*(xe=="desc"?-1:1)}}return n.index-s.index}function gd(n,s,c,g){for(var E=-1,F=n.length,W=c.length,Z=-1,re=s.length,xe=wn(F-W,0),Ee=K(re+xe),Me=!g;++Z<re;)Ee[Z]=s[Z];for(;++E<W;)(Me||E<F)&&(Ee[c[E]]=n[E]);for(;xe--;)Ee[Z++]=n[E++];return Ee}function Rf(n,s,c,g){for(var E=-1,F=n.length,W=-1,Z=c.length,re=-1,xe=s.length,Ee=wn(F-Z,0),Me=K(Ee+xe),We=!g;++E<Ee;)Me[E]=n[E];for(var Qe=E;++re<xe;)Me[Qe+re]=s[re];for(;++W<Z;)(We||E<F)&&(Me[Qe+c[W]]=n[E++]);return Me}function Ei(n,s){var c=-1,g=n.length;for(s||(s=K(g));++c<g;)s[c]=n[c];return s}function xr(n,s,c,g){var E=!c;c||(c={});for(var F=-1,W=s.length;++F<W;){var Z=s[F],re=g?g(c[Z],n[Z],Z,c,n):t;re===t&&(re=n[Z]),E?Pi(c,Z,re):Ro(c,Z,re)}return c}function If(n,s){return xr(n,No(n),s)}function Gm(n,s){return xr(n,wd(n),s)}function wc(n,s){return function(c,g){var E=mt(c)?wo:Cs,F=s?s():{};return E(c,n,rt(g,2),F)}}function Wa(n){return yt(function(s,c){var g=-1,E=c.length,F=E>1?c[E-1]:t,W=E>2?c[2]:t;for(F=n.length>3&&typeof F=="function"?(E--,F):t,W&&gi(c[0],c[1],W)&&(F=E<3?t:F,E=1),s=ut(s);++g<E;){var Z=c[g];Z&&n(s,Z,g,F)}return s})}function Oo(n,s){return function(c,g){if(c==null)return c;if(!Gi(c))return n(c,g);for(var E=c.length,F=s?E:-1,W=ut(c);(s?F--:++F<E)&&g(W[F],F,W)!==!1;);return c}}function Nh(n){return function(s,c,g){for(var E=-1,F=ut(s),W=g(s),Z=W.length;Z--;){var re=W[n?Z:++E];if(c(F[re],re,F)===!1)break}return s}}function Df(n,s,c){var g=s&P,E=_l(n);function F(){var W=this&&this!==yn&&this instanceof F?E:n;return W.apply(g?c:this,arguments)}return F}function Lf(n){return function(s){s=en(s);var c=ks(s)?Ai(s):t,g=c?c[0]:s.charAt(0),E=c?As(c,1).join(""):s.slice(1);return g[n]()+E}}function ha(n){return function(s){return So(wv(xv(s).replace(Hc,"")),n,"")}}function _l(n){return function(){var s=arguments;switch(s.length){case 0:return new n;case 1:return new n(s[0]);case 2:return new n(s[0],s[1]);case 3:return new n(s[0],s[1],s[2]);case 4:return new n(s[0],s[1],s[2],s[3]);case 5:return new n(s[0],s[1],s[2],s[3],s[4]);case 6:return new n(s[0],s[1],s[2],s[3],s[4],s[5]);case 7:return new n(s[0],s[1],s[2],s[3],s[4],s[5],s[6])}var c=Ns(n.prototype),g=n.apply(c,s);return Sn(g)?g:c}}function _d(n,s,c){var g=_l(n);function E(){for(var F=arguments.length,W=K(F),Z=F,re=so(E);Z--;)W[Z]=arguments[Z];var xe=F<3&&W[0]!==re&&W[F-1]!==re?[]:Mi(W,re);if(F-=xe.length,F<c)return Ps(n,s,Jl,E.placeholder,t,W,xe,t,t,c-F);var Ee=this&&this!==yn&&this instanceof E?g:n;return si(Ee,this,W)}return E}function Iu(n){return function(s,c,g){var E=ut(s);if(!Gi(s)){var F=rt(c,3);s=Zn(s),c=function(Z){return F(E[Z],Z,E)}}var W=n(s,c,g);return W>-1?E[F?s[W]:W]:t}}function Uh(n){return Zr(function(s){var c=s.length,g=c,E=mi.prototype.thru;for(n&&s.reverse();g--;){var F=s[g];if(typeof F!="function")throw new Ui(f);if(E&&!W&&Ql(F)=="wrapper")var W=new mi([],!0)}for(g=W?g:c;++g<c;){F=s[g];var Z=Ql(F),re=Z=="wrapper"?uh(F):t;re&&Mc(re[0])&&re[1]==(Q|L|$|te)&&!re[4].length&&re[9]==1?W=W[Ql(re[0])].apply(W,re[3]):W=F.length==1&&Mc(F)?W[Z]():W.thru(F)}return function(){var xe=arguments,Ee=xe[0];if(W&&xe.length==1&&mt(Ee))return W.plant(Ee).value();for(var Me=0,We=c?s[Me].apply(this,xe):Ee;++Me<c;)We=s[Me].call(this,We);return We}})}function Jl(n,s,c,g,E,F,W,Z,re,xe){var Ee=s&Q,Me=s&P,We=s&M,Qe=s&(L|B),at=s&V,Tt=We?t:_l(n);function lt(){for(var Lt=arguments.length,Bt=K(Lt),tr=Lt;tr--;)Bt[tr]=arguments[tr];if(Qe)var Ii=so(lt),nr=ol(Bt,Ii);if(g&&(Bt=gd(Bt,g,E,Qe)),F&&(Bt=Rf(Bt,F,W,Qe)),Lt-=nr,Qe&&Lt<xe){var In=Mi(Bt,Ii);return Ps(n,s,Jl,lt.placeholder,c,Bt,In,Z,re,xe-Lt)}var Br=Me?c:this,Xs=We?Br[n]:n;return Lt=Bt.length,Z?Bt=ja(Bt,Z):at&&Lt>1&&Bt.reverse(),Ee&&re<Lt&&(Bt.length=re),this&&this!==yn&&this instanceof lt&&(Xs=Tt||_l(Xs)),Xs.apply(Br,Bt)}return lt}function yd(n,s){return function(c,g){return Ga(c,n,s(g),{})}}function Du(n,s){return function(c,g){var E;if(c===t&&g===t)return s;if(c!==t&&(E=c),g!==t){if(E===t)return g;typeof c=="string"||typeof g=="string"?(c=$e(c),g=$e(g)):(c=ke(c),g=ke(g)),E=n(c,g)}return E}}function lh(n){return Zr(function(s){return s=Ft(s,ai(rt())),yt(function(c){var g=this;return n(s,function(E){return si(E,g,c)})})})}function Lu(n,s){s=s===t?" ":$e(s);var c=s.length;if(c<2)return c?Ha(s,n):s;var g=Ha(s,Qo(n/Hr(s)));return ks(s)?As(Ai(g),0,n).join(""):g.slice(0,n)}function Ap(n,s,c,g){var E=s&P,F=_l(n);function W(){for(var Z=-1,re=arguments.length,xe=-1,Ee=g.length,Me=K(Ee+re),We=this&&this!==yn&&this instanceof W?F:n;++xe<Ee;)Me[xe]=g[xe];for(;re--;)Me[xe++]=arguments[++Z];return si(We,E?c:this,Me)}return W}function kf(n){return function(s,c,g){return g&&typeof g!="number"&&gi(s,c,g)&&(c=g=t),s=js(s),c===t?(c=s,s=0):c=js(c),g=g===t?s<c?1:-1:js(g),yc(s,c,g,n)}}function Sc(n){return function(s,c){return typeof s=="string"&&typeof c=="string"||(s=_r(s),c=_r(c)),n(s,c)}}function Ps(n,s,c,g,E,F,W,Z,re,xe){var Ee=s&L,Me=Ee?W:t,We=Ee?t:W,Qe=Ee?F:t,at=Ee?t:F;s|=Ee?$:X,s&=~(Ee?X:$),s&U||(s&=-4);var Tt=[n,s,E,Qe,Me,at,We,Z,re,xe],lt=c.apply(t,Tt);return Mc(n)&&Gf(lt,Tt),lt.placeholder=g,Hf(lt,n,s)}function Fr(n){var s=hn[n];return function(c,g){if(c=_r(c),g=g==null?0:$n(bt(g),292),g&&Ba(c)){var E=(en(c)+"e").split("e"),F=s(E[0]+"e"+(+E[1]+g));return E=(en(F)+"e").split("e"),+(E[0]+"e"+(+E[1]-g))}return s(c)}}var Pp=ss&&1/gs(new ss([,-0]))[1]==Ie?function(n){return new ss(n)}:$d;function Ff(n){return function(s){var c=ei(s);return c==_e?vs(s):c==le?qc(s):ic(s,n(s))}}function Kr(n,s,c,g,E,F,W,Z){var re=s&M;if(!re&&typeof n!="function")throw new Ui(f);var xe=g?g.length:0;if(xe||(s&=-97,g=E=t),W=W===t?W:wn(bt(W),0),Z=Z===t?Z:bt(Z),xe-=E?E.length:0,s&X){var Ee=g,Me=E;g=E=t}var We=re?t:uh(n),Qe=[n,s,c,g,E,Ee,Me,F,W,Z];if(We&&kp(Qe,We),n=Qe[0],s=Qe[1],c=Qe[2],g=Qe[3],E=Qe[4],Z=Qe[9]=Qe[9]===t?re?0:n.length:wn(Qe[9]-xe,0),!Z&&s&(L|B)&&(s&=-25),!s||s==P)var at=Df(n,s,c);else s==L||s==B?at=_d(n,s,Z):(s==$||s==(P|$))&&!E.length?at=Ap(n,s,c,g):at=Jl.apply(t,Qe);var Tt=We?bc:Gf;return Hf(Tt(at,Qe),n,s)}function Of(n,s,c,g){return n===t||Ur(n,Qi[c])&&!Kt.call(g,c)?s:n}function Nf(n,s,c,g,E,F){return Sn(n)&&Sn(s)&&(F.set(s,n),oa(n,s,t,Nf,F),F.delete(s)),n}function bd(n){return Lc(n)?t:n}function Uf(n,s,c,g,E,F){var W=c&z,Z=n.length,re=s.length;if(Z!=re&&!(W&&re>Z))return!1;var xe=F.get(n),Ee=F.get(s);if(xe&&Ee)return xe==s&&Ee==n;var Me=-1,We=!0,Qe=c&O?new Us:t;for(F.set(n,s),F.set(s,n);++Me<Z;){var at=n[Me],Tt=s[Me];if(g)var lt=W?g(Tt,at,Me,s,n,F):g(at,Tt,Me,n,s,F);if(lt!==t){if(lt)continue;We=!1;break}if(Qe){if(!ps(s,function(Lt,Bt){if(!Dr(Qe,Bt)&&(at===Lt||E(at,Lt,c,g,F)))return Qe.push(Bt)})){We=!1;break}}else if(!(at===Tt||E(at,Tt,c,g,F))){We=!1;break}}return F.delete(n),F.delete(s),We}function xd(n,s,c,g,E,F,W){switch(c){case ht:if(n.byteLength!=s.byteLength||n.byteOffset!=s.byteOffset)return!1;n=n.buffer,s=s.buffer;case Pt:return!(n.byteLength!=s.byteLength||!F(new Ua(n),new Ua(s)));case He:case et:case Ln:return Ur(+n,+s);case Wt:return n.name==s.name&&n.message==s.message;case Dt:case ne:return n==s+"";case _e:var Z=vs;case le:var re=g&z;if(Z||(Z=gs),n.size!=s.size&&!re)return!1;var xe=W.get(n);if(xe)return xe==s;g|=O,W.set(n,s);var Ee=Uf(Z(n),Z(s),g,E,F,W);return W.delete(n),Ee;case Oe:if(vr)return vr.call(n)==vr.call(s)}return!1}function Rp(n,s,c,g,E,F){var W=c&z,Z=Ec(n),re=Z.length,xe=Ec(s),Ee=xe.length;if(re!=Ee&&!W)return!1;for(var Me=re;Me--;){var We=Z[Me];if(!(W?We in s:Kt.call(s,We)))return!1}var Qe=F.get(n),at=F.get(s);if(Qe&&at)return Qe==s&&at==n;var Tt=!0;F.set(n,s),F.set(s,n);for(var lt=W;++Me<re;){We=Z[Me];var Lt=n[We],Bt=s[We];if(g)var tr=W?g(Bt,Lt,We,s,n,F):g(Lt,Bt,We,n,s,F);if(!(tr===t?Lt===Bt||E(Lt,Bt,c,g,F):tr)){Tt=!1;break}lt||(lt=We=="constructor")}if(Tt&&!lt){var Ii=n.constructor,nr=s.constructor;Ii!=nr&&"constructor"in n&&"constructor"in s&&!(typeof Ii=="function"&&Ii instanceof Ii&&typeof nr=="function"&&nr instanceof nr)&&(Tt=!1)}return F.delete(n),F.delete(s),Tt}function Zr(n){return Gs(Vh(n,t,Hh),n+"")}function Ec(n){return Va(n,Zn,No)}function Cc(n){return Va(n,Hi,wd)}var uh=Xl?function(n){return Xl.get(n)}:$d;function Ql(n){for(var s=n.name+"",c=jr[s],g=Kt.call(jr,s)?c.length:0;g--;){var E=c[g],F=E.func;if(F==null||F==n)return E.name}return s}function so(n){var s=Kt.call(I,"placeholder")?I:n;return s.placeholder}function rt(){var n=I.iteratee||Xd;return n=n===Xd?Zl:n,arguments.length?n(arguments[0],arguments[1]):n}function ku(n,s){var c=n.__data__;return ch(s)?c[typeof s=="string"?"string":"hash"]:c.map}function Tc(n){for(var s=Zn(n),c=s.length;c--;){var g=s[c],E=n[g];s[c]=[g,E,hh(E)]}return s}function oo(n,s){var c=Zo(n,s);return rh(c)?c:t}function Bf(n){var s=Kt.call(n,xs),c=n[xs];try{n[xs]=t;var g=!0}catch{}var E=Oa.call(n);return g&&(s?n[xs]=c:delete n[xs]),E}var No=Hl?function(n){return n==null?[]:(n=ut(n),yi(Hl(n),function(s){return lc.call(n,s)}))}:Yd,wd=Hl?function(n){for(var s=[];n;)br(s,No(n)),n=ys(n);return s}:Yd,ei=Hn;(ul&&ei(new ul(new ArrayBuffer(1)))!=ht||To&&ei(new To)!=_e||jl&&ei(jl.resolve())!=Vt||ss&&ei(new ss)!=le||Os&&ei(new Os)!=Je)&&(ei=function(n){var s=Hn(n),c=s==Nt?n.constructor:t,g=c?ao(c):"";if(g)switch(g){case Rh:return ht;case cl:return _e;case yf:return Vt;case Su:return le;case eo:return Je}return s});function Sd(n,s,c){for(var g=-1,E=c.length;++g<E;){var F=c[g],W=F.size;switch(F.type){case"drop":n+=W;break;case"dropRight":s-=W;break;case"take":s=$n(s,n+W);break;case"takeRight":n=wn(n,s-W);break}}return{start:n,end:s}}function Ip(n){var s=n.match(vo);return s?s[1].split(Ho):[]}function zf(n,s,c){s=as(s,n);for(var g=-1,E=s.length,F=!1;++g<E;){var W=wr(s[g]);if(!(F=n!=null&&c(n,W)))break;n=n[W]}return F||++g!=E?F:(E=n==null?0:n.length,!!E&&Yh(E)&&ti(W,E)&&(mt(n)||qa(n)))}function Bh(n){var s=n.length,c=new n.constructor(s);return s&&typeof n[0]=="string"&&Kt.call(n,"index")&&(c.index=n.index,c.input=n.input),c}function Jr(n){return typeof n.constructor=="function"&&!Uo(n)?Ns(ys(n)):{}}function Hm(n,s,c){var g=n.constructor;switch(s){case Pt:return xc(n);case He:case et:return new g(+n);case ht:return Cp(n,c);case _t:case fn:case it:case St:case jt:case tn:case xt:case pn:case nn:return vd(n,c);case _e:return new g;case Ln:case ne:return new g(n);case Dt:return Tp(n);case le:return new g;case Oe:return Mp(n)}}function Wm(n,s){var c=s.length;if(!c)return n;var g=c-1;return s[g]=(c>1?"& ":"")+s[g],s=s.join(c>2?", ":" "),n.replace(mo,`{
/* [wrapped with `+s+`] */
`)}function Vf(n){return mt(n)||qa(n)||!!(Yc&&n&&n[Yc])}function ti(n,s){var c=typeof n;return s=s??ae,!!s&&(c=="number"||c!="symbol"&&oe.test(n))&&n>-1&&n%1==0&&n<s}function gi(n,s,c){if(!Sn(c))return!1;var g=typeof s;return(g=="number"?Gi(c)&&ti(s,c.length):g=="string"&&s in c)?Ur(c[s],n):!1}function Ot(n,s){if(mt(n))return!1;var c=typeof n;return c=="number"||c=="symbol"||c=="boolean"||n==null||er(n)?!0:yr.test(n)||!vn.test(n)||s!=null&&n in ut(s)}function ch(n){var s=typeof n;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?n!=="__proto__":n===null}function Mc(n){var s=Ql(n),c=I[s];if(typeof c!="function"||!(s in wt.prototype))return!1;if(n===c)return!0;var g=uh(c);return!!g&&n===g[0]}function Dp(n){return!!bu&&bu in n}var jm=Fa?Ws:Kd;function Uo(n){var s=n&&n.constructor,c=typeof s=="function"&&s.prototype||Qi;return n===c}function hh(n){return n===n&&!Sn(n)}function zh(n,s){return function(c){return c==null?!1:c[n]===s&&(s!==t||n in ut(c))}}function Lp(n){var s=Ne(n,function(g){return c.size===_&&c.clear(),g}),c=s.cache;return s}function kp(n,s){var c=n[1],g=s[1],E=c|g,F=E<(P|M|Q),W=g==Q&&c==L||g==Q&&c==te&&n[7].length<=s[8]||g==(Q|te)&&s[7].length<=s[8]&&c==L;if(!(F||W))return n;g&P&&(n[2]=s[2],E|=c&P?0:U);var Z=s[3];if(Z){var re=n[3];n[3]=re?gd(re,Z,s[4]):Z,n[4]=re?Mi(n[3],b):s[4]}return Z=s[5],Z&&(re=n[5],n[5]=re?Rf(re,Z,s[6]):Z,n[6]=re?Mi(n[5],b):s[6]),Z=s[7],Z&&(n[7]=Z),g&Q&&(n[8]=n[8]==null?s[8]:$n(n[8],s[8])),n[9]==null&&(n[9]=s[9]),n[0]=s[0],n[1]=E,n}function Fp(n){var s=[];if(n!=null)for(var c in ut(n))s.push(c);return s}function Ed(n){return Oa.call(n)}function Vh(n,s,c){return s=wn(s===t?n.length-1:s,0),function(){for(var g=arguments,E=-1,F=wn(g.length-s,0),W=K(F);++E<F;)W[E]=g[s+E];E=-1;for(var Z=K(s+1);++E<s;)Z[E]=g[E];return Z[s]=c(W),si(n,this,Z)}}function Or(n,s){return s.length<2?n:os(n,h(s,0,-1))}function ja(n,s){for(var c=n.length,g=$n(s.length,c),E=Ei(n);g--;){var F=s[g];n[g]=ti(F,c)?E[F]:t}return n}function fa(n,s){if(!(s==="constructor"&&typeof n[s]=="function")&&s!="__proto__")return n[s]}var Gf=da(bc),yl=Kc||function(n,s){return yn.setTimeout(n,s)},Gs=da(la);function Hf(n,s,c){var g=s+"";return Gs(n,Wm(g,Op(Ip(g),c)))}function da(n){var s=0,c=0;return function(){var g=md(),E=he-(g-c);if(c=g,E>0){if(++s>=ce)return arguments[0]}else s=0;return n.apply(t,arguments)}}function Ac(n,s){var c=-1,g=n.length,E=g-1;for(s=s===t?g:s;++c<s;){var F=gl(c,E),W=n[F];n[F]=n[c],n[c]=W}return n.length=s,n}var Wf=Lp(function(n){var s=[];return n.charCodeAt(0)===46&&s.push(""),n.replace(_i,function(c,g,E,F){s.push(E?F.replace(pu,"$1"):g||c)}),s});function wr(n){if(typeof n=="string"||er(n))return n;var s=n+"";return s=="0"&&1/n==-1/0?"-0":s}function ao(n){if(n!=null){try{return mr.call(n)}catch{}try{return n+""}catch{}}return""}function Op(n,s){return Qn(se,function(c){var g="_."+c[0];s&c[1]&&!Rr(n,g)&&n.push(g)}),n.sort()}function Cd(n){if(n instanceof wt)return n.clone();var s=new mi(n.__wrapped__,n.__chain__);return s.__actions__=Ei(n.__actions__),s.__index__=n.__index__,s.__values__=n.__values__,s}function jf(n,s,c){(c?gi(n,s,c):s===t)?s=1:s=wn(bt(s),0);var g=n==null?0:n.length;if(!g||s<1)return[];for(var E=0,F=0,W=K(Qo(g/s));E<g;)W[F++]=h(n,E,E+=s);return W}function Td(n){for(var s=-1,c=n==null?0:n.length,g=0,E=[];++s<c;){var F=n[s];F&&(E[g++]=F)}return E}function pa(){var n=arguments.length;if(!n)return[];for(var s=K(n-1),c=arguments[0],g=n;g--;)s[g-1]=arguments[g];return br(mt(c)?Ei(c):[c],An(s,1))}var Kn=yt(function(n,s){return Rn(n)?Ts(n,An(s,1,Rn,!0)):[]}),Qr=yt(function(n,s){var c=Oi(s);return Rn(c)&&(c=t),Rn(n)?Ts(n,An(s,1,Rn,!0),rt(c,2)):[]}),Sr=yt(function(n,s){var c=Oi(s);return Rn(c)&&(c=t),Rn(n)?Ts(n,An(s,1,Rn,!0),t,c):[]});function ls(n,s,c){var g=n==null?0:n.length;return g?(s=c||s===t?1:bt(s),h(n,s<0?0:s,g)):[]}function Bo(n,s,c){var g=n==null?0:n.length;return g?(s=c||s===t?1:bt(s),s=g-s,h(n,0,s<0?0:s)):[]}function fh(n,s){return n&&n.length?Pn(n,rt(s,3),!0,!0):[]}function Nr(n,s){return n&&n.length?Pn(n,rt(s,3),!0):[]}function Gh(n,s,c,g){var E=n==null?0:n.length;return E?(c&&typeof c!="number"&&gi(n,s,c)&&(c=0,g=E),Kl(n,s,c,g)):[]}function eu(n,s,c){var g=n==null?0:n.length;if(!g)return-1;var E=c==null?0:bt(c);return E<0&&(E=wn(g+E,0)),Yo(n,rt(s,3),E)}function dh(n,s,c){var g=n==null?0:n.length;if(!g)return-1;var E=g-1;return c!==t&&(E=bt(c),E=c<0?wn(g+E,0):$n(E,g-1)),Yo(n,rt(s,3),E,!0)}function Hh(n){var s=n==null?0:n.length;return s?An(n,1):[]}function Wh(n){var s=n==null?0:n.length;return s?An(n,Ie):[]}function lo(n,s){var c=n==null?0:n.length;return c?(s=s===t?1:bt(s),An(n,s)):[]}function Md(n){for(var s=-1,c=n==null?0:n.length,g={};++s<c;){var E=n[s];g[E[0]]=E[1]}return g}function Fu(n){return n&&n.length?n[0]:t}function tu(n,s,c){var g=n==null?0:n.length;if(!g)return-1;var E=c==null?0:bt(c);return E<0&&(E=wn(g+E,0)),Vr(n,s,E)}function Xf(n){var s=n==null?0:n.length;return s?h(n,0,-1):[]}var Ad=yt(function(n){var s=Ft(n,Fo);return s.length&&s[0]===n[0]?ml(s):[]}),Ou=yt(function(n){var s=Oi(n),c=Ft(n,Fo);return s===Oi(c)?s=t:c.pop(),c.length&&c[0]===n[0]?ml(c,rt(s,2)):[]}),qf=yt(function(n){var s=Oi(n),c=Ft(n,Fo);return s=typeof s=="function"?s:t,s&&c.pop(),c.length&&c[0]===n[0]?ml(c,t,s):[]});function Nu(n,s){return n==null?"":uc.call(n,s)}function Oi(n){var s=n==null?0:n.length;return s?n[s-1]:t}function jh(n,s,c){var g=n==null?0:n.length;if(!g)return-1;var E=g;return c!==t&&(E=bt(c),E=E<0?wn(g+E,0):$n(E,g-1)),s===s?La(n,s,E):Yo(n,Eo,E,!0)}function Pd(n,s){return n&&n.length?_c(n,bt(s)):t}var $f=yt(ph);function ph(n,s){return n&&n.length&&s&&s.length?Vi(n,s):n}function Hs(n,s,c){return n&&n.length&&s&&s.length?Vi(n,s,rt(c,2)):n}function Uu(n,s,c){return n&&n.length&&s&&s.length?Vi(n,s,t,c):n}var Xa=Zr(function(n,s){var c=n==null?0:n.length,g=Mu(n,s);return cr(n,Ft(s,function(E){return ti(E,c)?+E:E}).sort(Pf)),g});function uo(n,s){var c=[];if(!(n&&n.length))return c;var g=-1,E=[],F=n.length;for(s=rt(s,3);++g<F;){var W=n[g];s(W,g,n)&&(c.push(W),E.push(g))}return cr(n,E),c}function mh(n){return n==null?n:Jc.call(n)}function Rd(n,s,c){var g=n==null?0:n.length;return g?(c&&typeof c!="number"&&gi(n,s,c)?(s=0,c=g):(s=s==null?0:bt(s),c=c===t?g:bt(c)),h(n,s,c)):[]}function Id(n,s){return T(n,s)}function Xm(n,s,c){return q(n,s,rt(c,2))}function Bu(n,s){var c=n==null?0:n.length;if(c){var g=T(n,s);if(g<c&&Ur(n[g],s))return g}return-1}function Np(n,s){return T(n,s,!0)}function Dd(n,s,c){return q(n,s,rt(c,2),!0)}function Pc(n,s){var c=n==null?0:n.length;if(c){var g=T(n,s,!0)-1;if(Ur(n[g],s))return g}return-1}function Ld(n){return n&&n.length?ve(n):[]}function Rc(n,s){return n&&n.length?ve(n,rt(s,2)):[]}function Up(n){var s=n==null?0:n.length;return s?h(n,1,s):[]}function Bp(n,s,c){return n&&n.length?(s=c||s===t?1:bt(s),h(n,0,s<0?0:s)):[]}function kd(n,s,c){var g=n==null?0:n.length;return g?(s=c||s===t?1:bt(s),s=g-s,h(n,s<0?0:s,g)):[]}function Yf(n,s){return n&&n.length?Pn(n,rt(s,3),!1,!0):[]}function qm(n,s){return n&&n.length?Pn(n,rt(s,3)):[]}var $m=yt(function(n){return Ut(An(n,1,Rn,!0))}),zp=yt(function(n){var s=Oi(n);return Rn(s)&&(s=t),Ut(An(n,1,Rn,!0),rt(s,2))}),Vp=yt(function(n){var s=Oi(n);return s=typeof s=="function"?s:t,Ut(An(n,1,Rn,!0),t,s)});function Ic(n){return n&&n.length?Ut(n):[]}function Ym(n,s){return n&&n.length?Ut(n,rt(s,2)):[]}function vh(n,s){return s=typeof s=="function"?s:t,n&&n.length?Ut(n,t,s):[]}function gh(n){if(!(n&&n.length))return[];var s=0;return n=yi(n,function(c){if(Rn(c))return s=wn(c.length,s),!0}),Co(s,function(c){return Ft(n,Pa(c))})}function $i(n,s){if(!(n&&n.length))return[];var c=gh(n);return s==null?c:Ft(c,function(g){return si(s,t,g)})}var Km=yt(function(n,s){return Rn(n)?Ts(n,s):[]}),Gp=yt(function(n){return ua(yi(n,Rn))}),Zm=yt(function(n){var s=Oi(n);return Rn(s)&&(s=t),ua(yi(n,Rn),rt(s,2))}),Jm=yt(function(n){var s=Oi(n);return s=typeof s=="function"?s:t,ua(yi(n,Rn),t,s)}),Hp=yt(gh);function Wp(n,s){return ca(n||[],s||[],Ro)}function Qm(n,s){return ca(n||[],s||[],ro)}var ma=yt(function(n){var s=n.length,c=s>1?n[s-1]:t;return c=typeof c=="function"?(n.pop(),c):t,$i(n,c)});function Xh(n){var s=I(n);return s.__chain__=!0,s}function ev(n,s){return s(n),n}function co(n,s){return s(n)}var Kf=Zr(function(n){var s=n.length,c=s?n[0]:0,g=this.__wrapped__,E=function(F){return Mu(F,n)};return s>1||this.__actions__.length||!(g instanceof wt)||!ti(c)?this.thru(E):(g=g.slice(c,+c+(s?1:0)),g.__actions__.push({func:co,args:[E],thisArg:t}),new mi(g,this.__chain__).thru(function(F){return s&&!F.length&&F.push(t),F}))});function Dc(){return Xh(this)}function Zf(){return new mi(this.value(),this.__chain__)}function Fd(){this.__values__===t&&(this.__values__=fv(this.value()));var n=this.__index__>=this.__values__.length,s=n?t:this.__values__[this.__index__++];return{done:n,value:s}}function Od(){return this}function tv(n){for(var s,c=this;c instanceof ws;){var g=Cd(c);g.__index__=0,g.__values__=t,s?E.__wrapped__=g:s=g;var E=g;c=c.__wrapped__}return E.__wrapped__=n,s}function Nd(){var n=this.__wrapped__;if(n instanceof wt){var s=n;return this.__actions__.length&&(s=new wt(this)),s=s.reverse(),s.__actions__.push({func:co,args:[mh],thisArg:t}),new mi(s,this.__chain__)}return this.thru(mh)}function nv(){return Vs(this.__wrapped__,this.__actions__)}var jp=wc(function(n,s,c){Kt.call(n,c)?++n[c]:Pi(n,c,1)});function Xp(n,s,c){var g=mt(n)?Nl:Yl;return c&&gi(n,s,c)&&(s=t),g(n,rt(s,3))}function Jf(n,s){var c=mt(n)?yi:dc;return c(n,rt(s,3))}var Qf=Iu(eu),qp=Iu(dh);function Ud(n,s){return An(bl(n,s),1)}function iv(n,s){return An(bl(n,s),Ie)}function $p(n,s,c){return c=c===t?1:bt(c),An(bl(n,s),c)}function qh(n,s){var c=mt(n)?Qn:kr;return c(n,rt(s,3))}function _h(n,s){var c=mt(n)?Aa:Dh;return c(n,rt(s,3))}var Bd=wc(function(n,s,c){Kt.call(n,c)?n[c].push(s):Pi(n,c,[s])});function ed(n,s,c,g){n=Gi(n)?n:iu(n),c=c&&!g?bt(c):0;var E=n.length;return c<0&&(c=wn(E+c,0)),Kh(n)?c<=E&&n.indexOf(s,c)>-1:!!E&&Vr(n,s,c)>-1}var Yp=yt(function(n,s,c){var g=-1,E=typeof s=="function",F=Gi(n)?K(n.length):[];return kr(n,function(W){F[++g]=E?si(s,W,c):zi(W,s,c)}),F}),rv=wc(function(n,s,c){Pi(n,c,s)});function bl(n,s){var c=mt(n)?Ft:io;return c(n,rt(s,3))}function sv(n,s,c,g){return n==null?[]:(mt(s)||(s=s==null?[]:[s]),c=g?t:c,mt(c)||(c=c==null?[]:[c]),Ru(n,s,c))}var $h=wc(function(n,s,c){n[c?0:1].push(s)},function(){return[[],[]]});function ov(n,s,c){var g=mt(n)?So:Ko,E=arguments.length<3;return g(n,rt(s,4),c,E,kr)}function td(n,s,c){var g=mt(n)?nc:Ko,E=arguments.length<3;return g(n,rt(s,4),c,E,Dh)}function a(n,s){var c=mt(n)?yi:dc;return c(n,ct(rt(s,3)))}function u(n){var s=mt(n)?no:Yr;return s(n)}function p(n,s,c){(c?gi(n,s,c):s===t)?s=1:s=bt(s);var g=mt(n)?dl:Oh;return g(n,s)}function x(n){var s=mt(n)?Ef:y;return s(n)}function A(n){if(n==null)return 0;if(Gi(n))return Kh(n)?Hr(n):n.length;var s=ei(n);return s==_e||s==le?n.size:ko(n).length}function N(n,s,c){var g=mt(n)?ps:m;return c&&gi(n,s,c)&&(s=t),g(n,rt(s,3))}var ee=yt(function(n,s){if(n==null)return[];var c=s.length;return c>1&&gi(n,s[0],s[1])?s=[]:c>2&&gi(s[0],s[1],s[2])&&(s=[s[0]]),Ru(n,An(s,1),[])}),pe=pi||function(){return yn.Date.now()};function Ce(n,s){if(typeof s!="function")throw new Ui(f);return n=bt(n),function(){if(--n<1)return s.apply(this,arguments)}}function Ge(n,s,c){return s=c?t:s,s=n&&s==null?n.length:s,Kr(n,Q,t,t,t,t,s)}function nt(n,s){var c;if(typeof s!="function")throw new Ui(f);return n=bt(n),function(){return--n>0&&(c=s.apply(this,arguments)),n<=1&&(s=t),c}}var st=yt(function(n,s,c){var g=P;if(c.length){var E=Mi(c,so(st));g|=$}return Kr(n,g,s,c,E)}),tt=yt(function(n,s,c){var g=P|M;if(c.length){var E=Mi(c,so(tt));g|=$}return Kr(s,g,n,c,E)});function It(n,s,c){s=c?t:s;var g=Kr(n,L,t,t,t,t,t,s);return g.placeholder=It.placeholder,g}function Gt(n,s,c){s=c?t:s;var g=Kr(n,B,t,t,t,t,t,s);return g.placeholder=Gt.placeholder,g}function qt(n,s,c){var g,E,F,W,Z,re,xe=0,Ee=!1,Me=!1,We=!0;if(typeof n!="function")throw new Ui(f);s=_r(s)||0,Sn(c)&&(Ee=!!c.leading,Me="maxWait"in c,F=Me?wn(_r(c.maxWait)||0,s):F,We="trailing"in c?!!c.trailing:We);function Qe(In){var Br=g,Xs=E;return g=E=t,xe=In,W=n.apply(Xs,Br),W}function at(In){return xe=In,Z=yl(Lt,s),Ee?Qe(In):W}function Tt(In){var Br=In-re,Xs=In-xe,Cv=s-Br;return Me?$n(Cv,F-Xs):Cv}function lt(In){var Br=In-re,Xs=In-xe;return re===t||Br>=s||Br<0||Me&&Xs>=F}function Lt(){var In=pe();if(lt(In))return Bt(In);Z=yl(Lt,Tt(In))}function Bt(In){return Z=t,We&&g?Qe(In):(g=E=t,W)}function tr(){Z!==t&&Mf(Z),xe=0,g=re=E=Z=t}function Ii(){return Z===t?W:Bt(pe())}function nr(){var In=pe(),Br=lt(In);if(g=arguments,E=this,re=In,Br){if(Z===t)return at(re);if(Me)return Mf(Z),Z=yl(Lt,s),Qe(re)}return Z===t&&(Z=yl(Lt,s)),W}return nr.cancel=tr,nr.flush=Ii,nr}var gr=yt(function(n,s){return fc(n,1,s)}),Fe=yt(function(n,s,c){return fc(n,_r(s)||0,c)});function Pe(n){return Kr(n,V)}function Ne(n,s){if(typeof n!="function"||s!=null&&typeof s!="function")throw new Ui(f);var c=function(){var g=arguments,E=s?s.apply(this,g):g[0],F=c.cache;if(F.has(E))return F.get(E);var W=n.apply(this,g);return c.cache=F.set(E,W)||F,W};return c.cache=new(Ne.Cache||ur),c}Ne.Cache=ur;function ct(n){if(typeof n!="function")throw new Ui(f);return function(){var s=arguments;switch(s.length){case 0:return!n.call(this);case 1:return!n.call(this,s[0]);case 2:return!n.call(this,s[0],s[1]);case 3:return!n.call(this,s[0],s[1],s[2])}return!n.apply(this,s)}}function Jt(n){return nt(2,n)}var dn=Ep(function(n,s){s=s.length==1&&mt(s[0])?Ft(s[0],ai(rt())):Ft(An(s,1),ai(rt()));var c=s.length;return yt(function(g){for(var E=-1,F=$n(g.length,c);++E<F;)g[E]=s[E].call(this,g[E]);return si(n,this,g)})}),sn=yt(function(n,s){var c=Mi(s,so(sn));return Kr(n,$,t,s,c)}),_n=yt(function(n,s){var c=Mi(s,so(_n));return Kr(n,X,t,s,c)}),es=Zr(function(n,s){return Kr(n,te,t,t,t,s)});function ni(n,s){if(typeof n!="function")throw new Ui(f);return s=s===t?s:bt(s),yt(n,s)}function zu(n,s){if(typeof n!="function")throw new Ui(f);return s=s==null?0:wn(bt(s),0),yt(function(c){var g=c[s],E=As(c,0,s);return g&&br(E,g),si(n,this,E)})}function av(n,s,c){var g=!0,E=!0;if(typeof n!="function")throw new Ui(f);return Sn(c)&&(g="leading"in c?!!c.leading:g,E="trailing"in c?!!c.trailing:E),qt(n,s,{leading:g,maxWait:s,trailing:E})}function a_(n){return Ge(n,1)}function l_(n,s){return sn(ah(s),n)}function u_(){if(!arguments.length)return[];var n=arguments[0];return mt(n)?n:[n]}function c_(n){return Ri(n,R)}function h_(n,s){return s=typeof s=="function"?s:t,Ri(n,R,s)}function f_(n){return Ri(n,w|R)}function d_(n,s){return s=typeof s=="function"?s:t,Ri(n,w|R,s)}function p_(n,s){return s==null||Do(n,s,Zn(s))}function Ur(n,s){return n===s||n!==n&&s!==s}var m_=Sc(ia),v_=Sc(function(n,s){return n>=s}),qa=pc(function(){return arguments}())?pc:function(n){return Tn(n)&&Kt.call(n,"callee")&&!lc.call(n,"callee")},mt=K.isArray,g_=il?ai(il):Tf;function Gi(n){return n!=null&&Yh(n.length)&&!Ws(n)}function Rn(n){return Tn(n)&&Gi(n)}function __(n){return n===!0||n===!1||Tn(n)&&Hn(n)==He}var zo=Zc||Kd,y_=Ar?ai(Ar):Lo;function b_(n){return Tn(n)&&n.nodeType===1&&!Lc(n)}function x_(n){if(n==null)return!0;if(Gi(n)&&(mt(n)||typeof n=="string"||typeof n.splice=="function"||zo(n)||nu(n)||qa(n)))return!n.length;var s=ei(n);if(s==_e||s==le)return!n.size;if(Uo(n))return!ko(n).length;for(var c in n)if(Kt.call(n,c))return!1;return!0}function w_(n,s){return $r(n,s)}function S_(n,s,c){c=typeof c=="function"?c:t;var g=c?c(n,s):t;return g===t?$r(n,s,t,c):!!g}function zd(n){if(!Tn(n))return!1;var s=Hn(n);return s==Wt||s==pt||typeof n.message=="string"&&typeof n.name=="string"&&!Lc(n)}function E_(n){return typeof n=="number"&&Ba(n)}function Ws(n){if(!Sn(n))return!1;var s=Hn(n);return s==zt||s==bn||s==Be||s==Mn}function lv(n){return typeof n=="number"&&n==bt(n)}function Yh(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=ae}function Sn(n){var s=typeof n;return n!=null&&(s=="object"||s=="function")}function Tn(n){return n!=null&&typeof n=="object"}var uv=Pr?ai(Pr):kh;function C_(n,s){return n===s||vl(n,s,Tc(s))}function T_(n,s,c){return c=typeof c=="function"?c:t,vl(n,s,Tc(s),c)}function M_(n){return cv(n)&&n!=+n}function A_(n){if(jm(n))throw new Xe(l);return rh(n)}function P_(n){return n===null}function R_(n){return n==null}function cv(n){return typeof n=="number"||Tn(n)&&Hn(n)==Ln}function Lc(n){if(!Tn(n)||Hn(n)!=Nt)return!1;var s=ys(n);if(s===null)return!0;var c=Kt.call(s,"constructor")&&s.constructor;return typeof c=="function"&&c instanceof c&&mr.call(c)==oc}var Vd=Ta?ai(Ta):mc;function I_(n){return lv(n)&&n>=-9007199254740991&&n<=ae}var hv=Ma?ai(Ma):ra;function Kh(n){return typeof n=="string"||!mt(n)&&Tn(n)&&Hn(n)==ne}function er(n){return typeof n=="symbol"||Tn(n)&&Hn(n)==Oe}var nu=Ol?ai(Ol):vc;function D_(n){return n===t}function L_(n){return Tn(n)&&ei(n)==Je}function k_(n){return Tn(n)&&Hn(n)==Ye}var F_=Sc(sa),O_=Sc(function(n,s){return n<=s});function fv(n){if(!n)return[];if(Gi(n))return Kh(n)?Ai(n):Ei(n);if(bs&&n[bs])return Ia(n[bs]());var s=ei(n),c=s==_e?vs:s==le?gs:iu;return c(n)}function js(n){if(!n)return n===0?n:0;if(n=_r(n),n===Ie||n===-1/0){var s=n<0?-1:1;return s*ye}return n===n?n:0}function bt(n){var s=js(n),c=s%1;return s===s?c?s-c:s:0}function dv(n){return n?qr(bt(n),0,ie):0}function _r(n){if(typeof n=="number")return n;if(er(n))return de;if(Sn(n)){var s=typeof n.valueOf=="function"?n.valueOf():n;n=Sn(s)?s+"":s}if(typeof n!="string")return n===0?n:+n;n=Ir(n);var c=xa.test(n);return c||vu.test(n)?kl(n.slice(2),c?2:8):mu.test(n)?de:+n}function pv(n){return xr(n,Hi(n))}function N_(n){return n?qr(bt(n),-9007199254740991,ae):n===0?n:0}function en(n){return n==null?"":$e(n)}var U_=Wa(function(n,s){if(Uo(s)||Gi(s)){xr(s,Zn(s),n);return}for(var c in s)Kt.call(s,c)&&Ro(n,c,s[c])}),mv=Wa(function(n,s){xr(s,Hi(s),n)}),Zh=Wa(function(n,s,c,g){xr(s,Hi(s),n,g)}),B_=Wa(function(n,s,c,g){xr(s,Zn(s),n,g)}),z_=Zr(Mu);function V_(n,s){var c=Ns(n);return s==null?c:Yn(c,s)}var G_=yt(function(n,s){n=ut(n);var c=-1,g=s.length,E=g>2?s[2]:t;for(E&&gi(s[0],s[1],E)&&(g=1);++c<g;)for(var F=s[c],W=Hi(F),Z=-1,re=W.length;++Z<re;){var xe=W[Z],Ee=n[xe];(Ee===t||Ur(Ee,Qi[xe])&&!Kt.call(n,xe))&&(n[xe]=F[xe])}return n}),H_=yt(function(n){return n.push(t,Nf),si(vv,t,n)});function W_(n,s){return ms(n,rt(s,3),qi)}function j_(n,s){return ms(n,rt(s,3),na)}function X_(n,s){return n==null?n:Au(n,rt(s,3),Hi)}function q_(n,s){return n==null?n:Pu(n,rt(s,3),Hi)}function $_(n,s){return n&&qi(n,rt(s,3))}function Y_(n,s){return n&&na(n,rt(s,3))}function K_(n){return n==null?[]:za(n,Zn(n))}function Z_(n){return n==null?[]:za(n,Hi(n))}function Gd(n,s,c){var g=n==null?t:os(n,s);return g===t?c:g}function J_(n,s){return n!=null&&zf(n,s,Ms)}function Hd(n,s){return n!=null&&zf(n,s,pl)}var Q_=yd(function(n,s,c){s!=null&&typeof s.toString!="function"&&(s=Oa.call(s)),n[s]=c},jd(Wi)),e1=yd(function(n,s,c){s!=null&&typeof s.toString!="function"&&(s=Oa.call(s)),Kt.call(n,s)?n[s].push(c):n[s]=[c]},rt),t1=yt(zi);function Zn(n){return Gi(n)?zs(n):ko(n)}function Hi(n){return Gi(n)?zs(n,!0):Fh(n)}function n1(n,s){var c={};return s=rt(s,3),qi(n,function(g,E,F){Pi(c,s(g,E,F),g)}),c}function i1(n,s){var c={};return s=rt(s,3),qi(n,function(g,E,F){Pi(c,E,s(g,E,F))}),c}var r1=Wa(function(n,s,c){oa(n,s,c)}),vv=Wa(function(n,s,c,g){oa(n,s,c,g)}),s1=Zr(function(n,s){var c={};if(n==null)return c;var g=!1;s=Ft(s,function(F){return F=as(F,n),g||(g=F.length>1),F}),xr(n,Cc(n),c),g&&(c=Ri(c,w|C|R,bd));for(var E=s.length;E--;)ln(c,s[E]);return c});function o1(n,s){return gv(n,ct(rt(s)))}var a1=Zr(function(n,s){return n==null?{}:oh(n,s)});function gv(n,s){if(n==null)return{};var c=Ft(Cc(n),function(g){return[g]});return s=rt(s),aa(n,c,function(g,E){return s(g,E[0])})}function l1(n,s,c){s=as(s,n);var g=-1,E=s.length;for(E||(E=1,n=t);++g<E;){var F=n==null?t:n[wr(s[g])];F===t&&(g=E,F=c),n=Ws(F)?F.call(n):F}return n}function u1(n,s,c){return n==null?n:ro(n,s,c)}function c1(n,s,c,g){return g=typeof g=="function"?g:t,n==null?n:ro(n,s,c,g)}var _v=Ff(Zn),yv=Ff(Hi);function h1(n,s,c){var g=mt(n),E=g||zo(n)||nu(n);if(s=rt(s,4),c==null){var F=n&&n.constructor;E?c=g?new F:[]:Sn(n)?c=Ws(F)?Ns(ys(n)):{}:c={}}return(E?Qn:qi)(n,function(W,Z,re){return s(c,W,Z,re)}),c}function f1(n,s){return n==null?!0:ln(n,s)}function d1(n,s,c){return n==null?n:On(n,s,ah(c))}function p1(n,s,c,g){return g=typeof g=="function"?g:t,n==null?n:On(n,s,ah(c),g)}function iu(n){return n==null?[]:Ls(n,Zn(n))}function m1(n){return n==null?[]:Ls(n,Hi(n))}function v1(n,s,c){return c===t&&(c=s,s=t),c!==t&&(c=_r(c),c=c===c?c:0),s!==t&&(s=_r(s),s=s===s?s:0),qr(_r(n),s,c)}function g1(n,s,c){return s=js(s),c===t?(c=s,s=0):c=js(c),n=_r(n),Lh(n,s,c)}function _1(n,s,c){if(c&&typeof c!="boolean"&&gi(n,s,c)&&(s=c=t),c===t&&(typeof s=="boolean"?(c=s,s=t):typeof n=="boolean"&&(c=n,n=t)),n===t&&s===t?(n=0,s=1):(n=js(n),s===t?(s=n,n=0):s=js(s)),n>s){var g=n;n=s,s=g}if(c||n%1||s%1){var E=Wl();return $n(n+E*(s-n+ec("1e-"+((E+"").length-1))),s)}return gl(n,s)}var y1=ha(function(n,s,c){return s=s.toLowerCase(),n+(c?bv(s):s)});function bv(n){return Wd(en(n).toLowerCase())}function xv(n){return n=en(n),n&&n.replace(De,_u).replace(Ju,"")}function b1(n,s,c){n=en(n),s=$e(s);var g=n.length;c=c===t?g:qr(bt(c),0,g);var E=c;return c-=s.length,c>=0&&n.slice(c,E)==s}function x1(n){return n=en(n),n&&Et.test(n)?n.replace(Ke,Qs):n}function w1(n){return n=en(n),n&&hs.test(n)?n.replace(Ds,"\\$&"):n}var S1=ha(function(n,s,c){return n+(c?"-":"")+s.toLowerCase()}),E1=ha(function(n,s,c){return n+(c?" ":"")+s.toLowerCase()}),C1=Lf("toLowerCase");function T1(n,s,c){n=en(n),s=bt(s);var g=s?Hr(n):0;if(!s||g>=s)return n;var E=(s-g)/2;return Lu(Fs(E),c)+n+Lu(Qo(E),c)}function M1(n,s,c){n=en(n),s=bt(s);var g=s?Hr(n):0;return s&&g<s?n+Lu(s-g,c):n}function A1(n,s,c){n=en(n),s=bt(s);var g=s?Hr(n):0;return s&&g<s?Lu(s-g,c)+n:n}function P1(n,s,c){return c||s==null?s=0:s&&(s=+s),_f(en(n).replace(zr,""),s||0)}function R1(n,s,c){return(c?gi(n,s,c):s===t)?s=1:s=bt(s),Ha(en(n),s)}function I1(){var n=arguments,s=en(n[0]);return n.length<3?s:s.replace(n[1],n[2])}var D1=ha(function(n,s,c){return n+(c?"_":"")+s.toLowerCase()});function L1(n,s,c){return c&&typeof c!="number"&&gi(n,s,c)&&(s=c=t),c=c===t?ie:c>>>0,c?(n=en(n),n&&(typeof s=="string"||s!=null&&!Vd(s))&&(s=$e(s),!s&&ks(n))?As(Ai(n),0,c):n.split(s,c)):[]}var k1=ha(function(n,s,c){return n+(c?" ":"")+Wd(s)});function F1(n,s,c){return n=en(n),c=c==null?0:qr(bt(c),0,n.length),s=$e(s),n.slice(c,c+s.length)==s}function O1(n,s,c){var g=I.templateSettings;c&&gi(n,s,c)&&(s=t),n=en(n),s=Zh({},s,g,Of);var E=Zh({},s.imports,g.imports,Of),F=Zn(E),W=Ls(E,F),Z,re,xe=0,Ee=s.interpolate||Ue,Me="__p += '",We=Wr((s.escape||Ue).source+"|"+Ee.source+"|"+(Ee===Ti?ds:Ue).source+"|"+(s.evaluate||Ue).source+"|$","g"),Qe="//# sourceURL="+(Kt.call(s,"sourceURL")?(s.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Qu+"]")+`
`;n.replace(We,function(lt,Lt,Bt,tr,Ii,nr){return Bt||(Bt=tr),Me+=n.slice(xe,nr).replace(Ve,rc),Lt&&(Z=!0,Me+=`' +
__e(`+Lt+`) +
'`),Ii&&(re=!0,Me+=`';
`+Ii+`;
__p += '`),Bt&&(Me+=`' +
((__t = (`+Bt+`)) == null ? '' : __t) +
'`),xe=nr+lt.length,lt}),Me+=`';
`;var at=Kt.call(s,"variable")&&s.variable;if(!at)Me=`with (obj) {
`+Me+`
}
`;else if(tl.test(at))throw new Xe(d);Me=(re?Me.replace(Vn,""):Me).replace(Re,"$1").replace(gt,"$1;"),Me="function("+(at||"obj")+`) {
`+(at?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Z?", __e = _.escape":"")+(re?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Me+`return __p
}`;var Tt=Sv(function(){return Ct(F,Qe+"return "+Me).apply(t,W)});if(Tt.source=Me,zd(Tt))throw Tt;return Tt}function N1(n){return en(n).toLowerCase()}function U1(n){return en(n).toUpperCase()}function B1(n,s,c){if(n=en(n),n&&(c||s===t))return Ir(n);if(!n||!(s=$e(s)))return n;var g=Ai(n),E=Ai(s),F=sl(g,E),W=Gr(g,E)+1;return As(g,F,W).join("")}function z1(n,s,c){if(n=en(n),n&&(c||s===t))return n.slice(0,Vl(n)+1);if(!n||!(s=$e(s)))return n;var g=Ai(n),E=Gr(g,Ai(s))+1;return As(g,0,E).join("")}function V1(n,s,c){if(n=en(n),n&&(c||s===t))return n.replace(zr,"");if(!n||!(s=$e(s)))return n;var g=Ai(n),E=sl(g,Ai(s));return As(g,E).join("")}function G1(n,s){var c=H,g=J;if(Sn(s)){var E="separator"in s?s.separator:E;c="length"in s?bt(s.length):c,g="omission"in s?$e(s.omission):g}n=en(n);var F=n.length;if(ks(n)){var W=Ai(n);F=W.length}if(c>=F)return n;var Z=c-Hr(g);if(Z<1)return g;var re=W?As(W,0,Z).join(""):n.slice(0,Z);if(E===t)return re+g;if(W&&(Z+=re.length-Z),Vd(E)){if(n.slice(Z).search(E)){var xe,Ee=re;for(E.global||(E=Wr(E.source,en(nl.exec(E))+"g")),E.lastIndex=0;xe=E.exec(Ee);)var Me=xe.index;re=re.slice(0,Me===t?Z:Me)}}else if(n.indexOf($e(E),Z)!=Z){var We=re.lastIndexOf(E);We>-1&&(re=re.slice(0,We))}return re+g}function H1(n){return n=en(n),n&&Mt.test(n)?n.replace(je,$c):n}var W1=ha(function(n,s,c){return n+(c?" ":"")+s.toUpperCase()}),Wd=Lf("toUpperCase");function wv(n,s,c){return n=en(n),s=c?t:s,s===t?yu(n)?S(n):Bl(n):n.match(s)||[]}var Sv=yt(function(n,s){try{return si(n,t,s)}catch(c){return zd(c)?c:new Xe(c)}}),j1=Zr(function(n,s){return Qn(s,function(c){c=wr(c),Pi(n,c,st(n[c],n))}),n});function X1(n){var s=n==null?0:n.length,c=rt();return n=s?Ft(n,function(g){if(typeof g[1]!="function")throw new Ui(f);return[c(g[0]),g[1]]}):[],yt(function(g){for(var E=-1;++E<s;){var F=n[E];if(si(F[0],this,g))return si(F[1],this,g)}})}function q1(n){return Cf(Ri(n,w))}function jd(n){return function(){return n}}function $1(n,s){return n==null||n!==n?s:n}var Y1=Uh(),K1=Uh(!0);function Wi(n){return n}function Xd(n){return Zl(typeof n=="function"?n:Ri(n,w))}function Z1(n){return gc(Ri(n,w))}function J1(n,s){return Si(n,Ri(s,w))}var Q1=yt(function(n,s){return function(c){return zi(c,n,s)}}),ey=yt(function(n,s){return function(c){return zi(n,c,s)}});function qd(n,s,c){var g=Zn(s),E=za(s,g);c==null&&!(Sn(s)&&(E.length||!g.length))&&(c=s,s=n,n=this,E=za(s,Zn(s)));var F=!(Sn(c)&&"chain"in c)||!!c.chain,W=Ws(n);return Qn(E,function(Z){var re=s[Z];n[Z]=re,W&&(n.prototype[Z]=function(){var xe=this.__chain__;if(F||xe){var Ee=n(this.__wrapped__),Me=Ee.__actions__=Ei(this.__actions__);return Me.push({func:re,args:arguments,thisArg:n}),Ee.__chain__=xe,Ee}return re.apply(n,br([this.value()],arguments))})}),n}function ty(){return yn._===this&&(yn._=Ah),this}function $d(){}function ny(n){return n=bt(n),yt(function(s){return _c(s,n)})}var iy=lh(Ft),ry=lh(Nl),sy=lh(ps);function Ev(n){return Ot(n)?Pa(wr(n)):Fi(n)}function oy(n){return function(s){return n==null?t:os(n,s)}}var ay=kf(),ly=kf(!0);function Yd(){return[]}function Kd(){return!1}function uy(){return{}}function cy(){return""}function hy(){return!0}function fy(n,s){if(n=bt(n),n<1||n>ae)return[];var c=ie,g=$n(n,ie);s=rt(s),n-=ie;for(var E=Co(g,s);++c<n;)s(c);return E}function dy(n){return mt(n)?Ft(n,wr):er(n)?[n]:Ei(Wf(en(n)))}function py(n){var s=++Gl;return en(n)+s}var my=Du(function(n,s){return n+s},0),vy=Fr("ceil"),gy=Du(function(n,s){return n/s},1),_y=Fr("floor");function yy(n){return n&&n.length?ta(n,Wi,ia):t}function by(n,s){return n&&n.length?ta(n,rt(s,2),ia):t}function xy(n){return oi(n,Wi)}function wy(n,s){return oi(n,rt(s,2))}function Sy(n){return n&&n.length?ta(n,Wi,sa):t}function Ey(n,s){return n&&n.length?ta(n,rt(s,2),sa):t}var Cy=Du(function(n,s){return n*s},1),Ty=Fr("round"),My=Du(function(n,s){return n-s},0);function Ay(n){return n&&n.length?Ra(n,Wi):0}function Py(n,s){return n&&n.length?Ra(n,rt(s,2)):0}return I.after=Ce,I.ary=Ge,I.assign=U_,I.assignIn=mv,I.assignInWith=Zh,I.assignWith=B_,I.at=z_,I.before=nt,I.bind=st,I.bindAll=j1,I.bindKey=tt,I.castArray=u_,I.chain=Xh,I.chunk=jf,I.compact=Td,I.concat=pa,I.cond=X1,I.conforms=q1,I.constant=jd,I.countBy=jp,I.create=V_,I.curry=It,I.curryRight=Gt,I.debounce=qt,I.defaults=G_,I.defaultsDeep=H_,I.defer=gr,I.delay=Fe,I.difference=Kn,I.differenceBy=Qr,I.differenceWith=Sr,I.drop=ls,I.dropRight=Bo,I.dropRightWhile=fh,I.dropWhile=Nr,I.fill=Gh,I.filter=Jf,I.flatMap=Ud,I.flatMapDeep=iv,I.flatMapDepth=$p,I.flatten=Hh,I.flattenDeep=Wh,I.flattenDepth=lo,I.flip=Pe,I.flow=Y1,I.flowRight=K1,I.fromPairs=Md,I.functions=K_,I.functionsIn=Z_,I.groupBy=Bd,I.initial=Xf,I.intersection=Ad,I.intersectionBy=Ou,I.intersectionWith=qf,I.invert=Q_,I.invertBy=e1,I.invokeMap=Yp,I.iteratee=Xd,I.keyBy=rv,I.keys=Zn,I.keysIn=Hi,I.map=bl,I.mapKeys=n1,I.mapValues=i1,I.matches=Z1,I.matchesProperty=J1,I.memoize=Ne,I.merge=r1,I.mergeWith=vv,I.method=Q1,I.methodOf=ey,I.mixin=qd,I.negate=ct,I.nthArg=ny,I.omit=s1,I.omitBy=o1,I.once=Jt,I.orderBy=sv,I.over=iy,I.overArgs=dn,I.overEvery=ry,I.overSome=sy,I.partial=sn,I.partialRight=_n,I.partition=$h,I.pick=a1,I.pickBy=gv,I.property=Ev,I.propertyOf=oy,I.pull=$f,I.pullAll=ph,I.pullAllBy=Hs,I.pullAllWith=Uu,I.pullAt=Xa,I.range=ay,I.rangeRight=ly,I.rearg=es,I.reject=a,I.remove=uo,I.rest=ni,I.reverse=mh,I.sampleSize=p,I.set=u1,I.setWith=c1,I.shuffle=x,I.slice=Rd,I.sortBy=ee,I.sortedUniq=Ld,I.sortedUniqBy=Rc,I.split=L1,I.spread=zu,I.tail=Up,I.take=Bp,I.takeRight=kd,I.takeRightWhile=Yf,I.takeWhile=qm,I.tap=ev,I.throttle=av,I.thru=co,I.toArray=fv,I.toPairs=_v,I.toPairsIn=yv,I.toPath=dy,I.toPlainObject=pv,I.transform=h1,I.unary=a_,I.union=$m,I.unionBy=zp,I.unionWith=Vp,I.uniq=Ic,I.uniqBy=Ym,I.uniqWith=vh,I.unset=f1,I.unzip=gh,I.unzipWith=$i,I.update=d1,I.updateWith=p1,I.values=iu,I.valuesIn=m1,I.without=Km,I.words=wv,I.wrap=l_,I.xor=Gp,I.xorBy=Zm,I.xorWith=Jm,I.zip=Hp,I.zipObject=Wp,I.zipObjectDeep=Qm,I.zipWith=ma,I.entries=_v,I.entriesIn=yv,I.extend=mv,I.extendWith=Zh,qd(I,I),I.add=my,I.attempt=Sv,I.camelCase=y1,I.capitalize=bv,I.ceil=vy,I.clamp=v1,I.clone=c_,I.cloneDeep=f_,I.cloneDeepWith=d_,I.cloneWith=h_,I.conformsTo=p_,I.deburr=xv,I.defaultTo=$1,I.divide=gy,I.endsWith=b1,I.eq=Ur,I.escape=x1,I.escapeRegExp=w1,I.every=Xp,I.find=Qf,I.findIndex=eu,I.findKey=W_,I.findLast=qp,I.findLastIndex=dh,I.findLastKey=j_,I.floor=_y,I.forEach=qh,I.forEachRight=_h,I.forIn=X_,I.forInRight=q_,I.forOwn=$_,I.forOwnRight=Y_,I.get=Gd,I.gt=m_,I.gte=v_,I.has=J_,I.hasIn=Hd,I.head=Fu,I.identity=Wi,I.includes=ed,I.indexOf=tu,I.inRange=g1,I.invoke=t1,I.isArguments=qa,I.isArray=mt,I.isArrayBuffer=g_,I.isArrayLike=Gi,I.isArrayLikeObject=Rn,I.isBoolean=__,I.isBuffer=zo,I.isDate=y_,I.isElement=b_,I.isEmpty=x_,I.isEqual=w_,I.isEqualWith=S_,I.isError=zd,I.isFinite=E_,I.isFunction=Ws,I.isInteger=lv,I.isLength=Yh,I.isMap=uv,I.isMatch=C_,I.isMatchWith=T_,I.isNaN=M_,I.isNative=A_,I.isNil=R_,I.isNull=P_,I.isNumber=cv,I.isObject=Sn,I.isObjectLike=Tn,I.isPlainObject=Lc,I.isRegExp=Vd,I.isSafeInteger=I_,I.isSet=hv,I.isString=Kh,I.isSymbol=er,I.isTypedArray=nu,I.isUndefined=D_,I.isWeakMap=L_,I.isWeakSet=k_,I.join=Nu,I.kebabCase=S1,I.last=Oi,I.lastIndexOf=jh,I.lowerCase=E1,I.lowerFirst=C1,I.lt=F_,I.lte=O_,I.max=yy,I.maxBy=by,I.mean=xy,I.meanBy=wy,I.min=Sy,I.minBy=Ey,I.stubArray=Yd,I.stubFalse=Kd,I.stubObject=uy,I.stubString=cy,I.stubTrue=hy,I.multiply=Cy,I.nth=Pd,I.noConflict=ty,I.noop=$d,I.now=pe,I.pad=T1,I.padEnd=M1,I.padStart=A1,I.parseInt=P1,I.random=_1,I.reduce=ov,I.reduceRight=td,I.repeat=R1,I.replace=I1,I.result=l1,I.round=Ty,I.runInContext=k,I.sample=u,I.size=A,I.snakeCase=D1,I.some=N,I.sortedIndex=Id,I.sortedIndexBy=Xm,I.sortedIndexOf=Bu,I.sortedLastIndex=Np,I.sortedLastIndexBy=Dd,I.sortedLastIndexOf=Pc,I.startCase=k1,I.startsWith=F1,I.subtract=My,I.sum=Ay,I.sumBy=Py,I.template=O1,I.times=fy,I.toFinite=js,I.toInteger=bt,I.toLength=dv,I.toLower=N1,I.toNumber=_r,I.toSafeInteger=N_,I.toString=en,I.toUpper=U1,I.trim=B1,I.trimEnd=z1,I.trimStart=V1,I.truncate=G1,I.unescape=H1,I.uniqueId=py,I.upperCase=W1,I.upperFirst=Wd,I.each=qh,I.eachRight=_h,I.first=Fu,qd(I,function(){var n={};return qi(I,function(s,c){Kt.call(I.prototype,c)||(n[c]=s)}),n}(),{chain:!1}),I.VERSION=i,Qn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){I[n].placeholder=I}),Qn(["drop","take"],function(n,s){wt.prototype[n]=function(c){c=c===t?1:wn(bt(c),0);var g=this.__filtered__&&!s?new wt(this):this.clone();return g.__filtered__?g.__takeCount__=$n(c,g.__takeCount__):g.__views__.push({size:$n(c,ie),type:n+(g.__dir__<0?"Right":"")}),g},wt.prototype[n+"Right"]=function(c){return this.reverse()[n](c).reverse()}}),Qn(["filter","map","takeWhile"],function(n,s){var c=s+1,g=c==ge||c==me;wt.prototype[n]=function(E){var F=this.clone();return F.__iteratees__.push({iteratee:rt(E,3),type:c}),F.__filtered__=F.__filtered__||g,F}}),Qn(["head","last"],function(n,s){var c="take"+(s?"Right":"");wt.prototype[n]=function(){return this[c](1).value()[0]}}),Qn(["initial","tail"],function(n,s){var c="drop"+(s?"":"Right");wt.prototype[n]=function(){return this.__filtered__?new wt(this):this[c](1)}}),wt.prototype.compact=function(){return this.filter(Wi)},wt.prototype.find=function(n){return this.filter(n).head()},wt.prototype.findLast=function(n){return this.reverse().find(n)},wt.prototype.invokeMap=yt(function(n,s){return typeof n=="function"?new wt(this):this.map(function(c){return zi(c,n,s)})}),wt.prototype.reject=function(n){return this.filter(ct(rt(n)))},wt.prototype.slice=function(n,s){n=bt(n);var c=this;return c.__filtered__&&(n>0||s<0)?new wt(c):(n<0?c=c.takeRight(-n):n&&(c=c.drop(n)),s!==t&&(s=bt(s),c=s<0?c.dropRight(-s):c.take(s-n)),c)},wt.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},wt.prototype.toArray=function(){return this.take(ie)},qi(wt.prototype,function(n,s){var c=/^(?:filter|find|map|reject)|While$/.test(s),g=/^(?:head|last)$/.test(s),E=I[g?"take"+(s=="last"?"Right":""):s],F=g||/^find/.test(s);E&&(I.prototype[s]=function(){var W=this.__wrapped__,Z=g?[1]:arguments,re=W instanceof wt,xe=Z[0],Ee=re||mt(W),Me=function(Lt){var Bt=E.apply(I,br([Lt],Z));return g&&We?Bt[0]:Bt};Ee&&c&&typeof xe=="function"&&xe.length!=1&&(re=Ee=!1);var We=this.__chain__,Qe=!!this.__actions__.length,at=F&&!We,Tt=re&&!Qe;if(!F&&Ee){W=Tt?W:new wt(this);var lt=n.apply(W,Z);return lt.__actions__.push({func:co,args:[Me],thisArg:t}),new mi(lt,We)}return at&&Tt?n.apply(this,Z):(lt=this.thru(Me),at?g?lt.value()[0]:lt.value():lt)})}),Qn(["pop","push","shift","sort","splice","unshift"],function(n){var s=_s[n],c=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",g=/^(?:pop|shift)$/.test(n);I.prototype[n]=function(){var E=arguments;if(g&&!this.__chain__){var F=this.value();return s.apply(mt(F)?F:[],E)}return this[c](function(W){return s.apply(mt(W)?W:[],E)})}}),qi(wt.prototype,function(n,s){var c=I[s];if(c){var g=c.name+"";Kt.call(jr,g)||(jr[g]=[]),jr[g].push({name:s,func:c})}}),jr[Jl(t,M).name]=[{name:"wrapper",func:t}],wt.prototype.clone=Qc,wt.prototype.reverse=hc,wt.prototype.value=Eu,I.prototype.at=Kf,I.prototype.chain=Dc,I.prototype.commit=Zf,I.prototype.next=Fd,I.prototype.plant=tv,I.prototype.reverse=Nd,I.prototype.toJSON=I.prototype.valueOf=I.prototype.value=nv,I.prototype.first=I.prototype.head,bs&&(I.prototype[bs]=Od),I},j=D();dr?((dr.exports=j)._=j,Ca._=j):yn._=j}).call(gP)}(jv,jv.exports)),jv.exports}var ri=_P();function yP(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}function yT(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yT=function(){return!!r})()}function bP(r,e,t){if(yT())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var o=new(r.bind.apply(r,i));return t&&cg(o,t.prototype),o}function Qb(r){var e=typeof Map=="function"?new Map:void 0;return Qb=function(i){if(i===null||!yP(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,o)}function o(){return bP(i,arguments,bp(this).constructor)}return o.prototype=Object.create(i.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),cg(o,i)},Qb(r)}function xP(r,e,t){return e=bp(e),qC(r,bT()?Reflect.construct(e,t||[],bp(r).constructor):e.apply(r,t))}function bT(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bT=function(){return!!r})()}var Tl=function(r){return r.ERROR="error",r.INFO="info",r.WARNING="warning",r}({}),el=function(r){function e(t){var i,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tl.ERROR,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";Xn(this,e);for(var f=arguments.length,d=new Array(f>3?f-3:0),v=3;v<f;v++)d[v-3]=arguments[v];return i=xP(this,e,[].concat(d)),ue(i,"htmlData",void 0),ue(i,"level",void 0),i.name="FrontEndError",i.message=t,i.htmlData=l,i.level=o,i}return $C(e,r),qn(e)}(Qb(Error));function bS(r,e,t,i,o,l,f){try{var d=r[l](f),v=d.value}catch(_){return void t(_)}d.done?e(v):Promise.resolve(v).then(i,o)}function po(r){return function(){var e=this,t=arguments;return new Promise(function(i,o){var l=r.apply(e,t);function f(v){bS(l,i,o,f,d,"next",v)}function d(v){bS(l,i,o,f,d,"throw",v)}f(void 0)})}}var Hy={exports:{}},Wy={exports:{}},xS;function wP(){return xS||(xS=1,function(r){function e(t){"@babel/helpers - typeof";return r.exports=e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},r.exports.__esModule=!0,r.exports.default=r.exports,e(t)}r.exports=e,r.exports.__esModule=!0,r.exports.default=r.exports}(Wy)),Wy.exports}var wS;function SP(){return wS||(wS=1,function(r){var e=wP().default;function t(){r.exports=t=function(){return o},r.exports.__esModule=!0,r.exports.default=r.exports;var i,o={},l=Object.prototype,f=l.hasOwnProperty,d=Object.defineProperty||function(ye,de,ie){ye[de]=ie.value},v=typeof Symbol=="function"?Symbol:{},_=v.iterator||"@@iterator",b=v.asyncIterator||"@@asyncIterator",w=v.toStringTag||"@@toStringTag";function C(ye,de,ie){return Object.defineProperty(ye,de,{value:ie,enumerable:!0,configurable:!0,writable:!0}),ye[de]}try{C({},"")}catch{C=function(ie,we,ze){return ie[we]=ze}}function R(ye,de,ie,we){var ze=de&&de.prototype instanceof B?de:B,se=Object.create(ze.prototype),fe=new Ie(we||[]);return d(se,"_invoke",{value:he(ye,ie,fe)}),se}function z(ye,de,ie){try{return{type:"normal",arg:ye.call(de,ie)}}catch(we){return{type:"throw",arg:we}}}o.wrap=R;var O="suspendedStart",P="suspendedYield",M="executing",U="completed",L={};function B(){}function $(){}function X(){}var Q={};C(Q,_,function(){return this});var te=Object.getPrototypeOf,V=te&&te(te(ae([])));V&&V!==l&&f.call(V,_)&&(Q=V);var H=X.prototype=B.prototype=Object.create(Q);function J(ye){["next","throw","return"].forEach(function(de){C(ye,de,function(ie){return this._invoke(de,ie)})})}function ce(ye,de){function ie(ze,se,fe,Le){var Be=z(ye[ze],ye,se);if(Be.type!=="throw"){var He=Be.arg,et=He.value;return et&&e(et)=="object"&&f.call(et,"__await")?de.resolve(et.__await).then(function(pt){ie("next",pt,fe,Le)},function(pt){ie("throw",pt,fe,Le)}):de.resolve(et).then(function(pt){He.value=pt,fe(He)},function(pt){return ie("throw",pt,fe,Le)})}Le(Be.arg)}var we;d(this,"_invoke",{value:function(se,fe){function Le(){return new de(function(Be,He){ie(se,fe,Be,He)})}return we=we?we.then(Le,Le):Le()}})}function he(ye,de,ie){var we=O;return function(ze,se){if(we===M)throw Error("Generator is already running");if(we===U){if(ze==="throw")throw se;return{value:i,done:!0}}for(ie.method=ze,ie.arg=se;;){var fe=ie.delegate;if(fe){var Le=ge(fe,ie);if(Le){if(Le===L)continue;return Le}}if(ie.method==="next")ie.sent=ie._sent=ie.arg;else if(ie.method==="throw"){if(we===O)throw we=U,ie.arg;ie.dispatchException(ie.arg)}else ie.method==="return"&&ie.abrupt("return",ie.arg);we=M;var Be=z(ye,de,ie);if(Be.type==="normal"){if(we=ie.done?U:P,Be.arg===L)continue;return{value:Be.arg,done:ie.done}}Be.type==="throw"&&(we=U,ie.method="throw",ie.arg=Be.arg)}}}function ge(ye,de){var ie=de.method,we=ye.iterator[ie];if(we===i)return de.delegate=null,ie==="throw"&&ye.iterator.return&&(de.method="return",de.arg=i,ge(ye,de),de.method==="throw")||ie!=="return"&&(de.method="throw",de.arg=new TypeError("The iterator does not provide a '"+ie+"' method")),L;var ze=z(we,ye.iterator,de.arg);if(ze.type==="throw")return de.method="throw",de.arg=ze.arg,de.delegate=null,L;var se=ze.arg;return se?se.done?(de[ye.resultName]=se.value,de.next=ye.nextLoc,de.method!=="return"&&(de.method="next",de.arg=i),de.delegate=null,L):se:(de.method="throw",de.arg=new TypeError("iterator result is not an object"),de.delegate=null,L)}function Ae(ye){var de={tryLoc:ye[0]};1 in ye&&(de.catchLoc=ye[1]),2 in ye&&(de.finallyLoc=ye[2],de.afterLoc=ye[3]),this.tryEntries.push(de)}function me(ye){var de=ye.completion||{};de.type="normal",delete de.arg,ye.completion=de}function Ie(ye){this.tryEntries=[{tryLoc:"root"}],ye.forEach(Ae,this),this.reset(!0)}function ae(ye){if(ye||ye===""){var de=ye[_];if(de)return de.call(ye);if(typeof ye.next=="function")return ye;if(!isNaN(ye.length)){var ie=-1,we=function ze(){for(;++ie<ye.length;)if(f.call(ye,ie))return ze.value=ye[ie],ze.done=!1,ze;return ze.value=i,ze.done=!0,ze};return we.next=we}}throw new TypeError(e(ye)+" is not iterable")}return $.prototype=X,d(H,"constructor",{value:X,configurable:!0}),d(X,"constructor",{value:$,configurable:!0}),$.displayName=C(X,w,"GeneratorFunction"),o.isGeneratorFunction=function(ye){var de=typeof ye=="function"&&ye.constructor;return!!de&&(de===$||(de.displayName||de.name)==="GeneratorFunction")},o.mark=function(ye){return Object.setPrototypeOf?Object.setPrototypeOf(ye,X):(ye.__proto__=X,C(ye,w,"GeneratorFunction")),ye.prototype=Object.create(H),ye},o.awrap=function(ye){return{__await:ye}},J(ce.prototype),C(ce.prototype,b,function(){return this}),o.AsyncIterator=ce,o.async=function(ye,de,ie,we,ze){ze===void 0&&(ze=Promise);var se=new ce(R(ye,de,ie,we),ze);return o.isGeneratorFunction(de)?se:se.next().then(function(fe){return fe.done?fe.value:se.next()})},J(H),C(H,w,"Generator"),C(H,_,function(){return this}),C(H,"toString",function(){return"[object Generator]"}),o.keys=function(ye){var de=Object(ye),ie=[];for(var we in de)ie.push(we);return ie.reverse(),function ze(){for(;ie.length;){var se=ie.pop();if(se in de)return ze.value=se,ze.done=!1,ze}return ze.done=!0,ze}},o.values=ae,Ie.prototype={constructor:Ie,reset:function(de){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(me),!de)for(var ie in this)ie.charAt(0)==="t"&&f.call(this,ie)&&!isNaN(+ie.slice(1))&&(this[ie]=i)},stop:function(){this.done=!0;var de=this.tryEntries[0].completion;if(de.type==="throw")throw de.arg;return this.rval},dispatchException:function(de){if(this.done)throw de;var ie=this;function we(He,et){return fe.type="throw",fe.arg=de,ie.next=He,et&&(ie.method="next",ie.arg=i),!!et}for(var ze=this.tryEntries.length-1;ze>=0;--ze){var se=this.tryEntries[ze],fe=se.completion;if(se.tryLoc==="root")return we("end");if(se.tryLoc<=this.prev){var Le=f.call(se,"catchLoc"),Be=f.call(se,"finallyLoc");if(Le&&Be){if(this.prev<se.catchLoc)return we(se.catchLoc,!0);if(this.prev<se.finallyLoc)return we(se.finallyLoc)}else if(Le){if(this.prev<se.catchLoc)return we(se.catchLoc,!0)}else{if(!Be)throw Error("try statement without catch or finally");if(this.prev<se.finallyLoc)return we(se.finallyLoc)}}}},abrupt:function(de,ie){for(var we=this.tryEntries.length-1;we>=0;--we){var ze=this.tryEntries[we];if(ze.tryLoc<=this.prev&&f.call(ze,"finallyLoc")&&this.prev<ze.finallyLoc){var se=ze;break}}se&&(de==="break"||de==="continue")&&se.tryLoc<=ie&&ie<=se.finallyLoc&&(se=null);var fe=se?se.completion:{};return fe.type=de,fe.arg=ie,se?(this.method="next",this.next=se.finallyLoc,L):this.complete(fe)},complete:function(de,ie){if(de.type==="throw")throw de.arg;return de.type==="break"||de.type==="continue"?this.next=de.arg:de.type==="return"?(this.rval=this.arg=de.arg,this.method="return",this.next="end"):de.type==="normal"&&ie&&(this.next=ie),L},finish:function(de){for(var ie=this.tryEntries.length-1;ie>=0;--ie){var we=this.tryEntries[ie];if(we.finallyLoc===de)return this.complete(we.completion,we.afterLoc),me(we),L}},catch:function(de){for(var ie=this.tryEntries.length-1;ie>=0;--ie){var we=this.tryEntries[ie];if(we.tryLoc===de){var ze=we.completion;if(ze.type==="throw"){var se=ze.arg;me(we)}return se}}throw Error("illegal catch attempt")},delegateYield:function(de,ie,we){return this.delegate={iterator:ae(de),resultName:ie,nextLoc:we},this.method==="next"&&(this.arg=i),L}},o}r.exports=t,r.exports.__esModule=!0,r.exports.default=r.exports}(Hy)),Hy.exports}var jy,SS;function EP(){if(SS)return jy;SS=1;var r=SP()();jy=r;try{regeneratorRuntime=r}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}return jy}var CP=EP();const ii=Fm(CP);var ji=function(r){return r[r.ID_UNDEFINED_WEB_REQUEST=0]="ID_UNDEFINED_WEB_REQUEST",r[r.ID_VIS_DATA_ARRIVE=1]="ID_VIS_DATA_ARRIVE",r[r.ID_VIS_DATA_REQUEST=2]="ID_VIS_DATA_REQUEST",r[r.ID_VIS_DATA_FINISH=3]="ID_VIS_DATA_FINISH",r[r.ID_VIS_DATA_PAUSE=4]="ID_VIS_DATA_PAUSE",r[r.ID_VIS_DATA_RESUME=5]="ID_VIS_DATA_RESUME",r[r.ID_VIS_DATA_ABORT=6]="ID_VIS_DATA_ABORT",r[r.ID_UPDATE_TIME_STEP=7]="ID_UPDATE_TIME_STEP",r[r.ID_UPDATE_RATE_PARAM=8]="ID_UPDATE_RATE_PARAM",r[r.ID_MODEL_DEFINITION=9]="ID_MODEL_DEFINITION",r[r.ID_HEARTBEAT_PING=10]="ID_HEARTBEAT_PING",r[r.ID_HEARTBEAT_PONG=11]="ID_HEARTBEAT_PONG",r[r.ID_TRAJECTORY_FILE_INFO=12]="ID_TRAJECTORY_FILE_INFO",r[r.ID_GOTO_SIMULATION_TIME=13]="ID_GOTO_SIMULATION_TIME",r[r.ID_INIT_TRAJECTORY_FILE=14]="ID_INIT_TRAJECTORY_FILE",r[r.ID_UPDATE_SIMULATION_STATE=15]="ID_UPDATE_SIMULATION_STATE",r[r.ID_CONVERT_TRAJECTORY_FILE=16]="ID_CONVERT_TRAJECTORY_FILE",r[r.ID_AVAILABLE_METRICS_REQUEST=17]="ID_AVAILABLE_METRICS_REQUEST",r[r.ID_AVAILABLE_METRICS_RESPONSE=18]="ID_AVAILABLE_METRICS_RESPONSE",r[r.ID_PLOT_DATA_REQUEST=19]="ID_PLOT_DATA_REQUEST",r[r.ID_PLOT_DATA_RESPONSE=20]="ID_PLOT_DATA_RESPONSE",r[r.ID_ERROR_MSG=21]="ID_ERROR_MSG",r[r.ID_CHECK_HEALTH_REQUEST=22]="ID_CHECK_HEALTH_REQUEST",r[r.ID_SERVER_HEALTHY_RESPONSE=23]="ID_SERVER_HEALTHY_RESPONSE",r[r.ID_CANCEL_CONVERSION=24]="ID_CANCEL_CONVERSION",r[r.ID_START_SMOLDYN=25]="ID_START_SMOLDYN",r[r.LENGTH=26]="LENGTH",r}({}),ES="Remote sim successfully started",TP="Failed to connect to server; try reloading. If the problem persists, there may be a problem with your connection speed or the server might be too busy.",CS=function(){function r(e,t){Xn(this,r),ue(this,"webSocket",void 0),ue(this,"serverIp",void 0),ue(this,"serverPort",void 0),ue(this,"connectionTimeWaited",void 0),ue(this,"connectionRetries",void 0),ue(this,"jsonMessageHandlers",void 0),ue(this,"binaryMessageHandlers",void 0),ue(this,"logger",void 0),ue(this,"handleError",void 0),this.webSocket=null,this.jsonMessageHandlers=new Map,this.binaryMessageHandlers=new Map,this.serverIp=e&&e.serverIp?e.serverIp:"localhost",this.serverPort=e&&e.serverPort?e.serverPort:9002,this.connectionTimeWaited=0,this.connectionRetries=0,this.handleError=t||function(){},this.logger=Al.get("netconnection"),this.logger.setLevel(Al.DEBUG),window.addEventListener("beforeunload",this.onClose.bind(this))}return qn(r,[{key:"socketIsConnecting",value:function(){return this.webSocket!==null&&this.webSocket.readyState===this.webSocket.CONNECTING}},{key:"socketIsValid",value:function(){return!(this.webSocket===null||this.webSocket.readyState===this.webSocket.CLOSED)}},{key:"socketIsConnected",value:function(){return this.webSocket!==null&&this.webSocket.readyState===this.webSocket.OPEN}},{key:"addBinaryMessageHandler",value:function(t,i){this.binaryMessageHandlers[t.valueOf()]=i}},{key:"addJsonMessageHandler",value:function(t,i){this.jsonMessageHandlers[t]=i}},{key:"onMessage",value:function(t){if(this.socketIsValid()){if(t.data instanceof ArrayBuffer){var i=new Float32Array(t.data),o=i[0];o in this.binaryMessageHandlers?this.binaryMessageHandlers[o](t):this.logger.error("Unexpected binary message arrived of type ",o);return}var l=JSON.parse(t.data),f=l.msgType,d=ji.LENGTH;if(f>d||f<1){this.logger.error("Unrecognized web message of type ",l.msgType," arrived");return}f in this.jsonMessageHandlers?this.jsonMessageHandlers[f](l):this.logger.error("Unexpected json message arrived of type ",f),this.logger.debug("Web request recieved",l.msgType)}}},{key:"onOpen",value:function(){}},{key:"onClose",value:function(){}},{key:"createWebSocket",value:function(t){this.socketIsValid()&&this.disconnect(),this.webSocket=new WebSocket(t),this.webSocket.binaryType="arraybuffer",this.logger.debug("WS Connection Request Sent: ",t),this.webSocket.onopen=this.onOpen.bind(this),this.webSocket.onclose=this.onClose.bind(this),this.webSocket.onmessage=this.onMessage.bind(this)}},{key:"disconnect",value:function(){if(!this.socketIsValid()){this.logger.warn("disconnect failed, client is not connected");return}this.webSocket!==null&&this.webSocket.close()}},{key:"getIp",value:function(){return"wss://".concat(this.serverIp,":").concat(this.serverPort,"/")}},{key:"waitForWebSocket",value:function(){var e=po(ii.mark(function i(o){var l=this;return ii.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",new Promise(function(v){return setTimeout(function(){v(l.socketIsConnected())},o)}));case 1:case"end":return d.stop()}},i)}));function t(i){return e.apply(this,arguments)}return t}()},{key:"checkConnection",value:function(){var e=po(ii.mark(function i(o){var l,f,d,v,_=arguments;return ii.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return l=_.length>1&&_[1]!==void 0?_[1]:1e3,f=_.length>2&&_[2]!==void 0?_[2]:1,d=4*l,w.next=5,this.waitForWebSocket(l);case 5:if(v=w.sent,this.connectionTimeWaited+=l,!v){w.next=11;break}return w.abrupt("return",!0);case 11:if(!(this.connectionTimeWaited<d)){w.next=15;break}return w.abrupt("return",this.checkConnection(o,l));case 15:if(!(this.connectionRetries<f)){w.next=21;break}return this.createWebSocket(o),this.connectionRetries++,w.abrupt("return",this.checkConnection(o,l));case 21:return w.abrupt("return",!1);case 22:case"end":return w.stop()}},i,this)}));function t(i){return e.apply(this,arguments)}return t}()},{key:"connectToRemoteServer",value:function(){var e=po(ii.mark(function i(){var o,l;return ii.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(o=this.getIp(),this.connectionTimeWaited=0,this.connectionRetries=0,!this.socketIsConnected()){d.next=5;break}return d.abrupt("return",ES);case 5:return this.createWebSocket(o),d.next=8,this.checkConnection(o);case 8:if(l=d.sent,!l){d.next=13;break}return d.abrupt("return",ES);case 13:throw new Error(TP);case 14:case"end":return d.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"logWebSocketRequest",value:function(t,i){this.logger.debug("Web Socket Request Sent: ",t,i)}},{key:"sendWebSocketRequest",value:function(t,i){this.socketIsConnected()?(this.webSocket!==null&&this.webSocket.send(JSON.stringify(t)),this.logWebSocketRequest(i,t)):(console.error("Request to server cannot be made with a closed Websocket connection."),this.handleError(new el("Connection to server is closed; please try reloading. If the problem persists, the server may be too busy. Please try again at another time.",Tl.ERROR)))}}])}(),TS=function(){function r(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;Xn(this,r),ue(this,"webSocketClient",void 0),ue(this,"logger",void 0),ue(this,"onTrajectoryFileInfoArrive",void 0),ue(this,"onTrajectoryDataArrive",void 0),ue(this,"lastRequestedFile",void 0),ue(this,"handleError",void 0),ue(this,"jsonResponse",void 0),this.webSocketClient=e,this.lastRequestedFile="",this.handleError=t||function(){},this.logger=Al.get("netconnection"),this.logger.setLevel(Al.DEBUG),this.jsonResponse=i,this.registerBinaryMessageHandlers(),this.registerJsonMessageHandlers(),this.onTrajectoryFileInfoArrive=function(){},this.onTrajectoryDataArrive=function(){}}return qn(r,[{key:"setTrajectoryFileInfoHandler",value:function(t){this.onTrajectoryFileInfoArrive=t}},{key:"setTrajectoryDataHandler",value:function(t){this.onTrajectoryDataArrive=t}},{key:"setErrorHandler",value:function(t){this.handleError=t}},{key:"socketIsValid",value:function(){return this.webSocketClient.socketIsValid()}},{key:"getLastRequestedFile",value:function(){return this.lastRequestedFile}},{key:"onBinaryIdVisDataArrive",value:function(t){var i=8,o=new Float32Array(t.data),l=o[1],f=new Uint8Array(t.data),d=f.subarray(i,i+l),v=new TextDecoder("utf-8").decode(d);v==this.lastRequestedFile?this.onTrajectoryDataArrive(t.data):this.logger.error("File arrived ",v," is not file ",this.lastRequestedFile)}},{key:"onHeartbeatPing",value:function(t){this.webSocketClient.sendWebSocketRequest({connId:t.connId,msgType:ji.ID_HEARTBEAT_PONG},"Heartbeat pong")}},{key:"onJsonIdVisDataArrive",value:function(t){t.fileName===this.lastRequestedFile&&this.onTrajectoryDataArrive(t)}},{key:"updateTimestep",value:function(){this.logger.debug("Update Timestep Message Arrived")}},{key:"updateRateParam",value:function(){this.logger.debug("Update Rate Param Message Arrived")}},{key:"onModelDefinitionArrive",value:function(){this.logger.debug("Model Definition Arrived")}},{key:"onErrorMsg",value:function(t){this.logger.error("Error message of type ",t.errorCode," arrived: ",t.errorMsg);var i=new el(t.errorMsg,Tl.WARNING);this.handleError(i)}},{key:"registerBinaryMessageHandlers",value:function(){var t=this;this.webSocketClient.addBinaryMessageHandler(ji.ID_VIS_DATA_ARRIVE,function(i){return t.onBinaryIdVisDataArrive(i)})}},{key:"registerJsonMessageHandlers",value:function(){var t=this;this.webSocketClient.addJsonMessageHandler(ji.ID_TRAJECTORY_FILE_INFO,function(i){return t.onTrajectoryFileInfoArrive(i)}),this.webSocketClient.addJsonMessageHandler(ji.ID_HEARTBEAT_PING,function(i){return t.onHeartbeatPing(i)}),this.webSocketClient.addJsonMessageHandler(ji.ID_VIS_DATA_ARRIVE,function(i){return t.onJsonIdVisDataArrive(i)}),this.webSocketClient.addJsonMessageHandler(ji.ID_UPDATE_TIME_STEP,function(i){return t.updateTimestep()}),this.webSocketClient.addJsonMessageHandler(ji.ID_UPDATE_RATE_PARAM,function(i){return t.updateRateParam()}),this.webSocketClient.addJsonMessageHandler(ji.ID_MODEL_DEFINITION,function(i){return t.onModelDefinitionArrive()}),this.webSocketClient.addJsonMessageHandler(ji.ID_ERROR_MSG,function(i){return t.onErrorMsg(i)})}},{key:"disconnect",value:function(){this.webSocketClient.disconnect()}},{key:"getIp",value:function(){return this.webSocketClient.getIp()}},{key:"isConnectedToRemoteServer",value:function(){return this.webSocketClient.socketIsValid()}},{key:"connectToRemoteServer",value:function(){var e=po(ii.mark(function i(){return ii.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.registerBinaryMessageHandlers(),this.registerJsonMessageHandlers(),l.abrupt("return",this.webSocketClient.connectToRemoteServer());case 3:case"end":return l.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"sendTimeStepUpdate",value:function(t){var i={msgType:ji.ID_UPDATE_TIME_STEP,timeStep:t};this.webSocketClient.sendWebSocketRequest(i,"Update Time-Step")}},{key:"sendParameterUpdate",value:function(t,i){var o={msgType:ji.ID_UPDATE_RATE_PARAM,paramName:t,paramValue:i};this.webSocketClient.sendWebSocketRequest(o,"Rate Parameter Update")}},{key:"initialize",value:function(t){var i=this;this.isConnectedToRemoteServer()||this.connectToRemoteServer(),this.lastRequestedFile=t;var o={msgType:ji.ID_INIT_TRAJECTORY_FILE,fileName:t};return this.connectToRemoteServer().then(function(){i.webSocketClient.sendWebSocketRequest(o,"Start Trajectory File Playback")}).catch(function(l){throw new el(l.message,Tl.ERROR)})}},{key:"pause",value:function(){this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_VIS_DATA_PAUSE,fileName:this.lastRequestedFile},"Pause Simulation")}},{key:"stream",value:function(){this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_VIS_DATA_RESUME,fileName:this.lastRequestedFile},"Resume Simulation")}},{key:"abort",value:function(){this.socketIsValid()&&this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_VIS_DATA_ABORT,fileName:this.lastRequestedFile},"Abort Simulation")}},{key:"requestFrame",value:function(t){this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_VIS_DATA_REQUEST,frameNumber:t,fileName:this.lastRequestedFile,jsonResponse:this.jsonResponse},"Request Single Frame")}},{key:"requestFrameByTime",value:function(t){this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_GOTO_SIMULATION_TIME,time:t,fileName:this.lastRequestedFile,jsonResponse:this.jsonResponse},"Load single frame at specified Time")}},{key:"requestTrajectoryFileInfo",value:function(t){this.lastRequestedFile=t,this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_INIT_TRAJECTORY_FILE,fileName:t,jsonResponse:this.jsonResponse},"Initialize trajectory file info")}},{key:"sendUpdate",value:function(t){return this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_UPDATE_SIMULATION_STATE,data:t},"Send Update"),Promise.resolve()}}])}(),MP=function(){function r(e){Xn(this,r),ue(this,"simulariumFile",void 0),this.simulariumFile=e;var t=this.simulariumFile.spatialData;if(!t)throw new el("Simularium files need 'spatialData' array");t.bundleData.sort(function(i,o){return i.frameNumber-o.frameNumber})}return qn(r,[{key:"getTrajectoryFileInfo",value:function(){return this.simulariumFile.trajectoryInfo}},{key:"getNumFrames",value:function(){return this.simulariumFile.spatialData.bundleSize}},{key:"getFrameIndexAtTime",value:function(t){var i=this.simulariumFile.trajectoryInfo.timeStepSize,o=this.simulariumFile.spatialData.bundleData,l=o.findIndex(function(f){return ig(f.time,t,i)===0});return l}},{key:"getFrame",value:function(t){return this.simulariumFile.spatialData.bundleData[t]}},{key:"getPlotData",value:function(){return this.simulariumFile.plotData.data}},{key:"getAsBlob",value:function(){return new Blob([JSON.stringify(this.simulariumFile)],{type:"text/plain;charset=utf-8"})}}])}();function Xy(r,e){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=AP(r))||e){t&&(r=t);var i=0,o=function(){};return{s:o,n:function(){return i>=r.length?{done:!0}:{done:!1,value:r[i++]}},e:function(_){throw _},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l,f=!0,d=!1;return{s:function(){t=t.call(r)},n:function(){var _=t.next();return f=_.done,_},e:function(_){d=!0,l=_},f:function(){try{f||t.return==null||t.return()}finally{if(d)throw l}}}}function AP(r,e){if(r){if(typeof r=="string")return MS(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?MS(r,e):void 0}}function MS(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=Array(e);t<e;t++)i[t]=r[t];return i}var f0=function(r){return r[r.SPATIAL_DATA_JSON=0]="SPATIAL_DATA_JSON",r[r.TRAJECTORY_INFO_JSON=1]="TRAJECTORY_INFO_JSON",r[r.PLOT_DATA_JSON=2]="PLOT_DATA_JSON",r[r.SPATIAL_DATA_BINARY=3]="SPATIAL_DATA_BINARY",r}(f0||{}),AS="SIMULARIUMBINARY",PS=8,RS=function(){function r(e){Xn(this,r),ue(this,"fileContents",void 0),ue(this,"dataView",void 0),ue(this,"header",void 0),ue(this,"tfi",void 0),ue(this,"plotData",void 0),ue(this,"nFrames",void 0),ue(this,"frameOffsets",void 0),ue(this,"frameLengths",void 0),ue(this,"spatialDataBlock",void 0),this.nFrames=0,this.frameOffsets=[],this.frameLengths=[],this.fileContents=e,this.dataView=new DataView(e),this.header=this.readHeader(),this.tfi=this.readTrajectoryFileInfo(),this.plotData=this.readPlotData(),this.spatialDataBlock=this.readSpatialDataInfo()}return qn(r,[{key:"readSpatialDataInfo",value:function(){var t=Xy(this.header.blocks),i;try{for(t.s();!(i=t.n()).done;){var o=i.value;if(o.type===f0.SPATIAL_DATA_BINARY){var l=this.getBlockContent(o),f=0;f+=4,this.nFrames=l.getUint32(f,!0),f+=4;for(var d=0;d<this.nFrames;d++)this.frameOffsets.push(l.getUint32(f,!0)),f+=4,this.frameLengths.push(l.getUint32(f,!0)),f+=4;return this.getBlock(o)}}}catch(v){t.e(v)}finally{t.f()}throw new Error("No spatial data block found")}},{key:"readHeader",value:function(){var t=new Uint32Array(this.fileContents,AS.length),i=t[0],o=t[1],l=t[2];if(l<1)throw new Error("No blocks found in file");for(var f=[],d=3,v=0;v<l;v++)f.push({offset:t[d+v*3+0],type:t[d+v*3+1],size:t[d+v*3+2]});if(f[0].offset!==i)throw new Error("First block offset does not match header length");return{version:o,blocks:f}}},{key:"readTrajectoryFileInfo",value:function(){var t=Xy(this.header.blocks),i;try{for(t.s();!(i=t.n()).done;){var o=i.value;if(o.type===f0.TRAJECTORY_INFO_JSON){var l=this.parseJsonBlock(o);return l}}}catch(f){t.e(f)}finally{t.f()}throw new Error("No trajectory info block found")}},{key:"readPlotData",value:function(){var t=Xy(this.header.blocks),i;try{for(t.s();!(i=t.n()).done;){var o=i.value;if(o.type===f0.PLOT_DATA_JSON){var l=this.parseJsonBlock(o);return l.data}}}catch(f){t.e(f)}finally{t.f()}return[]}},{key:"getBlock",value:function(t){var i=this.dataView.getUint32(t.offset,!0),o=this.dataView.getUint32(t.offset+4,!0);if(i!==t.type)throw new Error("Block type mismatch.  Header says "+t.type+" but block says "+i);if(o!==t.size)throw new Error("Block size mismatch.  Header says "+t.size+" but block says "+o);return new DataView(this.fileContents,t.offset,t.size)}},{key:"getBlockContent",value:function(t){var i=this.dataView.getUint32(t.offset,!0),o=this.dataView.getUint32(t.offset+4,!0);if(i!==t.type)throw new Error("Block type mismatch.  Header says "+t.type+" but block says "+i);if(o!==t.size)throw new Error("Block size mismatch.  Header says "+t.size+" but block says "+o);return new DataView(this.fileContents,t.offset+PS,t.size-PS)}},{key:"parseJsonBlock",value:function(t){var i=this.getBlockContent(t),o=new TextDecoder("utf-8"),l=o.decode(i),f=l.replace(/\0+$/,""),d=JSON.parse(f);return d}},{key:"getTrajectoryFileInfo",value:function(){return this.tfi}},{key:"getNumFrames",value:function(){return this.nFrames}},{key:"getFrameIndexAtTime",value:function(t){for(var i=this.tfi.timeStepSize,o=0;o<this.nFrames;o++){var l=this.spatialDataBlock.getFloat32(this.frameOffsets[o]+4,!0);if(ig(l,t,i)===0)return o}return-1}},{key:"getFrame",value:function(t){var i=this.frameOffsets[t],o=this.frameLengths[t],l=this.spatialDataBlock.byteOffset+i,f=this.fileContents.slice(l,l+o);return f}},{key:"getPlotData",value:function(){return this.plotData}},{key:"getAsBlob",value:function(){return new Blob([this.fileContents],{type:"text/plain;charset=utf-8"})}}],[{key:"isBinarySimulariumFile",value:function(t){var i=t.slice(0,16);return i.text().then(function(o){return o===AS})}}])}(),PP="success",RP="fail",ju=["visType","instanceId","type","x","y","z","xrot","yrot","zrot","cr","nSubPoints"];function IP(r){if(Array.isArray(r))return r}function DP(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,o,l,f,d=[],v=!0,_=!1;try{if(l=(t=t.call(r)).next,e===0){if(Object(t)!==t)return;v=!1}else for(;!(v=(i=l.call(t)).done)&&(d.push(i.value),d.length!==e);v=!0);}catch(b){_=!0,o=b}finally{try{if(!v&&t.return!=null&&(f=t.return(),Object(f)!==f))return}finally{if(_)throw o}}return d}}function ex(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=Array(e);t<e;t++)i[t]=r[t];return i}function xT(r,e){if(r){if(typeof r=="string")return ex(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ex(r,e):void 0}}function LP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dm(r,e){return IP(r)||DP(r,e)||xT(r,e)||LP()}function kP(r){if(Array.isArray(r))return ex(r)}function FP(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function OP(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function af(r){return kP(r)||FP(r)||xT(r)||OP()}class NP{static isWebGL2Available(){try{const e=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&e.getContext("webgl2"))}catch{return!1}}static isColorSpaceAvailable(e){try{const t=document.createElement("canvas"),i=window.WebGL2RenderingContext&&t.getContext("webgl2");return i.drawingBufferColorSpace=e,i.drawingBufferColorSpace===e}catch{return!1}}static getWebGL2ErrorMessage(){return this.getErrorMessage(2)}static getErrorMessage(e){const t={1:"WebGL",2:"WebGL 2"},i={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext};let o='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';const l=document.createElement("div");return l.id="webglmessage",l.style.fontFamily="monospace",l.style.fontSize="13px",l.style.fontWeight="normal",l.style.textAlign="center",l.style.background="#fff",l.style.color="#000",l.style.padding="1.5em",l.style.width="400px",l.style.margin="5em auto 0",i[e]?o=o.replace("$0","graphics card"):o=o.replace("$0","browser"),o=o.replace("$1",t[e]),l.innerHTML=o,l}static isWebGLAvailable(){console.warn("isWebGLAvailable() has been deprecated and will be removed in r178. Use isWebGL2Available() instead.");try{const e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch{return!1}}static getWebGLErrorMessage(){return console.warn("getWebGLErrorMessage() has been deprecated and will be removed in r178. Use getWebGL2ErrorMessage() instead."),this.getErrorMessage(1)}}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const gw="171",Xu={ROTATE:0,DOLLY:1,PAN:2},ym={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},UP=0,IS=1,BP=2,wT=1,zP=2,sf=3,Ku=0,Ml=1,of=2,fd=0,Sm=1,DS=2,LS=3,kS=4,VP=5,lp=100,GP=101,HP=102,WP=103,jP=104,XP=200,qP=201,$P=202,YP=203,tx=204,nx=205,KP=206,ZP=207,JP=208,QP=209,eR=210,tR=211,nR=212,iR=213,rR=214,ix=0,rx=1,sx=2,Mm=3,ox=4,ax=5,lx=6,ux=7,e_=0,sR=1,oR=2,dd=0,aR=1,lR=2,uR=3,cR=4,hR=5,fR=6,dR=7,ST=300,Am=301,Pm=302,cx=303,hx=304,t_=306,fx=1e3,pp=1001,dx=1002,ir=1003,pR=1004,Pg=1005,Sh=1006,qy=1007,mp=1008,df=1009,ET=1010,CT=1011,fg=1012,_w=1013,xp=1014,fo=1015,_g=1016,yw=1017,bw=1018,Rm=1020,TT=35902,MT=1021,AT=1022,Is=1023,PT=1024,RT=1025,Em=1026,Im=1027,IT=1028,xw=1029,DT=1030,ww=1031,Sw=1033,d0=33776,p0=33777,m0=33778,v0=33779,px=35840,mx=35841,vx=35842,gx=35843,_x=36196,yx=37492,bx=37496,xx=37808,wx=37809,Sx=37810,Ex=37811,Cx=37812,Tx=37813,Mx=37814,Ax=37815,Px=37816,Rx=37817,Ix=37818,Dx=37819,Lx=37820,kx=37821,g0=36492,Fx=36494,Ox=36495,LT=36283,Nx=36284,Ux=36285,Bx=36286,mR=3200,vR=3201,Ew=0,gR=1,ud="",au="srgb",Dm="srgb-linear",F0="linear",Yi="srgb",Kp=7680,FS=519,_R=512,yR=513,bR=514,kT=515,xR=516,wR=517,SR=518,ER=519,OS=35044,Rg=35048,Lm="300 es",lf=2e3,O0=2001;class Sp{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const o=this._listeners[e];if(o!==void 0){const l=o.indexOf(t);l!==-1&&o.splice(l,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const o=i.slice(0);for(let l=0,f=o.length;l<f;l++)o[l].call(this,e);e.target=null}}}const va=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],_0=Math.PI/180,zx=180/Math.PI;function yg(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(va[r&255]+va[r>>8&255]+va[r>>16&255]+va[r>>24&255]+"-"+va[e&255]+va[e>>8&255]+"-"+va[e>>16&15|64]+va[e>>24&255]+"-"+va[t&63|128]+va[t>>8&255]+"-"+va[t>>16&255]+va[t>>24&255]+va[i&255]+va[i>>8&255]+va[i>>16&255]+va[i>>24&255]).toLowerCase()}function zn(r,e,t){return Math.max(e,Math.min(t,r))}function CR(r,e){return(r%e+e)%e}function $y(r,e,t){return(1-t)*r+t*e}function Mv(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function wl(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const TR={DEG2RAD:_0};class At{constructor(e=0,t=0){At.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6],this.y=o[1]*t+o[4]*i+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=zn(this.x,e.x,t.x),this.y=zn(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=zn(this.x,e,t),this.y=zn(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(zn(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(zn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),o=Math.sin(t),l=this.x-e.x,f=this.y-e.y;return this.x=l*i-f*o+e.x,this.y=l*o+f*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Dn{constructor(e,t,i,o,l,f,d,v,_){Dn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,o,l,f,d,v,_)}set(e,t,i,o,l,f,d,v,_){const b=this.elements;return b[0]=e,b[1]=o,b[2]=d,b[3]=t,b[4]=l,b[5]=v,b[6]=i,b[7]=f,b[8]=_,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,o=t.elements,l=this.elements,f=i[0],d=i[3],v=i[6],_=i[1],b=i[4],w=i[7],C=i[2],R=i[5],z=i[8],O=o[0],P=o[3],M=o[6],U=o[1],L=o[4],B=o[7],$=o[2],X=o[5],Q=o[8];return l[0]=f*O+d*U+v*$,l[3]=f*P+d*L+v*X,l[6]=f*M+d*B+v*Q,l[1]=_*O+b*U+w*$,l[4]=_*P+b*L+w*X,l[7]=_*M+b*B+w*Q,l[2]=C*O+R*U+z*$,l[5]=C*P+R*L+z*X,l[8]=C*M+R*B+z*Q,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],o=e[2],l=e[3],f=e[4],d=e[5],v=e[6],_=e[7],b=e[8];return t*f*b-t*d*_-i*l*b+i*d*v+o*l*_-o*f*v}invert(){const e=this.elements,t=e[0],i=e[1],o=e[2],l=e[3],f=e[4],d=e[5],v=e[6],_=e[7],b=e[8],w=b*f-d*_,C=d*v-b*l,R=_*l-f*v,z=t*w+i*C+o*R;if(z===0)return this.set(0,0,0,0,0,0,0,0,0);const O=1/z;return e[0]=w*O,e[1]=(o*_-b*i)*O,e[2]=(d*i-o*f)*O,e[3]=C*O,e[4]=(b*t-o*v)*O,e[5]=(o*l-d*t)*O,e[6]=R*O,e[7]=(i*v-_*t)*O,e[8]=(f*t-i*l)*O,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,o,l,f,d){const v=Math.cos(l),_=Math.sin(l);return this.set(i*v,i*_,-i*(v*f+_*d)+f+e,-o*_,o*v,-o*(-_*f+v*d)+d+t,0,0,1),this}scale(e,t){return this.premultiply(Yy.makeScale(e,t)),this}rotate(e){return this.premultiply(Yy.makeRotation(-e)),this}translate(e,t){return this.premultiply(Yy.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let o=0;o<9;o++)if(t[o]!==i[o])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Yy=new Dn;function FT(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function N0(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function MR(){const r=N0("canvas");return r.style.display="block",r}const NS={};function pm(r){r in NS||(NS[r]=!0,console.warn(r))}function AR(r,e,t){return new Promise(function(i,o){function l(){switch(r.clientWaitSync(e,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:o();break;case r.TIMEOUT_EXPIRED:setTimeout(l,t);break;default:i()}}setTimeout(l,t)})}function PR(r){const e=r.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function RR(r){const e=r.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const US=new Dn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),BS=new Dn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function IR(){const r={enabled:!0,workingColorSpace:Dm,spaces:{},convert:function(o,l,f){return this.enabled===!1||l===f||!l||!f||(this.spaces[l].transfer===Yi&&(o.r=cf(o.r),o.g=cf(o.g),o.b=cf(o.b)),this.spaces[l].primaries!==this.spaces[f].primaries&&(o.applyMatrix3(this.spaces[l].toXYZ),o.applyMatrix3(this.spaces[f].fromXYZ)),this.spaces[f].transfer===Yi&&(o.r=Cm(o.r),o.g=Cm(o.g),o.b=Cm(o.b))),o},fromWorkingColorSpace:function(o,l){return this.convert(o,this.workingColorSpace,l)},toWorkingColorSpace:function(o,l){return this.convert(o,l,this.workingColorSpace)},getPrimaries:function(o){return this.spaces[o].primaries},getTransfer:function(o){return o===ud?F0:this.spaces[o].transfer},getLuminanceCoefficients:function(o,l=this.workingColorSpace){return o.fromArray(this.spaces[l].luminanceCoefficients)},define:function(o){Object.assign(this.spaces,o)},_getMatrix:function(o,l,f){return o.copy(this.spaces[l].toXYZ).multiply(this.spaces[f].fromXYZ)},_getDrawingBufferColorSpace:function(o){return this.spaces[o].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(o=this.workingColorSpace){return this.spaces[o].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return r.define({[Dm]:{primaries:e,whitePoint:i,transfer:F0,toXYZ:US,fromXYZ:BS,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:au},outputColorSpaceConfig:{drawingBufferColorSpace:au}},[au]:{primaries:e,whitePoint:i,transfer:Yi,toXYZ:US,fromXYZ:BS,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:au}}}),r}const Ci=IR();function cf(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Cm(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Zp;class DR{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Zp===void 0&&(Zp=N0("canvas")),Zp.width=e.width,Zp.height=e.height;const i=Zp.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Zp}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=N0("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const o=i.getImageData(0,0,e.width,e.height),l=o.data;for(let f=0;f<l.length;f++)l[f]=cf(l[f]/255)*255;return i.putImageData(o,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(cf(t[i]/255)*255):t[i]=cf(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let LR=0;class OT{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:LR++}),this.uuid=yg(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},o=this.data;if(o!==null){let l;if(Array.isArray(o)){l=[];for(let f=0,d=o.length;f<d;f++)o[f].isDataTexture?l.push(Ky(o[f].image)):l.push(Ky(o[f]))}else l=Ky(o);i.url=l}return t||(e.images[this.uuid]=i),i}}function Ky(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?DR.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let kR=0;class Qa extends Sp{constructor(e=Qa.DEFAULT_IMAGE,t=Qa.DEFAULT_MAPPING,i=pp,o=pp,l=Sh,f=mp,d=Is,v=df,_=Qa.DEFAULT_ANISOTROPY,b=ud){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kR++}),this.uuid=yg(),this.name="",this.source=new OT(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=o,this.magFilter=l,this.minFilter=f,this.anisotropy=_,this.format=d,this.internalFormat=null,this.type=v,this.offset=new At(0,0),this.repeat=new At(1,1),this.center=new At(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=b,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ST)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case fx:e.x=e.x-Math.floor(e.x);break;case pp:e.x=e.x<0?0:1;break;case dx:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case fx:e.y=e.y-Math.floor(e.y);break;case pp:e.y=e.y<0?0:1;break;case dx:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Qa.DEFAULT_IMAGE=null;Qa.DEFAULT_MAPPING=ST;Qa.DEFAULT_ANISOTROPY=1;class Xi{constructor(e=0,t=0,i=0,o=1){Xi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=o}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,o){return this.x=e,this.y=t,this.z=i,this.w=o,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,o=this.z,l=this.w,f=e.elements;return this.x=f[0]*t+f[4]*i+f[8]*o+f[12]*l,this.y=f[1]*t+f[5]*i+f[9]*o+f[13]*l,this.z=f[2]*t+f[6]*i+f[10]*o+f[14]*l,this.w=f[3]*t+f[7]*i+f[11]*o+f[15]*l,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,o,l;const v=e.elements,_=v[0],b=v[4],w=v[8],C=v[1],R=v[5],z=v[9],O=v[2],P=v[6],M=v[10];if(Math.abs(b-C)<.01&&Math.abs(w-O)<.01&&Math.abs(z-P)<.01){if(Math.abs(b+C)<.1&&Math.abs(w+O)<.1&&Math.abs(z+P)<.1&&Math.abs(_+R+M-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const L=(_+1)/2,B=(R+1)/2,$=(M+1)/2,X=(b+C)/4,Q=(w+O)/4,te=(z+P)/4;return L>B&&L>$?L<.01?(i=0,o=.707106781,l=.707106781):(i=Math.sqrt(L),o=X/i,l=Q/i):B>$?B<.01?(i=.707106781,o=0,l=.707106781):(o=Math.sqrt(B),i=X/o,l=te/o):$<.01?(i=.707106781,o=.707106781,l=0):(l=Math.sqrt($),i=Q/l,o=te/l),this.set(i,o,l,t),this}let U=Math.sqrt((P-z)*(P-z)+(w-O)*(w-O)+(C-b)*(C-b));return Math.abs(U)<.001&&(U=1),this.x=(P-z)/U,this.y=(w-O)/U,this.z=(C-b)/U,this.w=Math.acos((_+R+M-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=zn(this.x,e.x,t.x),this.y=zn(this.y,e.y,t.y),this.z=zn(this.z,e.z,t.z),this.w=zn(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=zn(this.x,e,t),this.y=zn(this.y,e,t),this.z=zn(this.z,e,t),this.w=zn(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(zn(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class FR extends Sp{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Xi(0,0,e,t),this.scissorTest=!1,this.viewport=new Xi(0,0,e,t);const o={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Sh,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const l=new Qa(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);l.flipY=!1,l.generateMipmaps=i.generateMipmaps,l.internalFormat=i.internalFormat,this.textures=[];const f=i.count;for(let d=0;d<f;d++)this.textures[d]=l.clone(),this.textures[d].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let o=0,l=this.textures.length;o<l;o++)this.textures[o].image.width=e,this.textures[o].image.height=t,this.textures[o].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,o=e.textures.length;i<o;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new OT(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class El extends FR{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class NT extends Qa{constructor(e=null,t=1,i=1,o=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:o},this.magFilter=ir,this.minFilter=ir,this.wrapR=pp,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class OR extends Qa{constructor(e=null,t=1,i=1,o=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:o},this.magFilter=ir,this.minFilter=ir,this.wrapR=pp,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Zu{constructor(e=0,t=0,i=0,o=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=o}static slerpFlat(e,t,i,o,l,f,d){let v=i[o+0],_=i[o+1],b=i[o+2],w=i[o+3];const C=l[f+0],R=l[f+1],z=l[f+2],O=l[f+3];if(d===0){e[t+0]=v,e[t+1]=_,e[t+2]=b,e[t+3]=w;return}if(d===1){e[t+0]=C,e[t+1]=R,e[t+2]=z,e[t+3]=O;return}if(w!==O||v!==C||_!==R||b!==z){let P=1-d;const M=v*C+_*R+b*z+w*O,U=M>=0?1:-1,L=1-M*M;if(L>Number.EPSILON){const $=Math.sqrt(L),X=Math.atan2($,M*U);P=Math.sin(P*X)/$,d=Math.sin(d*X)/$}const B=d*U;if(v=v*P+C*B,_=_*P+R*B,b=b*P+z*B,w=w*P+O*B,P===1-d){const $=1/Math.sqrt(v*v+_*_+b*b+w*w);v*=$,_*=$,b*=$,w*=$}}e[t]=v,e[t+1]=_,e[t+2]=b,e[t+3]=w}static multiplyQuaternionsFlat(e,t,i,o,l,f){const d=i[o],v=i[o+1],_=i[o+2],b=i[o+3],w=l[f],C=l[f+1],R=l[f+2],z=l[f+3];return e[t]=d*z+b*w+v*R-_*C,e[t+1]=v*z+b*C+_*w-d*R,e[t+2]=_*z+b*R+d*C-v*w,e[t+3]=b*z-d*w-v*C-_*R,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,o){return this._x=e,this._y=t,this._z=i,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,o=e._y,l=e._z,f=e._order,d=Math.cos,v=Math.sin,_=d(i/2),b=d(o/2),w=d(l/2),C=v(i/2),R=v(o/2),z=v(l/2);switch(f){case"XYZ":this._x=C*b*w+_*R*z,this._y=_*R*w-C*b*z,this._z=_*b*z+C*R*w,this._w=_*b*w-C*R*z;break;case"YXZ":this._x=C*b*w+_*R*z,this._y=_*R*w-C*b*z,this._z=_*b*z-C*R*w,this._w=_*b*w+C*R*z;break;case"ZXY":this._x=C*b*w-_*R*z,this._y=_*R*w+C*b*z,this._z=_*b*z+C*R*w,this._w=_*b*w-C*R*z;break;case"ZYX":this._x=C*b*w-_*R*z,this._y=_*R*w+C*b*z,this._z=_*b*z-C*R*w,this._w=_*b*w+C*R*z;break;case"YZX":this._x=C*b*w+_*R*z,this._y=_*R*w+C*b*z,this._z=_*b*z-C*R*w,this._w=_*b*w-C*R*z;break;case"XZY":this._x=C*b*w-_*R*z,this._y=_*R*w-C*b*z,this._z=_*b*z+C*R*w,this._w=_*b*w+C*R*z;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+f)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,o=Math.sin(i);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],o=t[4],l=t[8],f=t[1],d=t[5],v=t[9],_=t[2],b=t[6],w=t[10],C=i+d+w;if(C>0){const R=.5/Math.sqrt(C+1);this._w=.25/R,this._x=(b-v)*R,this._y=(l-_)*R,this._z=(f-o)*R}else if(i>d&&i>w){const R=2*Math.sqrt(1+i-d-w);this._w=(b-v)/R,this._x=.25*R,this._y=(o+f)/R,this._z=(l+_)/R}else if(d>w){const R=2*Math.sqrt(1+d-i-w);this._w=(l-_)/R,this._x=(o+f)/R,this._y=.25*R,this._z=(v+b)/R}else{const R=2*Math.sqrt(1+w-i-d);this._w=(f-o)/R,this._x=(l+_)/R,this._y=(v+b)/R,this._z=.25*R}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(zn(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const o=Math.min(1,t/i);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,o=e._y,l=e._z,f=e._w,d=t._x,v=t._y,_=t._z,b=t._w;return this._x=i*b+f*d+o*_-l*v,this._y=o*b+f*v+l*d-i*_,this._z=l*b+f*_+i*v-o*d,this._w=f*b-i*d-o*v-l*_,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,o=this._y,l=this._z,f=this._w;let d=f*e._w+i*e._x+o*e._y+l*e._z;if(d<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,d=-d):this.copy(e),d>=1)return this._w=f,this._x=i,this._y=o,this._z=l,this;const v=1-d*d;if(v<=Number.EPSILON){const R=1-t;return this._w=R*f+t*this._w,this._x=R*i+t*this._x,this._y=R*o+t*this._y,this._z=R*l+t*this._z,this.normalize(),this}const _=Math.sqrt(v),b=Math.atan2(_,d),w=Math.sin((1-t)*b)/_,C=Math.sin(t*b)/_;return this._w=f*w+this._w*C,this._x=i*w+this._x*C,this._y=o*w+this._y*C,this._z=l*w+this._z*C,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),o=Math.sqrt(1-i),l=Math.sqrt(i);return this.set(o*Math.sin(e),o*Math.cos(e),l*Math.sin(t),l*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class be{constructor(e=0,t=0,i=0){be.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(zS.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(zS.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,o=this.z,l=e.elements;return this.x=l[0]*t+l[3]*i+l[6]*o,this.y=l[1]*t+l[4]*i+l[7]*o,this.z=l[2]*t+l[5]*i+l[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,o=this.z,l=e.elements,f=1/(l[3]*t+l[7]*i+l[11]*o+l[15]);return this.x=(l[0]*t+l[4]*i+l[8]*o+l[12])*f,this.y=(l[1]*t+l[5]*i+l[9]*o+l[13])*f,this.z=(l[2]*t+l[6]*i+l[10]*o+l[14])*f,this}applyQuaternion(e){const t=this.x,i=this.y,o=this.z,l=e.x,f=e.y,d=e.z,v=e.w,_=2*(f*o-d*i),b=2*(d*t-l*o),w=2*(l*i-f*t);return this.x=t+v*_+f*w-d*b,this.y=i+v*b+d*_-l*w,this.z=o+v*w+l*b-f*_,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,o=this.z,l=e.elements;return this.x=l[0]*t+l[4]*i+l[8]*o,this.y=l[1]*t+l[5]*i+l[9]*o,this.z=l[2]*t+l[6]*i+l[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=zn(this.x,e.x,t.x),this.y=zn(this.y,e.y,t.y),this.z=zn(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=zn(this.x,e,t),this.y=zn(this.y,e,t),this.z=zn(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(zn(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,o=e.y,l=e.z,f=t.x,d=t.y,v=t.z;return this.x=o*v-l*d,this.y=l*f-i*v,this.z=i*d-o*f,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Zy.copy(this).projectOnVector(e),this.sub(Zy)}reflect(e){return this.sub(Zy.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(zn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,o=this.z-e.z;return t*t+i*i+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const o=Math.sin(t)*e;return this.x=o*Math.sin(i),this.y=Math.cos(t)*e,this.z=o*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=o,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Zy=new be,zS=new Zu;class Eh{constructor(e=new be(1/0,1/0,1/0),t=new be(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(kc.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(kc.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=kc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const l=i.getAttribute("position");if(t===!0&&l!==void 0&&e.isInstancedMesh!==!0)for(let f=0,d=l.count;f<d;f++)e.isMesh===!0?e.getVertexPosition(f,kc):kc.fromBufferAttribute(l,f),kc.applyMatrix4(e.matrixWorld),this.expandByPoint(kc);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Ig.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Ig.copy(i.boundingBox)),Ig.applyMatrix4(e.matrixWorld),this.union(Ig)}const o=e.children;for(let l=0,f=o.length;l<f;l++)this.expandByObject(o[l],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,kc),kc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Av),Dg.subVectors(this.max,Av),Jp.subVectors(e.a,Av),Qp.subVectors(e.b,Av),em.subVectors(e.c,Av),nd.subVectors(Qp,Jp),id.subVectors(em,Qp),Zd.subVectors(Jp,em);let t=[0,-nd.z,nd.y,0,-id.z,id.y,0,-Zd.z,Zd.y,nd.z,0,-nd.x,id.z,0,-id.x,Zd.z,0,-Zd.x,-nd.y,nd.x,0,-id.y,id.x,0,-Zd.y,Zd.x,0];return!Jy(t,Jp,Qp,em,Dg)||(t=[1,0,0,0,1,0,0,0,1],!Jy(t,Jp,Qp,em,Dg))?!1:(Lg.crossVectors(nd,id),t=[Lg.x,Lg.y,Lg.z],Jy(t,Jp,Qp,em,Dg))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,kc).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(kc).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Jh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Jh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Jh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Jh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Jh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Jh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Jh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Jh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Jh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Jh=[new be,new be,new be,new be,new be,new be,new be,new be],kc=new be,Ig=new Eh,Jp=new be,Qp=new be,em=new be,nd=new be,id=new be,Zd=new be,Av=new be,Dg=new be,Lg=new be,Jd=new be;function Jy(r,e,t,i,o){for(let l=0,f=r.length-3;l<=f;l+=3){Jd.fromArray(r,l);const d=o.x*Math.abs(Jd.x)+o.y*Math.abs(Jd.y)+o.z*Math.abs(Jd.z),v=e.dot(Jd),_=t.dot(Jd),b=i.dot(Jd);if(Math.max(-Math.max(v,_,b),Math.min(v,_,b))>d)return!1}return!0}const NR=new Eh,Pv=new be,Qy=new be;class Om{constructor(e=new be,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):NR.setFromPoints(e).getCenter(i);let o=0;for(let l=0,f=e.length;l<f;l++)o=Math.max(o,i.distanceToSquared(e[l]));return this.radius=Math.sqrt(o),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Pv.subVectors(e,this.center);const t=Pv.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),o=(i-this.radius)*.5;this.center.addScaledVector(Pv,o/i),this.radius+=o}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Qy.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Pv.copy(e.center).add(Qy)),this.expandByPoint(Pv.copy(e.center).sub(Qy))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Qh=new be,eb=new be,kg=new be,rd=new be,tb=new be,Fg=new be,nb=new be;class bg{constructor(e=new be,t=new be(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Qh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Qh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Qh.copy(this.origin).addScaledVector(this.direction,t),Qh.distanceToSquared(e))}distanceSqToSegment(e,t,i,o){eb.copy(e).add(t).multiplyScalar(.5),kg.copy(t).sub(e).normalize(),rd.copy(this.origin).sub(eb);const l=e.distanceTo(t)*.5,f=-this.direction.dot(kg),d=rd.dot(this.direction),v=-rd.dot(kg),_=rd.lengthSq(),b=Math.abs(1-f*f);let w,C,R,z;if(b>0)if(w=f*v-d,C=f*d-v,z=l*b,w>=0)if(C>=-z)if(C<=z){const O=1/b;w*=O,C*=O,R=w*(w+f*C+2*d)+C*(f*w+C+2*v)+_}else C=l,w=Math.max(0,-(f*C+d)),R=-w*w+C*(C+2*v)+_;else C=-l,w=Math.max(0,-(f*C+d)),R=-w*w+C*(C+2*v)+_;else C<=-z?(w=Math.max(0,-(-f*l+d)),C=w>0?-l:Math.min(Math.max(-l,-v),l),R=-w*w+C*(C+2*v)+_):C<=z?(w=0,C=Math.min(Math.max(-l,-v),l),R=C*(C+2*v)+_):(w=Math.max(0,-(f*l+d)),C=w>0?l:Math.min(Math.max(-l,-v),l),R=-w*w+C*(C+2*v)+_);else C=f>0?-l:l,w=Math.max(0,-(f*C+d)),R=-w*w+C*(C+2*v)+_;return i&&i.copy(this.origin).addScaledVector(this.direction,w),o&&o.copy(eb).addScaledVector(kg,C),R}intersectSphere(e,t){Qh.subVectors(e.center,this.origin);const i=Qh.dot(this.direction),o=Qh.dot(Qh)-i*i,l=e.radius*e.radius;if(o>l)return null;const f=Math.sqrt(l-o),d=i-f,v=i+f;return v<0?null:d<0?this.at(v,t):this.at(d,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,o,l,f,d,v;const _=1/this.direction.x,b=1/this.direction.y,w=1/this.direction.z,C=this.origin;return _>=0?(i=(e.min.x-C.x)*_,o=(e.max.x-C.x)*_):(i=(e.max.x-C.x)*_,o=(e.min.x-C.x)*_),b>=0?(l=(e.min.y-C.y)*b,f=(e.max.y-C.y)*b):(l=(e.max.y-C.y)*b,f=(e.min.y-C.y)*b),i>f||l>o||((l>i||isNaN(i))&&(i=l),(f<o||isNaN(o))&&(o=f),w>=0?(d=(e.min.z-C.z)*w,v=(e.max.z-C.z)*w):(d=(e.max.z-C.z)*w,v=(e.min.z-C.z)*w),i>v||d>o)||((d>i||i!==i)&&(i=d),(v<o||o!==o)&&(o=v),o<0)?null:this.at(i>=0?i:o,t)}intersectsBox(e){return this.intersectBox(e,Qh)!==null}intersectTriangle(e,t,i,o,l){tb.subVectors(t,e),Fg.subVectors(i,e),nb.crossVectors(tb,Fg);let f=this.direction.dot(nb),d;if(f>0){if(o)return null;d=1}else if(f<0)d=-1,f=-f;else return null;rd.subVectors(this.origin,e);const v=d*this.direction.dot(Fg.crossVectors(rd,Fg));if(v<0)return null;const _=d*this.direction.dot(tb.cross(rd));if(_<0||v+_>f)return null;const b=-d*rd.dot(nb);return b<0?null:this.at(b/f,l)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class hi{constructor(e,t,i,o,l,f,d,v,_,b,w,C,R,z,O,P){hi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,o,l,f,d,v,_,b,w,C,R,z,O,P)}set(e,t,i,o,l,f,d,v,_,b,w,C,R,z,O,P){const M=this.elements;return M[0]=e,M[4]=t,M[8]=i,M[12]=o,M[1]=l,M[5]=f,M[9]=d,M[13]=v,M[2]=_,M[6]=b,M[10]=w,M[14]=C,M[3]=R,M[7]=z,M[11]=O,M[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new hi().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,o=1/tm.setFromMatrixColumn(e,0).length(),l=1/tm.setFromMatrixColumn(e,1).length(),f=1/tm.setFromMatrixColumn(e,2).length();return t[0]=i[0]*o,t[1]=i[1]*o,t[2]=i[2]*o,t[3]=0,t[4]=i[4]*l,t[5]=i[5]*l,t[6]=i[6]*l,t[7]=0,t[8]=i[8]*f,t[9]=i[9]*f,t[10]=i[10]*f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,o=e.y,l=e.z,f=Math.cos(i),d=Math.sin(i),v=Math.cos(o),_=Math.sin(o),b=Math.cos(l),w=Math.sin(l);if(e.order==="XYZ"){const C=f*b,R=f*w,z=d*b,O=d*w;t[0]=v*b,t[4]=-v*w,t[8]=_,t[1]=R+z*_,t[5]=C-O*_,t[9]=-d*v,t[2]=O-C*_,t[6]=z+R*_,t[10]=f*v}else if(e.order==="YXZ"){const C=v*b,R=v*w,z=_*b,O=_*w;t[0]=C+O*d,t[4]=z*d-R,t[8]=f*_,t[1]=f*w,t[5]=f*b,t[9]=-d,t[2]=R*d-z,t[6]=O+C*d,t[10]=f*v}else if(e.order==="ZXY"){const C=v*b,R=v*w,z=_*b,O=_*w;t[0]=C-O*d,t[4]=-f*w,t[8]=z+R*d,t[1]=R+z*d,t[5]=f*b,t[9]=O-C*d,t[2]=-f*_,t[6]=d,t[10]=f*v}else if(e.order==="ZYX"){const C=f*b,R=f*w,z=d*b,O=d*w;t[0]=v*b,t[4]=z*_-R,t[8]=C*_+O,t[1]=v*w,t[5]=O*_+C,t[9]=R*_-z,t[2]=-_,t[6]=d*v,t[10]=f*v}else if(e.order==="YZX"){const C=f*v,R=f*_,z=d*v,O=d*_;t[0]=v*b,t[4]=O-C*w,t[8]=z*w+R,t[1]=w,t[5]=f*b,t[9]=-d*b,t[2]=-_*b,t[6]=R*w+z,t[10]=C-O*w}else if(e.order==="XZY"){const C=f*v,R=f*_,z=d*v,O=d*_;t[0]=v*b,t[4]=-w,t[8]=_*b,t[1]=C*w+O,t[5]=f*b,t[9]=R*w-z,t[2]=z*w-R,t[6]=d*b,t[10]=O*w+C}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(UR,e,BR)}lookAt(e,t,i){const o=this.elements;return ru.subVectors(e,t),ru.lengthSq()===0&&(ru.z=1),ru.normalize(),sd.crossVectors(i,ru),sd.lengthSq()===0&&(Math.abs(i.z)===1?ru.x+=1e-4:ru.z+=1e-4,ru.normalize(),sd.crossVectors(i,ru)),sd.normalize(),Og.crossVectors(ru,sd),o[0]=sd.x,o[4]=Og.x,o[8]=ru.x,o[1]=sd.y,o[5]=Og.y,o[9]=ru.y,o[2]=sd.z,o[6]=Og.z,o[10]=ru.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,o=t.elements,l=this.elements,f=i[0],d=i[4],v=i[8],_=i[12],b=i[1],w=i[5],C=i[9],R=i[13],z=i[2],O=i[6],P=i[10],M=i[14],U=i[3],L=i[7],B=i[11],$=i[15],X=o[0],Q=o[4],te=o[8],V=o[12],H=o[1],J=o[5],ce=o[9],he=o[13],ge=o[2],Ae=o[6],me=o[10],Ie=o[14],ae=o[3],ye=o[7],de=o[11],ie=o[15];return l[0]=f*X+d*H+v*ge+_*ae,l[4]=f*Q+d*J+v*Ae+_*ye,l[8]=f*te+d*ce+v*me+_*de,l[12]=f*V+d*he+v*Ie+_*ie,l[1]=b*X+w*H+C*ge+R*ae,l[5]=b*Q+w*J+C*Ae+R*ye,l[9]=b*te+w*ce+C*me+R*de,l[13]=b*V+w*he+C*Ie+R*ie,l[2]=z*X+O*H+P*ge+M*ae,l[6]=z*Q+O*J+P*Ae+M*ye,l[10]=z*te+O*ce+P*me+M*de,l[14]=z*V+O*he+P*Ie+M*ie,l[3]=U*X+L*H+B*ge+$*ae,l[7]=U*Q+L*J+B*Ae+$*ye,l[11]=U*te+L*ce+B*me+$*de,l[15]=U*V+L*he+B*Ie+$*ie,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],o=e[8],l=e[12],f=e[1],d=e[5],v=e[9],_=e[13],b=e[2],w=e[6],C=e[10],R=e[14],z=e[3],O=e[7],P=e[11],M=e[15];return z*(+l*v*w-o*_*w-l*d*C+i*_*C+o*d*R-i*v*R)+O*(+t*v*R-t*_*C+l*f*C-o*f*R+o*_*b-l*v*b)+P*(+t*_*w-t*d*R-l*f*w+i*f*R+l*d*b-i*_*b)+M*(-o*d*b-t*v*w+t*d*C+o*f*w-i*f*C+i*v*b)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=t,o[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],o=e[2],l=e[3],f=e[4],d=e[5],v=e[6],_=e[7],b=e[8],w=e[9],C=e[10],R=e[11],z=e[12],O=e[13],P=e[14],M=e[15],U=w*P*_-O*C*_+O*v*R-d*P*R-w*v*M+d*C*M,L=z*C*_-b*P*_-z*v*R+f*P*R+b*v*M-f*C*M,B=b*O*_-z*w*_+z*d*R-f*O*R-b*d*M+f*w*M,$=z*w*v-b*O*v-z*d*C+f*O*C+b*d*P-f*w*P,X=t*U+i*L+o*B+l*$;if(X===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Q=1/X;return e[0]=U*Q,e[1]=(O*C*l-w*P*l-O*o*R+i*P*R+w*o*M-i*C*M)*Q,e[2]=(d*P*l-O*v*l+O*o*_-i*P*_-d*o*M+i*v*M)*Q,e[3]=(w*v*l-d*C*l-w*o*_+i*C*_+d*o*R-i*v*R)*Q,e[4]=L*Q,e[5]=(b*P*l-z*C*l+z*o*R-t*P*R-b*o*M+t*C*M)*Q,e[6]=(z*v*l-f*P*l-z*o*_+t*P*_+f*o*M-t*v*M)*Q,e[7]=(f*C*l-b*v*l+b*o*_-t*C*_-f*o*R+t*v*R)*Q,e[8]=B*Q,e[9]=(z*w*l-b*O*l-z*i*R+t*O*R+b*i*M-t*w*M)*Q,e[10]=(f*O*l-z*d*l+z*i*_-t*O*_-f*i*M+t*d*M)*Q,e[11]=(b*d*l-f*w*l-b*i*_+t*w*_+f*i*R-t*d*R)*Q,e[12]=$*Q,e[13]=(b*O*o-z*w*o+z*i*C-t*O*C-b*i*P+t*w*P)*Q,e[14]=(z*d*o-f*O*o-z*i*v+t*O*v+f*i*P-t*d*P)*Q,e[15]=(f*w*o-b*d*o+b*i*v-t*w*v-f*i*C+t*d*C)*Q,this}scale(e){const t=this.elements,i=e.x,o=e.y,l=e.z;return t[0]*=i,t[4]*=o,t[8]*=l,t[1]*=i,t[5]*=o,t[9]*=l,t[2]*=i,t[6]*=o,t[10]*=l,t[3]*=i,t[7]*=o,t[11]*=l,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,o))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),o=Math.sin(t),l=1-i,f=e.x,d=e.y,v=e.z,_=l*f,b=l*d;return this.set(_*f+i,_*d-o*v,_*v+o*d,0,_*d+o*v,b*d+i,b*v-o*f,0,_*v-o*d,b*v+o*f,l*v*v+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,o,l,f){return this.set(1,i,l,0,e,1,f,0,t,o,1,0,0,0,0,1),this}compose(e,t,i){const o=this.elements,l=t._x,f=t._y,d=t._z,v=t._w,_=l+l,b=f+f,w=d+d,C=l*_,R=l*b,z=l*w,O=f*b,P=f*w,M=d*w,U=v*_,L=v*b,B=v*w,$=i.x,X=i.y,Q=i.z;return o[0]=(1-(O+M))*$,o[1]=(R+B)*$,o[2]=(z-L)*$,o[3]=0,o[4]=(R-B)*X,o[5]=(1-(C+M))*X,o[6]=(P+U)*X,o[7]=0,o[8]=(z+L)*Q,o[9]=(P-U)*Q,o[10]=(1-(C+O))*Q,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,t,i){const o=this.elements;let l=tm.set(o[0],o[1],o[2]).length();const f=tm.set(o[4],o[5],o[6]).length(),d=tm.set(o[8],o[9],o[10]).length();this.determinant()<0&&(l=-l),e.x=o[12],e.y=o[13],e.z=o[14],Fc.copy(this);const _=1/l,b=1/f,w=1/d;return Fc.elements[0]*=_,Fc.elements[1]*=_,Fc.elements[2]*=_,Fc.elements[4]*=b,Fc.elements[5]*=b,Fc.elements[6]*=b,Fc.elements[8]*=w,Fc.elements[9]*=w,Fc.elements[10]*=w,t.setFromRotationMatrix(Fc),i.x=l,i.y=f,i.z=d,this}makePerspective(e,t,i,o,l,f,d=lf){const v=this.elements,_=2*l/(t-e),b=2*l/(i-o),w=(t+e)/(t-e),C=(i+o)/(i-o);let R,z;if(d===lf)R=-(f+l)/(f-l),z=-2*f*l/(f-l);else if(d===O0)R=-f/(f-l),z=-f*l/(f-l);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+d);return v[0]=_,v[4]=0,v[8]=w,v[12]=0,v[1]=0,v[5]=b,v[9]=C,v[13]=0,v[2]=0,v[6]=0,v[10]=R,v[14]=z,v[3]=0,v[7]=0,v[11]=-1,v[15]=0,this}makeOrthographic(e,t,i,o,l,f,d=lf){const v=this.elements,_=1/(t-e),b=1/(i-o),w=1/(f-l),C=(t+e)*_,R=(i+o)*b;let z,O;if(d===lf)z=(f+l)*w,O=-2*w;else if(d===O0)z=l*w,O=-1*w;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+d);return v[0]=2*_,v[4]=0,v[8]=0,v[12]=-C,v[1]=0,v[5]=2*b,v[9]=0,v[13]=-R,v[2]=0,v[6]=0,v[10]=O,v[14]=-z,v[3]=0,v[7]=0,v[11]=0,v[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let o=0;o<16;o++)if(t[o]!==i[o])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const tm=new be,Fc=new hi,UR=new be(0,0,0),BR=new be(1,1,1),sd=new be,Og=new be,ru=new be,VS=new hi,GS=new Zu;class Pl{constructor(e=0,t=0,i=0,o=Pl.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,o=this._order){return this._x=e,this._y=t,this._z=i,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const o=e.elements,l=o[0],f=o[4],d=o[8],v=o[1],_=o[5],b=o[9],w=o[2],C=o[6],R=o[10];switch(t){case"XYZ":this._y=Math.asin(zn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-b,R),this._z=Math.atan2(-f,l)):(this._x=Math.atan2(C,_),this._z=0);break;case"YXZ":this._x=Math.asin(-zn(b,-1,1)),Math.abs(b)<.9999999?(this._y=Math.atan2(d,R),this._z=Math.atan2(v,_)):(this._y=Math.atan2(-w,l),this._z=0);break;case"ZXY":this._x=Math.asin(zn(C,-1,1)),Math.abs(C)<.9999999?(this._y=Math.atan2(-w,R),this._z=Math.atan2(-f,_)):(this._y=0,this._z=Math.atan2(v,l));break;case"ZYX":this._y=Math.asin(-zn(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(C,R),this._z=Math.atan2(v,l)):(this._x=0,this._z=Math.atan2(-f,_));break;case"YZX":this._z=Math.asin(zn(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(-b,_),this._y=Math.atan2(-w,l)):(this._x=0,this._y=Math.atan2(d,R));break;case"XZY":this._z=Math.asin(-zn(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(C,_),this._y=Math.atan2(d,l)):(this._x=Math.atan2(-b,R),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return VS.makeRotationFromQuaternion(e),this.setFromRotationMatrix(VS,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return GS.setFromEuler(this),this.setFromQuaternion(GS,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Pl.DEFAULT_ORDER="XYZ";class Cw{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let zR=0;const HS=new be,nm=new Zu,ef=new hi,Ng=new be,Rv=new be,VR=new be,GR=new Zu,WS=new be(1,0,0),jS=new be(0,1,0),XS=new be(0,0,1),qS={type:"added"},HR={type:"removed"},im={type:"childadded",child:null},ib={type:"childremoved",child:null};class cs extends Sp{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:zR++}),this.uuid=yg(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cs.DEFAULT_UP.clone();const e=new be,t=new Pl,i=new Zu,o=new be(1,1,1);function l(){i.setFromEuler(t,!1)}function f(){t.setFromQuaternion(i,void 0,!1)}t._onChange(l),i._onChange(f),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new hi},normalMatrix:{value:new Dn}}),this.matrix=new hi,this.matrixWorld=new hi,this.matrixAutoUpdate=cs.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=cs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Cw,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return nm.setFromAxisAngle(e,t),this.quaternion.multiply(nm),this}rotateOnWorldAxis(e,t){return nm.setFromAxisAngle(e,t),this.quaternion.premultiply(nm),this}rotateX(e){return this.rotateOnAxis(WS,e)}rotateY(e){return this.rotateOnAxis(jS,e)}rotateZ(e){return this.rotateOnAxis(XS,e)}translateOnAxis(e,t){return HS.copy(e).applyQuaternion(this.quaternion),this.position.add(HS.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(WS,e)}translateY(e){return this.translateOnAxis(jS,e)}translateZ(e){return this.translateOnAxis(XS,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ef.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Ng.copy(e):Ng.set(e,t,i);const o=this.parent;this.updateWorldMatrix(!0,!1),Rv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ef.lookAt(Rv,Ng,this.up):ef.lookAt(Ng,Rv,this.up),this.quaternion.setFromRotationMatrix(ef),o&&(ef.extractRotation(o.matrixWorld),nm.setFromRotationMatrix(ef),this.quaternion.premultiply(nm.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(qS),im.child=e,this.dispatchEvent(im),im.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(HR),ib.child=e,this.dispatchEvent(ib),ib.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ef.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ef.multiply(e.parent.matrixWorld)),e.applyMatrix4(ef),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(qS),im.child=e,this.dispatchEvent(im),im.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,o=this.children.length;i<o;i++){const f=this.children[i].getObjectByProperty(e,t);if(f!==void 0)return f}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const o=this.children;for(let l=0,f=o.length;l<f;l++)o[l].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rv,e,VR),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rv,GR,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const o=this.children;for(let l=0,f=o.length;l<f;l++)o[l].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(o.type="BatchedMesh",o.perObjectFrustumCulled=this.perObjectFrustumCulled,o.sortObjects=this.sortObjects,o.drawRanges=this._drawRanges,o.reservedRanges=this._reservedRanges,o.visibility=this._visibility,o.active=this._active,o.bounds=this._bounds.map(d=>({boxInitialized:d.boxInitialized,boxMin:d.box.min.toArray(),boxMax:d.box.max.toArray(),sphereInitialized:d.sphereInitialized,sphereRadius:d.sphere.radius,sphereCenter:d.sphere.center.toArray()})),o.maxInstanceCount=this._maxInstanceCount,o.maxVertexCount=this._maxVertexCount,o.maxIndexCount=this._maxIndexCount,o.geometryInitialized=this._geometryInitialized,o.geometryCount=this._geometryCount,o.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(o.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(o.boundingSphere={center:o.boundingSphere.center.toArray(),radius:o.boundingSphere.radius}),this.boundingBox!==null&&(o.boundingBox={min:o.boundingBox.min.toArray(),max:o.boundingBox.max.toArray()}));function l(d,v){return d[v.uuid]===void 0&&(d[v.uuid]=v.toJSON(e)),v.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=l(e.geometries,this.geometry);const d=this.geometry.parameters;if(d!==void 0&&d.shapes!==void 0){const v=d.shapes;if(Array.isArray(v))for(let _=0,b=v.length;_<b;_++){const w=v[_];l(e.shapes,w)}else l(e.shapes,v)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(e.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const d=[];for(let v=0,_=this.material.length;v<_;v++)d.push(l(e.materials,this.material[v]));o.material=d}else o.material=l(e.materials,this.material);if(this.children.length>0){o.children=[];for(let d=0;d<this.children.length;d++)o.children.push(this.children[d].toJSON(e).object)}if(this.animations.length>0){o.animations=[];for(let d=0;d<this.animations.length;d++){const v=this.animations[d];o.animations.push(l(e.animations,v))}}if(t){const d=f(e.geometries),v=f(e.materials),_=f(e.textures),b=f(e.images),w=f(e.shapes),C=f(e.skeletons),R=f(e.animations),z=f(e.nodes);d.length>0&&(i.geometries=d),v.length>0&&(i.materials=v),_.length>0&&(i.textures=_),b.length>0&&(i.images=b),w.length>0&&(i.shapes=w),C.length>0&&(i.skeletons=C),R.length>0&&(i.animations=R),z.length>0&&(i.nodes=z)}return i.object=o,i;function f(d){const v=[];for(const _ in d){const b=d[_];delete b.metadata,v.push(b)}return v}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const o=e.children[i];this.add(o.clone())}return this}}cs.DEFAULT_UP=new be(0,1,0);cs.DEFAULT_MATRIX_AUTO_UPDATE=!0;cs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Oc=new be,tf=new be,rb=new be,nf=new be,rm=new be,sm=new be,$S=new be,sb=new be,ob=new be,ab=new be,lb=new Xi,ub=new Xi,cb=new Xi;class Bc{constructor(e=new be,t=new be,i=new be){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,o){o.subVectors(i,t),Oc.subVectors(e,t),o.cross(Oc);const l=o.lengthSq();return l>0?o.multiplyScalar(1/Math.sqrt(l)):o.set(0,0,0)}static getBarycoord(e,t,i,o,l){Oc.subVectors(o,t),tf.subVectors(i,t),rb.subVectors(e,t);const f=Oc.dot(Oc),d=Oc.dot(tf),v=Oc.dot(rb),_=tf.dot(tf),b=tf.dot(rb),w=f*_-d*d;if(w===0)return l.set(0,0,0),null;const C=1/w,R=(_*v-d*b)*C,z=(f*b-d*v)*C;return l.set(1-R-z,z,R)}static containsPoint(e,t,i,o){return this.getBarycoord(e,t,i,o,nf)===null?!1:nf.x>=0&&nf.y>=0&&nf.x+nf.y<=1}static getInterpolation(e,t,i,o,l,f,d,v){return this.getBarycoord(e,t,i,o,nf)===null?(v.x=0,v.y=0,"z"in v&&(v.z=0),"w"in v&&(v.w=0),null):(v.setScalar(0),v.addScaledVector(l,nf.x),v.addScaledVector(f,nf.y),v.addScaledVector(d,nf.z),v)}static getInterpolatedAttribute(e,t,i,o,l,f){return lb.setScalar(0),ub.setScalar(0),cb.setScalar(0),lb.fromBufferAttribute(e,t),ub.fromBufferAttribute(e,i),cb.fromBufferAttribute(e,o),f.setScalar(0),f.addScaledVector(lb,l.x),f.addScaledVector(ub,l.y),f.addScaledVector(cb,l.z),f}static isFrontFacing(e,t,i,o){return Oc.subVectors(i,t),tf.subVectors(e,t),Oc.cross(tf).dot(o)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,o){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[o]),this}setFromAttributeAndIndices(e,t,i,o){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,o),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Oc.subVectors(this.c,this.b),tf.subVectors(this.a,this.b),Oc.cross(tf).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Bc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Bc.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,o,l){return Bc.getInterpolation(e,this.a,this.b,this.c,t,i,o,l)}containsPoint(e){return Bc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Bc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,o=this.b,l=this.c;let f,d;rm.subVectors(o,i),sm.subVectors(l,i),sb.subVectors(e,i);const v=rm.dot(sb),_=sm.dot(sb);if(v<=0&&_<=0)return t.copy(i);ob.subVectors(e,o);const b=rm.dot(ob),w=sm.dot(ob);if(b>=0&&w<=b)return t.copy(o);const C=v*w-b*_;if(C<=0&&v>=0&&b<=0)return f=v/(v-b),t.copy(i).addScaledVector(rm,f);ab.subVectors(e,l);const R=rm.dot(ab),z=sm.dot(ab);if(z>=0&&R<=z)return t.copy(l);const O=R*_-v*z;if(O<=0&&_>=0&&z<=0)return d=_/(_-z),t.copy(i).addScaledVector(sm,d);const P=b*z-R*w;if(P<=0&&w-b>=0&&R-z>=0)return $S.subVectors(l,o),d=(w-b)/(w-b+(R-z)),t.copy(o).addScaledVector($S,d);const M=1/(P+O+C);return f=O*M,d=C*M,t.copy(i).addScaledVector(rm,f).addScaledVector(sm,d)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const UT={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},od={h:0,s:0,l:0},Ug={h:0,s:0,l:0};function hb(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class Ht{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const o=e;o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=au){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ci.toWorkingColorSpace(this,t),this}setRGB(e,t,i,o=Ci.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ci.toWorkingColorSpace(this,o),this}setHSL(e,t,i,o=Ci.workingColorSpace){if(e=CR(e,1),t=zn(t,0,1),i=zn(i,0,1),t===0)this.r=this.g=this.b=i;else{const l=i<=.5?i*(1+t):i+t-i*t,f=2*i-l;this.r=hb(f,l,e+1/3),this.g=hb(f,l,e),this.b=hb(f,l,e-1/3)}return Ci.toWorkingColorSpace(this,o),this}setStyle(e,t=au){function i(l){l!==void 0&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let o;if(o=/^(\w+)\(([^\)]*)\)/.exec(e)){let l;const f=o[1],d=o[2];switch(f){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return i(l[4]),this.setRGB(Math.min(255,parseInt(l[1],10))/255,Math.min(255,parseInt(l[2],10))/255,Math.min(255,parseInt(l[3],10))/255,t);if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return i(l[4]),this.setRGB(Math.min(100,parseInt(l[1],10))/100,Math.min(100,parseInt(l[2],10))/100,Math.min(100,parseInt(l[3],10))/100,t);break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return i(l[4]),this.setHSL(parseFloat(l[1])/360,parseFloat(l[2])/100,parseFloat(l[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(e)){const l=o[1],f=l.length;if(f===3)return this.setRGB(parseInt(l.charAt(0),16)/15,parseInt(l.charAt(1),16)/15,parseInt(l.charAt(2),16)/15,t);if(f===6)return this.setHex(parseInt(l,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=au){const i=UT[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=cf(e.r),this.g=cf(e.g),this.b=cf(e.b),this}copyLinearToSRGB(e){return this.r=Cm(e.r),this.g=Cm(e.g),this.b=Cm(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=au){return Ci.fromWorkingColorSpace(ga.copy(this),e),Math.round(zn(ga.r*255,0,255))*65536+Math.round(zn(ga.g*255,0,255))*256+Math.round(zn(ga.b*255,0,255))}getHexString(e=au){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ci.workingColorSpace){Ci.fromWorkingColorSpace(ga.copy(this),t);const i=ga.r,o=ga.g,l=ga.b,f=Math.max(i,o,l),d=Math.min(i,o,l);let v,_;const b=(d+f)/2;if(d===f)v=0,_=0;else{const w=f-d;switch(_=b<=.5?w/(f+d):w/(2-f-d),f){case i:v=(o-l)/w+(o<l?6:0);break;case o:v=(l-i)/w+2;break;case l:v=(i-o)/w+4;break}v/=6}return e.h=v,e.s=_,e.l=b,e}getRGB(e,t=Ci.workingColorSpace){return Ci.fromWorkingColorSpace(ga.copy(this),t),e.r=ga.r,e.g=ga.g,e.b=ga.b,e}getStyle(e=au){Ci.fromWorkingColorSpace(ga.copy(this),e);const t=ga.r,i=ga.g,o=ga.b;return e!==au?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${o.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(o*255)})`}offsetHSL(e,t,i){return this.getHSL(od),this.setHSL(od.h+e,od.s+t,od.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(od),e.getHSL(Ug);const i=$y(od.h,Ug.h,t),o=$y(od.s,Ug.s,t),l=$y(od.l,Ug.l,t);return this.setHSL(i,o,l),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,o=this.b,l=e.elements;return this.r=l[0]*t+l[3]*i+l[6]*o,this.g=l[1]*t+l[4]*i+l[7]*o,this.b=l[2]*t+l[5]*i+l[8]*o,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ga=new Ht;Ht.NAMES=UT;let WR=0;class Ch extends Sp{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:WR++}),this.uuid=yg(),this.name="",this.type="Material",this.blending=Sm,this.side=Ku,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=tx,this.blendDst=nx,this.blendEquation=lp,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ht(0,0,0),this.blendAlpha=0,this.depthFunc=Mm,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=FS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Kp,this.stencilZFail=Kp,this.stencilZPass=Kp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const o=this[t];if(o===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}o&&o.isColor?o.set(i):o&&o.isVector3&&i&&i.isVector3?o.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Sm&&(i.blending=this.blending),this.side!==Ku&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==tx&&(i.blendSrc=this.blendSrc),this.blendDst!==nx&&(i.blendDst=this.blendDst),this.blendEquation!==lp&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Mm&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==FS&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Kp&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Kp&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Kp&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function o(l){const f=[];for(const d in l){const v=l[d];delete v.metadata,f.push(v)}return f}if(t){const l=o(e.textures),f=o(e.images);l.length>0&&(i.textures=l),f.length>0&&(i.images=f)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const o=t.length;i=new Array(o);for(let l=0;l!==o;++l)i[l]=t[l].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class U0 extends Ch{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ht(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Pl,this.combine=e_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Rs=new be,Bg=new At;class ns{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=OS,this.updateRanges=[],this.gpuType=fo,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let o=0,l=this.itemSize;o<l;o++)this.array[e+o]=t.array[i+o];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Bg.fromBufferAttribute(this,t),Bg.applyMatrix3(e),this.setXY(t,Bg.x,Bg.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Rs.fromBufferAttribute(this,t),Rs.applyMatrix3(e),this.setXYZ(t,Rs.x,Rs.y,Rs.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Rs.fromBufferAttribute(this,t),Rs.applyMatrix4(e),this.setXYZ(t,Rs.x,Rs.y,Rs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Rs.fromBufferAttribute(this,t),Rs.applyNormalMatrix(e),this.setXYZ(t,Rs.x,Rs.y,Rs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Rs.fromBufferAttribute(this,t),Rs.transformDirection(e),this.setXYZ(t,Rs.x,Rs.y,Rs.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Mv(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=wl(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Mv(t,this.array)),t}setX(e,t){return this.normalized&&(t=wl(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Mv(t,this.array)),t}setY(e,t){return this.normalized&&(t=wl(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Mv(t,this.array)),t}setZ(e,t){return this.normalized&&(t=wl(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Mv(t,this.array)),t}setW(e,t){return this.normalized&&(t=wl(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=wl(t,this.array),i=wl(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,o){return e*=this.itemSize,this.normalized&&(t=wl(t,this.array),i=wl(i,this.array),o=wl(o,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=o,this}setXYZW(e,t,i,o,l){return e*=this.itemSize,this.normalized&&(t=wl(t,this.array),i=wl(i,this.array),o=wl(o,this.array),l=wl(l,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=o,this.array[e+3]=l,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==OS&&(e.usage=this.usage),e}}class BT extends ns{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class zT extends ns{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class hr extends ns{constructor(e,t,i){super(new Float32Array(e),t,i)}}let jR=0;const Vu=new hi,fb=new cs,om=new be,su=new Eh,Iv=new Eh,ho=new be;class is extends Sp{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:jR++}),this.uuid=yg(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(FT(e)?zT:BT)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const l=new Dn().getNormalMatrix(e);i.applyNormalMatrix(l),i.needsUpdate=!0}const o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(e),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Vu.makeRotationFromQuaternion(e),this.applyMatrix4(Vu),this}rotateX(e){return Vu.makeRotationX(e),this.applyMatrix4(Vu),this}rotateY(e){return Vu.makeRotationY(e),this.applyMatrix4(Vu),this}rotateZ(e){return Vu.makeRotationZ(e),this.applyMatrix4(Vu),this}translate(e,t,i){return Vu.makeTranslation(e,t,i),this.applyMatrix4(Vu),this}scale(e,t,i){return Vu.makeScale(e,t,i),this.applyMatrix4(Vu),this}lookAt(e){return fb.lookAt(e),fb.updateMatrix(),this.applyMatrix4(fb.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(om).negate(),this.translate(om.x,om.y,om.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let o=0,l=e.length;o<l;o++){const f=e[o];i.push(f.x,f.y,f.z||0)}this.setAttribute("position",new hr(i,3))}else{const i=Math.min(e.length,t.count);for(let o=0;o<i;o++){const l=e[o];t.setXYZ(o,l.x,l.y,l.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Eh);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new be(-1/0,-1/0,-1/0),new be(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,o=t.length;i<o;i++){const l=t[i];su.setFromBufferAttribute(l),this.morphTargetsRelative?(ho.addVectors(this.boundingBox.min,su.min),this.boundingBox.expandByPoint(ho),ho.addVectors(this.boundingBox.max,su.max),this.boundingBox.expandByPoint(ho)):(this.boundingBox.expandByPoint(su.min),this.boundingBox.expandByPoint(su.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Om);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new be,1/0);return}if(e){const i=this.boundingSphere.center;if(su.setFromBufferAttribute(e),t)for(let l=0,f=t.length;l<f;l++){const d=t[l];Iv.setFromBufferAttribute(d),this.morphTargetsRelative?(ho.addVectors(su.min,Iv.min),su.expandByPoint(ho),ho.addVectors(su.max,Iv.max),su.expandByPoint(ho)):(su.expandByPoint(Iv.min),su.expandByPoint(Iv.max))}su.getCenter(i);let o=0;for(let l=0,f=e.count;l<f;l++)ho.fromBufferAttribute(e,l),o=Math.max(o,i.distanceToSquared(ho));if(t)for(let l=0,f=t.length;l<f;l++){const d=t[l],v=this.morphTargetsRelative;for(let _=0,b=d.count;_<b;_++)ho.fromBufferAttribute(d,_),v&&(om.fromBufferAttribute(e,_),ho.add(om)),o=Math.max(o,i.distanceToSquared(ho))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,o=t.normal,l=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ns(new Float32Array(4*i.count),4));const f=this.getAttribute("tangent"),d=[],v=[];for(let te=0;te<i.count;te++)d[te]=new be,v[te]=new be;const _=new be,b=new be,w=new be,C=new At,R=new At,z=new At,O=new be,P=new be;function M(te,V,H){_.fromBufferAttribute(i,te),b.fromBufferAttribute(i,V),w.fromBufferAttribute(i,H),C.fromBufferAttribute(l,te),R.fromBufferAttribute(l,V),z.fromBufferAttribute(l,H),b.sub(_),w.sub(_),R.sub(C),z.sub(C);const J=1/(R.x*z.y-z.x*R.y);isFinite(J)&&(O.copy(b).multiplyScalar(z.y).addScaledVector(w,-R.y).multiplyScalar(J),P.copy(w).multiplyScalar(R.x).addScaledVector(b,-z.x).multiplyScalar(J),d[te].add(O),d[V].add(O),d[H].add(O),v[te].add(P),v[V].add(P),v[H].add(P))}let U=this.groups;U.length===0&&(U=[{start:0,count:e.count}]);for(let te=0,V=U.length;te<V;++te){const H=U[te],J=H.start,ce=H.count;for(let he=J,ge=J+ce;he<ge;he+=3)M(e.getX(he+0),e.getX(he+1),e.getX(he+2))}const L=new be,B=new be,$=new be,X=new be;function Q(te){$.fromBufferAttribute(o,te),X.copy($);const V=d[te];L.copy(V),L.sub($.multiplyScalar($.dot(V))).normalize(),B.crossVectors(X,V);const J=B.dot(v[te])<0?-1:1;f.setXYZW(te,L.x,L.y,L.z,J)}for(let te=0,V=U.length;te<V;++te){const H=U[te],J=H.start,ce=H.count;for(let he=J,ge=J+ce;he<ge;he+=3)Q(e.getX(he+0)),Q(e.getX(he+1)),Q(e.getX(he+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new ns(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let C=0,R=i.count;C<R;C++)i.setXYZ(C,0,0,0);const o=new be,l=new be,f=new be,d=new be,v=new be,_=new be,b=new be,w=new be;if(e)for(let C=0,R=e.count;C<R;C+=3){const z=e.getX(C+0),O=e.getX(C+1),P=e.getX(C+2);o.fromBufferAttribute(t,z),l.fromBufferAttribute(t,O),f.fromBufferAttribute(t,P),b.subVectors(f,l),w.subVectors(o,l),b.cross(w),d.fromBufferAttribute(i,z),v.fromBufferAttribute(i,O),_.fromBufferAttribute(i,P),d.add(b),v.add(b),_.add(b),i.setXYZ(z,d.x,d.y,d.z),i.setXYZ(O,v.x,v.y,v.z),i.setXYZ(P,_.x,_.y,_.z)}else for(let C=0,R=t.count;C<R;C+=3)o.fromBufferAttribute(t,C+0),l.fromBufferAttribute(t,C+1),f.fromBufferAttribute(t,C+2),b.subVectors(f,l),w.subVectors(o,l),b.cross(w),i.setXYZ(C+0,b.x,b.y,b.z),i.setXYZ(C+1,b.x,b.y,b.z),i.setXYZ(C+2,b.x,b.y,b.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ho.fromBufferAttribute(e,t),ho.normalize(),e.setXYZ(t,ho.x,ho.y,ho.z)}toNonIndexed(){function e(d,v){const _=d.array,b=d.itemSize,w=d.normalized,C=new _.constructor(v.length*b);let R=0,z=0;for(let O=0,P=v.length;O<P;O++){d.isInterleavedBufferAttribute?R=v[O]*d.data.stride+d.offset:R=v[O]*b;for(let M=0;M<b;M++)C[z++]=_[R++]}return new ns(C,b,w)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new is,i=this.index.array,o=this.attributes;for(const d in o){const v=o[d],_=e(v,i);t.setAttribute(d,_)}const l=this.morphAttributes;for(const d in l){const v=[],_=l[d];for(let b=0,w=_.length;b<w;b++){const C=_[b],R=e(C,i);v.push(R)}t.morphAttributes[d]=v}t.morphTargetsRelative=this.morphTargetsRelative;const f=this.groups;for(let d=0,v=f.length;d<v;d++){const _=f[d];t.addGroup(_.start,_.count,_.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const v=this.parameters;for(const _ in v)v[_]!==void 0&&(e[_]=v[_]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const v in i){const _=i[v];e.data.attributes[v]=_.toJSON(e.data)}const o={};let l=!1;for(const v in this.morphAttributes){const _=this.morphAttributes[v],b=[];for(let w=0,C=_.length;w<C;w++){const R=_[w];b.push(R.toJSON(e.data))}b.length>0&&(o[v]=b,l=!0)}l&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);const f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));const d=this.boundingSphere;return d!==null&&(e.data.boundingSphere={center:d.center.toArray(),radius:d.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const o=e.attributes;for(const _ in o){const b=o[_];this.setAttribute(_,b.clone(t))}const l=e.morphAttributes;for(const _ in l){const b=[],w=l[_];for(let C=0,R=w.length;C<R;C++)b.push(w[C].clone(t));this.morphAttributes[_]=b}this.morphTargetsRelative=e.morphTargetsRelative;const f=e.groups;for(let _=0,b=f.length;_<b;_++){const w=f[_];this.addGroup(w.start,w.count,w.materialIndex)}const d=e.boundingBox;d!==null&&(this.boundingBox=d.clone());const v=e.boundingSphere;return v!==null&&(this.boundingSphere=v.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const YS=new hi,Qd=new bg,zg=new Om,KS=new be,Vg=new be,Gg=new be,Hg=new be,db=new be,Wg=new be,ZS=new be,jg=new be;class Cr extends cs{constructor(e=new is,t=new U0){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,f=o.length;l<f;l++){const d=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=l}}}}getVertexPosition(e,t){const i=this.geometry,o=i.attributes.position,l=i.morphAttributes.position,f=i.morphTargetsRelative;t.fromBufferAttribute(o,e);const d=this.morphTargetInfluences;if(l&&d){Wg.set(0,0,0);for(let v=0,_=l.length;v<_;v++){const b=d[v],w=l[v];b!==0&&(db.fromBufferAttribute(w,e),f?Wg.addScaledVector(db,b):Wg.addScaledVector(db.sub(t),b))}t.add(Wg)}return t}raycast(e,t){const i=this.geometry,o=this.material,l=this.matrixWorld;o!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),zg.copy(i.boundingSphere),zg.applyMatrix4(l),Qd.copy(e.ray).recast(e.near),!(zg.containsPoint(Qd.origin)===!1&&(Qd.intersectSphere(zg,KS)===null||Qd.origin.distanceToSquared(KS)>(e.far-e.near)**2))&&(YS.copy(l).invert(),Qd.copy(e.ray).applyMatrix4(YS),!(i.boundingBox!==null&&Qd.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Qd)))}_computeIntersections(e,t,i){let o;const l=this.geometry,f=this.material,d=l.index,v=l.attributes.position,_=l.attributes.uv,b=l.attributes.uv1,w=l.attributes.normal,C=l.groups,R=l.drawRange;if(d!==null)if(Array.isArray(f))for(let z=0,O=C.length;z<O;z++){const P=C[z],M=f[P.materialIndex],U=Math.max(P.start,R.start),L=Math.min(d.count,Math.min(P.start+P.count,R.start+R.count));for(let B=U,$=L;B<$;B+=3){const X=d.getX(B),Q=d.getX(B+1),te=d.getX(B+2);o=Xg(this,M,e,i,_,b,w,X,Q,te),o&&(o.faceIndex=Math.floor(B/3),o.face.materialIndex=P.materialIndex,t.push(o))}}else{const z=Math.max(0,R.start),O=Math.min(d.count,R.start+R.count);for(let P=z,M=O;P<M;P+=3){const U=d.getX(P),L=d.getX(P+1),B=d.getX(P+2);o=Xg(this,f,e,i,_,b,w,U,L,B),o&&(o.faceIndex=Math.floor(P/3),t.push(o))}}else if(v!==void 0)if(Array.isArray(f))for(let z=0,O=C.length;z<O;z++){const P=C[z],M=f[P.materialIndex],U=Math.max(P.start,R.start),L=Math.min(v.count,Math.min(P.start+P.count,R.start+R.count));for(let B=U,$=L;B<$;B+=3){const X=B,Q=B+1,te=B+2;o=Xg(this,M,e,i,_,b,w,X,Q,te),o&&(o.faceIndex=Math.floor(B/3),o.face.materialIndex=P.materialIndex,t.push(o))}}else{const z=Math.max(0,R.start),O=Math.min(v.count,R.start+R.count);for(let P=z,M=O;P<M;P+=3){const U=P,L=P+1,B=P+2;o=Xg(this,f,e,i,_,b,w,U,L,B),o&&(o.faceIndex=Math.floor(P/3),t.push(o))}}}}function XR(r,e,t,i,o,l,f,d){let v;if(e.side===Ml?v=i.intersectTriangle(f,l,o,!0,d):v=i.intersectTriangle(o,l,f,e.side===Ku,d),v===null)return null;jg.copy(d),jg.applyMatrix4(r.matrixWorld);const _=t.ray.origin.distanceTo(jg);return _<t.near||_>t.far?null:{distance:_,point:jg.clone(),object:r}}function Xg(r,e,t,i,o,l,f,d,v,_){r.getVertexPosition(d,Vg),r.getVertexPosition(v,Gg),r.getVertexPosition(_,Hg);const b=XR(r,e,t,i,Vg,Gg,Hg,ZS);if(b){const w=new be;Bc.getBarycoord(ZS,Vg,Gg,Hg,w),o&&(b.uv=Bc.getInterpolatedAttribute(o,d,v,_,w,new At)),l&&(b.uv1=Bc.getInterpolatedAttribute(l,d,v,_,w,new At)),f&&(b.normal=Bc.getInterpolatedAttribute(f,d,v,_,w,new be),b.normal.dot(i.direction)>0&&b.normal.multiplyScalar(-1));const C={a:d,b:v,c:_,normal:new be,materialIndex:0};Bc.getNormal(Vg,Gg,Hg,C.normal),b.face=C,b.barycoord=w}return b}class Nm extends is{constructor(e=1,t=1,i=1,o=1,l=1,f=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:o,heightSegments:l,depthSegments:f};const d=this;o=Math.floor(o),l=Math.floor(l),f=Math.floor(f);const v=[],_=[],b=[],w=[];let C=0,R=0;z("z","y","x",-1,-1,i,t,e,f,l,0),z("z","y","x",1,-1,i,t,-e,f,l,1),z("x","z","y",1,1,e,i,t,o,f,2),z("x","z","y",1,-1,e,i,-t,o,f,3),z("x","y","z",1,-1,e,t,i,o,l,4),z("x","y","z",-1,-1,e,t,-i,o,l,5),this.setIndex(v),this.setAttribute("position",new hr(_,3)),this.setAttribute("normal",new hr(b,3)),this.setAttribute("uv",new hr(w,2));function z(O,P,M,U,L,B,$,X,Q,te,V){const H=B/Q,J=$/te,ce=B/2,he=$/2,ge=X/2,Ae=Q+1,me=te+1;let Ie=0,ae=0;const ye=new be;for(let de=0;de<me;de++){const ie=de*J-he;for(let we=0;we<Ae;we++){const ze=we*H-ce;ye[O]=ze*U,ye[P]=ie*L,ye[M]=ge,_.push(ye.x,ye.y,ye.z),ye[O]=0,ye[P]=0,ye[M]=X>0?1:-1,b.push(ye.x,ye.y,ye.z),w.push(we/Q),w.push(1-de/te),Ie+=1}}for(let de=0;de<te;de++)for(let ie=0;ie<Q;ie++){const we=C+ie+Ae*de,ze=C+ie+Ae*(de+1),se=C+(ie+1)+Ae*(de+1),fe=C+(ie+1)+Ae*de;v.push(we,ze,fe),v.push(ze,se,fe),ae+=6}d.addGroup(R,ae,V),R+=ae,C+=Ie}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Nm(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function km(r){const e={};for(const t in r){e[t]={};for(const i in r[t]){const o=r[t][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?o.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=o.clone():Array.isArray(o)?e[t][i]=o.slice():e[t][i]=o}}return e}function Ya(r){const e={};for(let t=0;t<r.length;t++){const i=km(r[t]);for(const o in i)e[o]=i[o]}return e}function qR(r){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function VT(r){const e=r.getRenderTarget();return e===null?r.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Ci.workingColorSpace}const $R={clone:km,merge:Ya};var YR=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,KR=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Vc extends Ch{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=YR,this.fragmentShader=KR,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=km(e.uniforms),this.uniformsGroups=qR(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const o in this.uniforms){const f=this.uniforms[o].value;f&&f.isTexture?t.uniforms[o]={type:"t",value:f.toJSON(e).uuid}:f&&f.isColor?t.uniforms[o]={type:"c",value:f.getHex()}:f&&f.isVector2?t.uniforms[o]={type:"v2",value:f.toArray()}:f&&f.isVector3?t.uniforms[o]={type:"v3",value:f.toArray()}:f&&f.isVector4?t.uniforms[o]={type:"v4",value:f.toArray()}:f&&f.isMatrix3?t.uniforms[o]={type:"m3",value:f.toArray()}:f&&f.isMatrix4?t.uniforms[o]={type:"m4",value:f.toArray()}:t.uniforms[o]={value:f}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const o in this.extensions)this.extensions[o]===!0&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class GT extends cs{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new hi,this.projectionMatrix=new hi,this.projectionMatrixInverse=new hi,this.coordinateSystem=lf}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const ad=new be,JS=new At,QS=new At;class qu extends GT{constructor(e=50,t=1,i=.1,o=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=o,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=zx*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(_0*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return zx*2*Math.atan(Math.tan(_0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){ad.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(ad.x,ad.y).multiplyScalar(-e/ad.z),ad.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(ad.x,ad.y).multiplyScalar(-e/ad.z)}getViewSize(e,t){return this.getViewBounds(e,JS,QS),t.subVectors(QS,JS)}setViewOffset(e,t,i,o,l,f){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=o,this.view.width=l,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(_0*.5*this.fov)/this.zoom,i=2*t,o=this.aspect*i,l=-.5*o;const f=this.view;if(this.view!==null&&this.view.enabled){const v=f.fullWidth,_=f.fullHeight;l+=f.offsetX*o/v,t-=f.offsetY*i/_,o*=f.width/v,i*=f.height/_}const d=this.filmOffset;d!==0&&(l+=e*d/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+o,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const am=-90,lm=1;class ZR extends cs{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const o=new qu(am,lm,e,t);o.layers=this.layers,this.add(o);const l=new qu(am,lm,e,t);l.layers=this.layers,this.add(l);const f=new qu(am,lm,e,t);f.layers=this.layers,this.add(f);const d=new qu(am,lm,e,t);d.layers=this.layers,this.add(d);const v=new qu(am,lm,e,t);v.layers=this.layers,this.add(v);const _=new qu(am,lm,e,t);_.layers=this.layers,this.add(_)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,o,l,f,d,v]=t;for(const _ of t)this.remove(_);if(e===lf)i.up.set(0,1,0),i.lookAt(1,0,0),o.up.set(0,1,0),o.lookAt(-1,0,0),l.up.set(0,0,-1),l.lookAt(0,1,0),f.up.set(0,0,1),f.lookAt(0,-1,0),d.up.set(0,1,0),d.lookAt(0,0,1),v.up.set(0,1,0),v.lookAt(0,0,-1);else if(e===O0)i.up.set(0,-1,0),i.lookAt(-1,0,0),o.up.set(0,-1,0),o.lookAt(1,0,0),l.up.set(0,0,1),l.lookAt(0,1,0),f.up.set(0,0,-1),f.lookAt(0,-1,0),d.up.set(0,-1,0),d.lookAt(0,0,1),v.up.set(0,-1,0),v.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const _ of t)this.add(_),_.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:o}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[l,f,d,v,_,b]=this.children,w=e.getRenderTarget(),C=e.getActiveCubeFace(),R=e.getActiveMipmapLevel(),z=e.xr.enabled;e.xr.enabled=!1;const O=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,o),e.render(t,l),e.setRenderTarget(i,1,o),e.render(t,f),e.setRenderTarget(i,2,o),e.render(t,d),e.setRenderTarget(i,3,o),e.render(t,v),e.setRenderTarget(i,4,o),e.render(t,_),i.texture.generateMipmaps=O,e.setRenderTarget(i,5,o),e.render(t,b),e.setRenderTarget(w,C,R),e.xr.enabled=z,i.texture.needsPMREMUpdate=!0}}class HT extends Qa{constructor(e,t,i,o,l,f,d,v,_,b){e=e!==void 0?e:[],t=t!==void 0?t:Am,super(e,t,i,o,l,f,d,v,_,b),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class JR extends El{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},o=[i,i,i,i,i,i];this.texture=new HT(o,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Sh}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},o=new Nm(5,5,5),l=new Vc({name:"CubemapFromEquirect",uniforms:km(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Ml,blending:fd});l.uniforms.tEquirect.value=t;const f=new Cr(o,l),d=t.minFilter;return t.minFilter===mp&&(t.minFilter=Sh),new ZR(1,10,this).update(e,f),t.minFilter=d,f.geometry.dispose(),f.material.dispose(),this}clear(e,t,i,o){const l=e.getRenderTarget();for(let f=0;f<6;f++)e.setRenderTarget(this,f),e.clear(t,i,o);e.setRenderTarget(l)}}class n_ extends cs{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Pl,this.environmentIntensity=1,this.environmentRotation=new Pl,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const qg=new be,eE=new be;class QR extends cs{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,o=t.length;i<o;i++){const l=t[i];this.addLevel(l.object.clone(),l.distance,l.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const o=this.levels;let l;for(l=0;l<o.length&&!(t<o[l].distance);l++);return o.splice(l,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let i=0;i<t.length;i++)if(t[i].distance===e){const o=t.splice(i,1);return this.remove(o[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,o;for(i=1,o=t.length;i<o;i++){let l=t[i].distance;if(t[i].object.visible&&(l-=l*t[i].hysteresis),e<l)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){qg.setFromMatrixPosition(this.matrixWorld);const o=e.ray.origin.distanceTo(qg);this.getObjectForDistance(o).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){qg.setFromMatrixPosition(e.matrixWorld),eE.setFromMatrixPosition(this.matrixWorld);const i=qg.distanceTo(eE)/e.zoom;t[0].object.visible=!0;let o,l;for(o=1,l=t.length;o<l;o++){let f=t[o].distance;if(t[o].object.visible&&(f-=f*t[o].hysteresis),i>=f)t[o-1].object.visible=!1,t[o].object.visible=!0;else break}for(this._currentLevel=o-1;o<l;o++)t[o].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let o=0,l=i.length;o<l;o++){const f=i[o];t.object.levels.push({object:f.object.uuid,distance:f.distance,hysteresis:f.hysteresis})}return t}}class Vx extends Qa{constructor(e=null,t=1,i=1,o,l,f,d,v,_=ir,b=ir,w,C){super(null,f,d,v,_,b,o,l,w,C),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class $u extends ns{constructor(e,t,i,o=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=o}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const pb=new be,e2=new be,t2=new Dn;class ld{constructor(e=new be(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,o){return this.normal.set(e,t,i),this.constant=o,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const o=pb.subVectors(i,t).cross(e2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(o,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(pb),o=this.normal.dot(i);if(o===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const l=-(e.start.dot(this.normal)+this.constant)/o;return l<0||l>1?null:t.copy(e.start).addScaledVector(i,l)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||t2.getNormalMatrix(e),o=this.coplanarPoint(pb).applyMatrix4(e),l=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(l),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const ep=new Om,$g=new be;class Tw{constructor(e=new ld,t=new ld,i=new ld,o=new ld,l=new ld,f=new ld){this.planes=[e,t,i,o,l,f]}set(e,t,i,o,l,f){const d=this.planes;return d[0].copy(e),d[1].copy(t),d[2].copy(i),d[3].copy(o),d[4].copy(l),d[5].copy(f),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=lf){const i=this.planes,o=e.elements,l=o[0],f=o[1],d=o[2],v=o[3],_=o[4],b=o[5],w=o[6],C=o[7],R=o[8],z=o[9],O=o[10],P=o[11],M=o[12],U=o[13],L=o[14],B=o[15];if(i[0].setComponents(v-l,C-_,P-R,B-M).normalize(),i[1].setComponents(v+l,C+_,P+R,B+M).normalize(),i[2].setComponents(v+f,C+b,P+z,B+U).normalize(),i[3].setComponents(v-f,C-b,P-z,B-U).normalize(),i[4].setComponents(v-d,C-w,P-O,B-L).normalize(),t===lf)i[5].setComponents(v+d,C+w,P+O,B+L).normalize();else if(t===O0)i[5].setComponents(d,w,O,L).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),ep.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),ep.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ep)}intersectsSprite(e){return ep.center.set(0,0,0),ep.radius=.7071067811865476,ep.applyMatrix4(e.matrixWorld),this.intersectsSphere(ep)}intersectsSphere(e){const t=this.planes,i=e.center,o=-e.radius;for(let l=0;l<6;l++)if(t[l].distanceToPoint(i)<o)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const o=t[i];if($g.x=o.normal.x>0?e.max.x:e.min.x,$g.y=o.normal.y>0?e.max.y:e.min.y,$g.z=o.normal.z>0?e.max.z:e.min.z,o.distanceToPoint($g)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class _p extends Ch{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ht(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const B0=new be,z0=new be,tE=new hi,Dv=new bg,Yg=new Om,mb=new be,nE=new be;class n2 extends cs{constructor(e=new is,t=new _p){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let o=1,l=t.count;o<l;o++)B0.fromBufferAttribute(t,o-1),z0.fromBufferAttribute(t,o),i[o]=i[o-1],i[o]+=B0.distanceTo(z0);e.setAttribute("lineDistance",new hr(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,o=this.matrixWorld,l=e.params.Line.threshold,f=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Yg.copy(i.boundingSphere),Yg.applyMatrix4(o),Yg.radius+=l,e.ray.intersectsSphere(Yg)===!1)return;tE.copy(o).invert(),Dv.copy(e.ray).applyMatrix4(tE);const d=l/((this.scale.x+this.scale.y+this.scale.z)/3),v=d*d,_=this.isLineSegments?2:1,b=i.index,C=i.attributes.position;if(b!==null){const R=Math.max(0,f.start),z=Math.min(b.count,f.start+f.count);for(let O=R,P=z-1;O<P;O+=_){const M=b.getX(O),U=b.getX(O+1),L=Kg(this,e,Dv,v,M,U);L&&t.push(L)}if(this.isLineLoop){const O=b.getX(z-1),P=b.getX(R),M=Kg(this,e,Dv,v,O,P);M&&t.push(M)}}else{const R=Math.max(0,f.start),z=Math.min(C.count,f.start+f.count);for(let O=R,P=z-1;O<P;O+=_){const M=Kg(this,e,Dv,v,O,O+1);M&&t.push(M)}if(this.isLineLoop){const O=Kg(this,e,Dv,v,z-1,R);O&&t.push(O)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,f=o.length;l<f;l++){const d=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=l}}}}}function Kg(r,e,t,i,o,l){const f=r.geometry.attributes.position;if(B0.fromBufferAttribute(f,o),z0.fromBufferAttribute(f,l),t.distanceSqToSegment(B0,z0,mb,nE)>i)return;mb.applyMatrix4(r.matrixWorld);const v=e.ray.origin.distanceTo(mb);if(!(v<e.near||v>e.far))return{distance:v,point:nE.clone().applyMatrix4(r.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:r}}const iE=new be,rE=new be;class dg extends n2{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let o=0,l=t.count;o<l;o+=2)iE.fromBufferAttribute(t,o),rE.fromBufferAttribute(t,o+1),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+iE.distanceTo(rE);e.setAttribute("lineDistance",new hr(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class bm extends Ch{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ht(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const sE=new hi,Gx=new bg,Zg=new Om,Jg=new be;class Qv extends cs{constructor(e=new is,t=new bm){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,o=this.matrixWorld,l=e.params.Points.threshold,f=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Zg.copy(i.boundingSphere),Zg.applyMatrix4(o),Zg.radius+=l,e.ray.intersectsSphere(Zg)===!1)return;sE.copy(o).invert(),Gx.copy(e.ray).applyMatrix4(sE);const d=l/((this.scale.x+this.scale.y+this.scale.z)/3),v=d*d,_=i.index,w=i.attributes.position;if(_!==null){const C=Math.max(0,f.start),R=Math.min(_.count,f.start+f.count);for(let z=C,O=R;z<O;z++){const P=_.getX(z);Jg.fromBufferAttribute(w,P),oE(Jg,P,v,o,e,t,this)}}else{const C=Math.max(0,f.start),R=Math.min(w.count,f.start+f.count);for(let z=C,O=R;z<O;z++)Jg.fromBufferAttribute(w,z),oE(Jg,z,v,o,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,f=o.length;l<f;l++){const d=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=l}}}}}function oE(r,e,t,i,o,l,f){const d=Gx.distanceSqToPoint(r);if(d<t){const v=new be;Gx.closestPointToPoint(r,v),v.applyMatrix4(i);const _=o.ray.origin.distanceTo(v);if(_<o.near||_>o.far)return;l.push({distance:_,distanceToRay:Math.sqrt(d),point:v,index:e,face:null,faceIndex:null,barycoord:null,object:f})}}class cu extends cs{constructor(){super(),this.isGroup=!0,this.type="Group"}}class WT extends Qa{constructor(e,t,i,o,l,f,d,v,_,b=Em){if(b!==Em&&b!==Im)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&b===Em&&(i=xp),i===void 0&&b===Im&&(i=Rm),super(null,o,l,f,d,v,b,i,_),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=d!==void 0?d:ir,this.minFilter=v!==void 0?v:ir,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class mf{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,o=this.getPoint(0),l=0;t.push(0);for(let f=1;f<=e;f++)i=this.getPoint(f/e),l+=i.distanceTo(o),t.push(l),o=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let o=0;const l=i.length;let f;t?f=t:f=e*i[l-1];let d=0,v=l-1,_;for(;d<=v;)if(o=Math.floor(d+(v-d)/2),_=i[o]-f,_<0)d=o+1;else if(_>0)v=o-1;else{v=o;break}if(o=v,i[o]===f)return o/(l-1);const b=i[o],C=i[o+1]-b,R=(f-b)/C;return(o+R)/(l-1)}getTangent(e,t){let o=e-1e-4,l=e+1e-4;o<0&&(o=0),l>1&&(l=1);const f=this.getPoint(o),d=this.getPoint(l),v=t||(f.isVector2?new At:new be);return v.copy(d).sub(f).normalize(),v}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new be,o=[],l=[],f=[],d=new be,v=new hi;for(let R=0;R<=e;R++){const z=R/e;o[R]=this.getTangentAt(z,new be)}l[0]=new be,f[0]=new be;let _=Number.MAX_VALUE;const b=Math.abs(o[0].x),w=Math.abs(o[0].y),C=Math.abs(o[0].z);b<=_&&(_=b,i.set(1,0,0)),w<=_&&(_=w,i.set(0,1,0)),C<=_&&i.set(0,0,1),d.crossVectors(o[0],i).normalize(),l[0].crossVectors(o[0],d),f[0].crossVectors(o[0],l[0]);for(let R=1;R<=e;R++){if(l[R]=l[R-1].clone(),f[R]=f[R-1].clone(),d.crossVectors(o[R-1],o[R]),d.length()>Number.EPSILON){d.normalize();const z=Math.acos(zn(o[R-1].dot(o[R]),-1,1));l[R].applyMatrix4(v.makeRotationAxis(d,z))}f[R].crossVectors(o[R],l[R])}if(t===!0){let R=Math.acos(zn(l[0].dot(l[e]),-1,1));R/=e,o[0].dot(d.crossVectors(l[0],l[e]))>0&&(R=-R);for(let z=1;z<=e;z++)l[z].applyMatrix4(v.makeRotationAxis(o[z],R*z)),f[z].crossVectors(o[z],l[z])}return{tangents:o,normals:l,binormals:f}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class jT extends mf{constructor(e=0,t=0,i=1,o=1,l=0,f=Math.PI*2,d=!1,v=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=o,this.aStartAngle=l,this.aEndAngle=f,this.aClockwise=d,this.aRotation=v}getPoint(e,t=new At){const i=t,o=Math.PI*2;let l=this.aEndAngle-this.aStartAngle;const f=Math.abs(l)<Number.EPSILON;for(;l<0;)l+=o;for(;l>o;)l-=o;l<Number.EPSILON&&(f?l=0:l=o),this.aClockwise===!0&&!f&&(l===o?l=-o:l=l-o);const d=this.aStartAngle+e*l;let v=this.aX+this.xRadius*Math.cos(d),_=this.aY+this.yRadius*Math.sin(d);if(this.aRotation!==0){const b=Math.cos(this.aRotation),w=Math.sin(this.aRotation),C=v-this.aX,R=_-this.aY;v=C*b-R*w+this.aX,_=C*w+R*b+this.aY}return i.set(v,_)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class i2 extends jT{constructor(e,t,i,o,l,f){super(e,t,i,i,o,l,f),this.isArcCurve=!0,this.type="ArcCurve"}}function Mw(){let r=0,e=0,t=0,i=0;function o(l,f,d,v){r=l,e=d,t=-3*l+3*f-2*d-v,i=2*l-2*f+d+v}return{initCatmullRom:function(l,f,d,v,_){o(f,d,_*(d-l),_*(v-f))},initNonuniformCatmullRom:function(l,f,d,v,_,b,w){let C=(f-l)/_-(d-l)/(_+b)+(d-f)/b,R=(d-f)/b-(v-f)/(b+w)+(v-d)/w;C*=b,R*=b,o(f,d,C,R)},calc:function(l){const f=l*l,d=f*l;return r+e*l+t*f+i*d}}}const Qg=new be,vb=new Mw,gb=new Mw,_b=new Mw;class XT extends mf{constructor(e=[],t=!1,i="centripetal",o=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=o}getPoint(e,t=new be){const i=t,o=this.points,l=o.length,f=(l-(this.closed?0:1))*e;let d=Math.floor(f),v=f-d;this.closed?d+=d>0?0:(Math.floor(Math.abs(d)/l)+1)*l:v===0&&d===l-1&&(d=l-2,v=1);let _,b;this.closed||d>0?_=o[(d-1)%l]:(Qg.subVectors(o[0],o[1]).add(o[0]),_=Qg);const w=o[d%l],C=o[(d+1)%l];if(this.closed||d+2<l?b=o[(d+2)%l]:(Qg.subVectors(o[l-1],o[l-2]).add(o[l-1]),b=Qg),this.curveType==="centripetal"||this.curveType==="chordal"){const R=this.curveType==="chordal"?.5:.25;let z=Math.pow(_.distanceToSquared(w),R),O=Math.pow(w.distanceToSquared(C),R),P=Math.pow(C.distanceToSquared(b),R);O<1e-4&&(O=1),z<1e-4&&(z=O),P<1e-4&&(P=O),vb.initNonuniformCatmullRom(_.x,w.x,C.x,b.x,z,O,P),gb.initNonuniformCatmullRom(_.y,w.y,C.y,b.y,z,O,P),_b.initNonuniformCatmullRom(_.z,w.z,C.z,b.z,z,O,P)}else this.curveType==="catmullrom"&&(vb.initCatmullRom(_.x,w.x,C.x,b.x,this.tension),gb.initCatmullRom(_.y,w.y,C.y,b.y,this.tension),_b.initCatmullRom(_.z,w.z,C.z,b.z,this.tension));return i.set(vb.calc(v),gb.calc(v),_b.calc(v)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const o=e.points[t];this.points.push(o.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const o=this.points[t];e.points.push(o.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const o=e.points[t];this.points.push(new be().fromArray(o))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function aE(r,e,t,i,o){const l=(i-e)*.5,f=(o-t)*.5,d=r*r,v=r*d;return(2*t-2*i+l+f)*v+(-3*t+3*i-2*l-f)*d+l*r+t}function r2(r,e){const t=1-r;return t*t*e}function s2(r,e){return 2*(1-r)*r*e}function o2(r,e){return r*r*e}function eg(r,e,t,i){return r2(r,e)+s2(r,t)+o2(r,i)}function a2(r,e){const t=1-r;return t*t*t*e}function l2(r,e){const t=1-r;return 3*t*t*r*e}function u2(r,e){return 3*(1-r)*r*r*e}function c2(r,e){return r*r*r*e}function tg(r,e,t,i,o){return a2(r,e)+l2(r,t)+u2(r,i)+c2(r,o)}class h2 extends mf{constructor(e=new At,t=new At,i=new At,o=new At){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=o}getPoint(e,t=new At){const i=t,o=this.v0,l=this.v1,f=this.v2,d=this.v3;return i.set(tg(e,o.x,l.x,f.x,d.x),tg(e,o.y,l.y,f.y,d.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class f2 extends mf{constructor(e=new be,t=new be,i=new be,o=new be){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=o}getPoint(e,t=new be){const i=t,o=this.v0,l=this.v1,f=this.v2,d=this.v3;return i.set(tg(e,o.x,l.x,f.x,d.x),tg(e,o.y,l.y,f.y,d.y),tg(e,o.z,l.z,f.z,d.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class d2 extends mf{constructor(e=new At,t=new At){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new At){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new At){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class p2 extends mf{constructor(e=new be,t=new be){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new be){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new be){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class m2 extends mf{constructor(e=new At,t=new At,i=new At){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new At){const i=t,o=this.v0,l=this.v1,f=this.v2;return i.set(eg(e,o.x,l.x,f.x),eg(e,o.y,l.y,f.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class qT extends mf{constructor(e=new be,t=new be,i=new be){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new be){const i=t,o=this.v0,l=this.v1,f=this.v2;return i.set(eg(e,o.x,l.x,f.x),eg(e,o.y,l.y,f.y),eg(e,o.z,l.z,f.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class v2 extends mf{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new At){const i=t,o=this.points,l=(o.length-1)*e,f=Math.floor(l),d=l-f,v=o[f===0?f:f-1],_=o[f],b=o[f>o.length-2?o.length-1:f+1],w=o[f>o.length-3?o.length-1:f+2];return i.set(aE(d,v.x,_.x,b.x,w.x),aE(d,v.y,_.y,b.y,w.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const o=e.points[t];this.points.push(o.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const o=this.points[t];e.points.push(o.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const o=e.points[t];this.points.push(new At().fromArray(o))}return this}}var g2=Object.freeze({__proto__:null,ArcCurve:i2,CatmullRomCurve3:XT,CubicBezierCurve:h2,CubicBezierCurve3:f2,EllipseCurve:jT,LineCurve:d2,LineCurve3:p2,QuadraticBezierCurve:m2,QuadraticBezierCurve3:qT,SplineCurve:v2});class Aw extends is{constructor(e=1,t=1,i=1,o=32,l=1,f=!1,d=0,v=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:o,heightSegments:l,openEnded:f,thetaStart:d,thetaLength:v};const _=this;o=Math.floor(o),l=Math.floor(l);const b=[],w=[],C=[],R=[];let z=0;const O=[],P=i/2;let M=0;U(),f===!1&&(e>0&&L(!0),t>0&&L(!1)),this.setIndex(b),this.setAttribute("position",new hr(w,3)),this.setAttribute("normal",new hr(C,3)),this.setAttribute("uv",new hr(R,2));function U(){const B=new be,$=new be;let X=0;const Q=(t-e)/i;for(let te=0;te<=l;te++){const V=[],H=te/l,J=H*(t-e)+e;for(let ce=0;ce<=o;ce++){const he=ce/o,ge=he*v+d,Ae=Math.sin(ge),me=Math.cos(ge);$.x=J*Ae,$.y=-H*i+P,$.z=J*me,w.push($.x,$.y,$.z),B.set(Ae,Q,me).normalize(),C.push(B.x,B.y,B.z),R.push(he,1-H),V.push(z++)}O.push(V)}for(let te=0;te<o;te++)for(let V=0;V<l;V++){const H=O[V][te],J=O[V+1][te],ce=O[V+1][te+1],he=O[V][te+1];(e>0||V!==0)&&(b.push(H,J,he),X+=3),(t>0||V!==l-1)&&(b.push(J,ce,he),X+=3)}_.addGroup(M,X,0),M+=X}function L(B){const $=z,X=new At,Q=new be;let te=0;const V=B===!0?e:t,H=B===!0?1:-1;for(let ce=1;ce<=o;ce++)w.push(0,P*H,0),C.push(0,H,0),R.push(.5,.5),z++;const J=z;for(let ce=0;ce<=o;ce++){const ge=ce/o*v+d,Ae=Math.cos(ge),me=Math.sin(ge);Q.x=V*me,Q.y=P*H,Q.z=V*Ae,w.push(Q.x,Q.y,Q.z),C.push(0,H,0),X.x=Ae*.5+.5,X.y=me*.5*H+.5,R.push(X.x,X.y),z++}for(let ce=0;ce<o;ce++){const he=$+ce,ge=J+ce;B===!0?b.push(ge,ge+1,he):b.push(ge+1,ge,he),te+=3}_.addGroup(M,te,B===!0?1:2),M+=te}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Aw(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Um extends is{constructor(e=1,t=1,i=1,o=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:o};const l=e/2,f=t/2,d=Math.floor(i),v=Math.floor(o),_=d+1,b=v+1,w=e/d,C=t/v,R=[],z=[],O=[],P=[];for(let M=0;M<b;M++){const U=M*C-f;for(let L=0;L<_;L++){const B=L*w-l;z.push(B,-U,0),O.push(0,0,1),P.push(L/d),P.push(1-M/v)}}for(let M=0;M<v;M++)for(let U=0;U<d;U++){const L=U+_*M,B=U+_*(M+1),$=U+1+_*(M+1),X=U+1+_*M;R.push(L,B,X),R.push(B,$,X)}this.setIndex(R),this.setAttribute("position",new hr(z,3)),this.setAttribute("normal",new hr(O,3)),this.setAttribute("uv",new hr(P,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Um(e.width,e.height,e.widthSegments,e.heightSegments)}}class Pw extends is{constructor(e=1,t=32,i=16,o=0,l=Math.PI*2,f=0,d=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:o,phiLength:l,thetaStart:f,thetaLength:d},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const v=Math.min(f+d,Math.PI);let _=0;const b=[],w=new be,C=new be,R=[],z=[],O=[],P=[];for(let M=0;M<=i;M++){const U=[],L=M/i;let B=0;M===0&&f===0?B=.5/t:M===i&&v===Math.PI&&(B=-.5/t);for(let $=0;$<=t;$++){const X=$/t;w.x=-e*Math.cos(o+X*l)*Math.sin(f+L*d),w.y=e*Math.cos(f+L*d),w.z=e*Math.sin(o+X*l)*Math.sin(f+L*d),z.push(w.x,w.y,w.z),C.copy(w).normalize(),O.push(C.x,C.y,C.z),P.push(X+B,1-L),U.push(_++)}b.push(U)}for(let M=0;M<i;M++)for(let U=0;U<t;U++){const L=b[M][U+1],B=b[M][U],$=b[M+1][U],X=b[M+1][U+1];(M!==0||f>0)&&R.push(L,B,X),(M!==i-1||v<Math.PI)&&R.push(B,$,X)}this.setIndex(R),this.setAttribute("position",new hr(z,3)),this.setAttribute("normal",new hr(O,3)),this.setAttribute("uv",new hr(P,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pw(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Rw extends is{constructor(e=new qT(new be(-1,-1,0),new be(-1,1,0),new be(1,1,0)),t=64,i=1,o=8,l=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:o,closed:l};const f=e.computeFrenetFrames(t,l);this.tangents=f.tangents,this.normals=f.normals,this.binormals=f.binormals;const d=new be,v=new be,_=new At;let b=new be;const w=[],C=[],R=[],z=[];O(),this.setIndex(z),this.setAttribute("position",new hr(w,3)),this.setAttribute("normal",new hr(C,3)),this.setAttribute("uv",new hr(R,2));function O(){for(let L=0;L<t;L++)P(L);P(l===!1?t:0),U(),M()}function P(L){b=e.getPointAt(L/t,b);const B=f.normals[L],$=f.binormals[L];for(let X=0;X<=o;X++){const Q=X/o*Math.PI*2,te=Math.sin(Q),V=-Math.cos(Q);v.x=V*B.x+te*$.x,v.y=V*B.y+te*$.y,v.z=V*B.z+te*$.z,v.normalize(),C.push(v.x,v.y,v.z),d.x=b.x+i*v.x,d.y=b.y+i*v.y,d.z=b.z+i*v.z,w.push(d.x,d.y,d.z)}}function M(){for(let L=1;L<=t;L++)for(let B=1;B<=o;B++){const $=(o+1)*(L-1)+(B-1),X=(o+1)*L+(B-1),Q=(o+1)*L+B,te=(o+1)*(L-1)+B;z.push($,X,te),z.push(X,Q,te)}}function U(){for(let L=0;L<=t;L++)for(let B=0;B<=o;B++)_.x=L/t,_.y=B/o,R.push(_.x,_.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Rw(new g2[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class i_ extends Vc{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class _2 extends Ch{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ht(16777215),this.specular=new Ht(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ht(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ew,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Pl,this.combine=e_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class y2 extends Ch{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ht(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ht(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ew,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Pl,this.combine=e_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class b2 extends Ch{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=mR,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class x2 extends Ch{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const lE={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class w2{constructor(e,t,i){const o=this;let l=!1,f=0,d=0,v;const _=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(b){d++,l===!1&&o.onStart!==void 0&&o.onStart(b,f,d),l=!0},this.itemEnd=function(b){f++,o.onProgress!==void 0&&o.onProgress(b,f,d),f===d&&(l=!1,o.onLoad!==void 0&&o.onLoad())},this.itemError=function(b){o.onError!==void 0&&o.onError(b)},this.resolveURL=function(b){return v?v(b):b},this.setURLModifier=function(b){return v=b,this},this.addHandler=function(b,w){return _.push(b,w),this},this.removeHandler=function(b){const w=_.indexOf(b);return w!==-1&&_.splice(w,2),this},this.getHandler=function(b){for(let w=0,C=_.length;w<C;w+=2){const R=_[w],z=_[w+1];if(R.global&&(R.lastIndex=0),R.test(b))return z}return null}}}const S2=new w2;class Iw{constructor(e){this.manager=e!==void 0?e:S2,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(o,l){i.load(e,o,t,l)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Iw.DEFAULT_MATERIAL_NAME="__DEFAULT";const rf={};class E2 extends Error{constructor(e,t){super(e),this.response=t}}class C2 extends Iw{constructor(e){super(e)}load(e,t,i,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const l=lE.get(e);if(l!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(l),this.manager.itemEnd(e)},0),l;if(rf[e]!==void 0){rf[e].push({onLoad:t,onProgress:i,onError:o});return}rf[e]=[],rf[e].push({onLoad:t,onProgress:i,onError:o});const f=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),d=this.mimeType,v=this.responseType;fetch(f).then(_=>{if(_.status===200||_.status===0){if(_.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||_.body===void 0||_.body.getReader===void 0)return _;const b=rf[e],w=_.body.getReader(),C=_.headers.get("X-File-Size")||_.headers.get("Content-Length"),R=C?parseInt(C):0,z=R!==0;let O=0;const P=new ReadableStream({start(M){U();function U(){w.read().then(({done:L,value:B})=>{if(L)M.close();else{O+=B.byteLength;const $=new ProgressEvent("progress",{lengthComputable:z,loaded:O,total:R});for(let X=0,Q=b.length;X<Q;X++){const te=b[X];te.onProgress&&te.onProgress($)}M.enqueue(B),U()}},L=>{M.error(L)})}}});return new Response(P)}else throw new E2(`fetch for "${_.url}" responded with ${_.status}: ${_.statusText}`,_)}).then(_=>{switch(v){case"arraybuffer":return _.arrayBuffer();case"blob":return _.blob();case"document":return _.text().then(b=>new DOMParser().parseFromString(b,d));case"json":return _.json();default:if(d===void 0)return _.text();{const w=/charset="?([^;"\s]*)"?/i.exec(d),C=w&&w[1]?w[1].toLowerCase():void 0,R=new TextDecoder(C);return _.arrayBuffer().then(z=>R.decode(z))}}}).then(_=>{lE.add(e,_);const b=rf[e];delete rf[e];for(let w=0,C=b.length;w<C;w++){const R=b[w];R.onLoad&&R.onLoad(_)}}).catch(_=>{const b=rf[e];if(b===void 0)throw this.manager.itemError(e),_;delete rf[e];for(let w=0,C=b.length;w<C;w++){const R=b[w];R.onError&&R.onError(_)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class $T extends cs{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ht(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class T2 extends $T{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(cs.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ht(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const yb=new hi,uE=new be,cE=new be;class M2{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new At(512,512),this.map=null,this.mapPass=null,this.matrix=new hi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Tw,this._frameExtents=new At(1,1),this._viewportCount=1,this._viewports=[new Xi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;uE.setFromMatrixPosition(e.matrixWorld),t.position.copy(uE),cE.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(cE),t.updateMatrixWorld(),yb.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yb),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(yb)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class xg extends GT{constructor(e=-1,t=1,i=1,o=-1,l=.1,f=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=o,this.near=l,this.far=f,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,o,l,f){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=o,this.view.width=l,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let l=i-e,f=i+e,d=o+t,v=o-t;if(this.view!==null&&this.view.enabled){const _=(this.right-this.left)/this.view.fullWidth/this.zoom,b=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l+=_*this.view.offsetX,f=l+_*this.view.width,d-=b*this.view.offsetY,v=d-b*this.view.height}this.projectionMatrix.makeOrthographic(l,f,d,v,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class A2 extends M2{constructor(){super(new xg(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class P2 extends $T{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(cs.DEFAULT_UP),this.updateMatrix(),this.target=new cs,this.shadow=new A2}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class V0 extends is{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class R2 extends qu{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}const hE=new hi;class I2{constructor(e,t,i=0,o=1/0){this.ray=new bg(e,t),this.near=i,this.far=o,this.camera=null,this.layers=new Cw,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return hE.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(hE),this}intersectObject(e,t=!0,i=[]){return Hx(e,this,i,t),i.sort(fE),i}intersectObjects(e,t=!0,i=[]){for(let o=0,l=e.length;o<l;o++)Hx(e[o],this,i,t);return i.sort(fE),i}}function fE(r,e){return r.distance-e.distance}function Hx(r,e,t,i){let o=!0;if(r.layers.test(e.layers)&&r.raycast(e,t)===!1&&(o=!1),o===!0&&i===!0){const l=r.children;for(let f=0,d=l.length;f<d;f++)Hx(l[f],e,t,!0)}}class Wx{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=zn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(zn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class D2 extends dg{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],l=new is;l.setIndex(new ns(i,1)),l.setAttribute("position",new hr(o,3)),super(l,new _p({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class L2 extends Sp{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function dE(r,e,t,i){const o=k2(i);switch(t){case MT:return r*e;case PT:return r*e;case RT:return r*e*2;case IT:return r*e/o.components*o.byteLength;case xw:return r*e/o.components*o.byteLength;case DT:return r*e*2/o.components*o.byteLength;case ww:return r*e*2/o.components*o.byteLength;case AT:return r*e*3/o.components*o.byteLength;case Is:return r*e*4/o.components*o.byteLength;case Sw:return r*e*4/o.components*o.byteLength;case d0:case p0:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case m0:case v0:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case mx:case gx:return Math.max(r,16)*Math.max(e,8)/4;case px:case vx:return Math.max(r,8)*Math.max(e,8)/2;case _x:case yx:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case bx:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case xx:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case wx:return Math.floor((r+4)/5)*Math.floor((e+3)/4)*16;case Sx:return Math.floor((r+4)/5)*Math.floor((e+4)/5)*16;case Ex:return Math.floor((r+5)/6)*Math.floor((e+4)/5)*16;case Cx:return Math.floor((r+5)/6)*Math.floor((e+5)/6)*16;case Tx:return Math.floor((r+7)/8)*Math.floor((e+4)/5)*16;case Mx:return Math.floor((r+7)/8)*Math.floor((e+5)/6)*16;case Ax:return Math.floor((r+7)/8)*Math.floor((e+7)/8)*16;case Px:return Math.floor((r+9)/10)*Math.floor((e+4)/5)*16;case Rx:return Math.floor((r+9)/10)*Math.floor((e+5)/6)*16;case Ix:return Math.floor((r+9)/10)*Math.floor((e+7)/8)*16;case Dx:return Math.floor((r+9)/10)*Math.floor((e+9)/10)*16;case Lx:return Math.floor((r+11)/12)*Math.floor((e+9)/10)*16;case kx:return Math.floor((r+11)/12)*Math.floor((e+11)/12)*16;case g0:case Fx:case Ox:return Math.ceil(r/4)*Math.ceil(e/4)*16;case LT:case Nx:return Math.ceil(r/4)*Math.ceil(e/4)*8;case Ux:case Bx:return Math.ceil(r/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function k2(r){switch(r){case df:case ET:return{byteLength:1,components:1};case fg:case CT:case _g:return{byteLength:2,components:1};case yw:case bw:return{byteLength:2,components:4};case xp:case _w:case fo:return{byteLength:4,components:1};case TT:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:gw}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=gw);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function YT(){let r=null,e=!1,t=null,i=null;function o(l,f){t(l,f),i=r.requestAnimationFrame(o)}return{start:function(){e!==!0&&t!==null&&(i=r.requestAnimationFrame(o),e=!0)},stop:function(){r.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(l){t=l},setContext:function(l){r=l}}}function F2(r){const e=new WeakMap;function t(d,v){const _=d.array,b=d.usage,w=_.byteLength,C=r.createBuffer();r.bindBuffer(v,C),r.bufferData(v,_,b),d.onUploadCallback();let R;if(_ instanceof Float32Array)R=r.FLOAT;else if(_ instanceof Uint16Array)d.isFloat16BufferAttribute?R=r.HALF_FLOAT:R=r.UNSIGNED_SHORT;else if(_ instanceof Int16Array)R=r.SHORT;else if(_ instanceof Uint32Array)R=r.UNSIGNED_INT;else if(_ instanceof Int32Array)R=r.INT;else if(_ instanceof Int8Array)R=r.BYTE;else if(_ instanceof Uint8Array)R=r.UNSIGNED_BYTE;else if(_ instanceof Uint8ClampedArray)R=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+_);return{buffer:C,type:R,bytesPerElement:_.BYTES_PER_ELEMENT,version:d.version,size:w}}function i(d,v,_){const b=v.array,w=v.updateRanges;if(r.bindBuffer(_,d),w.length===0)r.bufferSubData(_,0,b);else{w.sort((R,z)=>R.start-z.start);let C=0;for(let R=1;R<w.length;R++){const z=w[C],O=w[R];O.start<=z.start+z.count+1?z.count=Math.max(z.count,O.start+O.count-z.start):(++C,w[C]=O)}w.length=C+1;for(let R=0,z=w.length;R<z;R++){const O=w[R];r.bufferSubData(_,O.start*b.BYTES_PER_ELEMENT,b,O.start,O.count)}v.clearUpdateRanges()}v.onUploadCallback()}function o(d){return d.isInterleavedBufferAttribute&&(d=d.data),e.get(d)}function l(d){d.isInterleavedBufferAttribute&&(d=d.data);const v=e.get(d);v&&(r.deleteBuffer(v.buffer),e.delete(d))}function f(d,v){if(d.isInterleavedBufferAttribute&&(d=d.data),d.isGLBufferAttribute){const b=e.get(d);(!b||b.version<d.version)&&e.set(d,{buffer:d.buffer,type:d.type,bytesPerElement:d.elementSize,version:d.version});return}const _=e.get(d);if(_===void 0)e.set(d,t(d,v));else if(_.version<d.version){if(_.size!==d.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(_.buffer,d,v),_.version=d.version}}return{get:o,remove:l,update:f}}var O2=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,N2=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,U2=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,B2=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,z2=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,V2=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,G2=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,H2=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,W2=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,j2=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,X2=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,q2=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,$2=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Y2=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,K2=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Z2=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,J2=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Q2=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,eI=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,tI=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,nI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,iI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,rI=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,sI=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,oI=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,aI=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,lI=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,uI=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,cI=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,hI=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,fI="gl_FragColor = linearToOutputTexel( gl_FragColor );",dI=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,pI=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,mI=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,vI=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,gI=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,_I=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,yI=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,bI=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,xI=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,wI=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,SI=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,EI=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,CI=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,TI=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,MI=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,AI=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,PI=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,RI=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,II=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,DI=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,LI=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,kI=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,FI=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,OI=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,NI=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,UI=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,BI=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,zI=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,VI=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,GI=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,HI=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,WI=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,jI=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,XI=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,qI=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,$I=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,YI=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,KI=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,ZI=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,JI=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,QI=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,eD=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,tD=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,nD=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,iD=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,rD=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,sD=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,oD=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,aD=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,lD=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,uD=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,cD=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,hD=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,fD=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dD=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,pD=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,mD=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,vD=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,gD=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,_D=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,yD=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,bD=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,xD=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,wD=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,SD=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,ED=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,CD=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,TD=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,MD=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,AD=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,PD=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,RD=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,ID=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,DD=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,LD=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,kD=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const FD=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,OD=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ND=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,UD=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,BD=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,zD=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,VD=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,GD=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,HD=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,WD=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,jD=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,XD=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,qD=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,$D=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,YD=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,KD=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ZD=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,JD=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QD=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,eL=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tL=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,nL=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,iL=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,rL=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,sL=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,oL=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,aL=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lL=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uL=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,cL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,hL=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fL=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,dL=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,pL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Un={alphahash_fragment:O2,alphahash_pars_fragment:N2,alphamap_fragment:U2,alphamap_pars_fragment:B2,alphatest_fragment:z2,alphatest_pars_fragment:V2,aomap_fragment:G2,aomap_pars_fragment:H2,batching_pars_vertex:W2,batching_vertex:j2,begin_vertex:X2,beginnormal_vertex:q2,bsdfs:$2,iridescence_fragment:Y2,bumpmap_pars_fragment:K2,clipping_planes_fragment:Z2,clipping_planes_pars_fragment:J2,clipping_planes_pars_vertex:Q2,clipping_planes_vertex:eI,color_fragment:tI,color_pars_fragment:nI,color_pars_vertex:iI,color_vertex:rI,common:sI,cube_uv_reflection_fragment:oI,defaultnormal_vertex:aI,displacementmap_pars_vertex:lI,displacementmap_vertex:uI,emissivemap_fragment:cI,emissivemap_pars_fragment:hI,colorspace_fragment:fI,colorspace_pars_fragment:dI,envmap_fragment:pI,envmap_common_pars_fragment:mI,envmap_pars_fragment:vI,envmap_pars_vertex:gI,envmap_physical_pars_fragment:AI,envmap_vertex:_I,fog_vertex:yI,fog_pars_vertex:bI,fog_fragment:xI,fog_pars_fragment:wI,gradientmap_pars_fragment:SI,lightmap_pars_fragment:EI,lights_lambert_fragment:CI,lights_lambert_pars_fragment:TI,lights_pars_begin:MI,lights_toon_fragment:PI,lights_toon_pars_fragment:RI,lights_phong_fragment:II,lights_phong_pars_fragment:DI,lights_physical_fragment:LI,lights_physical_pars_fragment:kI,lights_fragment_begin:FI,lights_fragment_maps:OI,lights_fragment_end:NI,logdepthbuf_fragment:UI,logdepthbuf_pars_fragment:BI,logdepthbuf_pars_vertex:zI,logdepthbuf_vertex:VI,map_fragment:GI,map_pars_fragment:HI,map_particle_fragment:WI,map_particle_pars_fragment:jI,metalnessmap_fragment:XI,metalnessmap_pars_fragment:qI,morphinstance_vertex:$I,morphcolor_vertex:YI,morphnormal_vertex:KI,morphtarget_pars_vertex:ZI,morphtarget_vertex:JI,normal_fragment_begin:QI,normal_fragment_maps:eD,normal_pars_fragment:tD,normal_pars_vertex:nD,normal_vertex:iD,normalmap_pars_fragment:rD,clearcoat_normal_fragment_begin:sD,clearcoat_normal_fragment_maps:oD,clearcoat_pars_fragment:aD,iridescence_pars_fragment:lD,opaque_fragment:uD,packing:cD,premultiplied_alpha_fragment:hD,project_vertex:fD,dithering_fragment:dD,dithering_pars_fragment:pD,roughnessmap_fragment:mD,roughnessmap_pars_fragment:vD,shadowmap_pars_fragment:gD,shadowmap_pars_vertex:_D,shadowmap_vertex:yD,shadowmask_pars_fragment:bD,skinbase_vertex:xD,skinning_pars_vertex:wD,skinning_vertex:SD,skinnormal_vertex:ED,specularmap_fragment:CD,specularmap_pars_fragment:TD,tonemapping_fragment:MD,tonemapping_pars_fragment:AD,transmission_fragment:PD,transmission_pars_fragment:RD,uv_pars_fragment:ID,uv_pars_vertex:DD,uv_vertex:LD,worldpos_vertex:kD,background_vert:FD,background_frag:OD,backgroundCube_vert:ND,backgroundCube_frag:UD,cube_vert:BD,cube_frag:zD,depth_vert:VD,depth_frag:GD,distanceRGBA_vert:HD,distanceRGBA_frag:WD,equirect_vert:jD,equirect_frag:XD,linedashed_vert:qD,linedashed_frag:$D,meshbasic_vert:YD,meshbasic_frag:KD,meshlambert_vert:ZD,meshlambert_frag:JD,meshmatcap_vert:QD,meshmatcap_frag:eL,meshnormal_vert:tL,meshnormal_frag:nL,meshphong_vert:iL,meshphong_frag:rL,meshphysical_vert:sL,meshphysical_frag:oL,meshtoon_vert:aL,meshtoon_frag:lL,points_vert:uL,points_frag:cL,shadow_vert:hL,shadow_frag:fL,sprite_vert:dL,sprite_frag:pL},kt={common:{diffuse:{value:new Ht(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Dn},alphaMap:{value:null},alphaMapTransform:{value:new Dn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Dn}},envmap:{envMap:{value:null},envMapRotation:{value:new Dn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Dn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Dn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Dn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Dn},normalScale:{value:new At(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Dn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Dn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Dn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Dn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ht(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ht(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Dn},alphaTest:{value:0},uvTransform:{value:new Dn}},sprite:{diffuse:{value:new Ht(16777215)},opacity:{value:1},center:{value:new At(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Dn},alphaMap:{value:null},alphaMapTransform:{value:new Dn},alphaTest:{value:0}}},bh={basic:{uniforms:Ya([kt.common,kt.specularmap,kt.envmap,kt.aomap,kt.lightmap,kt.fog]),vertexShader:Un.meshbasic_vert,fragmentShader:Un.meshbasic_frag},lambert:{uniforms:Ya([kt.common,kt.specularmap,kt.envmap,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.fog,kt.lights,{emissive:{value:new Ht(0)}}]),vertexShader:Un.meshlambert_vert,fragmentShader:Un.meshlambert_frag},phong:{uniforms:Ya([kt.common,kt.specularmap,kt.envmap,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.fog,kt.lights,{emissive:{value:new Ht(0)},specular:{value:new Ht(1118481)},shininess:{value:30}}]),vertexShader:Un.meshphong_vert,fragmentShader:Un.meshphong_frag},standard:{uniforms:Ya([kt.common,kt.envmap,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.roughnessmap,kt.metalnessmap,kt.fog,kt.lights,{emissive:{value:new Ht(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Un.meshphysical_vert,fragmentShader:Un.meshphysical_frag},toon:{uniforms:Ya([kt.common,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.gradientmap,kt.fog,kt.lights,{emissive:{value:new Ht(0)}}]),vertexShader:Un.meshtoon_vert,fragmentShader:Un.meshtoon_frag},matcap:{uniforms:Ya([kt.common,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.fog,{matcap:{value:null}}]),vertexShader:Un.meshmatcap_vert,fragmentShader:Un.meshmatcap_frag},points:{uniforms:Ya([kt.points,kt.fog]),vertexShader:Un.points_vert,fragmentShader:Un.points_frag},dashed:{uniforms:Ya([kt.common,kt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Un.linedashed_vert,fragmentShader:Un.linedashed_frag},depth:{uniforms:Ya([kt.common,kt.displacementmap]),vertexShader:Un.depth_vert,fragmentShader:Un.depth_frag},normal:{uniforms:Ya([kt.common,kt.bumpmap,kt.normalmap,kt.displacementmap,{opacity:{value:1}}]),vertexShader:Un.meshnormal_vert,fragmentShader:Un.meshnormal_frag},sprite:{uniforms:Ya([kt.sprite,kt.fog]),vertexShader:Un.sprite_vert,fragmentShader:Un.sprite_frag},background:{uniforms:{uvTransform:{value:new Dn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Un.background_vert,fragmentShader:Un.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Dn}},vertexShader:Un.backgroundCube_vert,fragmentShader:Un.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Un.cube_vert,fragmentShader:Un.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Un.equirect_vert,fragmentShader:Un.equirect_frag},distanceRGBA:{uniforms:Ya([kt.common,kt.displacementmap,{referencePosition:{value:new be},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Un.distanceRGBA_vert,fragmentShader:Un.distanceRGBA_frag},shadow:{uniforms:Ya([kt.lights,kt.fog,{color:{value:new Ht(0)},opacity:{value:1}}]),vertexShader:Un.shadow_vert,fragmentShader:Un.shadow_frag}};bh.physical={uniforms:Ya([bh.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Dn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Dn},clearcoatNormalScale:{value:new At(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Dn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Dn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Dn},sheen:{value:0},sheenColor:{value:new Ht(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Dn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Dn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Dn},transmissionSamplerSize:{value:new At},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Dn},attenuationDistance:{value:0},attenuationColor:{value:new Ht(0)},specularColor:{value:new Ht(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Dn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Dn},anisotropyVector:{value:new At},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Dn}}]),vertexShader:Un.meshphysical_vert,fragmentShader:Un.meshphysical_frag};const e0={r:0,b:0,g:0},tp=new Pl,mL=new hi;function vL(r,e,t,i,o,l,f){const d=new Ht(0);let v=l===!0?0:1,_,b,w=null,C=0,R=null;function z(L){let B=L.isScene===!0?L.background:null;return B&&B.isTexture&&(B=(L.backgroundBlurriness>0?t:e).get(B)),B}function O(L){let B=!1;const $=z(L);$===null?M(d,v):$&&$.isColor&&(M($,1),B=!0);const X=r.xr.getEnvironmentBlendMode();X==="additive"?i.buffers.color.setClear(0,0,0,1,f):X==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,f),(r.autoClear||B)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function P(L,B){const $=z(B);$&&($.isCubeTexture||$.mapping===t_)?(b===void 0&&(b=new Cr(new Nm(1,1,1),new Vc({name:"BackgroundCubeMaterial",uniforms:km(bh.backgroundCube.uniforms),vertexShader:bh.backgroundCube.vertexShader,fragmentShader:bh.backgroundCube.fragmentShader,side:Ml,depthTest:!1,depthWrite:!1,fog:!1})),b.geometry.deleteAttribute("normal"),b.geometry.deleteAttribute("uv"),b.onBeforeRender=function(X,Q,te){this.matrixWorld.copyPosition(te.matrixWorld)},Object.defineProperty(b.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(b)),tp.copy(B.backgroundRotation),tp.x*=-1,tp.y*=-1,tp.z*=-1,$.isCubeTexture&&$.isRenderTargetTexture===!1&&(tp.y*=-1,tp.z*=-1),b.material.uniforms.envMap.value=$,b.material.uniforms.flipEnvMap.value=$.isCubeTexture&&$.isRenderTargetTexture===!1?-1:1,b.material.uniforms.backgroundBlurriness.value=B.backgroundBlurriness,b.material.uniforms.backgroundIntensity.value=B.backgroundIntensity,b.material.uniforms.backgroundRotation.value.setFromMatrix4(mL.makeRotationFromEuler(tp)),b.material.toneMapped=Ci.getTransfer($.colorSpace)!==Yi,(w!==$||C!==$.version||R!==r.toneMapping)&&(b.material.needsUpdate=!0,w=$,C=$.version,R=r.toneMapping),b.layers.enableAll(),L.unshift(b,b.geometry,b.material,0,0,null)):$&&$.isTexture&&(_===void 0&&(_=new Cr(new Um(2,2),new Vc({name:"BackgroundMaterial",uniforms:km(bh.background.uniforms),vertexShader:bh.background.vertexShader,fragmentShader:bh.background.fragmentShader,side:Ku,depthTest:!1,depthWrite:!1,fog:!1})),_.geometry.deleteAttribute("normal"),Object.defineProperty(_.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(_)),_.material.uniforms.t2D.value=$,_.material.uniforms.backgroundIntensity.value=B.backgroundIntensity,_.material.toneMapped=Ci.getTransfer($.colorSpace)!==Yi,$.matrixAutoUpdate===!0&&$.updateMatrix(),_.material.uniforms.uvTransform.value.copy($.matrix),(w!==$||C!==$.version||R!==r.toneMapping)&&(_.material.needsUpdate=!0,w=$,C=$.version,R=r.toneMapping),_.layers.enableAll(),L.unshift(_,_.geometry,_.material,0,0,null))}function M(L,B){L.getRGB(e0,VT(r)),i.buffers.color.setClear(e0.r,e0.g,e0.b,B,f)}function U(){b!==void 0&&(b.geometry.dispose(),b.material.dispose()),_!==void 0&&(_.geometry.dispose(),_.material.dispose())}return{getClearColor:function(){return d},setClearColor:function(L,B=1){d.set(L),v=B,M(d,v)},getClearAlpha:function(){return v},setClearAlpha:function(L){v=L,M(d,v)},render:O,addToRenderList:P,dispose:U}}function gL(r,e){const t=r.getParameter(r.MAX_VERTEX_ATTRIBS),i={},o=C(null);let l=o,f=!1;function d(H,J,ce,he,ge){let Ae=!1;const me=w(he,ce,J);l!==me&&(l=me,_(l.object)),Ae=R(H,he,ce,ge),Ae&&z(H,he,ce,ge),ge!==null&&e.update(ge,r.ELEMENT_ARRAY_BUFFER),(Ae||f)&&(f=!1,B(H,J,ce,he),ge!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.get(ge).buffer))}function v(){return r.createVertexArray()}function _(H){return r.bindVertexArray(H)}function b(H){return r.deleteVertexArray(H)}function w(H,J,ce){const he=ce.wireframe===!0;let ge=i[H.id];ge===void 0&&(ge={},i[H.id]=ge);let Ae=ge[J.id];Ae===void 0&&(Ae={},ge[J.id]=Ae);let me=Ae[he];return me===void 0&&(me=C(v()),Ae[he]=me),me}function C(H){const J=[],ce=[],he=[];for(let ge=0;ge<t;ge++)J[ge]=0,ce[ge]=0,he[ge]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:J,enabledAttributes:ce,attributeDivisors:he,object:H,attributes:{},index:null}}function R(H,J,ce,he){const ge=l.attributes,Ae=J.attributes;let me=0;const Ie=ce.getAttributes();for(const ae in Ie)if(Ie[ae].location>=0){const de=ge[ae];let ie=Ae[ae];if(ie===void 0&&(ae==="instanceMatrix"&&H.instanceMatrix&&(ie=H.instanceMatrix),ae==="instanceColor"&&H.instanceColor&&(ie=H.instanceColor)),de===void 0||de.attribute!==ie||ie&&de.data!==ie.data)return!0;me++}return l.attributesNum!==me||l.index!==he}function z(H,J,ce,he){const ge={},Ae=J.attributes;let me=0;const Ie=ce.getAttributes();for(const ae in Ie)if(Ie[ae].location>=0){let de=Ae[ae];de===void 0&&(ae==="instanceMatrix"&&H.instanceMatrix&&(de=H.instanceMatrix),ae==="instanceColor"&&H.instanceColor&&(de=H.instanceColor));const ie={};ie.attribute=de,de&&de.data&&(ie.data=de.data),ge[ae]=ie,me++}l.attributes=ge,l.attributesNum=me,l.index=he}function O(){const H=l.newAttributes;for(let J=0,ce=H.length;J<ce;J++)H[J]=0}function P(H){M(H,0)}function M(H,J){const ce=l.newAttributes,he=l.enabledAttributes,ge=l.attributeDivisors;ce[H]=1,he[H]===0&&(r.enableVertexAttribArray(H),he[H]=1),ge[H]!==J&&(r.vertexAttribDivisor(H,J),ge[H]=J)}function U(){const H=l.newAttributes,J=l.enabledAttributes;for(let ce=0,he=J.length;ce<he;ce++)J[ce]!==H[ce]&&(r.disableVertexAttribArray(ce),J[ce]=0)}function L(H,J,ce,he,ge,Ae,me){me===!0?r.vertexAttribIPointer(H,J,ce,ge,Ae):r.vertexAttribPointer(H,J,ce,he,ge,Ae)}function B(H,J,ce,he){O();const ge=he.attributes,Ae=ce.getAttributes(),me=J.defaultAttributeValues;for(const Ie in Ae){const ae=Ae[Ie];if(ae.location>=0){let ye=ge[Ie];if(ye===void 0&&(Ie==="instanceMatrix"&&H.instanceMatrix&&(ye=H.instanceMatrix),Ie==="instanceColor"&&H.instanceColor&&(ye=H.instanceColor)),ye!==void 0){const de=ye.normalized,ie=ye.itemSize,we=e.get(ye);if(we===void 0)continue;const ze=we.buffer,se=we.type,fe=we.bytesPerElement,Le=se===r.INT||se===r.UNSIGNED_INT||ye.gpuType===_w;if(ye.isInterleavedBufferAttribute){const Be=ye.data,He=Be.stride,et=ye.offset;if(Be.isInstancedInterleavedBuffer){for(let pt=0;pt<ae.locationSize;pt++)M(ae.location+pt,Be.meshPerAttribute);H.isInstancedMesh!==!0&&he._maxInstanceCount===void 0&&(he._maxInstanceCount=Be.meshPerAttribute*Be.count)}else for(let pt=0;pt<ae.locationSize;pt++)P(ae.location+pt);r.bindBuffer(r.ARRAY_BUFFER,ze);for(let pt=0;pt<ae.locationSize;pt++)L(ae.location+pt,ie/ae.locationSize,se,de,He*fe,(et+ie/ae.locationSize*pt)*fe,Le)}else{if(ye.isInstancedBufferAttribute){for(let Be=0;Be<ae.locationSize;Be++)M(ae.location+Be,ye.meshPerAttribute);H.isInstancedMesh!==!0&&he._maxInstanceCount===void 0&&(he._maxInstanceCount=ye.meshPerAttribute*ye.count)}else for(let Be=0;Be<ae.locationSize;Be++)P(ae.location+Be);r.bindBuffer(r.ARRAY_BUFFER,ze);for(let Be=0;Be<ae.locationSize;Be++)L(ae.location+Be,ie/ae.locationSize,se,de,ie*fe,ie/ae.locationSize*Be*fe,Le)}}else if(me!==void 0){const de=me[Ie];if(de!==void 0)switch(de.length){case 2:r.vertexAttrib2fv(ae.location,de);break;case 3:r.vertexAttrib3fv(ae.location,de);break;case 4:r.vertexAttrib4fv(ae.location,de);break;default:r.vertexAttrib1fv(ae.location,de)}}}}U()}function $(){te();for(const H in i){const J=i[H];for(const ce in J){const he=J[ce];for(const ge in he)b(he[ge].object),delete he[ge];delete J[ce]}delete i[H]}}function X(H){if(i[H.id]===void 0)return;const J=i[H.id];for(const ce in J){const he=J[ce];for(const ge in he)b(he[ge].object),delete he[ge];delete J[ce]}delete i[H.id]}function Q(H){for(const J in i){const ce=i[J];if(ce[H.id]===void 0)continue;const he=ce[H.id];for(const ge in he)b(he[ge].object),delete he[ge];delete ce[H.id]}}function te(){V(),f=!0,l!==o&&(l=o,_(l.object))}function V(){o.geometry=null,o.program=null,o.wireframe=!1}return{setup:d,reset:te,resetDefaultState:V,dispose:$,releaseStatesOfGeometry:X,releaseStatesOfProgram:Q,initAttributes:O,enableAttribute:P,disableUnusedAttributes:U}}function _L(r,e,t){let i;function o(_){i=_}function l(_,b){r.drawArrays(i,_,b),t.update(b,i,1)}function f(_,b,w){w!==0&&(r.drawArraysInstanced(i,_,b,w),t.update(b,i,w))}function d(_,b,w){if(w===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,_,0,b,0,w);let R=0;for(let z=0;z<w;z++)R+=b[z];t.update(R,i,1)}function v(_,b,w,C){if(w===0)return;const R=e.get("WEBGL_multi_draw");if(R===null)for(let z=0;z<_.length;z++)f(_[z],b[z],C[z]);else{R.multiDrawArraysInstancedWEBGL(i,_,0,b,0,C,0,w);let z=0;for(let O=0;O<w;O++)z+=b[O]*C[O];t.update(z,i,1)}}this.setMode=o,this.render=l,this.renderInstances=f,this.renderMultiDraw=d,this.renderMultiDrawInstances=v}function yL(r,e,t,i){let o;function l(){if(o!==void 0)return o;if(e.has("EXT_texture_filter_anisotropic")===!0){const Q=e.get("EXT_texture_filter_anisotropic");o=r.getParameter(Q.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else o=0;return o}function f(Q){return!(Q!==Is&&i.convert(Q)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function d(Q){const te=Q===_g&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(Q!==df&&i.convert(Q)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&Q!==fo&&!te)}function v(Q){if(Q==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";Q="mediump"}return Q==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let _=t.precision!==void 0?t.precision:"highp";const b=v(_);b!==_&&(console.warn("THREE.WebGLRenderer:",_,"not supported, using",b,"instead."),_=b);const w=t.logarithmicDepthBuffer===!0,C=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),R=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),z=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),O=r.getParameter(r.MAX_TEXTURE_SIZE),P=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),M=r.getParameter(r.MAX_VERTEX_ATTRIBS),U=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),L=r.getParameter(r.MAX_VARYING_VECTORS),B=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),$=z>0,X=r.getParameter(r.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:l,getMaxPrecision:v,textureFormatReadable:f,textureTypeReadable:d,precision:_,logarithmicDepthBuffer:w,reverseDepthBuffer:C,maxTextures:R,maxVertexTextures:z,maxTextureSize:O,maxCubemapSize:P,maxAttributes:M,maxVertexUniforms:U,maxVaryings:L,maxFragmentUniforms:B,vertexTextures:$,maxSamples:X}}function bL(r){const e=this;let t=null,i=0,o=!1,l=!1;const f=new ld,d=new Dn,v={value:null,needsUpdate:!1};this.uniform=v,this.numPlanes=0,this.numIntersection=0,this.init=function(w,C){const R=w.length!==0||C||i!==0||o;return o=C,i=w.length,R},this.beginShadows=function(){l=!0,b(null)},this.endShadows=function(){l=!1},this.setGlobalState=function(w,C){t=b(w,C,0)},this.setState=function(w,C,R){const z=w.clippingPlanes,O=w.clipIntersection,P=w.clipShadows,M=r.get(w);if(!o||z===null||z.length===0||l&&!P)l?b(null):_();else{const U=l?0:i,L=U*4;let B=M.clippingState||null;v.value=B,B=b(z,C,L,R);for(let $=0;$!==L;++$)B[$]=t[$];M.clippingState=B,this.numIntersection=O?this.numPlanes:0,this.numPlanes+=U}};function _(){v.value!==t&&(v.value=t,v.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function b(w,C,R,z){const O=w!==null?w.length:0;let P=null;if(O!==0){if(P=v.value,z!==!0||P===null){const M=R+O*4,U=C.matrixWorldInverse;d.getNormalMatrix(U),(P===null||P.length<M)&&(P=new Float32Array(M));for(let L=0,B=R;L!==O;++L,B+=4)f.copy(w[L]).applyMatrix4(U,d),f.normal.toArray(P,B),P[B+3]=f.constant}v.value=P,v.needsUpdate=!0}return e.numPlanes=O,e.numIntersection=0,P}}function xL(r){let e=new WeakMap;function t(f,d){return d===cx?f.mapping=Am:d===hx&&(f.mapping=Pm),f}function i(f){if(f&&f.isTexture){const d=f.mapping;if(d===cx||d===hx)if(e.has(f)){const v=e.get(f).texture;return t(v,f.mapping)}else{const v=f.image;if(v&&v.height>0){const _=new JR(v.height);return _.fromEquirectangularTexture(r,f),e.set(f,_),f.addEventListener("dispose",o),t(_.texture,f.mapping)}else return null}}return f}function o(f){const d=f.target;d.removeEventListener("dispose",o);const v=e.get(d);v!==void 0&&(e.delete(d),v.dispose())}function l(){e=new WeakMap}return{get:i,dispose:l}}const xm=4,pE=[.125,.215,.35,.446,.526,.582],up=20,bb=new xg,mE=new Ht;let xb=null,wb=0,Sb=0,Eb=!1;const sp=(1+Math.sqrt(5))/2,um=1/sp,vE=[new be(-sp,um,0),new be(sp,um,0),new be(-um,0,sp),new be(um,0,sp),new be(0,sp,-um),new be(0,sp,um),new be(-1,1,-1),new be(1,1,-1),new be(-1,1,1),new be(1,1,1)];class gE{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,o=100){xb=this._renderer.getRenderTarget(),wb=this._renderer.getActiveCubeFace(),Sb=this._renderer.getActiveMipmapLevel(),Eb=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,i,o,l),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=bE(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=yE(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(xb,wb,Sb),this._renderer.xr.enabled=Eb,e.scissorTest=!1,t0(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Am||e.mapping===Pm?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),xb=this._renderer.getRenderTarget(),wb=this._renderer.getActiveCubeFace(),Sb=this._renderer.getActiveMipmapLevel(),Eb=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Sh,minFilter:Sh,generateMipmaps:!1,type:_g,format:Is,colorSpace:Dm,depthBuffer:!1},o=_E(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_E(e,t,i);const{_lodMax:l}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=wL(l)),this._blurMaterial=SL(l,e,t)}return o}_compileMaterial(e){const t=new Cr(this._lodPlanes[0],e);this._renderer.compile(t,bb)}_sceneToCubeUV(e,t,i,o){const d=new qu(90,1,t,i),v=[1,-1,1,1,1,1],_=[1,1,1,-1,-1,-1],b=this._renderer,w=b.autoClear,C=b.toneMapping;b.getClearColor(mE),b.toneMapping=dd,b.autoClear=!1;const R=new U0({name:"PMREM.Background",side:Ml,depthWrite:!1,depthTest:!1}),z=new Cr(new Nm,R);let O=!1;const P=e.background;P?P.isColor&&(R.color.copy(P),e.background=null,O=!0):(R.color.copy(mE),O=!0);for(let M=0;M<6;M++){const U=M%3;U===0?(d.up.set(0,v[M],0),d.lookAt(_[M],0,0)):U===1?(d.up.set(0,0,v[M]),d.lookAt(0,_[M],0)):(d.up.set(0,v[M],0),d.lookAt(0,0,_[M]));const L=this._cubeSize;t0(o,U*L,M>2?L:0,L,L),b.setRenderTarget(o),O&&b.render(z,d),b.render(e,d)}z.geometry.dispose(),z.material.dispose(),b.toneMapping=C,b.autoClear=w,e.background=P}_textureToCubeUV(e,t){const i=this._renderer,o=e.mapping===Am||e.mapping===Pm;o?(this._cubemapMaterial===null&&(this._cubemapMaterial=bE()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=yE());const l=o?this._cubemapMaterial:this._equirectMaterial,f=new Cr(this._lodPlanes[0],l),d=l.uniforms;d.envMap.value=e;const v=this._cubeSize;t0(t,0,0,3*v,2*v),i.setRenderTarget(t),i.render(f,bb)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const o=this._lodPlanes.length;for(let l=1;l<o;l++){const f=Math.sqrt(this._sigmas[l]*this._sigmas[l]-this._sigmas[l-1]*this._sigmas[l-1]),d=vE[(o-l-1)%vE.length];this._blur(e,l-1,l,f,d)}t.autoClear=i}_blur(e,t,i,o,l){const f=this._pingPongRenderTarget;this._halfBlur(e,f,t,i,o,"latitudinal",l),this._halfBlur(f,e,i,i,o,"longitudinal",l)}_halfBlur(e,t,i,o,l,f,d){const v=this._renderer,_=this._blurMaterial;f!=="latitudinal"&&f!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const b=3,w=new Cr(this._lodPlanes[o],_),C=_.uniforms,R=this._sizeLods[i]-1,z=isFinite(l)?Math.PI/(2*R):2*Math.PI/(2*up-1),O=l/z,P=isFinite(l)?1+Math.floor(b*O):up;P>up&&console.warn(`sigmaRadians, ${l}, is too large and will clip, as it requested ${P} samples when the maximum is set to ${up}`);const M=[];let U=0;for(let Q=0;Q<up;++Q){const te=Q/O,V=Math.exp(-te*te/2);M.push(V),Q===0?U+=V:Q<P&&(U+=2*V)}for(let Q=0;Q<M.length;Q++)M[Q]=M[Q]/U;C.envMap.value=e.texture,C.samples.value=P,C.weights.value=M,C.latitudinal.value=f==="latitudinal",d&&(C.poleAxis.value=d);const{_lodMax:L}=this;C.dTheta.value=z,C.mipInt.value=L-i;const B=this._sizeLods[o],$=3*B*(o>L-xm?o-L+xm:0),X=4*(this._cubeSize-B);t0(t,$,X,3*B,2*B),v.setRenderTarget(t),v.render(w,bb)}}function wL(r){const e=[],t=[],i=[];let o=r;const l=r-xm+1+pE.length;for(let f=0;f<l;f++){const d=Math.pow(2,o);t.push(d);let v=1/d;f>r-xm?v=pE[f-r+xm-1]:f===0&&(v=0),i.push(v);const _=1/(d-2),b=-_,w=1+_,C=[b,b,w,b,w,w,b,b,w,w,b,w],R=6,z=6,O=3,P=2,M=1,U=new Float32Array(O*z*R),L=new Float32Array(P*z*R),B=new Float32Array(M*z*R);for(let X=0;X<R;X++){const Q=X%3*2/3-1,te=X>2?0:-1,V=[Q,te,0,Q+2/3,te,0,Q+2/3,te+1,0,Q,te,0,Q+2/3,te+1,0,Q,te+1,0];U.set(V,O*z*X),L.set(C,P*z*X);const H=[X,X,X,X,X,X];B.set(H,M*z*X)}const $=new is;$.setAttribute("position",new ns(U,O)),$.setAttribute("uv",new ns(L,P)),$.setAttribute("faceIndex",new ns(B,M)),e.push($),o>xm&&o--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function _E(r,e,t){const i=new El(r,e,t);return i.texture.mapping=t_,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function t0(r,e,t,i,o){r.viewport.set(e,t,i,o),r.scissor.set(e,t,i,o)}function SL(r,e,t){const i=new Float32Array(up),o=new be(0,1,0);return new Vc({name:"SphericalGaussianBlur",defines:{n:up,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:Dw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:fd,depthTest:!1,depthWrite:!1})}function yE(){return new Vc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Dw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:fd,depthTest:!1,depthWrite:!1})}function bE(){return new Vc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Dw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:fd,depthTest:!1,depthWrite:!1})}function Dw(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function EL(r){let e=new WeakMap,t=null;function i(d){if(d&&d.isTexture){const v=d.mapping,_=v===cx||v===hx,b=v===Am||v===Pm;if(_||b){let w=e.get(d);const C=w!==void 0?w.texture.pmremVersion:0;if(d.isRenderTargetTexture&&d.pmremVersion!==C)return t===null&&(t=new gE(r)),w=_?t.fromEquirectangular(d,w):t.fromCubemap(d,w),w.texture.pmremVersion=d.pmremVersion,e.set(d,w),w.texture;if(w!==void 0)return w.texture;{const R=d.image;return _&&R&&R.height>0||b&&R&&o(R)?(t===null&&(t=new gE(r)),w=_?t.fromEquirectangular(d):t.fromCubemap(d),w.texture.pmremVersion=d.pmremVersion,e.set(d,w),d.addEventListener("dispose",l),w.texture):null}}}return d}function o(d){let v=0;const _=6;for(let b=0;b<_;b++)d[b]!==void 0&&v++;return v===_}function l(d){const v=d.target;v.removeEventListener("dispose",l);const _=e.get(v);_!==void 0&&(e.delete(v),_.dispose())}function f(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:f}}function CL(r){const e={};function t(i){if(e[i]!==void 0)return e[i];let o;switch(i){case"WEBGL_depth_texture":o=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=r.getExtension(i)}return e[i]=o,o}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const o=t(i);return o===null&&pm("THREE.WebGLRenderer: "+i+" extension not supported."),o}}}function TL(r,e,t,i){const o={},l=new WeakMap;function f(w){const C=w.target;C.index!==null&&e.remove(C.index);for(const z in C.attributes)e.remove(C.attributes[z]);C.removeEventListener("dispose",f),delete o[C.id];const R=l.get(C);R&&(e.remove(R),l.delete(C)),i.releaseStatesOfGeometry(C),C.isInstancedBufferGeometry===!0&&delete C._maxInstanceCount,t.memory.geometries--}function d(w,C){return o[C.id]===!0||(C.addEventListener("dispose",f),o[C.id]=!0,t.memory.geometries++),C}function v(w){const C=w.attributes;for(const R in C)e.update(C[R],r.ARRAY_BUFFER)}function _(w){const C=[],R=w.index,z=w.attributes.position;let O=0;if(R!==null){const U=R.array;O=R.version;for(let L=0,B=U.length;L<B;L+=3){const $=U[L+0],X=U[L+1],Q=U[L+2];C.push($,X,X,Q,Q,$)}}else if(z!==void 0){const U=z.array;O=z.version;for(let L=0,B=U.length/3-1;L<B;L+=3){const $=L+0,X=L+1,Q=L+2;C.push($,X,X,Q,Q,$)}}else return;const P=new(FT(C)?zT:BT)(C,1);P.version=O;const M=l.get(w);M&&e.remove(M),l.set(w,P)}function b(w){const C=l.get(w);if(C){const R=w.index;R!==null&&C.version<R.version&&_(w)}else _(w);return l.get(w)}return{get:d,update:v,getWireframeAttribute:b}}function ML(r,e,t){let i;function o(C){i=C}let l,f;function d(C){l=C.type,f=C.bytesPerElement}function v(C,R){r.drawElements(i,R,l,C*f),t.update(R,i,1)}function _(C,R,z){z!==0&&(r.drawElementsInstanced(i,R,l,C*f,z),t.update(R,i,z))}function b(C,R,z){if(z===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,R,0,l,C,0,z);let P=0;for(let M=0;M<z;M++)P+=R[M];t.update(P,i,1)}function w(C,R,z,O){if(z===0)return;const P=e.get("WEBGL_multi_draw");if(P===null)for(let M=0;M<C.length;M++)_(C[M]/f,R[M],O[M]);else{P.multiDrawElementsInstancedWEBGL(i,R,0,l,C,0,O,0,z);let M=0;for(let U=0;U<z;U++)M+=R[U]*O[U];t.update(M,i,1)}}this.setMode=o,this.setIndex=d,this.render=v,this.renderInstances=_,this.renderMultiDraw=b,this.renderMultiDrawInstances=w}function AL(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(l,f,d){switch(t.calls++,f){case r.TRIANGLES:t.triangles+=d*(l/3);break;case r.LINES:t.lines+=d*(l/2);break;case r.LINE_STRIP:t.lines+=d*(l-1);break;case r.LINE_LOOP:t.lines+=d*l;break;case r.POINTS:t.points+=d*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",f);break}}function o(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:o,update:i}}function PL(r,e,t){const i=new WeakMap,o=new Xi;function l(f,d,v){const _=f.morphTargetInfluences,b=d.morphAttributes.position||d.morphAttributes.normal||d.morphAttributes.color,w=b!==void 0?b.length:0;let C=i.get(d);if(C===void 0||C.count!==w){let V=function(){Q.dispose(),i.delete(d),d.removeEventListener("dispose",V)};C!==void 0&&C.texture.dispose();const R=d.morphAttributes.position!==void 0,z=d.morphAttributes.normal!==void 0,O=d.morphAttributes.color!==void 0,P=d.morphAttributes.position||[],M=d.morphAttributes.normal||[],U=d.morphAttributes.color||[];let L=0;R===!0&&(L=1),z===!0&&(L=2),O===!0&&(L=3);let B=d.attributes.position.count*L,$=1;B>e.maxTextureSize&&($=Math.ceil(B/e.maxTextureSize),B=e.maxTextureSize);const X=new Float32Array(B*$*4*w),Q=new NT(X,B,$,w);Q.type=fo,Q.needsUpdate=!0;const te=L*4;for(let H=0;H<w;H++){const J=P[H],ce=M[H],he=U[H],ge=B*$*4*H;for(let Ae=0;Ae<J.count;Ae++){const me=Ae*te;R===!0&&(o.fromBufferAttribute(J,Ae),X[ge+me+0]=o.x,X[ge+me+1]=o.y,X[ge+me+2]=o.z,X[ge+me+3]=0),z===!0&&(o.fromBufferAttribute(ce,Ae),X[ge+me+4]=o.x,X[ge+me+5]=o.y,X[ge+me+6]=o.z,X[ge+me+7]=0),O===!0&&(o.fromBufferAttribute(he,Ae),X[ge+me+8]=o.x,X[ge+me+9]=o.y,X[ge+me+10]=o.z,X[ge+me+11]=he.itemSize===4?o.w:1)}}C={count:w,texture:Q,size:new At(B,$)},i.set(d,C),d.addEventListener("dispose",V)}if(f.isInstancedMesh===!0&&f.morphTexture!==null)v.getUniforms().setValue(r,"morphTexture",f.morphTexture,t);else{let R=0;for(let O=0;O<_.length;O++)R+=_[O];const z=d.morphTargetsRelative?1:1-R;v.getUniforms().setValue(r,"morphTargetBaseInfluence",z),v.getUniforms().setValue(r,"morphTargetInfluences",_)}v.getUniforms().setValue(r,"morphTargetsTexture",C.texture,t),v.getUniforms().setValue(r,"morphTargetsTextureSize",C.size)}return{update:l}}function RL(r,e,t,i){let o=new WeakMap;function l(v){const _=i.render.frame,b=v.geometry,w=e.get(v,b);if(o.get(w)!==_&&(e.update(w),o.set(w,_)),v.isInstancedMesh&&(v.hasEventListener("dispose",d)===!1&&v.addEventListener("dispose",d),o.get(v)!==_&&(t.update(v.instanceMatrix,r.ARRAY_BUFFER),v.instanceColor!==null&&t.update(v.instanceColor,r.ARRAY_BUFFER),o.set(v,_))),v.isSkinnedMesh){const C=v.skeleton;o.get(C)!==_&&(C.update(),o.set(C,_))}return w}function f(){o=new WeakMap}function d(v){const _=v.target;_.removeEventListener("dispose",d),t.remove(_.instanceMatrix),_.instanceColor!==null&&t.remove(_.instanceColor)}return{update:l,dispose:f}}const KT=new Qa,xE=new WT(1,1),ZT=new NT,JT=new OR,QT=new HT,wE=[],SE=[],EE=new Float32Array(16),CE=new Float32Array(9),TE=new Float32Array(4);function Bm(r,e,t){const i=r[0];if(i<=0||i>0)return r;const o=e*t;let l=wE[o];if(l===void 0&&(l=new Float32Array(o),wE[o]=l),e!==0){i.toArray(l,0);for(let f=1,d=0;f!==e;++f)d+=t,r[f].toArray(l,d)}return l}function $s(r,e){if(r.length!==e.length)return!1;for(let t=0,i=r.length;t<i;t++)if(r[t]!==e[t])return!1;return!0}function Ys(r,e){for(let t=0,i=e.length;t<i;t++)r[t]=e[t]}function r_(r,e){let t=SE[e];t===void 0&&(t=new Int32Array(e),SE[e]=t);for(let i=0;i!==e;++i)t[i]=r.allocateTextureUnit();return t}function IL(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function DL(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if($s(t,e))return;r.uniform2fv(this.addr,e),Ys(t,e)}}function LL(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if($s(t,e))return;r.uniform3fv(this.addr,e),Ys(t,e)}}function kL(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if($s(t,e))return;r.uniform4fv(this.addr,e),Ys(t,e)}}function FL(r,e){const t=this.cache,i=e.elements;if(i===void 0){if($s(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),Ys(t,e)}else{if($s(t,i))return;TE.set(i),r.uniformMatrix2fv(this.addr,!1,TE),Ys(t,i)}}function OL(r,e){const t=this.cache,i=e.elements;if(i===void 0){if($s(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),Ys(t,e)}else{if($s(t,i))return;CE.set(i),r.uniformMatrix3fv(this.addr,!1,CE),Ys(t,i)}}function NL(r,e){const t=this.cache,i=e.elements;if(i===void 0){if($s(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),Ys(t,e)}else{if($s(t,i))return;EE.set(i),r.uniformMatrix4fv(this.addr,!1,EE),Ys(t,i)}}function UL(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function BL(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if($s(t,e))return;r.uniform2iv(this.addr,e),Ys(t,e)}}function zL(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if($s(t,e))return;r.uniform3iv(this.addr,e),Ys(t,e)}}function VL(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if($s(t,e))return;r.uniform4iv(this.addr,e),Ys(t,e)}}function GL(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function HL(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if($s(t,e))return;r.uniform2uiv(this.addr,e),Ys(t,e)}}function WL(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if($s(t,e))return;r.uniform3uiv(this.addr,e),Ys(t,e)}}function jL(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if($s(t,e))return;r.uniform4uiv(this.addr,e),Ys(t,e)}}function XL(r,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(r.uniform1i(this.addr,o),i[0]=o);let l;this.type===r.SAMPLER_2D_SHADOW?(xE.compareFunction=kT,l=xE):l=KT,t.setTexture2D(e||l,o)}function qL(r,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(r.uniform1i(this.addr,o),i[0]=o),t.setTexture3D(e||JT,o)}function $L(r,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(r.uniform1i(this.addr,o),i[0]=o),t.setTextureCube(e||QT,o)}function YL(r,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(r.uniform1i(this.addr,o),i[0]=o),t.setTexture2DArray(e||ZT,o)}function KL(r){switch(r){case 5126:return IL;case 35664:return DL;case 35665:return LL;case 35666:return kL;case 35674:return FL;case 35675:return OL;case 35676:return NL;case 5124:case 35670:return UL;case 35667:case 35671:return BL;case 35668:case 35672:return zL;case 35669:case 35673:return VL;case 5125:return GL;case 36294:return HL;case 36295:return WL;case 36296:return jL;case 35678:case 36198:case 36298:case 36306:case 35682:return XL;case 35679:case 36299:case 36307:return qL;case 35680:case 36300:case 36308:case 36293:return $L;case 36289:case 36303:case 36311:case 36292:return YL}}function ZL(r,e){r.uniform1fv(this.addr,e)}function JL(r,e){const t=Bm(e,this.size,2);r.uniform2fv(this.addr,t)}function QL(r,e){const t=Bm(e,this.size,3);r.uniform3fv(this.addr,t)}function e3(r,e){const t=Bm(e,this.size,4);r.uniform4fv(this.addr,t)}function t3(r,e){const t=Bm(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function n3(r,e){const t=Bm(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function i3(r,e){const t=Bm(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function r3(r,e){r.uniform1iv(this.addr,e)}function s3(r,e){r.uniform2iv(this.addr,e)}function o3(r,e){r.uniform3iv(this.addr,e)}function a3(r,e){r.uniform4iv(this.addr,e)}function l3(r,e){r.uniform1uiv(this.addr,e)}function u3(r,e){r.uniform2uiv(this.addr,e)}function c3(r,e){r.uniform3uiv(this.addr,e)}function h3(r,e){r.uniform4uiv(this.addr,e)}function f3(r,e,t){const i=this.cache,o=e.length,l=r_(t,o);$s(i,l)||(r.uniform1iv(this.addr,l),Ys(i,l));for(let f=0;f!==o;++f)t.setTexture2D(e[f]||KT,l[f])}function d3(r,e,t){const i=this.cache,o=e.length,l=r_(t,o);$s(i,l)||(r.uniform1iv(this.addr,l),Ys(i,l));for(let f=0;f!==o;++f)t.setTexture3D(e[f]||JT,l[f])}function p3(r,e,t){const i=this.cache,o=e.length,l=r_(t,o);$s(i,l)||(r.uniform1iv(this.addr,l),Ys(i,l));for(let f=0;f!==o;++f)t.setTextureCube(e[f]||QT,l[f])}function m3(r,e,t){const i=this.cache,o=e.length,l=r_(t,o);$s(i,l)||(r.uniform1iv(this.addr,l),Ys(i,l));for(let f=0;f!==o;++f)t.setTexture2DArray(e[f]||ZT,l[f])}function v3(r){switch(r){case 5126:return ZL;case 35664:return JL;case 35665:return QL;case 35666:return e3;case 35674:return t3;case 35675:return n3;case 35676:return i3;case 5124:case 35670:return r3;case 35667:case 35671:return s3;case 35668:case 35672:return o3;case 35669:case 35673:return a3;case 5125:return l3;case 36294:return u3;case 36295:return c3;case 36296:return h3;case 35678:case 36198:case 36298:case 36306:case 35682:return f3;case 35679:case 36299:case 36307:return d3;case 35680:case 36300:case 36308:case 36293:return p3;case 36289:case 36303:case 36311:case 36292:return m3}}class g3{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=KL(t.type)}}class _3{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=v3(t.type)}}class y3{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const o=this.seq;for(let l=0,f=o.length;l!==f;++l){const d=o[l];d.setValue(e,t[d.id],i)}}}const Cb=/(\w+)(\])?(\[|\.)?/g;function ME(r,e){r.seq.push(e),r.map[e.id]=e}function b3(r,e,t){const i=r.name,o=i.length;for(Cb.lastIndex=0;;){const l=Cb.exec(i),f=Cb.lastIndex;let d=l[1];const v=l[2]==="]",_=l[3];if(v&&(d=d|0),_===void 0||_==="["&&f+2===o){ME(t,_===void 0?new g3(d,r,e):new _3(d,r,e));break}else{let w=t.map[d];w===void 0&&(w=new y3(d),ME(t,w)),t=w}}}class y0{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<i;++o){const l=e.getActiveUniform(t,o),f=e.getUniformLocation(t,l.name);b3(l,f,this)}}setValue(e,t,i,o){const l=this.map[t];l!==void 0&&l.setValue(e,i,o)}setOptional(e,t,i){const o=t[i];o!==void 0&&this.setValue(e,i,o)}static upload(e,t,i,o){for(let l=0,f=t.length;l!==f;++l){const d=t[l],v=i[d.id];v.needsUpdate!==!1&&d.setValue(e,v.value,o)}}static seqWithValue(e,t){const i=[];for(let o=0,l=e.length;o!==l;++o){const f=e[o];f.id in t&&i.push(f)}return i}}function AE(r,e,t){const i=r.createShader(e);return r.shaderSource(i,t),r.compileShader(i),i}const x3=37297;let w3=0;function S3(r,e){const t=r.split(`
`),i=[],o=Math.max(e-6,0),l=Math.min(e+6,t.length);for(let f=o;f<l;f++){const d=f+1;i.push(`${d===e?">":" "} ${d}: ${t[f]}`)}return i.join(`
`)}const PE=new Dn;function E3(r){Ci._getMatrix(PE,Ci.workingColorSpace,r);const e=`mat3( ${PE.elements.map(t=>t.toFixed(4))} )`;switch(Ci.getTransfer(r)){case F0:return[e,"LinearTransferOETF"];case Yi:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",r),[e,"LinearTransferOETF"]}}function RE(r,e,t){const i=r.getShaderParameter(e,r.COMPILE_STATUS),o=r.getShaderInfoLog(e).trim();if(i&&o==="")return"";const l=/ERROR: 0:(\d+)/.exec(o);if(l){const f=parseInt(l[1]);return t.toUpperCase()+`

`+o+`

`+S3(r.getShaderSource(e),f)}else return o}function C3(r,e){const t=E3(e);return[`vec4 ${r}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function T3(r,e){let t;switch(e){case aR:t="Linear";break;case lR:t="Reinhard";break;case uR:t="Cineon";break;case cR:t="ACESFilmic";break;case fR:t="AgX";break;case dR:t="Neutral";break;case hR:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const n0=new be;function M3(){Ci.getLuminanceCoefficients(n0);const r=n0.x.toFixed(4),e=n0.y.toFixed(4),t=n0.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${r}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function A3(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Xv).join(`
`)}function P3(r){const e=[];for(const t in r){const i=r[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function R3(r,e){const t={},i=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let o=0;o<i;o++){const l=r.getActiveAttrib(e,o),f=l.name;let d=1;l.type===r.FLOAT_MAT2&&(d=2),l.type===r.FLOAT_MAT3&&(d=3),l.type===r.FLOAT_MAT4&&(d=4),t[f]={type:l.type,location:r.getAttribLocation(e,f),locationSize:d}}return t}function Xv(r){return r!==""}function IE(r,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function DE(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const I3=/^[ \t]*#include +<([\w\d./]+)>/gm;function jx(r){return r.replace(I3,L3)}const D3=new Map;function L3(r,e){let t=Un[e];if(t===void 0){const i=D3.get(e);if(i!==void 0)t=Un[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return jx(t)}const k3=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function LE(r){return r.replace(k3,F3)}function F3(r,e,t,i){let o="";for(let l=parseInt(e);l<parseInt(t);l++)o+=i.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return o}function kE(r){let e=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function O3(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===wT?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===zP?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===sf&&(e="SHADOWMAP_TYPE_VSM"),e}function N3(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case Am:case Pm:e="ENVMAP_TYPE_CUBE";break;case t_:e="ENVMAP_TYPE_CUBE_UV";break}return e}function U3(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case Pm:e="ENVMAP_MODE_REFRACTION";break}return e}function B3(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case e_:e="ENVMAP_BLENDING_MULTIPLY";break;case sR:e="ENVMAP_BLENDING_MIX";break;case oR:e="ENVMAP_BLENDING_ADD";break}return e}function z3(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function V3(r,e,t,i){const o=r.getContext(),l=t.defines;let f=t.vertexShader,d=t.fragmentShader;const v=O3(t),_=N3(t),b=U3(t),w=B3(t),C=z3(t),R=A3(t),z=P3(l),O=o.createProgram();let P,M,U=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(P=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,z].filter(Xv).join(`
`),P.length>0&&(P+=`
`),M=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,z].filter(Xv).join(`
`),M.length>0&&(M+=`
`)):(P=[kE(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,z,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+b:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+v:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Xv).join(`
`),M=[kE(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,z,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+_:"",t.envMap?"#define "+b:"",t.envMap?"#define "+w:"",C?"#define CUBEUV_TEXEL_WIDTH "+C.texelWidth:"",C?"#define CUBEUV_TEXEL_HEIGHT "+C.texelHeight:"",C?"#define CUBEUV_MAX_MIP "+C.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+v:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==dd?"#define TONE_MAPPING":"",t.toneMapping!==dd?Un.tonemapping_pars_fragment:"",t.toneMapping!==dd?T3("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Un.colorspace_pars_fragment,C3("linearToOutputTexel",t.outputColorSpace),M3(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Xv).join(`
`)),f=jx(f),f=IE(f,t),f=DE(f,t),d=jx(d),d=IE(d,t),d=DE(d,t),f=LE(f),d=LE(d),t.isRawShaderMaterial!==!0&&(U=`#version 300 es
`,P=[R,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+P,M=["#define varying in",t.glslVersion===Lm?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Lm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+M);const L=U+P+f,B=U+M+d,$=AE(o,o.VERTEX_SHADER,L),X=AE(o,o.FRAGMENT_SHADER,B);o.attachShader(O,$),o.attachShader(O,X),t.index0AttributeName!==void 0?o.bindAttribLocation(O,0,t.index0AttributeName):t.morphTargets===!0&&o.bindAttribLocation(O,0,"position"),o.linkProgram(O);function Q(J){if(r.debug.checkShaderErrors){const ce=o.getProgramInfoLog(O).trim(),he=o.getShaderInfoLog($).trim(),ge=o.getShaderInfoLog(X).trim();let Ae=!0,me=!0;if(o.getProgramParameter(O,o.LINK_STATUS)===!1)if(Ae=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(o,O,$,X);else{const Ie=RE(o,$,"vertex"),ae=RE(o,X,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(O,o.VALIDATE_STATUS)+`

Material Name: `+J.name+`
Material Type: `+J.type+`

Program Info Log: `+ce+`
`+Ie+`
`+ae)}else ce!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ce):(he===""||ge==="")&&(me=!1);me&&(J.diagnostics={runnable:Ae,programLog:ce,vertexShader:{log:he,prefix:P},fragmentShader:{log:ge,prefix:M}})}o.deleteShader($),o.deleteShader(X),te=new y0(o,O),V=R3(o,O)}let te;this.getUniforms=function(){return te===void 0&&Q(this),te};let V;this.getAttributes=function(){return V===void 0&&Q(this),V};let H=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return H===!1&&(H=o.getProgramParameter(O,x3)),H},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(O),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=w3++,this.cacheKey=e,this.usedTimes=1,this.program=O,this.vertexShader=$,this.fragmentShader=X,this}let G3=0;class H3{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,o=this._getShaderStage(t),l=this._getShaderStage(i),f=this._getShaderCacheForMaterial(e);return f.has(o)===!1&&(f.add(o),o.usedTimes++),f.has(l)===!1&&(f.add(l),l.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new W3(e),t.set(e,i)),i}}class W3{constructor(e){this.id=G3++,this.code=e,this.usedTimes=0}}function j3(r,e,t,i,o,l,f){const d=new Cw,v=new H3,_=new Set,b=[],w=o.logarithmicDepthBuffer,C=o.vertexTextures;let R=o.precision;const z={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function O(V){return _.add(V),V===0?"uv":`uv${V}`}function P(V,H,J,ce,he){const ge=ce.fog,Ae=he.geometry,me=V.isMeshStandardMaterial?ce.environment:null,Ie=(V.isMeshStandardMaterial?t:e).get(V.envMap||me),ae=Ie&&Ie.mapping===t_?Ie.image.height:null,ye=z[V.type];V.precision!==null&&(R=o.getMaxPrecision(V.precision),R!==V.precision&&console.warn("THREE.WebGLProgram.getParameters:",V.precision,"not supported, using",R,"instead."));const de=Ae.morphAttributes.position||Ae.morphAttributes.normal||Ae.morphAttributes.color,ie=de!==void 0?de.length:0;let we=0;Ae.morphAttributes.position!==void 0&&(we=1),Ae.morphAttributes.normal!==void 0&&(we=2),Ae.morphAttributes.color!==void 0&&(we=3);let ze,se,fe,Le;if(ye){const vn=bh[ye];ze=vn.vertexShader,se=vn.fragmentShader}else ze=V.vertexShader,se=V.fragmentShader,v.update(V),fe=v.getVertexShaderID(V),Le=v.getFragmentShaderID(V);const Be=r.getRenderTarget(),He=r.state.buffers.depth.getReversed(),et=he.isInstancedMesh===!0,pt=he.isBatchedMesh===!0,Wt=!!V.map,zt=!!V.matcap,bn=!!Ie,_e=!!V.aoMap,Ln=!!V.lightMap,on=!!V.bumpMap,Nt=!!V.normalMap,Vt=!!V.displacementMap,Mn=!!V.emissiveMap,Dt=!!V.metalnessMap,le=!!V.roughnessMap,ne=V.anisotropy>0,Oe=V.clearcoat>0,Ze=V.dispersion>0,Je=V.iridescence>0,Ye=V.sheen>0,Pt=V.transmission>0,ht=ne&&!!V.anisotropyMap,_t=Oe&&!!V.clearcoatMap,fn=Oe&&!!V.clearcoatNormalMap,it=Oe&&!!V.clearcoatRoughnessMap,St=Je&&!!V.iridescenceMap,jt=Je&&!!V.iridescenceThicknessMap,tn=Ye&&!!V.sheenColorMap,xt=Ye&&!!V.sheenRoughnessMap,pn=!!V.specularMap,nn=!!V.specularColorMap,Vn=!!V.specularIntensityMap,Re=Pt&&!!V.transmissionMap,gt=Pt&&!!V.thicknessMap,je=!!V.gradientMap,Ke=!!V.alphaMap,Mt=V.alphaTest>0,Et=!!V.alphaHash,mn=!!V.extensions;let Bn=dd;V.toneMapped&&(Be===null||Be.isXRRenderTarget===!0)&&(Bn=r.toneMapping);const Ti={shaderID:ye,shaderType:V.type,shaderName:V.name,vertexShader:ze,fragmentShader:se,defines:V.defines,customVertexShaderID:fe,customFragmentShaderID:Le,isRawShaderMaterial:V.isRawShaderMaterial===!0,glslVersion:V.glslVersion,precision:R,batching:pt,batchingColor:pt&&he._colorsTexture!==null,instancing:et,instancingColor:et&&he.instanceColor!==null,instancingMorph:et&&he.morphTexture!==null,supportsVertexTextures:C,outputColorSpace:Be===null?r.outputColorSpace:Be.isXRRenderTarget===!0?Be.texture.colorSpace:Dm,alphaToCoverage:!!V.alphaToCoverage,map:Wt,matcap:zt,envMap:bn,envMapMode:bn&&Ie.mapping,envMapCubeUVHeight:ae,aoMap:_e,lightMap:Ln,bumpMap:on,normalMap:Nt,displacementMap:C&&Vt,emissiveMap:Mn,normalMapObjectSpace:Nt&&V.normalMapType===gR,normalMapTangentSpace:Nt&&V.normalMapType===Ew,metalnessMap:Dt,roughnessMap:le,anisotropy:ne,anisotropyMap:ht,clearcoat:Oe,clearcoatMap:_t,clearcoatNormalMap:fn,clearcoatRoughnessMap:it,dispersion:Ze,iridescence:Je,iridescenceMap:St,iridescenceThicknessMap:jt,sheen:Ye,sheenColorMap:tn,sheenRoughnessMap:xt,specularMap:pn,specularColorMap:nn,specularIntensityMap:Vn,transmission:Pt,transmissionMap:Re,thicknessMap:gt,gradientMap:je,opaque:V.transparent===!1&&V.blending===Sm&&V.alphaToCoverage===!1,alphaMap:Ke,alphaTest:Mt,alphaHash:Et,combine:V.combine,mapUv:Wt&&O(V.map.channel),aoMapUv:_e&&O(V.aoMap.channel),lightMapUv:Ln&&O(V.lightMap.channel),bumpMapUv:on&&O(V.bumpMap.channel),normalMapUv:Nt&&O(V.normalMap.channel),displacementMapUv:Vt&&O(V.displacementMap.channel),emissiveMapUv:Mn&&O(V.emissiveMap.channel),metalnessMapUv:Dt&&O(V.metalnessMap.channel),roughnessMapUv:le&&O(V.roughnessMap.channel),anisotropyMapUv:ht&&O(V.anisotropyMap.channel),clearcoatMapUv:_t&&O(V.clearcoatMap.channel),clearcoatNormalMapUv:fn&&O(V.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:it&&O(V.clearcoatRoughnessMap.channel),iridescenceMapUv:St&&O(V.iridescenceMap.channel),iridescenceThicknessMapUv:jt&&O(V.iridescenceThicknessMap.channel),sheenColorMapUv:tn&&O(V.sheenColorMap.channel),sheenRoughnessMapUv:xt&&O(V.sheenRoughnessMap.channel),specularMapUv:pn&&O(V.specularMap.channel),specularColorMapUv:nn&&O(V.specularColorMap.channel),specularIntensityMapUv:Vn&&O(V.specularIntensityMap.channel),transmissionMapUv:Re&&O(V.transmissionMap.channel),thicknessMapUv:gt&&O(V.thicknessMap.channel),alphaMapUv:Ke&&O(V.alphaMap.channel),vertexTangents:!!Ae.attributes.tangent&&(Nt||ne),vertexColors:V.vertexColors,vertexAlphas:V.vertexColors===!0&&!!Ae.attributes.color&&Ae.attributes.color.itemSize===4,pointsUvs:he.isPoints===!0&&!!Ae.attributes.uv&&(Wt||Ke),fog:!!ge,useFog:V.fog===!0,fogExp2:!!ge&&ge.isFogExp2,flatShading:V.flatShading===!0,sizeAttenuation:V.sizeAttenuation===!0,logarithmicDepthBuffer:w,reverseDepthBuffer:He,skinning:he.isSkinnedMesh===!0,morphTargets:Ae.morphAttributes.position!==void 0,morphNormals:Ae.morphAttributes.normal!==void 0,morphColors:Ae.morphAttributes.color!==void 0,morphTargetsCount:ie,morphTextureStride:we,numDirLights:H.directional.length,numPointLights:H.point.length,numSpotLights:H.spot.length,numSpotLightMaps:H.spotLightMap.length,numRectAreaLights:H.rectArea.length,numHemiLights:H.hemi.length,numDirLightShadows:H.directionalShadowMap.length,numPointLightShadows:H.pointShadowMap.length,numSpotLightShadows:H.spotShadowMap.length,numSpotLightShadowsWithMaps:H.numSpotLightShadowsWithMaps,numLightProbes:H.numLightProbes,numClippingPlanes:f.numPlanes,numClipIntersection:f.numIntersection,dithering:V.dithering,shadowMapEnabled:r.shadowMap.enabled&&J.length>0,shadowMapType:r.shadowMap.type,toneMapping:Bn,decodeVideoTexture:Wt&&V.map.isVideoTexture===!0&&Ci.getTransfer(V.map.colorSpace)===Yi,decodeVideoTextureEmissive:Mn&&V.emissiveMap.isVideoTexture===!0&&Ci.getTransfer(V.emissiveMap.colorSpace)===Yi,premultipliedAlpha:V.premultipliedAlpha,doubleSided:V.side===of,flipSided:V.side===Ml,useDepthPacking:V.depthPacking>=0,depthPacking:V.depthPacking||0,index0AttributeName:V.index0AttributeName,extensionClipCullDistance:mn&&V.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(mn&&V.extensions.multiDraw===!0||pt)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:V.customProgramCacheKey()};return Ti.vertexUv1s=_.has(1),Ti.vertexUv2s=_.has(2),Ti.vertexUv3s=_.has(3),_.clear(),Ti}function M(V){const H=[];if(V.shaderID?H.push(V.shaderID):(H.push(V.customVertexShaderID),H.push(V.customFragmentShaderID)),V.defines!==void 0)for(const J in V.defines)H.push(J),H.push(V.defines[J]);return V.isRawShaderMaterial===!1&&(U(H,V),L(H,V),H.push(r.outputColorSpace)),H.push(V.customProgramCacheKey),H.join()}function U(V,H){V.push(H.precision),V.push(H.outputColorSpace),V.push(H.envMapMode),V.push(H.envMapCubeUVHeight),V.push(H.mapUv),V.push(H.alphaMapUv),V.push(H.lightMapUv),V.push(H.aoMapUv),V.push(H.bumpMapUv),V.push(H.normalMapUv),V.push(H.displacementMapUv),V.push(H.emissiveMapUv),V.push(H.metalnessMapUv),V.push(H.roughnessMapUv),V.push(H.anisotropyMapUv),V.push(H.clearcoatMapUv),V.push(H.clearcoatNormalMapUv),V.push(H.clearcoatRoughnessMapUv),V.push(H.iridescenceMapUv),V.push(H.iridescenceThicknessMapUv),V.push(H.sheenColorMapUv),V.push(H.sheenRoughnessMapUv),V.push(H.specularMapUv),V.push(H.specularColorMapUv),V.push(H.specularIntensityMapUv),V.push(H.transmissionMapUv),V.push(H.thicknessMapUv),V.push(H.combine),V.push(H.fogExp2),V.push(H.sizeAttenuation),V.push(H.morphTargetsCount),V.push(H.morphAttributeCount),V.push(H.numDirLights),V.push(H.numPointLights),V.push(H.numSpotLights),V.push(H.numSpotLightMaps),V.push(H.numHemiLights),V.push(H.numRectAreaLights),V.push(H.numDirLightShadows),V.push(H.numPointLightShadows),V.push(H.numSpotLightShadows),V.push(H.numSpotLightShadowsWithMaps),V.push(H.numLightProbes),V.push(H.shadowMapType),V.push(H.toneMapping),V.push(H.numClippingPlanes),V.push(H.numClipIntersection),V.push(H.depthPacking)}function L(V,H){d.disableAll(),H.supportsVertexTextures&&d.enable(0),H.instancing&&d.enable(1),H.instancingColor&&d.enable(2),H.instancingMorph&&d.enable(3),H.matcap&&d.enable(4),H.envMap&&d.enable(5),H.normalMapObjectSpace&&d.enable(6),H.normalMapTangentSpace&&d.enable(7),H.clearcoat&&d.enable(8),H.iridescence&&d.enable(9),H.alphaTest&&d.enable(10),H.vertexColors&&d.enable(11),H.vertexAlphas&&d.enable(12),H.vertexUv1s&&d.enable(13),H.vertexUv2s&&d.enable(14),H.vertexUv3s&&d.enable(15),H.vertexTangents&&d.enable(16),H.anisotropy&&d.enable(17),H.alphaHash&&d.enable(18),H.batching&&d.enable(19),H.dispersion&&d.enable(20),H.batchingColor&&d.enable(21),V.push(d.mask),d.disableAll(),H.fog&&d.enable(0),H.useFog&&d.enable(1),H.flatShading&&d.enable(2),H.logarithmicDepthBuffer&&d.enable(3),H.reverseDepthBuffer&&d.enable(4),H.skinning&&d.enable(5),H.morphTargets&&d.enable(6),H.morphNormals&&d.enable(7),H.morphColors&&d.enable(8),H.premultipliedAlpha&&d.enable(9),H.shadowMapEnabled&&d.enable(10),H.doubleSided&&d.enable(11),H.flipSided&&d.enable(12),H.useDepthPacking&&d.enable(13),H.dithering&&d.enable(14),H.transmission&&d.enable(15),H.sheen&&d.enable(16),H.opaque&&d.enable(17),H.pointsUvs&&d.enable(18),H.decodeVideoTexture&&d.enable(19),H.decodeVideoTextureEmissive&&d.enable(20),H.alphaToCoverage&&d.enable(21),V.push(d.mask)}function B(V){const H=z[V.type];let J;if(H){const ce=bh[H];J=$R.clone(ce.uniforms)}else J=V.uniforms;return J}function $(V,H){let J;for(let ce=0,he=b.length;ce<he;ce++){const ge=b[ce];if(ge.cacheKey===H){J=ge,++J.usedTimes;break}}return J===void 0&&(J=new V3(r,H,V,l),b.push(J)),J}function X(V){if(--V.usedTimes===0){const H=b.indexOf(V);b[H]=b[b.length-1],b.pop(),V.destroy()}}function Q(V){v.remove(V)}function te(){v.dispose()}return{getParameters:P,getProgramCacheKey:M,getUniforms:B,acquireProgram:$,releaseProgram:X,releaseShaderCache:Q,programs:b,dispose:te}}function X3(){let r=new WeakMap;function e(f){return r.has(f)}function t(f){let d=r.get(f);return d===void 0&&(d={},r.set(f,d)),d}function i(f){r.delete(f)}function o(f,d,v){r.get(f)[d]=v}function l(){r=new WeakMap}return{has:e,get:t,remove:i,update:o,dispose:l}}function q3(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function FE(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function OE(){const r=[];let e=0;const t=[],i=[],o=[];function l(){e=0,t.length=0,i.length=0,o.length=0}function f(w,C,R,z,O,P){let M=r[e];return M===void 0?(M={id:w.id,object:w,geometry:C,material:R,groupOrder:z,renderOrder:w.renderOrder,z:O,group:P},r[e]=M):(M.id=w.id,M.object=w,M.geometry=C,M.material=R,M.groupOrder=z,M.renderOrder=w.renderOrder,M.z=O,M.group=P),e++,M}function d(w,C,R,z,O,P){const M=f(w,C,R,z,O,P);R.transmission>0?i.push(M):R.transparent===!0?o.push(M):t.push(M)}function v(w,C,R,z,O,P){const M=f(w,C,R,z,O,P);R.transmission>0?i.unshift(M):R.transparent===!0?o.unshift(M):t.unshift(M)}function _(w,C){t.length>1&&t.sort(w||q3),i.length>1&&i.sort(C||FE),o.length>1&&o.sort(C||FE)}function b(){for(let w=e,C=r.length;w<C;w++){const R=r[w];if(R.id===null)break;R.id=null,R.object=null,R.geometry=null,R.material=null,R.group=null}}return{opaque:t,transmissive:i,transparent:o,init:l,push:d,unshift:v,finish:b,sort:_}}function $3(){let r=new WeakMap;function e(i,o){const l=r.get(i);let f;return l===void 0?(f=new OE,r.set(i,[f])):o>=l.length?(f=new OE,l.push(f)):f=l[o],f}function t(){r=new WeakMap}return{get:e,dispose:t}}function Y3(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new be,color:new Ht};break;case"SpotLight":t={position:new be,direction:new be,color:new Ht,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new be,color:new Ht,distance:0,decay:0};break;case"HemisphereLight":t={direction:new be,skyColor:new Ht,groundColor:new Ht};break;case"RectAreaLight":t={color:new Ht,position:new be,halfWidth:new be,halfHeight:new be};break}return r[e.id]=t,t}}}function K3(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new At};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new At};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new At,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let Z3=0;function J3(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function Q3(r){const e=new Y3,t=K3(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let _=0;_<9;_++)i.probe.push(new be);const o=new be,l=new hi,f=new hi;function d(_){let b=0,w=0,C=0;for(let V=0;V<9;V++)i.probe[V].set(0,0,0);let R=0,z=0,O=0,P=0,M=0,U=0,L=0,B=0,$=0,X=0,Q=0;_.sort(J3);for(let V=0,H=_.length;V<H;V++){const J=_[V],ce=J.color,he=J.intensity,ge=J.distance,Ae=J.shadow&&J.shadow.map?J.shadow.map.texture:null;if(J.isAmbientLight)b+=ce.r*he,w+=ce.g*he,C+=ce.b*he;else if(J.isLightProbe){for(let me=0;me<9;me++)i.probe[me].addScaledVector(J.sh.coefficients[me],he);Q++}else if(J.isDirectionalLight){const me=e.get(J);if(me.color.copy(J.color).multiplyScalar(J.intensity),J.castShadow){const Ie=J.shadow,ae=t.get(J);ae.shadowIntensity=Ie.intensity,ae.shadowBias=Ie.bias,ae.shadowNormalBias=Ie.normalBias,ae.shadowRadius=Ie.radius,ae.shadowMapSize=Ie.mapSize,i.directionalShadow[R]=ae,i.directionalShadowMap[R]=Ae,i.directionalShadowMatrix[R]=J.shadow.matrix,U++}i.directional[R]=me,R++}else if(J.isSpotLight){const me=e.get(J);me.position.setFromMatrixPosition(J.matrixWorld),me.color.copy(ce).multiplyScalar(he),me.distance=ge,me.coneCos=Math.cos(J.angle),me.penumbraCos=Math.cos(J.angle*(1-J.penumbra)),me.decay=J.decay,i.spot[O]=me;const Ie=J.shadow;if(J.map&&(i.spotLightMap[$]=J.map,$++,Ie.updateMatrices(J),J.castShadow&&X++),i.spotLightMatrix[O]=Ie.matrix,J.castShadow){const ae=t.get(J);ae.shadowIntensity=Ie.intensity,ae.shadowBias=Ie.bias,ae.shadowNormalBias=Ie.normalBias,ae.shadowRadius=Ie.radius,ae.shadowMapSize=Ie.mapSize,i.spotShadow[O]=ae,i.spotShadowMap[O]=Ae,B++}O++}else if(J.isRectAreaLight){const me=e.get(J);me.color.copy(ce).multiplyScalar(he),me.halfWidth.set(J.width*.5,0,0),me.halfHeight.set(0,J.height*.5,0),i.rectArea[P]=me,P++}else if(J.isPointLight){const me=e.get(J);if(me.color.copy(J.color).multiplyScalar(J.intensity),me.distance=J.distance,me.decay=J.decay,J.castShadow){const Ie=J.shadow,ae=t.get(J);ae.shadowIntensity=Ie.intensity,ae.shadowBias=Ie.bias,ae.shadowNormalBias=Ie.normalBias,ae.shadowRadius=Ie.radius,ae.shadowMapSize=Ie.mapSize,ae.shadowCameraNear=Ie.camera.near,ae.shadowCameraFar=Ie.camera.far,i.pointShadow[z]=ae,i.pointShadowMap[z]=Ae,i.pointShadowMatrix[z]=J.shadow.matrix,L++}i.point[z]=me,z++}else if(J.isHemisphereLight){const me=e.get(J);me.skyColor.copy(J.color).multiplyScalar(he),me.groundColor.copy(J.groundColor).multiplyScalar(he),i.hemi[M]=me,M++}}P>0&&(r.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=kt.LTC_FLOAT_1,i.rectAreaLTC2=kt.LTC_FLOAT_2):(i.rectAreaLTC1=kt.LTC_HALF_1,i.rectAreaLTC2=kt.LTC_HALF_2)),i.ambient[0]=b,i.ambient[1]=w,i.ambient[2]=C;const te=i.hash;(te.directionalLength!==R||te.pointLength!==z||te.spotLength!==O||te.rectAreaLength!==P||te.hemiLength!==M||te.numDirectionalShadows!==U||te.numPointShadows!==L||te.numSpotShadows!==B||te.numSpotMaps!==$||te.numLightProbes!==Q)&&(i.directional.length=R,i.spot.length=O,i.rectArea.length=P,i.point.length=z,i.hemi.length=M,i.directionalShadow.length=U,i.directionalShadowMap.length=U,i.pointShadow.length=L,i.pointShadowMap.length=L,i.spotShadow.length=B,i.spotShadowMap.length=B,i.directionalShadowMatrix.length=U,i.pointShadowMatrix.length=L,i.spotLightMatrix.length=B+$-X,i.spotLightMap.length=$,i.numSpotLightShadowsWithMaps=X,i.numLightProbes=Q,te.directionalLength=R,te.pointLength=z,te.spotLength=O,te.rectAreaLength=P,te.hemiLength=M,te.numDirectionalShadows=U,te.numPointShadows=L,te.numSpotShadows=B,te.numSpotMaps=$,te.numLightProbes=Q,i.version=Z3++)}function v(_,b){let w=0,C=0,R=0,z=0,O=0;const P=b.matrixWorldInverse;for(let M=0,U=_.length;M<U;M++){const L=_[M];if(L.isDirectionalLight){const B=i.directional[w];B.direction.setFromMatrixPosition(L.matrixWorld),o.setFromMatrixPosition(L.target.matrixWorld),B.direction.sub(o),B.direction.transformDirection(P),w++}else if(L.isSpotLight){const B=i.spot[R];B.position.setFromMatrixPosition(L.matrixWorld),B.position.applyMatrix4(P),B.direction.setFromMatrixPosition(L.matrixWorld),o.setFromMatrixPosition(L.target.matrixWorld),B.direction.sub(o),B.direction.transformDirection(P),R++}else if(L.isRectAreaLight){const B=i.rectArea[z];B.position.setFromMatrixPosition(L.matrixWorld),B.position.applyMatrix4(P),f.identity(),l.copy(L.matrixWorld),l.premultiply(P),f.extractRotation(l),B.halfWidth.set(L.width*.5,0,0),B.halfHeight.set(0,L.height*.5,0),B.halfWidth.applyMatrix4(f),B.halfHeight.applyMatrix4(f),z++}else if(L.isPointLight){const B=i.point[C];B.position.setFromMatrixPosition(L.matrixWorld),B.position.applyMatrix4(P),C++}else if(L.isHemisphereLight){const B=i.hemi[O];B.direction.setFromMatrixPosition(L.matrixWorld),B.direction.transformDirection(P),O++}}}return{setup:d,setupView:v,state:i}}function NE(r){const e=new Q3(r),t=[],i=[];function o(b){_.camera=b,t.length=0,i.length=0}function l(b){t.push(b)}function f(b){i.push(b)}function d(){e.setup(t)}function v(b){e.setupView(t,b)}const _={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:o,state:_,setupLights:d,setupLightsView:v,pushLight:l,pushShadow:f}}function ek(r){let e=new WeakMap;function t(o,l=0){const f=e.get(o);let d;return f===void 0?(d=new NE(r),e.set(o,[d])):l>=f.length?(d=new NE(r),f.push(d)):d=f[l],d}function i(){e=new WeakMap}return{get:t,dispose:i}}const tk=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,nk=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function ik(r,e,t){let i=new Tw;const o=new At,l=new At,f=new Xi,d=new b2({depthPacking:vR}),v=new x2,_={},b=t.maxTextureSize,w={[Ku]:Ml,[Ml]:Ku,[of]:of},C=new Vc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new At},radius:{value:4}},vertexShader:tk,fragmentShader:nk}),R=C.clone();R.defines.HORIZONTAL_PASS=1;const z=new is;z.setAttribute("position",new ns(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const O=new Cr(z,C),P=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=wT;let M=this.type;this.render=function(X,Q,te){if(P.enabled===!1||P.autoUpdate===!1&&P.needsUpdate===!1||X.length===0)return;const V=r.getRenderTarget(),H=r.getActiveCubeFace(),J=r.getActiveMipmapLevel(),ce=r.state;ce.setBlending(fd),ce.buffers.color.setClear(1,1,1,1),ce.buffers.depth.setTest(!0),ce.setScissorTest(!1);const he=M!==sf&&this.type===sf,ge=M===sf&&this.type!==sf;for(let Ae=0,me=X.length;Ae<me;Ae++){const Ie=X[Ae],ae=Ie.shadow;if(ae===void 0){console.warn("THREE.WebGLShadowMap:",Ie,"has no shadow.");continue}if(ae.autoUpdate===!1&&ae.needsUpdate===!1)continue;o.copy(ae.mapSize);const ye=ae.getFrameExtents();if(o.multiply(ye),l.copy(ae.mapSize),(o.x>b||o.y>b)&&(o.x>b&&(l.x=Math.floor(b/ye.x),o.x=l.x*ye.x,ae.mapSize.x=l.x),o.y>b&&(l.y=Math.floor(b/ye.y),o.y=l.y*ye.y,ae.mapSize.y=l.y)),ae.map===null||he===!0||ge===!0){const ie=this.type!==sf?{minFilter:ir,magFilter:ir}:{};ae.map!==null&&ae.map.dispose(),ae.map=new El(o.x,o.y,ie),ae.map.texture.name=Ie.name+".shadowMap",ae.camera.updateProjectionMatrix()}r.setRenderTarget(ae.map),r.clear();const de=ae.getViewportCount();for(let ie=0;ie<de;ie++){const we=ae.getViewport(ie);f.set(l.x*we.x,l.y*we.y,l.x*we.z,l.y*we.w),ce.viewport(f),ae.updateMatrices(Ie,ie),i=ae.getFrustum(),B(Q,te,ae.camera,Ie,this.type)}ae.isPointLightShadow!==!0&&this.type===sf&&U(ae,te),ae.needsUpdate=!1}M=this.type,P.needsUpdate=!1,r.setRenderTarget(V,H,J)};function U(X,Q){const te=e.update(O);C.defines.VSM_SAMPLES!==X.blurSamples&&(C.defines.VSM_SAMPLES=X.blurSamples,R.defines.VSM_SAMPLES=X.blurSamples,C.needsUpdate=!0,R.needsUpdate=!0),X.mapPass===null&&(X.mapPass=new El(o.x,o.y)),C.uniforms.shadow_pass.value=X.map.texture,C.uniforms.resolution.value=X.mapSize,C.uniforms.radius.value=X.radius,r.setRenderTarget(X.mapPass),r.clear(),r.renderBufferDirect(Q,null,te,C,O,null),R.uniforms.shadow_pass.value=X.mapPass.texture,R.uniforms.resolution.value=X.mapSize,R.uniforms.radius.value=X.radius,r.setRenderTarget(X.map),r.clear(),r.renderBufferDirect(Q,null,te,R,O,null)}function L(X,Q,te,V){let H=null;const J=te.isPointLight===!0?X.customDistanceMaterial:X.customDepthMaterial;if(J!==void 0)H=J;else if(H=te.isPointLight===!0?v:d,r.localClippingEnabled&&Q.clipShadows===!0&&Array.isArray(Q.clippingPlanes)&&Q.clippingPlanes.length!==0||Q.displacementMap&&Q.displacementScale!==0||Q.alphaMap&&Q.alphaTest>0||Q.map&&Q.alphaTest>0){const ce=H.uuid,he=Q.uuid;let ge=_[ce];ge===void 0&&(ge={},_[ce]=ge);let Ae=ge[he];Ae===void 0&&(Ae=H.clone(),ge[he]=Ae,Q.addEventListener("dispose",$)),H=Ae}if(H.visible=Q.visible,H.wireframe=Q.wireframe,V===sf?H.side=Q.shadowSide!==null?Q.shadowSide:Q.side:H.side=Q.shadowSide!==null?Q.shadowSide:w[Q.side],H.alphaMap=Q.alphaMap,H.alphaTest=Q.alphaTest,H.map=Q.map,H.clipShadows=Q.clipShadows,H.clippingPlanes=Q.clippingPlanes,H.clipIntersection=Q.clipIntersection,H.displacementMap=Q.displacementMap,H.displacementScale=Q.displacementScale,H.displacementBias=Q.displacementBias,H.wireframeLinewidth=Q.wireframeLinewidth,H.linewidth=Q.linewidth,te.isPointLight===!0&&H.isMeshDistanceMaterial===!0){const ce=r.properties.get(H);ce.light=te}return H}function B(X,Q,te,V,H){if(X.visible===!1)return;if(X.layers.test(Q.layers)&&(X.isMesh||X.isLine||X.isPoints)&&(X.castShadow||X.receiveShadow&&H===sf)&&(!X.frustumCulled||i.intersectsObject(X))){X.modelViewMatrix.multiplyMatrices(te.matrixWorldInverse,X.matrixWorld);const he=e.update(X),ge=X.material;if(Array.isArray(ge)){const Ae=he.groups;for(let me=0,Ie=Ae.length;me<Ie;me++){const ae=Ae[me],ye=ge[ae.materialIndex];if(ye&&ye.visible){const de=L(X,ye,V,H);X.onBeforeShadow(r,X,Q,te,he,de,ae),r.renderBufferDirect(te,null,he,de,X,ae),X.onAfterShadow(r,X,Q,te,he,de,ae)}}}else if(ge.visible){const Ae=L(X,ge,V,H);X.onBeforeShadow(r,X,Q,te,he,Ae,null),r.renderBufferDirect(te,null,he,Ae,X,null),X.onAfterShadow(r,X,Q,te,he,Ae,null)}}const ce=X.children;for(let he=0,ge=ce.length;he<ge;he++)B(ce[he],Q,te,V,H)}function $(X){X.target.removeEventListener("dispose",$);for(const te in _){const V=_[te],H=X.target.uuid;H in V&&(V[H].dispose(),delete V[H])}}}const rk={[ix]:rx,[sx]:lx,[ox]:ux,[Mm]:ax,[rx]:ix,[lx]:sx,[ux]:ox,[ax]:Mm};function sk(r,e){function t(){let Re=!1;const gt=new Xi;let je=null;const Ke=new Xi(0,0,0,0);return{setMask:function(Mt){je!==Mt&&!Re&&(r.colorMask(Mt,Mt,Mt,Mt),je=Mt)},setLocked:function(Mt){Re=Mt},setClear:function(Mt,Et,mn,Bn,Ti){Ti===!0&&(Mt*=Bn,Et*=Bn,mn*=Bn),gt.set(Mt,Et,mn,Bn),Ke.equals(gt)===!1&&(r.clearColor(Mt,Et,mn,Bn),Ke.copy(gt))},reset:function(){Re=!1,je=null,Ke.set(-1,0,0,0)}}}function i(){let Re=!1,gt=!1,je=null,Ke=null,Mt=null;return{setReversed:function(Et){if(gt!==Et){const mn=e.get("EXT_clip_control");gt?mn.clipControlEXT(mn.LOWER_LEFT_EXT,mn.ZERO_TO_ONE_EXT):mn.clipControlEXT(mn.LOWER_LEFT_EXT,mn.NEGATIVE_ONE_TO_ONE_EXT);const Bn=Mt;Mt=null,this.setClear(Bn)}gt=Et},getReversed:function(){return gt},setTest:function(Et){Et?Be(r.DEPTH_TEST):He(r.DEPTH_TEST)},setMask:function(Et){je!==Et&&!Re&&(r.depthMask(Et),je=Et)},setFunc:function(Et){if(gt&&(Et=rk[Et]),Ke!==Et){switch(Et){case ix:r.depthFunc(r.NEVER);break;case rx:r.depthFunc(r.ALWAYS);break;case sx:r.depthFunc(r.LESS);break;case Mm:r.depthFunc(r.LEQUAL);break;case ox:r.depthFunc(r.EQUAL);break;case ax:r.depthFunc(r.GEQUAL);break;case lx:r.depthFunc(r.GREATER);break;case ux:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}Ke=Et}},setLocked:function(Et){Re=Et},setClear:function(Et){Mt!==Et&&(gt&&(Et=1-Et),r.clearDepth(Et),Mt=Et)},reset:function(){Re=!1,je=null,Ke=null,Mt=null,gt=!1}}}function o(){let Re=!1,gt=null,je=null,Ke=null,Mt=null,Et=null,mn=null,Bn=null,Ti=null;return{setTest:function(vn){Re||(vn?Be(r.STENCIL_TEST):He(r.STENCIL_TEST))},setMask:function(vn){gt!==vn&&!Re&&(r.stencilMask(vn),gt=vn)},setFunc:function(vn,yr,_i){(je!==vn||Ke!==yr||Mt!==_i)&&(r.stencilFunc(vn,yr,_i),je=vn,Ke=yr,Mt=_i)},setOp:function(vn,yr,_i){(Et!==vn||mn!==yr||Bn!==_i)&&(r.stencilOp(vn,yr,_i),Et=vn,mn=yr,Bn=_i)},setLocked:function(vn){Re=vn},setClear:function(vn){Ti!==vn&&(r.clearStencil(vn),Ti=vn)},reset:function(){Re=!1,gt=null,je=null,Ke=null,Mt=null,Et=null,mn=null,Bn=null,Ti=null}}}const l=new t,f=new i,d=new o,v=new WeakMap,_=new WeakMap;let b={},w={},C=new WeakMap,R=[],z=null,O=!1,P=null,M=null,U=null,L=null,B=null,$=null,X=null,Q=new Ht(0,0,0),te=0,V=!1,H=null,J=null,ce=null,he=null,ge=null;const Ae=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let me=!1,Ie=0;const ae=r.getParameter(r.VERSION);ae.indexOf("WebGL")!==-1?(Ie=parseFloat(/^WebGL (\d)/.exec(ae)[1]),me=Ie>=1):ae.indexOf("OpenGL ES")!==-1&&(Ie=parseFloat(/^OpenGL ES (\d)/.exec(ae)[1]),me=Ie>=2);let ye=null,de={};const ie=r.getParameter(r.SCISSOR_BOX),we=r.getParameter(r.VIEWPORT),ze=new Xi().fromArray(ie),se=new Xi().fromArray(we);function fe(Re,gt,je,Ke){const Mt=new Uint8Array(4),Et=r.createTexture();r.bindTexture(Re,Et),r.texParameteri(Re,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(Re,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let mn=0;mn<je;mn++)Re===r.TEXTURE_3D||Re===r.TEXTURE_2D_ARRAY?r.texImage3D(gt,0,r.RGBA,1,1,Ke,0,r.RGBA,r.UNSIGNED_BYTE,Mt):r.texImage2D(gt+mn,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,Mt);return Et}const Le={};Le[r.TEXTURE_2D]=fe(r.TEXTURE_2D,r.TEXTURE_2D,1),Le[r.TEXTURE_CUBE_MAP]=fe(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),Le[r.TEXTURE_2D_ARRAY]=fe(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),Le[r.TEXTURE_3D]=fe(r.TEXTURE_3D,r.TEXTURE_3D,1,1),l.setClear(0,0,0,1),f.setClear(1),d.setClear(0),Be(r.DEPTH_TEST),f.setFunc(Mm),on(!1),Nt(IS),Be(r.CULL_FACE),_e(fd);function Be(Re){b[Re]!==!0&&(r.enable(Re),b[Re]=!0)}function He(Re){b[Re]!==!1&&(r.disable(Re),b[Re]=!1)}function et(Re,gt){return w[Re]!==gt?(r.bindFramebuffer(Re,gt),w[Re]=gt,Re===r.DRAW_FRAMEBUFFER&&(w[r.FRAMEBUFFER]=gt),Re===r.FRAMEBUFFER&&(w[r.DRAW_FRAMEBUFFER]=gt),!0):!1}function pt(Re,gt){let je=R,Ke=!1;if(Re){je=C.get(gt),je===void 0&&(je=[],C.set(gt,je));const Mt=Re.textures;if(je.length!==Mt.length||je[0]!==r.COLOR_ATTACHMENT0){for(let Et=0,mn=Mt.length;Et<mn;Et++)je[Et]=r.COLOR_ATTACHMENT0+Et;je.length=Mt.length,Ke=!0}}else je[0]!==r.BACK&&(je[0]=r.BACK,Ke=!0);Ke&&r.drawBuffers(je)}function Wt(Re){return z!==Re?(r.useProgram(Re),z=Re,!0):!1}const zt={[lp]:r.FUNC_ADD,[GP]:r.FUNC_SUBTRACT,[HP]:r.FUNC_REVERSE_SUBTRACT};zt[WP]=r.MIN,zt[jP]=r.MAX;const bn={[XP]:r.ZERO,[qP]:r.ONE,[$P]:r.SRC_COLOR,[tx]:r.SRC_ALPHA,[eR]:r.SRC_ALPHA_SATURATE,[JP]:r.DST_COLOR,[KP]:r.DST_ALPHA,[YP]:r.ONE_MINUS_SRC_COLOR,[nx]:r.ONE_MINUS_SRC_ALPHA,[QP]:r.ONE_MINUS_DST_COLOR,[ZP]:r.ONE_MINUS_DST_ALPHA,[tR]:r.CONSTANT_COLOR,[nR]:r.ONE_MINUS_CONSTANT_COLOR,[iR]:r.CONSTANT_ALPHA,[rR]:r.ONE_MINUS_CONSTANT_ALPHA};function _e(Re,gt,je,Ke,Mt,Et,mn,Bn,Ti,vn){if(Re===fd){O===!0&&(He(r.BLEND),O=!1);return}if(O===!1&&(Be(r.BLEND),O=!0),Re!==VP){if(Re!==P||vn!==V){if((M!==lp||B!==lp)&&(r.blendEquation(r.FUNC_ADD),M=lp,B=lp),vn)switch(Re){case Sm:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case DS:r.blendFunc(r.ONE,r.ONE);break;case LS:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case kS:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Re);break}else switch(Re){case Sm:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case DS:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case LS:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case kS:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Re);break}U=null,L=null,$=null,X=null,Q.set(0,0,0),te=0,P=Re,V=vn}return}Mt=Mt||gt,Et=Et||je,mn=mn||Ke,(gt!==M||Mt!==B)&&(r.blendEquationSeparate(zt[gt],zt[Mt]),M=gt,B=Mt),(je!==U||Ke!==L||Et!==$||mn!==X)&&(r.blendFuncSeparate(bn[je],bn[Ke],bn[Et],bn[mn]),U=je,L=Ke,$=Et,X=mn),(Bn.equals(Q)===!1||Ti!==te)&&(r.blendColor(Bn.r,Bn.g,Bn.b,Ti),Q.copy(Bn),te=Ti),P=Re,V=!1}function Ln(Re,gt){Re.side===of?He(r.CULL_FACE):Be(r.CULL_FACE);let je=Re.side===Ml;gt&&(je=!je),on(je),Re.blending===Sm&&Re.transparent===!1?_e(fd):_e(Re.blending,Re.blendEquation,Re.blendSrc,Re.blendDst,Re.blendEquationAlpha,Re.blendSrcAlpha,Re.blendDstAlpha,Re.blendColor,Re.blendAlpha,Re.premultipliedAlpha),f.setFunc(Re.depthFunc),f.setTest(Re.depthTest),f.setMask(Re.depthWrite),l.setMask(Re.colorWrite);const Ke=Re.stencilWrite;d.setTest(Ke),Ke&&(d.setMask(Re.stencilWriteMask),d.setFunc(Re.stencilFunc,Re.stencilRef,Re.stencilFuncMask),d.setOp(Re.stencilFail,Re.stencilZFail,Re.stencilZPass)),Mn(Re.polygonOffset,Re.polygonOffsetFactor,Re.polygonOffsetUnits),Re.alphaToCoverage===!0?Be(r.SAMPLE_ALPHA_TO_COVERAGE):He(r.SAMPLE_ALPHA_TO_COVERAGE)}function on(Re){H!==Re&&(Re?r.frontFace(r.CW):r.frontFace(r.CCW),H=Re)}function Nt(Re){Re!==UP?(Be(r.CULL_FACE),Re!==J&&(Re===IS?r.cullFace(r.BACK):Re===BP?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):He(r.CULL_FACE),J=Re}function Vt(Re){Re!==ce&&(me&&r.lineWidth(Re),ce=Re)}function Mn(Re,gt,je){Re?(Be(r.POLYGON_OFFSET_FILL),(he!==gt||ge!==je)&&(r.polygonOffset(gt,je),he=gt,ge=je)):He(r.POLYGON_OFFSET_FILL)}function Dt(Re){Re?Be(r.SCISSOR_TEST):He(r.SCISSOR_TEST)}function le(Re){Re===void 0&&(Re=r.TEXTURE0+Ae-1),ye!==Re&&(r.activeTexture(Re),ye=Re)}function ne(Re,gt,je){je===void 0&&(ye===null?je=r.TEXTURE0+Ae-1:je=ye);let Ke=de[je];Ke===void 0&&(Ke={type:void 0,texture:void 0},de[je]=Ke),(Ke.type!==Re||Ke.texture!==gt)&&(ye!==je&&(r.activeTexture(je),ye=je),r.bindTexture(Re,gt||Le[Re]),Ke.type=Re,Ke.texture=gt)}function Oe(){const Re=de[ye];Re!==void 0&&Re.type!==void 0&&(r.bindTexture(Re.type,null),Re.type=void 0,Re.texture=void 0)}function Ze(){try{r.compressedTexImage2D.apply(r,arguments)}catch(Re){console.error("THREE.WebGLState:",Re)}}function Je(){try{r.compressedTexImage3D.apply(r,arguments)}catch(Re){console.error("THREE.WebGLState:",Re)}}function Ye(){try{r.texSubImage2D.apply(r,arguments)}catch(Re){console.error("THREE.WebGLState:",Re)}}function Pt(){try{r.texSubImage3D.apply(r,arguments)}catch(Re){console.error("THREE.WebGLState:",Re)}}function ht(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(Re){console.error("THREE.WebGLState:",Re)}}function _t(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(Re){console.error("THREE.WebGLState:",Re)}}function fn(){try{r.texStorage2D.apply(r,arguments)}catch(Re){console.error("THREE.WebGLState:",Re)}}function it(){try{r.texStorage3D.apply(r,arguments)}catch(Re){console.error("THREE.WebGLState:",Re)}}function St(){try{r.texImage2D.apply(r,arguments)}catch(Re){console.error("THREE.WebGLState:",Re)}}function jt(){try{r.texImage3D.apply(r,arguments)}catch(Re){console.error("THREE.WebGLState:",Re)}}function tn(Re){ze.equals(Re)===!1&&(r.scissor(Re.x,Re.y,Re.z,Re.w),ze.copy(Re))}function xt(Re){se.equals(Re)===!1&&(r.viewport(Re.x,Re.y,Re.z,Re.w),se.copy(Re))}function pn(Re,gt){let je=_.get(gt);je===void 0&&(je=new WeakMap,_.set(gt,je));let Ke=je.get(Re);Ke===void 0&&(Ke=r.getUniformBlockIndex(gt,Re.name),je.set(Re,Ke))}function nn(Re,gt){const Ke=_.get(gt).get(Re);v.get(gt)!==Ke&&(r.uniformBlockBinding(gt,Ke,Re.__bindingPointIndex),v.set(gt,Ke))}function Vn(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),f.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),b={},ye=null,de={},w={},C=new WeakMap,R=[],z=null,O=!1,P=null,M=null,U=null,L=null,B=null,$=null,X=null,Q=new Ht(0,0,0),te=0,V=!1,H=null,J=null,ce=null,he=null,ge=null,ze.set(0,0,r.canvas.width,r.canvas.height),se.set(0,0,r.canvas.width,r.canvas.height),l.reset(),f.reset(),d.reset()}return{buffers:{color:l,depth:f,stencil:d},enable:Be,disable:He,bindFramebuffer:et,drawBuffers:pt,useProgram:Wt,setBlending:_e,setMaterial:Ln,setFlipSided:on,setCullFace:Nt,setLineWidth:Vt,setPolygonOffset:Mn,setScissorTest:Dt,activeTexture:le,bindTexture:ne,unbindTexture:Oe,compressedTexImage2D:Ze,compressedTexImage3D:Je,texImage2D:St,texImage3D:jt,updateUBOMapping:pn,uniformBlockBinding:nn,texStorage2D:fn,texStorage3D:it,texSubImage2D:Ye,texSubImage3D:Pt,compressedTexSubImage2D:ht,compressedTexSubImage3D:_t,scissor:tn,viewport:xt,reset:Vn}}function ok(r,e,t,i,o,l,f){const d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,v=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),_=new At,b=new WeakMap;let w;const C=new WeakMap;let R=!1;try{R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function z(le,ne){return R?new OffscreenCanvas(le,ne):N0("canvas")}function O(le,ne,Oe){let Ze=1;const Je=Dt(le);if((Je.width>Oe||Je.height>Oe)&&(Ze=Oe/Math.max(Je.width,Je.height)),Ze<1)if(typeof HTMLImageElement<"u"&&le instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&le instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&le instanceof ImageBitmap||typeof VideoFrame<"u"&&le instanceof VideoFrame){const Ye=Math.floor(Ze*Je.width),Pt=Math.floor(Ze*Je.height);w===void 0&&(w=z(Ye,Pt));const ht=ne?z(Ye,Pt):w;return ht.width=Ye,ht.height=Pt,ht.getContext("2d").drawImage(le,0,0,Ye,Pt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Je.width+"x"+Je.height+") to ("+Ye+"x"+Pt+")."),ht}else return"data"in le&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Je.width+"x"+Je.height+")."),le;return le}function P(le){return le.generateMipmaps}function M(le){r.generateMipmap(le)}function U(le){return le.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:le.isWebGL3DRenderTarget?r.TEXTURE_3D:le.isWebGLArrayRenderTarget||le.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function L(le,ne,Oe,Ze,Je=!1){if(le!==null){if(r[le]!==void 0)return r[le];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+le+"'")}let Ye=ne;if(ne===r.RED&&(Oe===r.FLOAT&&(Ye=r.R32F),Oe===r.HALF_FLOAT&&(Ye=r.R16F),Oe===r.UNSIGNED_BYTE&&(Ye=r.R8)),ne===r.RED_INTEGER&&(Oe===r.UNSIGNED_BYTE&&(Ye=r.R8UI),Oe===r.UNSIGNED_SHORT&&(Ye=r.R16UI),Oe===r.UNSIGNED_INT&&(Ye=r.R32UI),Oe===r.BYTE&&(Ye=r.R8I),Oe===r.SHORT&&(Ye=r.R16I),Oe===r.INT&&(Ye=r.R32I)),ne===r.RG&&(Oe===r.FLOAT&&(Ye=r.RG32F),Oe===r.HALF_FLOAT&&(Ye=r.RG16F),Oe===r.UNSIGNED_BYTE&&(Ye=r.RG8)),ne===r.RG_INTEGER&&(Oe===r.UNSIGNED_BYTE&&(Ye=r.RG8UI),Oe===r.UNSIGNED_SHORT&&(Ye=r.RG16UI),Oe===r.UNSIGNED_INT&&(Ye=r.RG32UI),Oe===r.BYTE&&(Ye=r.RG8I),Oe===r.SHORT&&(Ye=r.RG16I),Oe===r.INT&&(Ye=r.RG32I)),ne===r.RGB_INTEGER&&(Oe===r.UNSIGNED_BYTE&&(Ye=r.RGB8UI),Oe===r.UNSIGNED_SHORT&&(Ye=r.RGB16UI),Oe===r.UNSIGNED_INT&&(Ye=r.RGB32UI),Oe===r.BYTE&&(Ye=r.RGB8I),Oe===r.SHORT&&(Ye=r.RGB16I),Oe===r.INT&&(Ye=r.RGB32I)),ne===r.RGBA_INTEGER&&(Oe===r.UNSIGNED_BYTE&&(Ye=r.RGBA8UI),Oe===r.UNSIGNED_SHORT&&(Ye=r.RGBA16UI),Oe===r.UNSIGNED_INT&&(Ye=r.RGBA32UI),Oe===r.BYTE&&(Ye=r.RGBA8I),Oe===r.SHORT&&(Ye=r.RGBA16I),Oe===r.INT&&(Ye=r.RGBA32I)),ne===r.RGB&&Oe===r.UNSIGNED_INT_5_9_9_9_REV&&(Ye=r.RGB9_E5),ne===r.RGBA){const Pt=Je?F0:Ci.getTransfer(Ze);Oe===r.FLOAT&&(Ye=r.RGBA32F),Oe===r.HALF_FLOAT&&(Ye=r.RGBA16F),Oe===r.UNSIGNED_BYTE&&(Ye=Pt===Yi?r.SRGB8_ALPHA8:r.RGBA8),Oe===r.UNSIGNED_SHORT_4_4_4_4&&(Ye=r.RGBA4),Oe===r.UNSIGNED_SHORT_5_5_5_1&&(Ye=r.RGB5_A1)}return(Ye===r.R16F||Ye===r.R32F||Ye===r.RG16F||Ye===r.RG32F||Ye===r.RGBA16F||Ye===r.RGBA32F)&&e.get("EXT_color_buffer_float"),Ye}function B(le,ne){let Oe;return le?ne===null||ne===xp||ne===Rm?Oe=r.DEPTH24_STENCIL8:ne===fo?Oe=r.DEPTH32F_STENCIL8:ne===fg&&(Oe=r.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):ne===null||ne===xp||ne===Rm?Oe=r.DEPTH_COMPONENT24:ne===fo?Oe=r.DEPTH_COMPONENT32F:ne===fg&&(Oe=r.DEPTH_COMPONENT16),Oe}function $(le,ne){return P(le)===!0||le.isFramebufferTexture&&le.minFilter!==ir&&le.minFilter!==Sh?Math.log2(Math.max(ne.width,ne.height))+1:le.mipmaps!==void 0&&le.mipmaps.length>0?le.mipmaps.length:le.isCompressedTexture&&Array.isArray(le.image)?ne.mipmaps.length:1}function X(le){const ne=le.target;ne.removeEventListener("dispose",X),te(ne),ne.isVideoTexture&&b.delete(ne)}function Q(le){const ne=le.target;ne.removeEventListener("dispose",Q),H(ne)}function te(le){const ne=i.get(le);if(ne.__webglInit===void 0)return;const Oe=le.source,Ze=C.get(Oe);if(Ze){const Je=Ze[ne.__cacheKey];Je.usedTimes--,Je.usedTimes===0&&V(le),Object.keys(Ze).length===0&&C.delete(Oe)}i.remove(le)}function V(le){const ne=i.get(le);r.deleteTexture(ne.__webglTexture);const Oe=le.source,Ze=C.get(Oe);delete Ze[ne.__cacheKey],f.memory.textures--}function H(le){const ne=i.get(le);if(le.depthTexture&&(le.depthTexture.dispose(),i.remove(le.depthTexture)),le.isWebGLCubeRenderTarget)for(let Ze=0;Ze<6;Ze++){if(Array.isArray(ne.__webglFramebuffer[Ze]))for(let Je=0;Je<ne.__webglFramebuffer[Ze].length;Je++)r.deleteFramebuffer(ne.__webglFramebuffer[Ze][Je]);else r.deleteFramebuffer(ne.__webglFramebuffer[Ze]);ne.__webglDepthbuffer&&r.deleteRenderbuffer(ne.__webglDepthbuffer[Ze])}else{if(Array.isArray(ne.__webglFramebuffer))for(let Ze=0;Ze<ne.__webglFramebuffer.length;Ze++)r.deleteFramebuffer(ne.__webglFramebuffer[Ze]);else r.deleteFramebuffer(ne.__webglFramebuffer);if(ne.__webglDepthbuffer&&r.deleteRenderbuffer(ne.__webglDepthbuffer),ne.__webglMultisampledFramebuffer&&r.deleteFramebuffer(ne.__webglMultisampledFramebuffer),ne.__webglColorRenderbuffer)for(let Ze=0;Ze<ne.__webglColorRenderbuffer.length;Ze++)ne.__webglColorRenderbuffer[Ze]&&r.deleteRenderbuffer(ne.__webglColorRenderbuffer[Ze]);ne.__webglDepthRenderbuffer&&r.deleteRenderbuffer(ne.__webglDepthRenderbuffer)}const Oe=le.textures;for(let Ze=0,Je=Oe.length;Ze<Je;Ze++){const Ye=i.get(Oe[Ze]);Ye.__webglTexture&&(r.deleteTexture(Ye.__webglTexture),f.memory.textures--),i.remove(Oe[Ze])}i.remove(le)}let J=0;function ce(){J=0}function he(){const le=J;return le>=o.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+le+" texture units while this GPU supports only "+o.maxTextures),J+=1,le}function ge(le){const ne=[];return ne.push(le.wrapS),ne.push(le.wrapT),ne.push(le.wrapR||0),ne.push(le.magFilter),ne.push(le.minFilter),ne.push(le.anisotropy),ne.push(le.internalFormat),ne.push(le.format),ne.push(le.type),ne.push(le.generateMipmaps),ne.push(le.premultiplyAlpha),ne.push(le.flipY),ne.push(le.unpackAlignment),ne.push(le.colorSpace),ne.join()}function Ae(le,ne){const Oe=i.get(le);if(le.isVideoTexture&&Vt(le),le.isRenderTargetTexture===!1&&le.version>0&&Oe.__version!==le.version){const Ze=le.image;if(Ze===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ze.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{se(Oe,le,ne);return}}t.bindTexture(r.TEXTURE_2D,Oe.__webglTexture,r.TEXTURE0+ne)}function me(le,ne){const Oe=i.get(le);if(le.version>0&&Oe.__version!==le.version){se(Oe,le,ne);return}t.bindTexture(r.TEXTURE_2D_ARRAY,Oe.__webglTexture,r.TEXTURE0+ne)}function Ie(le,ne){const Oe=i.get(le);if(le.version>0&&Oe.__version!==le.version){se(Oe,le,ne);return}t.bindTexture(r.TEXTURE_3D,Oe.__webglTexture,r.TEXTURE0+ne)}function ae(le,ne){const Oe=i.get(le);if(le.version>0&&Oe.__version!==le.version){fe(Oe,le,ne);return}t.bindTexture(r.TEXTURE_CUBE_MAP,Oe.__webglTexture,r.TEXTURE0+ne)}const ye={[fx]:r.REPEAT,[pp]:r.CLAMP_TO_EDGE,[dx]:r.MIRRORED_REPEAT},de={[ir]:r.NEAREST,[pR]:r.NEAREST_MIPMAP_NEAREST,[Pg]:r.NEAREST_MIPMAP_LINEAR,[Sh]:r.LINEAR,[qy]:r.LINEAR_MIPMAP_NEAREST,[mp]:r.LINEAR_MIPMAP_LINEAR},ie={[_R]:r.NEVER,[ER]:r.ALWAYS,[yR]:r.LESS,[kT]:r.LEQUAL,[bR]:r.EQUAL,[SR]:r.GEQUAL,[xR]:r.GREATER,[wR]:r.NOTEQUAL};function we(le,ne){if(ne.type===fo&&e.has("OES_texture_float_linear")===!1&&(ne.magFilter===Sh||ne.magFilter===qy||ne.magFilter===Pg||ne.magFilter===mp||ne.minFilter===Sh||ne.minFilter===qy||ne.minFilter===Pg||ne.minFilter===mp)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(le,r.TEXTURE_WRAP_S,ye[ne.wrapS]),r.texParameteri(le,r.TEXTURE_WRAP_T,ye[ne.wrapT]),(le===r.TEXTURE_3D||le===r.TEXTURE_2D_ARRAY)&&r.texParameteri(le,r.TEXTURE_WRAP_R,ye[ne.wrapR]),r.texParameteri(le,r.TEXTURE_MAG_FILTER,de[ne.magFilter]),r.texParameteri(le,r.TEXTURE_MIN_FILTER,de[ne.minFilter]),ne.compareFunction&&(r.texParameteri(le,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(le,r.TEXTURE_COMPARE_FUNC,ie[ne.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(ne.magFilter===ir||ne.minFilter!==Pg&&ne.minFilter!==mp||ne.type===fo&&e.has("OES_texture_float_linear")===!1)return;if(ne.anisotropy>1||i.get(ne).__currentAnisotropy){const Oe=e.get("EXT_texture_filter_anisotropic");r.texParameterf(le,Oe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ne.anisotropy,o.getMaxAnisotropy())),i.get(ne).__currentAnisotropy=ne.anisotropy}}}function ze(le,ne){let Oe=!1;le.__webglInit===void 0&&(le.__webglInit=!0,ne.addEventListener("dispose",X));const Ze=ne.source;let Je=C.get(Ze);Je===void 0&&(Je={},C.set(Ze,Je));const Ye=ge(ne);if(Ye!==le.__cacheKey){Je[Ye]===void 0&&(Je[Ye]={texture:r.createTexture(),usedTimes:0},f.memory.textures++,Oe=!0),Je[Ye].usedTimes++;const Pt=Je[le.__cacheKey];Pt!==void 0&&(Je[le.__cacheKey].usedTimes--,Pt.usedTimes===0&&V(ne)),le.__cacheKey=Ye,le.__webglTexture=Je[Ye].texture}return Oe}function se(le,ne,Oe){let Ze=r.TEXTURE_2D;(ne.isDataArrayTexture||ne.isCompressedArrayTexture)&&(Ze=r.TEXTURE_2D_ARRAY),ne.isData3DTexture&&(Ze=r.TEXTURE_3D);const Je=ze(le,ne),Ye=ne.source;t.bindTexture(Ze,le.__webglTexture,r.TEXTURE0+Oe);const Pt=i.get(Ye);if(Ye.version!==Pt.__version||Je===!0){t.activeTexture(r.TEXTURE0+Oe);const ht=Ci.getPrimaries(Ci.workingColorSpace),_t=ne.colorSpace===ud?null:Ci.getPrimaries(ne.colorSpace),fn=ne.colorSpace===ud||ht===_t?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,ne.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ne.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,ne.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,fn);let it=O(ne.image,!1,o.maxTextureSize);it=Mn(ne,it);const St=l.convert(ne.format,ne.colorSpace),jt=l.convert(ne.type);let tn=L(ne.internalFormat,St,jt,ne.colorSpace,ne.isVideoTexture);we(Ze,ne);let xt;const pn=ne.mipmaps,nn=ne.isVideoTexture!==!0,Vn=Pt.__version===void 0||Je===!0,Re=Ye.dataReady,gt=$(ne,it);if(ne.isDepthTexture)tn=B(ne.format===Im,ne.type),Vn&&(nn?t.texStorage2D(r.TEXTURE_2D,1,tn,it.width,it.height):t.texImage2D(r.TEXTURE_2D,0,tn,it.width,it.height,0,St,jt,null));else if(ne.isDataTexture)if(pn.length>0){nn&&Vn&&t.texStorage2D(r.TEXTURE_2D,gt,tn,pn[0].width,pn[0].height);for(let je=0,Ke=pn.length;je<Ke;je++)xt=pn[je],nn?Re&&t.texSubImage2D(r.TEXTURE_2D,je,0,0,xt.width,xt.height,St,jt,xt.data):t.texImage2D(r.TEXTURE_2D,je,tn,xt.width,xt.height,0,St,jt,xt.data);ne.generateMipmaps=!1}else nn?(Vn&&t.texStorage2D(r.TEXTURE_2D,gt,tn,it.width,it.height),Re&&t.texSubImage2D(r.TEXTURE_2D,0,0,0,it.width,it.height,St,jt,it.data)):t.texImage2D(r.TEXTURE_2D,0,tn,it.width,it.height,0,St,jt,it.data);else if(ne.isCompressedTexture)if(ne.isCompressedArrayTexture){nn&&Vn&&t.texStorage3D(r.TEXTURE_2D_ARRAY,gt,tn,pn[0].width,pn[0].height,it.depth);for(let je=0,Ke=pn.length;je<Ke;je++)if(xt=pn[je],ne.format!==Is)if(St!==null)if(nn){if(Re)if(ne.layerUpdates.size>0){const Mt=dE(xt.width,xt.height,ne.format,ne.type);for(const Et of ne.layerUpdates){const mn=xt.data.subarray(Et*Mt/xt.data.BYTES_PER_ELEMENT,(Et+1)*Mt/xt.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,je,0,0,Et,xt.width,xt.height,1,St,mn)}ne.clearLayerUpdates()}else t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,je,0,0,0,xt.width,xt.height,it.depth,St,xt.data)}else t.compressedTexImage3D(r.TEXTURE_2D_ARRAY,je,tn,xt.width,xt.height,it.depth,0,xt.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else nn?Re&&t.texSubImage3D(r.TEXTURE_2D_ARRAY,je,0,0,0,xt.width,xt.height,it.depth,St,jt,xt.data):t.texImage3D(r.TEXTURE_2D_ARRAY,je,tn,xt.width,xt.height,it.depth,0,St,jt,xt.data)}else{nn&&Vn&&t.texStorage2D(r.TEXTURE_2D,gt,tn,pn[0].width,pn[0].height);for(let je=0,Ke=pn.length;je<Ke;je++)xt=pn[je],ne.format!==Is?St!==null?nn?Re&&t.compressedTexSubImage2D(r.TEXTURE_2D,je,0,0,xt.width,xt.height,St,xt.data):t.compressedTexImage2D(r.TEXTURE_2D,je,tn,xt.width,xt.height,0,xt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):nn?Re&&t.texSubImage2D(r.TEXTURE_2D,je,0,0,xt.width,xt.height,St,jt,xt.data):t.texImage2D(r.TEXTURE_2D,je,tn,xt.width,xt.height,0,St,jt,xt.data)}else if(ne.isDataArrayTexture)if(nn){if(Vn&&t.texStorage3D(r.TEXTURE_2D_ARRAY,gt,tn,it.width,it.height,it.depth),Re)if(ne.layerUpdates.size>0){const je=dE(it.width,it.height,ne.format,ne.type);for(const Ke of ne.layerUpdates){const Mt=it.data.subarray(Ke*je/it.data.BYTES_PER_ELEMENT,(Ke+1)*je/it.data.BYTES_PER_ELEMENT);t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,Ke,it.width,it.height,1,St,jt,Mt)}ne.clearLayerUpdates()}else t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,it.width,it.height,it.depth,St,jt,it.data)}else t.texImage3D(r.TEXTURE_2D_ARRAY,0,tn,it.width,it.height,it.depth,0,St,jt,it.data);else if(ne.isData3DTexture)nn?(Vn&&t.texStorage3D(r.TEXTURE_3D,gt,tn,it.width,it.height,it.depth),Re&&t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,it.width,it.height,it.depth,St,jt,it.data)):t.texImage3D(r.TEXTURE_3D,0,tn,it.width,it.height,it.depth,0,St,jt,it.data);else if(ne.isFramebufferTexture){if(Vn)if(nn)t.texStorage2D(r.TEXTURE_2D,gt,tn,it.width,it.height);else{let je=it.width,Ke=it.height;for(let Mt=0;Mt<gt;Mt++)t.texImage2D(r.TEXTURE_2D,Mt,tn,je,Ke,0,St,jt,null),je>>=1,Ke>>=1}}else if(pn.length>0){if(nn&&Vn){const je=Dt(pn[0]);t.texStorage2D(r.TEXTURE_2D,gt,tn,je.width,je.height)}for(let je=0,Ke=pn.length;je<Ke;je++)xt=pn[je],nn?Re&&t.texSubImage2D(r.TEXTURE_2D,je,0,0,St,jt,xt):t.texImage2D(r.TEXTURE_2D,je,tn,St,jt,xt);ne.generateMipmaps=!1}else if(nn){if(Vn){const je=Dt(it);t.texStorage2D(r.TEXTURE_2D,gt,tn,je.width,je.height)}Re&&t.texSubImage2D(r.TEXTURE_2D,0,0,0,St,jt,it)}else t.texImage2D(r.TEXTURE_2D,0,tn,St,jt,it);P(ne)&&M(Ze),Pt.__version=Ye.version,ne.onUpdate&&ne.onUpdate(ne)}le.__version=ne.version}function fe(le,ne,Oe){if(ne.image.length!==6)return;const Ze=ze(le,ne),Je=ne.source;t.bindTexture(r.TEXTURE_CUBE_MAP,le.__webglTexture,r.TEXTURE0+Oe);const Ye=i.get(Je);if(Je.version!==Ye.__version||Ze===!0){t.activeTexture(r.TEXTURE0+Oe);const Pt=Ci.getPrimaries(Ci.workingColorSpace),ht=ne.colorSpace===ud?null:Ci.getPrimaries(ne.colorSpace),_t=ne.colorSpace===ud||Pt===ht?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,ne.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ne.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,ne.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,_t);const fn=ne.isCompressedTexture||ne.image[0].isCompressedTexture,it=ne.image[0]&&ne.image[0].isDataTexture,St=[];for(let Ke=0;Ke<6;Ke++)!fn&&!it?St[Ke]=O(ne.image[Ke],!0,o.maxCubemapSize):St[Ke]=it?ne.image[Ke].image:ne.image[Ke],St[Ke]=Mn(ne,St[Ke]);const jt=St[0],tn=l.convert(ne.format,ne.colorSpace),xt=l.convert(ne.type),pn=L(ne.internalFormat,tn,xt,ne.colorSpace),nn=ne.isVideoTexture!==!0,Vn=Ye.__version===void 0||Ze===!0,Re=Je.dataReady;let gt=$(ne,jt);we(r.TEXTURE_CUBE_MAP,ne);let je;if(fn){nn&&Vn&&t.texStorage2D(r.TEXTURE_CUBE_MAP,gt,pn,jt.width,jt.height);for(let Ke=0;Ke<6;Ke++){je=St[Ke].mipmaps;for(let Mt=0;Mt<je.length;Mt++){const Et=je[Mt];ne.format!==Is?tn!==null?nn?Re&&t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,Mt,0,0,Et.width,Et.height,tn,Et.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,Mt,pn,Et.width,Et.height,0,Et.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):nn?Re&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,Mt,0,0,Et.width,Et.height,tn,xt,Et.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,Mt,pn,Et.width,Et.height,0,tn,xt,Et.data)}}}else{if(je=ne.mipmaps,nn&&Vn){je.length>0&&gt++;const Ke=Dt(St[0]);t.texStorage2D(r.TEXTURE_CUBE_MAP,gt,pn,Ke.width,Ke.height)}for(let Ke=0;Ke<6;Ke++)if(it){nn?Re&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,0,0,St[Ke].width,St[Ke].height,tn,xt,St[Ke].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,pn,St[Ke].width,St[Ke].height,0,tn,xt,St[Ke].data);for(let Mt=0;Mt<je.length;Mt++){const mn=je[Mt].image[Ke].image;nn?Re&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,Mt+1,0,0,mn.width,mn.height,tn,xt,mn.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,Mt+1,pn,mn.width,mn.height,0,tn,xt,mn.data)}}else{nn?Re&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,0,0,tn,xt,St[Ke]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,pn,tn,xt,St[Ke]);for(let Mt=0;Mt<je.length;Mt++){const Et=je[Mt];nn?Re&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,Mt+1,0,0,tn,xt,Et.image[Ke]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,Mt+1,pn,tn,xt,Et.image[Ke])}}}P(ne)&&M(r.TEXTURE_CUBE_MAP),Ye.__version=Je.version,ne.onUpdate&&ne.onUpdate(ne)}le.__version=ne.version}function Le(le,ne,Oe,Ze,Je,Ye){const Pt=l.convert(Oe.format,Oe.colorSpace),ht=l.convert(Oe.type),_t=L(Oe.internalFormat,Pt,ht,Oe.colorSpace),fn=i.get(ne),it=i.get(Oe);if(it.__renderTarget=ne,!fn.__hasExternalTextures){const St=Math.max(1,ne.width>>Ye),jt=Math.max(1,ne.height>>Ye);Je===r.TEXTURE_3D||Je===r.TEXTURE_2D_ARRAY?t.texImage3D(Je,Ye,_t,St,jt,ne.depth,0,Pt,ht,null):t.texImage2D(Je,Ye,_t,St,jt,0,Pt,ht,null)}t.bindFramebuffer(r.FRAMEBUFFER,le),Nt(ne)?d.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,Ze,Je,it.__webglTexture,0,on(ne)):(Je===r.TEXTURE_2D||Je>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&Je<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,Ze,Je,it.__webglTexture,Ye),t.bindFramebuffer(r.FRAMEBUFFER,null)}function Be(le,ne,Oe){if(r.bindRenderbuffer(r.RENDERBUFFER,le),ne.depthBuffer){const Ze=ne.depthTexture,Je=Ze&&Ze.isDepthTexture?Ze.type:null,Ye=B(ne.stencilBuffer,Je),Pt=ne.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,ht=on(ne);Nt(ne)?d.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,ht,Ye,ne.width,ne.height):Oe?r.renderbufferStorageMultisample(r.RENDERBUFFER,ht,Ye,ne.width,ne.height):r.renderbufferStorage(r.RENDERBUFFER,Ye,ne.width,ne.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,Pt,r.RENDERBUFFER,le)}else{const Ze=ne.textures;for(let Je=0;Je<Ze.length;Je++){const Ye=Ze[Je],Pt=l.convert(Ye.format,Ye.colorSpace),ht=l.convert(Ye.type),_t=L(Ye.internalFormat,Pt,ht,Ye.colorSpace),fn=on(ne);Oe&&Nt(ne)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,fn,_t,ne.width,ne.height):Nt(ne)?d.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,fn,_t,ne.width,ne.height):r.renderbufferStorage(r.RENDERBUFFER,_t,ne.width,ne.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function He(le,ne){if(ne&&ne.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(r.FRAMEBUFFER,le),!(ne.depthTexture&&ne.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ze=i.get(ne.depthTexture);Ze.__renderTarget=ne,(!Ze.__webglTexture||ne.depthTexture.image.width!==ne.width||ne.depthTexture.image.height!==ne.height)&&(ne.depthTexture.image.width=ne.width,ne.depthTexture.image.height=ne.height,ne.depthTexture.needsUpdate=!0),Ae(ne.depthTexture,0);const Je=Ze.__webglTexture,Ye=on(ne);if(ne.depthTexture.format===Em)Nt(ne)?d.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Je,0,Ye):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Je,0);else if(ne.depthTexture.format===Im)Nt(ne)?d.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Je,0,Ye):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Je,0);else throw new Error("Unknown depthTexture format")}function et(le){const ne=i.get(le),Oe=le.isWebGLCubeRenderTarget===!0;if(ne.__boundDepthTexture!==le.depthTexture){const Ze=le.depthTexture;if(ne.__depthDisposeCallback&&ne.__depthDisposeCallback(),Ze){const Je=()=>{delete ne.__boundDepthTexture,delete ne.__depthDisposeCallback,Ze.removeEventListener("dispose",Je)};Ze.addEventListener("dispose",Je),ne.__depthDisposeCallback=Je}ne.__boundDepthTexture=Ze}if(le.depthTexture&&!ne.__autoAllocateDepthBuffer){if(Oe)throw new Error("target.depthTexture not supported in Cube render targets");He(ne.__webglFramebuffer,le)}else if(Oe){ne.__webglDepthbuffer=[];for(let Ze=0;Ze<6;Ze++)if(t.bindFramebuffer(r.FRAMEBUFFER,ne.__webglFramebuffer[Ze]),ne.__webglDepthbuffer[Ze]===void 0)ne.__webglDepthbuffer[Ze]=r.createRenderbuffer(),Be(ne.__webglDepthbuffer[Ze],le,!1);else{const Je=le.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Ye=ne.__webglDepthbuffer[Ze];r.bindRenderbuffer(r.RENDERBUFFER,Ye),r.framebufferRenderbuffer(r.FRAMEBUFFER,Je,r.RENDERBUFFER,Ye)}}else if(t.bindFramebuffer(r.FRAMEBUFFER,ne.__webglFramebuffer),ne.__webglDepthbuffer===void 0)ne.__webglDepthbuffer=r.createRenderbuffer(),Be(ne.__webglDepthbuffer,le,!1);else{const Ze=le.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Je=ne.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,Je),r.framebufferRenderbuffer(r.FRAMEBUFFER,Ze,r.RENDERBUFFER,Je)}t.bindFramebuffer(r.FRAMEBUFFER,null)}function pt(le,ne,Oe){const Ze=i.get(le);ne!==void 0&&Le(Ze.__webglFramebuffer,le,le.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),Oe!==void 0&&et(le)}function Wt(le){const ne=le.texture,Oe=i.get(le),Ze=i.get(ne);le.addEventListener("dispose",Q);const Je=le.textures,Ye=le.isWebGLCubeRenderTarget===!0,Pt=Je.length>1;if(Pt||(Ze.__webglTexture===void 0&&(Ze.__webglTexture=r.createTexture()),Ze.__version=ne.version,f.memory.textures++),Ye){Oe.__webglFramebuffer=[];for(let ht=0;ht<6;ht++)if(ne.mipmaps&&ne.mipmaps.length>0){Oe.__webglFramebuffer[ht]=[];for(let _t=0;_t<ne.mipmaps.length;_t++)Oe.__webglFramebuffer[ht][_t]=r.createFramebuffer()}else Oe.__webglFramebuffer[ht]=r.createFramebuffer()}else{if(ne.mipmaps&&ne.mipmaps.length>0){Oe.__webglFramebuffer=[];for(let ht=0;ht<ne.mipmaps.length;ht++)Oe.__webglFramebuffer[ht]=r.createFramebuffer()}else Oe.__webglFramebuffer=r.createFramebuffer();if(Pt)for(let ht=0,_t=Je.length;ht<_t;ht++){const fn=i.get(Je[ht]);fn.__webglTexture===void 0&&(fn.__webglTexture=r.createTexture(),f.memory.textures++)}if(le.samples>0&&Nt(le)===!1){Oe.__webglMultisampledFramebuffer=r.createFramebuffer(),Oe.__webglColorRenderbuffer=[],t.bindFramebuffer(r.FRAMEBUFFER,Oe.__webglMultisampledFramebuffer);for(let ht=0;ht<Je.length;ht++){const _t=Je[ht];Oe.__webglColorRenderbuffer[ht]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,Oe.__webglColorRenderbuffer[ht]);const fn=l.convert(_t.format,_t.colorSpace),it=l.convert(_t.type),St=L(_t.internalFormat,fn,it,_t.colorSpace,le.isXRRenderTarget===!0),jt=on(le);r.renderbufferStorageMultisample(r.RENDERBUFFER,jt,St,le.width,le.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ht,r.RENDERBUFFER,Oe.__webglColorRenderbuffer[ht])}r.bindRenderbuffer(r.RENDERBUFFER,null),le.depthBuffer&&(Oe.__webglDepthRenderbuffer=r.createRenderbuffer(),Be(Oe.__webglDepthRenderbuffer,le,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}}if(Ye){t.bindTexture(r.TEXTURE_CUBE_MAP,Ze.__webglTexture),we(r.TEXTURE_CUBE_MAP,ne);for(let ht=0;ht<6;ht++)if(ne.mipmaps&&ne.mipmaps.length>0)for(let _t=0;_t<ne.mipmaps.length;_t++)Le(Oe.__webglFramebuffer[ht][_t],le,ne,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+ht,_t);else Le(Oe.__webglFramebuffer[ht],le,ne,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0);P(ne)&&M(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Pt){for(let ht=0,_t=Je.length;ht<_t;ht++){const fn=Je[ht],it=i.get(fn);t.bindTexture(r.TEXTURE_2D,it.__webglTexture),we(r.TEXTURE_2D,fn),Le(Oe.__webglFramebuffer,le,fn,r.COLOR_ATTACHMENT0+ht,r.TEXTURE_2D,0),P(fn)&&M(r.TEXTURE_2D)}t.unbindTexture()}else{let ht=r.TEXTURE_2D;if((le.isWebGL3DRenderTarget||le.isWebGLArrayRenderTarget)&&(ht=le.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),t.bindTexture(ht,Ze.__webglTexture),we(ht,ne),ne.mipmaps&&ne.mipmaps.length>0)for(let _t=0;_t<ne.mipmaps.length;_t++)Le(Oe.__webglFramebuffer[_t],le,ne,r.COLOR_ATTACHMENT0,ht,_t);else Le(Oe.__webglFramebuffer,le,ne,r.COLOR_ATTACHMENT0,ht,0);P(ne)&&M(ht),t.unbindTexture()}le.depthBuffer&&et(le)}function zt(le){const ne=le.textures;for(let Oe=0,Ze=ne.length;Oe<Ze;Oe++){const Je=ne[Oe];if(P(Je)){const Ye=U(le),Pt=i.get(Je).__webglTexture;t.bindTexture(Ye,Pt),M(Ye),t.unbindTexture()}}}const bn=[],_e=[];function Ln(le){if(le.samples>0){if(Nt(le)===!1){const ne=le.textures,Oe=le.width,Ze=le.height;let Je=r.COLOR_BUFFER_BIT;const Ye=le.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Pt=i.get(le),ht=ne.length>1;if(ht)for(let _t=0;_t<ne.length;_t++)t.bindFramebuffer(r.FRAMEBUFFER,Pt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+_t,r.RENDERBUFFER,null),t.bindFramebuffer(r.FRAMEBUFFER,Pt.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+_t,r.TEXTURE_2D,null,0);t.bindFramebuffer(r.READ_FRAMEBUFFER,Pt.__webglMultisampledFramebuffer),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Pt.__webglFramebuffer);for(let _t=0;_t<ne.length;_t++){if(le.resolveDepthBuffer&&(le.depthBuffer&&(Je|=r.DEPTH_BUFFER_BIT),le.stencilBuffer&&le.resolveStencilBuffer&&(Je|=r.STENCIL_BUFFER_BIT)),ht){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,Pt.__webglColorRenderbuffer[_t]);const fn=i.get(ne[_t]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,fn,0)}r.blitFramebuffer(0,0,Oe,Ze,0,0,Oe,Ze,Je,r.NEAREST),v===!0&&(bn.length=0,_e.length=0,bn.push(r.COLOR_ATTACHMENT0+_t),le.depthBuffer&&le.resolveDepthBuffer===!1&&(bn.push(Ye),_e.push(Ye),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,_e)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,bn))}if(t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),ht)for(let _t=0;_t<ne.length;_t++){t.bindFramebuffer(r.FRAMEBUFFER,Pt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+_t,r.RENDERBUFFER,Pt.__webglColorRenderbuffer[_t]);const fn=i.get(ne[_t]).__webglTexture;t.bindFramebuffer(r.FRAMEBUFFER,Pt.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+_t,r.TEXTURE_2D,fn,0)}t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Pt.__webglMultisampledFramebuffer)}else if(le.depthBuffer&&le.resolveDepthBuffer===!1&&v){const ne=le.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[ne])}}}function on(le){return Math.min(o.maxSamples,le.samples)}function Nt(le){const ne=i.get(le);return le.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&ne.__useRenderToTexture!==!1}function Vt(le){const ne=f.render.frame;b.get(le)!==ne&&(b.set(le,ne),le.update())}function Mn(le,ne){const Oe=le.colorSpace,Ze=le.format,Je=le.type;return le.isCompressedTexture===!0||le.isVideoTexture===!0||Oe!==Dm&&Oe!==ud&&(Ci.getTransfer(Oe)===Yi?(Ze!==Is||Je!==df)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Oe)),ne}function Dt(le){return typeof HTMLImageElement<"u"&&le instanceof HTMLImageElement?(_.width=le.naturalWidth||le.width,_.height=le.naturalHeight||le.height):typeof VideoFrame<"u"&&le instanceof VideoFrame?(_.width=le.displayWidth,_.height=le.displayHeight):(_.width=le.width,_.height=le.height),_}this.allocateTextureUnit=he,this.resetTextureUnits=ce,this.setTexture2D=Ae,this.setTexture2DArray=me,this.setTexture3D=Ie,this.setTextureCube=ae,this.rebindTextures=pt,this.setupRenderTarget=Wt,this.updateRenderTargetMipmap=zt,this.updateMultisampleRenderTarget=Ln,this.setupDepthRenderbuffer=et,this.setupFrameBufferTexture=Le,this.useMultisampledRTT=Nt}function ak(r,e){function t(i,o=ud){let l;const f=Ci.getTransfer(o);if(i===df)return r.UNSIGNED_BYTE;if(i===yw)return r.UNSIGNED_SHORT_4_4_4_4;if(i===bw)return r.UNSIGNED_SHORT_5_5_5_1;if(i===TT)return r.UNSIGNED_INT_5_9_9_9_REV;if(i===ET)return r.BYTE;if(i===CT)return r.SHORT;if(i===fg)return r.UNSIGNED_SHORT;if(i===_w)return r.INT;if(i===xp)return r.UNSIGNED_INT;if(i===fo)return r.FLOAT;if(i===_g)return r.HALF_FLOAT;if(i===MT)return r.ALPHA;if(i===AT)return r.RGB;if(i===Is)return r.RGBA;if(i===PT)return r.LUMINANCE;if(i===RT)return r.LUMINANCE_ALPHA;if(i===Em)return r.DEPTH_COMPONENT;if(i===Im)return r.DEPTH_STENCIL;if(i===IT)return r.RED;if(i===xw)return r.RED_INTEGER;if(i===DT)return r.RG;if(i===ww)return r.RG_INTEGER;if(i===Sw)return r.RGBA_INTEGER;if(i===d0||i===p0||i===m0||i===v0)if(f===Yi)if(l=e.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(i===d0)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===p0)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===m0)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===v0)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=e.get("WEBGL_compressed_texture_s3tc"),l!==null){if(i===d0)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===p0)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===m0)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===v0)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===px||i===mx||i===vx||i===gx)if(l=e.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(i===px)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===mx)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===vx)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===gx)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===_x||i===yx||i===bx)if(l=e.get("WEBGL_compressed_texture_etc"),l!==null){if(i===_x||i===yx)return f===Yi?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(i===bx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===xx||i===wx||i===Sx||i===Ex||i===Cx||i===Tx||i===Mx||i===Ax||i===Px||i===Rx||i===Ix||i===Dx||i===Lx||i===kx)if(l=e.get("WEBGL_compressed_texture_astc"),l!==null){if(i===xx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===wx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Sx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Ex)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Cx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===Tx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===Mx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Ax)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===Px)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Rx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Ix)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Dx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Lx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===kx)return f===Yi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===g0||i===Fx||i===Ox)if(l=e.get("EXT_texture_compression_bptc"),l!==null){if(i===g0)return f===Yi?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Fx)return l.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Ox)return l.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===LT||i===Nx||i===Ux||i===Bx)if(l=e.get("EXT_texture_compression_rgtc"),l!==null){if(i===g0)return l.COMPRESSED_RED_RGTC1_EXT;if(i===Nx)return l.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Ux)return l.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Bx)return l.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Rm?r.UNSIGNED_INT_24_8:r[i]!==void 0?r[i]:null}return{convert:t}}const lk={type:"move"};class Tb{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new cu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new cu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new be,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new be),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new cu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new be,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new be),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let o=null,l=null,f=null;const d=this._targetRay,v=this._grip,_=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(_&&e.hand){f=!0;for(const O of e.hand.values()){const P=t.getJointPose(O,i),M=this._getHandJoint(_,O);P!==null&&(M.matrix.fromArray(P.transform.matrix),M.matrix.decompose(M.position,M.rotation,M.scale),M.matrixWorldNeedsUpdate=!0,M.jointRadius=P.radius),M.visible=P!==null}const b=_.joints["index-finger-tip"],w=_.joints["thumb-tip"],C=b.position.distanceTo(w.position),R=.02,z=.005;_.inputState.pinching&&C>R+z?(_.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!_.inputState.pinching&&C<=R-z&&(_.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else v!==null&&e.gripSpace&&(l=t.getPose(e.gripSpace,i),l!==null&&(v.matrix.fromArray(l.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,l.linearVelocity?(v.hasLinearVelocity=!0,v.linearVelocity.copy(l.linearVelocity)):v.hasLinearVelocity=!1,l.angularVelocity?(v.hasAngularVelocity=!0,v.angularVelocity.copy(l.angularVelocity)):v.hasAngularVelocity=!1));d!==null&&(o=t.getPose(e.targetRaySpace,i),o===null&&l!==null&&(o=l),o!==null&&(d.matrix.fromArray(o.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.matrixWorldNeedsUpdate=!0,o.linearVelocity?(d.hasLinearVelocity=!0,d.linearVelocity.copy(o.linearVelocity)):d.hasLinearVelocity=!1,o.angularVelocity?(d.hasAngularVelocity=!0,d.angularVelocity.copy(o.angularVelocity)):d.hasAngularVelocity=!1,this.dispatchEvent(lk)))}return d!==null&&(d.visible=o!==null),v!==null&&(v.visible=l!==null),_!==null&&(_.visible=f!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new cu;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const uk=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,ck=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class hk{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const o=new Qa,l=e.properties.get(o);l.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=o}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new Vc({vertexShader:uk,fragmentShader:ck,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Cr(new Um(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class fk extends Sp{constructor(e,t){super();const i=this;let o=null,l=1,f=null,d="local-floor",v=1,_=null,b=null,w=null,C=null,R=null,z=null;const O=new hk,P=t.getContextAttributes();let M=null,U=null;const L=[],B=[],$=new At;let X=null;const Q=new qu;Q.viewport=new Xi;const te=new qu;te.viewport=new Xi;const V=[Q,te],H=new R2;let J=null,ce=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(se){let fe=L[se];return fe===void 0&&(fe=new Tb,L[se]=fe),fe.getTargetRaySpace()},this.getControllerGrip=function(se){let fe=L[se];return fe===void 0&&(fe=new Tb,L[se]=fe),fe.getGripSpace()},this.getHand=function(se){let fe=L[se];return fe===void 0&&(fe=new Tb,L[se]=fe),fe.getHandSpace()};function he(se){const fe=B.indexOf(se.inputSource);if(fe===-1)return;const Le=L[fe];Le!==void 0&&(Le.update(se.inputSource,se.frame,_||f),Le.dispatchEvent({type:se.type,data:se.inputSource}))}function ge(){o.removeEventListener("select",he),o.removeEventListener("selectstart",he),o.removeEventListener("selectend",he),o.removeEventListener("squeeze",he),o.removeEventListener("squeezestart",he),o.removeEventListener("squeezeend",he),o.removeEventListener("end",ge),o.removeEventListener("inputsourceschange",Ae);for(let se=0;se<L.length;se++){const fe=B[se];fe!==null&&(B[se]=null,L[se].disconnect(fe))}J=null,ce=null,O.reset(),e.setRenderTarget(M),R=null,C=null,w=null,o=null,U=null,ze.stop(),i.isPresenting=!1,e.setPixelRatio(X),e.setSize($.width,$.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(se){l=se,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(se){d=se,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return _||f},this.setReferenceSpace=function(se){_=se},this.getBaseLayer=function(){return C!==null?C:R},this.getBinding=function(){return w},this.getFrame=function(){return z},this.getSession=function(){return o},this.setSession=async function(se){if(o=se,o!==null){if(M=e.getRenderTarget(),o.addEventListener("select",he),o.addEventListener("selectstart",he),o.addEventListener("selectend",he),o.addEventListener("squeeze",he),o.addEventListener("squeezestart",he),o.addEventListener("squeezeend",he),o.addEventListener("end",ge),o.addEventListener("inputsourceschange",Ae),P.xrCompatible!==!0&&await t.makeXRCompatible(),X=e.getPixelRatio(),e.getSize($),o.renderState.layers===void 0){const fe={antialias:P.antialias,alpha:!0,depth:P.depth,stencil:P.stencil,framebufferScaleFactor:l};R=new XRWebGLLayer(o,t,fe),o.updateRenderState({baseLayer:R}),e.setPixelRatio(1),e.setSize(R.framebufferWidth,R.framebufferHeight,!1),U=new El(R.framebufferWidth,R.framebufferHeight,{format:Is,type:df,colorSpace:e.outputColorSpace,stencilBuffer:P.stencil})}else{let fe=null,Le=null,Be=null;P.depth&&(Be=P.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,fe=P.stencil?Im:Em,Le=P.stencil?Rm:xp);const He={colorFormat:t.RGBA8,depthFormat:Be,scaleFactor:l};w=new XRWebGLBinding(o,t),C=w.createProjectionLayer(He),o.updateRenderState({layers:[C]}),e.setPixelRatio(1),e.setSize(C.textureWidth,C.textureHeight,!1),U=new El(C.textureWidth,C.textureHeight,{format:Is,type:df,depthTexture:new WT(C.textureWidth,C.textureHeight,Le,void 0,void 0,void 0,void 0,void 0,void 0,fe),stencilBuffer:P.stencil,colorSpace:e.outputColorSpace,samples:P.antialias?4:0,resolveDepthBuffer:C.ignoreDepthValues===!1})}U.isXRRenderTarget=!0,this.setFoveation(v),_=null,f=await o.requestReferenceSpace(d),ze.setContext(o),ze.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(o!==null)return o.environmentBlendMode},this.getDepthTexture=function(){return O.getDepthTexture()};function Ae(se){for(let fe=0;fe<se.removed.length;fe++){const Le=se.removed[fe],Be=B.indexOf(Le);Be>=0&&(B[Be]=null,L[Be].disconnect(Le))}for(let fe=0;fe<se.added.length;fe++){const Le=se.added[fe];let Be=B.indexOf(Le);if(Be===-1){for(let et=0;et<L.length;et++)if(et>=B.length){B.push(Le),Be=et;break}else if(B[et]===null){B[et]=Le,Be=et;break}if(Be===-1)break}const He=L[Be];He&&He.connect(Le)}}const me=new be,Ie=new be;function ae(se,fe,Le){me.setFromMatrixPosition(fe.matrixWorld),Ie.setFromMatrixPosition(Le.matrixWorld);const Be=me.distanceTo(Ie),He=fe.projectionMatrix.elements,et=Le.projectionMatrix.elements,pt=He[14]/(He[10]-1),Wt=He[14]/(He[10]+1),zt=(He[9]+1)/He[5],bn=(He[9]-1)/He[5],_e=(He[8]-1)/He[0],Ln=(et[8]+1)/et[0],on=pt*_e,Nt=pt*Ln,Vt=Be/(-_e+Ln),Mn=Vt*-_e;if(fe.matrixWorld.decompose(se.position,se.quaternion,se.scale),se.translateX(Mn),se.translateZ(Vt),se.matrixWorld.compose(se.position,se.quaternion,se.scale),se.matrixWorldInverse.copy(se.matrixWorld).invert(),He[10]===-1)se.projectionMatrix.copy(fe.projectionMatrix),se.projectionMatrixInverse.copy(fe.projectionMatrixInverse);else{const Dt=pt+Vt,le=Wt+Vt,ne=on-Mn,Oe=Nt+(Be-Mn),Ze=zt*Wt/le*Dt,Je=bn*Wt/le*Dt;se.projectionMatrix.makePerspective(ne,Oe,Ze,Je,Dt,le),se.projectionMatrixInverse.copy(se.projectionMatrix).invert()}}function ye(se,fe){fe===null?se.matrixWorld.copy(se.matrix):se.matrixWorld.multiplyMatrices(fe.matrixWorld,se.matrix),se.matrixWorldInverse.copy(se.matrixWorld).invert()}this.updateCamera=function(se){if(o===null)return;let fe=se.near,Le=se.far;O.texture!==null&&(O.depthNear>0&&(fe=O.depthNear),O.depthFar>0&&(Le=O.depthFar)),H.near=te.near=Q.near=fe,H.far=te.far=Q.far=Le,(J!==H.near||ce!==H.far)&&(o.updateRenderState({depthNear:H.near,depthFar:H.far}),J=H.near,ce=H.far),Q.layers.mask=se.layers.mask|2,te.layers.mask=se.layers.mask|4,H.layers.mask=Q.layers.mask|te.layers.mask;const Be=se.parent,He=H.cameras;ye(H,Be);for(let et=0;et<He.length;et++)ye(He[et],Be);He.length===2?ae(H,Q,te):H.projectionMatrix.copy(Q.projectionMatrix),de(se,H,Be)};function de(se,fe,Le){Le===null?se.matrix.copy(fe.matrixWorld):(se.matrix.copy(Le.matrixWorld),se.matrix.invert(),se.matrix.multiply(fe.matrixWorld)),se.matrix.decompose(se.position,se.quaternion,se.scale),se.updateMatrixWorld(!0),se.projectionMatrix.copy(fe.projectionMatrix),se.projectionMatrixInverse.copy(fe.projectionMatrixInverse),se.isPerspectiveCamera&&(se.fov=zx*2*Math.atan(1/se.projectionMatrix.elements[5]),se.zoom=1)}this.getCamera=function(){return H},this.getFoveation=function(){if(!(C===null&&R===null))return v},this.setFoveation=function(se){v=se,C!==null&&(C.fixedFoveation=se),R!==null&&R.fixedFoveation!==void 0&&(R.fixedFoveation=se)},this.hasDepthSensing=function(){return O.texture!==null},this.getDepthSensingMesh=function(){return O.getMesh(H)};let ie=null;function we(se,fe){if(b=fe.getViewerPose(_||f),z=fe,b!==null){const Le=b.views;R!==null&&(e.setRenderTargetFramebuffer(U,R.framebuffer),e.setRenderTarget(U));let Be=!1;Le.length!==H.cameras.length&&(H.cameras.length=0,Be=!0);for(let et=0;et<Le.length;et++){const pt=Le[et];let Wt=null;if(R!==null)Wt=R.getViewport(pt);else{const bn=w.getViewSubImage(C,pt);Wt=bn.viewport,et===0&&(e.setRenderTargetTextures(U,bn.colorTexture,C.ignoreDepthValues?void 0:bn.depthStencilTexture),e.setRenderTarget(U))}let zt=V[et];zt===void 0&&(zt=new qu,zt.layers.enable(et),zt.viewport=new Xi,V[et]=zt),zt.matrix.fromArray(pt.transform.matrix),zt.matrix.decompose(zt.position,zt.quaternion,zt.scale),zt.projectionMatrix.fromArray(pt.projectionMatrix),zt.projectionMatrixInverse.copy(zt.projectionMatrix).invert(),zt.viewport.set(Wt.x,Wt.y,Wt.width,Wt.height),et===0&&(H.matrix.copy(zt.matrix),H.matrix.decompose(H.position,H.quaternion,H.scale)),Be===!0&&H.cameras.push(zt)}const He=o.enabledFeatures;if(He&&He.includes("depth-sensing")){const et=w.getDepthInformation(Le[0]);et&&et.isValid&&et.texture&&O.init(e,et,o.renderState)}}for(let Le=0;Le<L.length;Le++){const Be=B[Le],He=L[Le];Be!==null&&He!==void 0&&He.update(Be,fe,_||f)}ie&&ie(se,fe),fe.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:fe}),z=null}const ze=new YT;ze.setAnimationLoop(we),this.setAnimationLoop=function(se){ie=se},this.dispose=function(){}}}const np=new Pl,dk=new hi;function pk(r,e){function t(P,M){P.matrixAutoUpdate===!0&&P.updateMatrix(),M.value.copy(P.matrix)}function i(P,M){M.color.getRGB(P.fogColor.value,VT(r)),M.isFog?(P.fogNear.value=M.near,P.fogFar.value=M.far):M.isFogExp2&&(P.fogDensity.value=M.density)}function o(P,M,U,L,B){M.isMeshBasicMaterial||M.isMeshLambertMaterial?l(P,M):M.isMeshToonMaterial?(l(P,M),w(P,M)):M.isMeshPhongMaterial?(l(P,M),b(P,M)):M.isMeshStandardMaterial?(l(P,M),C(P,M),M.isMeshPhysicalMaterial&&R(P,M,B)):M.isMeshMatcapMaterial?(l(P,M),z(P,M)):M.isMeshDepthMaterial?l(P,M):M.isMeshDistanceMaterial?(l(P,M),O(P,M)):M.isMeshNormalMaterial?l(P,M):M.isLineBasicMaterial?(f(P,M),M.isLineDashedMaterial&&d(P,M)):M.isPointsMaterial?v(P,M,U,L):M.isSpriteMaterial?_(P,M):M.isShadowMaterial?(P.color.value.copy(M.color),P.opacity.value=M.opacity):M.isShaderMaterial&&(M.uniformsNeedUpdate=!1)}function l(P,M){P.opacity.value=M.opacity,M.color&&P.diffuse.value.copy(M.color),M.emissive&&P.emissive.value.copy(M.emissive).multiplyScalar(M.emissiveIntensity),M.map&&(P.map.value=M.map,t(M.map,P.mapTransform)),M.alphaMap&&(P.alphaMap.value=M.alphaMap,t(M.alphaMap,P.alphaMapTransform)),M.bumpMap&&(P.bumpMap.value=M.bumpMap,t(M.bumpMap,P.bumpMapTransform),P.bumpScale.value=M.bumpScale,M.side===Ml&&(P.bumpScale.value*=-1)),M.normalMap&&(P.normalMap.value=M.normalMap,t(M.normalMap,P.normalMapTransform),P.normalScale.value.copy(M.normalScale),M.side===Ml&&P.normalScale.value.negate()),M.displacementMap&&(P.displacementMap.value=M.displacementMap,t(M.displacementMap,P.displacementMapTransform),P.displacementScale.value=M.displacementScale,P.displacementBias.value=M.displacementBias),M.emissiveMap&&(P.emissiveMap.value=M.emissiveMap,t(M.emissiveMap,P.emissiveMapTransform)),M.specularMap&&(P.specularMap.value=M.specularMap,t(M.specularMap,P.specularMapTransform)),M.alphaTest>0&&(P.alphaTest.value=M.alphaTest);const U=e.get(M),L=U.envMap,B=U.envMapRotation;L&&(P.envMap.value=L,np.copy(B),np.x*=-1,np.y*=-1,np.z*=-1,L.isCubeTexture&&L.isRenderTargetTexture===!1&&(np.y*=-1,np.z*=-1),P.envMapRotation.value.setFromMatrix4(dk.makeRotationFromEuler(np)),P.flipEnvMap.value=L.isCubeTexture&&L.isRenderTargetTexture===!1?-1:1,P.reflectivity.value=M.reflectivity,P.ior.value=M.ior,P.refractionRatio.value=M.refractionRatio),M.lightMap&&(P.lightMap.value=M.lightMap,P.lightMapIntensity.value=M.lightMapIntensity,t(M.lightMap,P.lightMapTransform)),M.aoMap&&(P.aoMap.value=M.aoMap,P.aoMapIntensity.value=M.aoMapIntensity,t(M.aoMap,P.aoMapTransform))}function f(P,M){P.diffuse.value.copy(M.color),P.opacity.value=M.opacity,M.map&&(P.map.value=M.map,t(M.map,P.mapTransform))}function d(P,M){P.dashSize.value=M.dashSize,P.totalSize.value=M.dashSize+M.gapSize,P.scale.value=M.scale}function v(P,M,U,L){P.diffuse.value.copy(M.color),P.opacity.value=M.opacity,P.size.value=M.size*U,P.scale.value=L*.5,M.map&&(P.map.value=M.map,t(M.map,P.uvTransform)),M.alphaMap&&(P.alphaMap.value=M.alphaMap,t(M.alphaMap,P.alphaMapTransform)),M.alphaTest>0&&(P.alphaTest.value=M.alphaTest)}function _(P,M){P.diffuse.value.copy(M.color),P.opacity.value=M.opacity,P.rotation.value=M.rotation,M.map&&(P.map.value=M.map,t(M.map,P.mapTransform)),M.alphaMap&&(P.alphaMap.value=M.alphaMap,t(M.alphaMap,P.alphaMapTransform)),M.alphaTest>0&&(P.alphaTest.value=M.alphaTest)}function b(P,M){P.specular.value.copy(M.specular),P.shininess.value=Math.max(M.shininess,1e-4)}function w(P,M){M.gradientMap&&(P.gradientMap.value=M.gradientMap)}function C(P,M){P.metalness.value=M.metalness,M.metalnessMap&&(P.metalnessMap.value=M.metalnessMap,t(M.metalnessMap,P.metalnessMapTransform)),P.roughness.value=M.roughness,M.roughnessMap&&(P.roughnessMap.value=M.roughnessMap,t(M.roughnessMap,P.roughnessMapTransform)),M.envMap&&(P.envMapIntensity.value=M.envMapIntensity)}function R(P,M,U){P.ior.value=M.ior,M.sheen>0&&(P.sheenColor.value.copy(M.sheenColor).multiplyScalar(M.sheen),P.sheenRoughness.value=M.sheenRoughness,M.sheenColorMap&&(P.sheenColorMap.value=M.sheenColorMap,t(M.sheenColorMap,P.sheenColorMapTransform)),M.sheenRoughnessMap&&(P.sheenRoughnessMap.value=M.sheenRoughnessMap,t(M.sheenRoughnessMap,P.sheenRoughnessMapTransform))),M.clearcoat>0&&(P.clearcoat.value=M.clearcoat,P.clearcoatRoughness.value=M.clearcoatRoughness,M.clearcoatMap&&(P.clearcoatMap.value=M.clearcoatMap,t(M.clearcoatMap,P.clearcoatMapTransform)),M.clearcoatRoughnessMap&&(P.clearcoatRoughnessMap.value=M.clearcoatRoughnessMap,t(M.clearcoatRoughnessMap,P.clearcoatRoughnessMapTransform)),M.clearcoatNormalMap&&(P.clearcoatNormalMap.value=M.clearcoatNormalMap,t(M.clearcoatNormalMap,P.clearcoatNormalMapTransform),P.clearcoatNormalScale.value.copy(M.clearcoatNormalScale),M.side===Ml&&P.clearcoatNormalScale.value.negate())),M.dispersion>0&&(P.dispersion.value=M.dispersion),M.iridescence>0&&(P.iridescence.value=M.iridescence,P.iridescenceIOR.value=M.iridescenceIOR,P.iridescenceThicknessMinimum.value=M.iridescenceThicknessRange[0],P.iridescenceThicknessMaximum.value=M.iridescenceThicknessRange[1],M.iridescenceMap&&(P.iridescenceMap.value=M.iridescenceMap,t(M.iridescenceMap,P.iridescenceMapTransform)),M.iridescenceThicknessMap&&(P.iridescenceThicknessMap.value=M.iridescenceThicknessMap,t(M.iridescenceThicknessMap,P.iridescenceThicknessMapTransform))),M.transmission>0&&(P.transmission.value=M.transmission,P.transmissionSamplerMap.value=U.texture,P.transmissionSamplerSize.value.set(U.width,U.height),M.transmissionMap&&(P.transmissionMap.value=M.transmissionMap,t(M.transmissionMap,P.transmissionMapTransform)),P.thickness.value=M.thickness,M.thicknessMap&&(P.thicknessMap.value=M.thicknessMap,t(M.thicknessMap,P.thicknessMapTransform)),P.attenuationDistance.value=M.attenuationDistance,P.attenuationColor.value.copy(M.attenuationColor)),M.anisotropy>0&&(P.anisotropyVector.value.set(M.anisotropy*Math.cos(M.anisotropyRotation),M.anisotropy*Math.sin(M.anisotropyRotation)),M.anisotropyMap&&(P.anisotropyMap.value=M.anisotropyMap,t(M.anisotropyMap,P.anisotropyMapTransform))),P.specularIntensity.value=M.specularIntensity,P.specularColor.value.copy(M.specularColor),M.specularColorMap&&(P.specularColorMap.value=M.specularColorMap,t(M.specularColorMap,P.specularColorMapTransform)),M.specularIntensityMap&&(P.specularIntensityMap.value=M.specularIntensityMap,t(M.specularIntensityMap,P.specularIntensityMapTransform))}function z(P,M){M.matcap&&(P.matcap.value=M.matcap)}function O(P,M){const U=e.get(M).light;P.referencePosition.value.setFromMatrixPosition(U.matrixWorld),P.nearDistance.value=U.shadow.camera.near,P.farDistance.value=U.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:o}}function mk(r,e,t,i){let o={},l={},f=[];const d=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function v(U,L){const B=L.program;i.uniformBlockBinding(U,B)}function _(U,L){let B=o[U.id];B===void 0&&(z(U),B=b(U),o[U.id]=B,U.addEventListener("dispose",P));const $=L.program;i.updateUBOMapping(U,$);const X=e.render.frame;l[U.id]!==X&&(C(U),l[U.id]=X)}function b(U){const L=w();U.__bindingPointIndex=L;const B=r.createBuffer(),$=U.__size,X=U.usage;return r.bindBuffer(r.UNIFORM_BUFFER,B),r.bufferData(r.UNIFORM_BUFFER,$,X),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,L,B),B}function w(){for(let U=0;U<d;U++)if(f.indexOf(U)===-1)return f.push(U),U;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function C(U){const L=o[U.id],B=U.uniforms,$=U.__cache;r.bindBuffer(r.UNIFORM_BUFFER,L);for(let X=0,Q=B.length;X<Q;X++){const te=Array.isArray(B[X])?B[X]:[B[X]];for(let V=0,H=te.length;V<H;V++){const J=te[V];if(R(J,X,V,$)===!0){const ce=J.__offset,he=Array.isArray(J.value)?J.value:[J.value];let ge=0;for(let Ae=0;Ae<he.length;Ae++){const me=he[Ae],Ie=O(me);typeof me=="number"||typeof me=="boolean"?(J.__data[0]=me,r.bufferSubData(r.UNIFORM_BUFFER,ce+ge,J.__data)):me.isMatrix3?(J.__data[0]=me.elements[0],J.__data[1]=me.elements[1],J.__data[2]=me.elements[2],J.__data[3]=0,J.__data[4]=me.elements[3],J.__data[5]=me.elements[4],J.__data[6]=me.elements[5],J.__data[7]=0,J.__data[8]=me.elements[6],J.__data[9]=me.elements[7],J.__data[10]=me.elements[8],J.__data[11]=0):(me.toArray(J.__data,ge),ge+=Ie.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,ce,J.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function R(U,L,B,$){const X=U.value,Q=L+"_"+B;if($[Q]===void 0)return typeof X=="number"||typeof X=="boolean"?$[Q]=X:$[Q]=X.clone(),!0;{const te=$[Q];if(typeof X=="number"||typeof X=="boolean"){if(te!==X)return $[Q]=X,!0}else if(te.equals(X)===!1)return te.copy(X),!0}return!1}function z(U){const L=U.uniforms;let B=0;const $=16;for(let Q=0,te=L.length;Q<te;Q++){const V=Array.isArray(L[Q])?L[Q]:[L[Q]];for(let H=0,J=V.length;H<J;H++){const ce=V[H],he=Array.isArray(ce.value)?ce.value:[ce.value];for(let ge=0,Ae=he.length;ge<Ae;ge++){const me=he[ge],Ie=O(me),ae=B%$,ye=ae%Ie.boundary,de=ae+ye;B+=ye,de!==0&&$-de<Ie.storage&&(B+=$-de),ce.__data=new Float32Array(Ie.storage/Float32Array.BYTES_PER_ELEMENT),ce.__offset=B,B+=Ie.storage}}}const X=B%$;return X>0&&(B+=$-X),U.__size=B,U.__cache={},this}function O(U){const L={boundary:0,storage:0};return typeof U=="number"||typeof U=="boolean"?(L.boundary=4,L.storage=4):U.isVector2?(L.boundary=8,L.storage=8):U.isVector3||U.isColor?(L.boundary=16,L.storage=12):U.isVector4?(L.boundary=16,L.storage=16):U.isMatrix3?(L.boundary=48,L.storage=48):U.isMatrix4?(L.boundary=64,L.storage=64):U.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",U),L}function P(U){const L=U.target;L.removeEventListener("dispose",P);const B=f.indexOf(L.__bindingPointIndex);f.splice(B,1),r.deleteBuffer(o[L.id]),delete o[L.id],delete l[L.id]}function M(){for(const U in o)r.deleteBuffer(o[U]);f=[],o={},l={}}return{bind:v,update:_,dispose:M}}class UE{constructor(e={}){const{canvas:t=MR(),context:i=null,depth:o=!0,stencil:l=!1,alpha:f=!1,antialias:d=!1,premultipliedAlpha:v=!0,preserveDrawingBuffer:_=!1,powerPreference:b="default",failIfMajorPerformanceCaveat:w=!1,reverseDepthBuffer:C=!1}=e;this.isWebGLRenderer=!0;let R;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");R=i.getContextAttributes().alpha}else R=f;const z=new Uint32Array(4),O=new Int32Array(4);let P=null,M=null;const U=[],L=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=au,this.toneMapping=dd,this.toneMappingExposure=1;const B=this;let $=!1,X=0,Q=0,te=null,V=-1,H=null;const J=new Xi,ce=new Xi;let he=null;const ge=new Ht(0);let Ae=0,me=t.width,Ie=t.height,ae=1,ye=null,de=null;const ie=new Xi(0,0,me,Ie),we=new Xi(0,0,me,Ie);let ze=!1;const se=new Tw;let fe=!1,Le=!1;const Be=new hi,He=new hi,et=new be,pt=new Xi,Wt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let zt=!1;function bn(){return te===null?ae:1}let _e=i;function Ln(oe,De){return t.getContext(oe,De)}try{const oe={alpha:!0,depth:o,stencil:l,antialias:d,premultipliedAlpha:v,preserveDrawingBuffer:_,powerPreference:b,failIfMajorPerformanceCaveat:w};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${gw}`),t.addEventListener("webglcontextlost",Ke,!1),t.addEventListener("webglcontextrestored",Mt,!1),t.addEventListener("webglcontextcreationerror",Et,!1),_e===null){const De="webgl2";if(_e=Ln(De,oe),_e===null)throw Ln(De)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(oe){throw console.error("THREE.WebGLRenderer: "+oe.message),oe}let on,Nt,Vt,Mn,Dt,le,ne,Oe,Ze,Je,Ye,Pt,ht,_t,fn,it,St,jt,tn,xt,pn,nn,Vn,Re;function gt(){on=new CL(_e),on.init(),nn=new ak(_e,on),Nt=new yL(_e,on,e,nn),Vt=new sk(_e,on),Nt.reverseDepthBuffer&&C&&Vt.buffers.depth.setReversed(!0),Mn=new AL(_e),Dt=new X3,le=new ok(_e,on,Vt,Dt,Nt,nn,Mn),ne=new xL(B),Oe=new EL(B),Ze=new F2(_e),Vn=new gL(_e,Ze),Je=new TL(_e,Ze,Mn,Vn),Ye=new RL(_e,Je,Ze,Mn),tn=new PL(_e,Nt,le),it=new bL(Dt),Pt=new j3(B,ne,Oe,on,Nt,Vn,it),ht=new pk(B,Dt),_t=new $3,fn=new ek(on),jt=new vL(B,ne,Oe,Vt,Ye,R,v),St=new ik(B,Ye,Nt),Re=new mk(_e,Mn,Nt,Vt),xt=new _L(_e,on,Mn),pn=new ML(_e,on,Mn),Mn.programs=Pt.programs,B.capabilities=Nt,B.extensions=on,B.properties=Dt,B.renderLists=_t,B.shadowMap=St,B.state=Vt,B.info=Mn}gt();const je=new fk(B,_e);this.xr=je,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const oe=on.get("WEBGL_lose_context");oe&&oe.loseContext()},this.forceContextRestore=function(){const oe=on.get("WEBGL_lose_context");oe&&oe.restoreContext()},this.getPixelRatio=function(){return ae},this.setPixelRatio=function(oe){oe!==void 0&&(ae=oe,this.setSize(me,Ie,!1))},this.getSize=function(oe){return oe.set(me,Ie)},this.setSize=function(oe,De,Ue=!0){if(je.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}me=oe,Ie=De,t.width=Math.floor(oe*ae),t.height=Math.floor(De*ae),Ue===!0&&(t.style.width=oe+"px",t.style.height=De+"px"),this.setViewport(0,0,oe,De)},this.getDrawingBufferSize=function(oe){return oe.set(me*ae,Ie*ae).floor()},this.setDrawingBufferSize=function(oe,De,Ue){me=oe,Ie=De,ae=Ue,t.width=Math.floor(oe*Ue),t.height=Math.floor(De*Ue),this.setViewport(0,0,oe,De)},this.getCurrentViewport=function(oe){return oe.copy(J)},this.getViewport=function(oe){return oe.copy(ie)},this.setViewport=function(oe,De,Ue,Ve){oe.isVector4?ie.set(oe.x,oe.y,oe.z,oe.w):ie.set(oe,De,Ue,Ve),Vt.viewport(J.copy(ie).multiplyScalar(ae).round())},this.getScissor=function(oe){return oe.copy(we)},this.setScissor=function(oe,De,Ue,Ve){oe.isVector4?we.set(oe.x,oe.y,oe.z,oe.w):we.set(oe,De,Ue,Ve),Vt.scissor(ce.copy(we).multiplyScalar(ae).round())},this.getScissorTest=function(){return ze},this.setScissorTest=function(oe){Vt.setScissorTest(ze=oe)},this.setOpaqueSort=function(oe){ye=oe},this.setTransparentSort=function(oe){de=oe},this.getClearColor=function(oe){return oe.copy(jt.getClearColor())},this.setClearColor=function(){jt.setClearColor.apply(jt,arguments)},this.getClearAlpha=function(){return jt.getClearAlpha()},this.setClearAlpha=function(){jt.setClearAlpha.apply(jt,arguments)},this.clear=function(oe=!0,De=!0,Ue=!0){let Ve=0;if(oe){let Te=!1;if(te!==null){const ot=te.texture.format;Te=ot===Sw||ot===ww||ot===xw}if(Te){const ot=te.texture.type,dt=ot===df||ot===xp||ot===fg||ot===Rm||ot===yw||ot===bw,Rt=jt.getClearColor(),ft=jt.getClearAlpha(),un=Rt.r,rn=Rt.g,Yt=Rt.b;dt?(z[0]=un,z[1]=rn,z[2]=Yt,z[3]=ft,_e.clearBufferuiv(_e.COLOR,0,z)):(O[0]=un,O[1]=rn,O[2]=Yt,O[3]=ft,_e.clearBufferiv(_e.COLOR,0,O))}else Ve|=_e.COLOR_BUFFER_BIT}De&&(Ve|=_e.DEPTH_BUFFER_BIT),Ue&&(Ve|=_e.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),_e.clear(Ve)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ke,!1),t.removeEventListener("webglcontextrestored",Mt,!1),t.removeEventListener("webglcontextcreationerror",Et,!1),jt.dispose(),_t.dispose(),fn.dispose(),Dt.dispose(),ne.dispose(),Oe.dispose(),Ye.dispose(),Vn.dispose(),Re.dispose(),Pt.dispose(),je.dispose(),je.removeEventListener("sessionstart",Ds),je.removeEventListener("sessionend",hs),zr.stop()};function Ke(oe){oe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),$=!0}function Mt(){console.log("THREE.WebGLRenderer: Context Restored."),$=!1;const oe=Mn.autoReset,De=St.enabled,Ue=St.autoUpdate,Ve=St.needsUpdate,Te=St.type;gt(),Mn.autoReset=oe,St.enabled=De,St.autoUpdate=Ue,St.needsUpdate=Ve,St.type=Te}function Et(oe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",oe.statusMessage)}function mn(oe){const De=oe.target;De.removeEventListener("dispose",mn),Bn(De)}function Bn(oe){Ti(oe),Dt.remove(oe)}function Ti(oe){const De=Dt.get(oe).programs;De!==void 0&&(De.forEach(function(Ue){Pt.releaseProgram(Ue)}),oe.isShaderMaterial&&Pt.releaseShaderCache(oe))}this.renderBufferDirect=function(oe,De,Ue,Ve,Te,ot){De===null&&(De=Wt);const dt=Te.isMesh&&Te.matrixWorld.determinant()<0,Rt=nl(oe,De,Ue,Ve,Te);Vt.setMaterial(Ve,dt);let ft=Ue.index,un=1;if(Ve.wireframe===!0){if(ft=Je.getWireframeAttribute(Ue),ft===void 0)return;un=2}const rn=Ue.drawRange,Yt=Ue.attributes.position;let gn=rn.start*un,kn=(rn.start+rn.count)*un;ot!==null&&(gn=Math.max(gn,ot.start*un),kn=Math.min(kn,(ot.start+ot.count)*un)),ft!==null?(gn=Math.max(gn,0),kn=Math.min(kn,ft.count)):Yt!=null&&(gn=Math.max(gn,0),kn=Math.min(kn,Yt.count));const Fn=kn-gn;if(Fn<0||Fn===1/0)return;Vn.setup(Te,Ve,Rt,Ue,ft);let ui,xn=xt;if(ft!==null&&(ui=Ze.get(ft),xn=pn,xn.setIndex(ui)),Te.isMesh)Ve.wireframe===!0?(Vt.setLineWidth(Ve.wireframeLinewidth*bn()),xn.setMode(_e.LINES)):xn.setMode(_e.TRIANGLES);else if(Te.isLine){let Xt=Ve.linewidth;Xt===void 0&&(Xt=1),Vt.setLineWidth(Xt*bn()),Te.isLineSegments?xn.setMode(_e.LINES):Te.isLineLoop?xn.setMode(_e.LINE_LOOP):xn.setMode(_e.LINE_STRIP)}else Te.isPoints?xn.setMode(_e.POINTS):Te.isSprite&&xn.setMode(_e.TRIANGLES);if(Te.isBatchedMesh)if(Te._multiDrawInstances!==null)xn.renderMultiDrawInstances(Te._multiDrawStarts,Te._multiDrawCounts,Te._multiDrawCount,Te._multiDrawInstances);else if(on.get("WEBGL_multi_draw"))xn.renderMultiDraw(Te._multiDrawStarts,Te._multiDrawCounts,Te._multiDrawCount);else{const Xt=Te._multiDrawStarts,Gn=Te._multiDrawCounts,Cn=Te._multiDrawCount,Zi=ft?Ze.get(ft).bytesPerElement:1,sr=Dt.get(Ve).currentProgram.getUniforms();for(let Ji=0;Ji<Cn;Ji++)sr.setValue(_e,"_gl_DrawID",Ji),xn.render(Xt[Ji]/Zi,Gn[Ji])}else if(Te.isInstancedMesh)xn.renderInstances(gn,Fn,Te.count);else if(Ue.isInstancedBufferGeometry){const Xt=Ue._maxInstanceCount!==void 0?Ue._maxInstanceCount:1/0,Gn=Math.min(Ue.instanceCount,Xt);xn.renderInstances(gn,Fn,Gn)}else xn.render(gn,Fn)};function vn(oe,De,Ue){oe.transparent===!0&&oe.side===of&&oe.forceSinglePass===!1?(oe.side=Ml,oe.needsUpdate=!0,tl(oe,De,Ue),oe.side=Ku,oe.needsUpdate=!0,tl(oe,De,Ue),oe.side=of):tl(oe,De,Ue)}this.compile=function(oe,De,Ue=null){Ue===null&&(Ue=oe),M=fn.get(Ue),M.init(De),L.push(M),Ue.traverseVisible(function(Te){Te.isLight&&Te.layers.test(De.layers)&&(M.pushLight(Te),Te.castShadow&&M.pushShadow(Te))}),oe!==Ue&&oe.traverseVisible(function(Te){Te.isLight&&Te.layers.test(De.layers)&&(M.pushLight(Te),Te.castShadow&&M.pushShadow(Te))}),M.setupLights();const Ve=new Set;return oe.traverse(function(Te){if(!(Te.isMesh||Te.isPoints||Te.isLine||Te.isSprite))return;const ot=Te.material;if(ot)if(Array.isArray(ot))for(let dt=0;dt<ot.length;dt++){const Rt=ot[dt];vn(Rt,Ue,Te),Ve.add(Rt)}else vn(ot,Ue,Te),Ve.add(ot)}),L.pop(),M=null,Ve},this.compileAsync=function(oe,De,Ue=null){const Ve=this.compile(oe,De,Ue);return new Promise(Te=>{function ot(){if(Ve.forEach(function(dt){Dt.get(dt).currentProgram.isReady()&&Ve.delete(dt)}),Ve.size===0){Te(oe);return}setTimeout(ot,10)}on.get("KHR_parallel_shader_compile")!==null?ot():setTimeout(ot,10)})};let yr=null;function _i(oe){yr&&yr(oe)}function Ds(){zr.stop()}function hs(){zr.start()}const zr=new YT;zr.setAnimationLoop(_i),typeof self<"u"&&zr.setContext(self),this.setAnimationLoop=function(oe){yr=oe,je.setAnimationLoop(oe),oe===null?zr.stop():zr.start()},je.addEventListener("sessionstart",Ds),je.addEventListener("sessionend",hs),this.render=function(oe,De){if(De!==void 0&&De.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if($===!0)return;if(oe.matrixWorldAutoUpdate===!0&&oe.updateMatrixWorld(),De.parent===null&&De.matrixWorldAutoUpdate===!0&&De.updateMatrixWorld(),je.enabled===!0&&je.isPresenting===!0&&(je.cameraAutoUpdate===!0&&je.updateCamera(De),De=je.getCamera()),oe.isScene===!0&&oe.onBeforeRender(B,oe,De,te),M=fn.get(oe,L.length),M.init(De),L.push(M),He.multiplyMatrices(De.projectionMatrix,De.matrixWorldInverse),se.setFromProjectionMatrix(He),Le=this.localClippingEnabled,fe=it.init(this.clippingPlanes,Le),P=_t.get(oe,U.length),P.init(),U.push(P),je.enabled===!0&&je.isPresenting===!0){const ot=B.xr.getDepthSensingMesh();ot!==null&&fs(ot,De,-1/0,B.sortObjects)}fs(oe,De,0,B.sortObjects),P.finish(),B.sortObjects===!0&&P.sort(ye,de),zt=je.enabled===!1||je.isPresenting===!1||je.hasDepthSensing()===!1,zt&&jt.addToRenderList(P,oe),this.info.render.frame++,fe===!0&&it.beginShadows();const Ue=M.state.shadowsArray;St.render(Ue,oe,De),fe===!0&&it.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ve=P.opaque,Te=P.transmissive;if(M.setupLights(),De.isArrayCamera){const ot=De.cameras;if(Te.length>0)for(let dt=0,Rt=ot.length;dt<Rt;dt++){const ft=ot[dt];vo(Ve,Te,oe,ft)}zt&&jt.render(oe);for(let dt=0,Rt=ot.length;dt<Rt;dt++){const ft=ot[dt];mo(P,oe,ft,ft.viewport)}}else Te.length>0&&vo(Ve,Te,oe,De),zt&&jt.render(oe),mo(P,oe,De);te!==null&&(le.updateMultisampleRenderTarget(te),le.updateRenderTargetMipmap(te)),oe.isScene===!0&&oe.onAfterRender(B,oe,De),Vn.resetDefaultState(),V=-1,H=null,L.pop(),L.length>0?(M=L[L.length-1],fe===!0&&it.setGlobalState(B.clippingPlanes,M.state.camera)):M=null,U.pop(),U.length>0?P=U[U.length-1]:P=null};function fs(oe,De,Ue,Ve){if(oe.visible===!1)return;if(oe.layers.test(De.layers)){if(oe.isGroup)Ue=oe.renderOrder;else if(oe.isLOD)oe.autoUpdate===!0&&oe.update(De);else if(oe.isLight)M.pushLight(oe),oe.castShadow&&M.pushShadow(oe);else if(oe.isSprite){if(!oe.frustumCulled||se.intersectsSprite(oe)){Ve&&pt.setFromMatrixPosition(oe.matrixWorld).applyMatrix4(He);const dt=Ye.update(oe),Rt=oe.material;Rt.visible&&P.push(oe,dt,Rt,Ue,pt.z,null)}}else if((oe.isMesh||oe.isLine||oe.isPoints)&&(!oe.frustumCulled||se.intersectsObject(oe))){const dt=Ye.update(oe),Rt=oe.material;if(Ve&&(oe.boundingSphere!==void 0?(oe.boundingSphere===null&&oe.computeBoundingSphere(),pt.copy(oe.boundingSphere.center)):(dt.boundingSphere===null&&dt.computeBoundingSphere(),pt.copy(dt.boundingSphere.center)),pt.applyMatrix4(oe.matrixWorld).applyMatrix4(He)),Array.isArray(Rt)){const ft=dt.groups;for(let un=0,rn=ft.length;un<rn;un++){const Yt=ft[un],gn=Rt[Yt.materialIndex];gn&&gn.visible&&P.push(oe,dt,gn,Ue,pt.z,Yt)}}else Rt.visible&&P.push(oe,dt,Rt,Ue,pt.z,null)}}const ot=oe.children;for(let dt=0,Rt=ot.length;dt<Rt;dt++)fs(ot[dt],De,Ue,Ve)}function mo(oe,De,Ue,Ve){const Te=oe.opaque,ot=oe.transmissive,dt=oe.transparent;M.setupLightsView(Ue),fe===!0&&it.setGlobalState(B.clippingPlanes,Ue),Ve&&Vt.viewport(J.copy(Ve)),Te.length>0&&Ho(Te,De,Ue),ot.length>0&&Ho(ot,De,Ue),dt.length>0&&Ho(dt,De,Ue),Vt.buffers.depth.setTest(!0),Vt.buffers.depth.setMask(!0),Vt.buffers.color.setMask(!0),Vt.setPolygonOffset(!1)}function vo(oe,De,Ue,Ve){if((Ue.isScene===!0?Ue.overrideMaterial:null)!==null)return;M.state.transmissionRenderTarget[Ve.id]===void 0&&(M.state.transmissionRenderTarget[Ve.id]=new El(1,1,{generateMipmaps:!0,type:on.has("EXT_color_buffer_half_float")||on.has("EXT_color_buffer_float")?_g:df,minFilter:mp,samples:4,stencilBuffer:l,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Ci.workingColorSpace}));const ot=M.state.transmissionRenderTarget[Ve.id],dt=Ve.viewport||J;ot.setSize(dt.z,dt.w);const Rt=B.getRenderTarget();B.setRenderTarget(ot),B.getClearColor(ge),Ae=B.getClearAlpha(),Ae<1&&B.setClearColor(16777215,.5),B.clear(),zt&&jt.render(Ue);const ft=B.toneMapping;B.toneMapping=dd;const un=Ve.viewport;if(Ve.viewport!==void 0&&(Ve.viewport=void 0),M.setupLightsView(Ve),fe===!0&&it.setGlobalState(B.clippingPlanes,Ve),Ho(oe,Ue,Ve),le.updateMultisampleRenderTarget(ot),le.updateRenderTargetMipmap(ot),on.has("WEBGL_multisampled_render_to_texture")===!1){let rn=!1;for(let Yt=0,gn=De.length;Yt<gn;Yt++){const kn=De[Yt],Fn=kn.object,ui=kn.geometry,xn=kn.material,Xt=kn.group;if(xn.side===of&&Fn.layers.test(Ve.layers)){const Gn=xn.side;xn.side=Ml,xn.needsUpdate=!0,du(Fn,Ue,Ve,ui,xn,Xt),xn.side=Gn,xn.needsUpdate=!0,rn=!0}}rn===!0&&(le.updateMultisampleRenderTarget(ot),le.updateRenderTargetMipmap(ot))}B.setRenderTarget(Rt),B.setClearColor(ge,Ae),un!==void 0&&(Ve.viewport=un),B.toneMapping=ft}function Ho(oe,De,Ue){const Ve=De.isScene===!0?De.overrideMaterial:null;for(let Te=0,ot=oe.length;Te<ot;Te++){const dt=oe[Te],Rt=dt.object,ft=dt.geometry,un=Ve===null?dt.material:Ve,rn=dt.group;Rt.layers.test(Ue.layers)&&du(Rt,De,Ue,ft,un,rn)}}function du(oe,De,Ue,Ve,Te,ot){oe.onBeforeRender(B,De,Ue,Ve,Te,ot),oe.modelViewMatrix.multiplyMatrices(Ue.matrixWorldInverse,oe.matrixWorld),oe.normalMatrix.getNormalMatrix(oe.modelViewMatrix),Te.onBeforeRender(B,De,Ue,Ve,oe,ot),Te.transparent===!0&&Te.side===of&&Te.forceSinglePass===!1?(Te.side=Ml,Te.needsUpdate=!0,B.renderBufferDirect(Ue,De,Ve,Te,oe,ot),Te.side=Ku,Te.needsUpdate=!0,B.renderBufferDirect(Ue,De,Ve,Te,oe,ot),Te.side=of):B.renderBufferDirect(Ue,De,Ve,Te,oe,ot),oe.onAfterRender(B,De,Ue,Ve,Te,ot)}function tl(oe,De,Ue){De.isScene!==!0&&(De=Wt);const Ve=Dt.get(oe),Te=M.state.lights,ot=M.state.shadowsArray,dt=Te.state.version,Rt=Pt.getParameters(oe,Te.state,ot,De,Ue),ft=Pt.getProgramCacheKey(Rt);let un=Ve.programs;Ve.environment=oe.isMeshStandardMaterial?De.environment:null,Ve.fog=De.fog,Ve.envMap=(oe.isMeshStandardMaterial?Oe:ne).get(oe.envMap||Ve.environment),Ve.envMapRotation=Ve.environment!==null&&oe.envMap===null?De.environmentRotation:oe.envMapRotation,un===void 0&&(oe.addEventListener("dispose",mn),un=new Map,Ve.programs=un);let rn=un.get(ft);if(rn!==void 0){if(Ve.currentProgram===rn&&Ve.lightsStateVersion===dt)return ds(oe,Rt),rn}else Rt.uniforms=Pt.getUniforms(oe),oe.onBeforeCompile(Rt,B),rn=Pt.acquireProgram(Rt,ft),un.set(ft,rn),Ve.uniforms=Rt.uniforms;const Yt=Ve.uniforms;return(!oe.isShaderMaterial&&!oe.isRawShaderMaterial||oe.clipping===!0)&&(Yt.clippingPlanes=it.uniform),ds(oe,Rt),Ve.needsLights=xa(oe),Ve.lightsStateVersion=dt,Ve.needsLights&&(Yt.ambientLightColor.value=Te.state.ambient,Yt.lightProbe.value=Te.state.probe,Yt.directionalLights.value=Te.state.directional,Yt.directionalLightShadows.value=Te.state.directionalShadow,Yt.spotLights.value=Te.state.spot,Yt.spotLightShadows.value=Te.state.spotShadow,Yt.rectAreaLights.value=Te.state.rectArea,Yt.ltc_1.value=Te.state.rectAreaLTC1,Yt.ltc_2.value=Te.state.rectAreaLTC2,Yt.pointLights.value=Te.state.point,Yt.pointLightShadows.value=Te.state.pointShadow,Yt.hemisphereLights.value=Te.state.hemi,Yt.directionalShadowMap.value=Te.state.directionalShadowMap,Yt.directionalShadowMatrix.value=Te.state.directionalShadowMatrix,Yt.spotShadowMap.value=Te.state.spotShadowMap,Yt.spotLightMatrix.value=Te.state.spotLightMatrix,Yt.spotLightMap.value=Te.state.spotLightMap,Yt.pointShadowMap.value=Te.state.pointShadowMap,Yt.pointShadowMatrix.value=Te.state.pointShadowMatrix),Ve.currentProgram=rn,Ve.uniformsList=null,rn}function pu(oe){if(oe.uniformsList===null){const De=oe.currentProgram.getUniforms();oe.uniformsList=y0.seqWithValue(De.seq,oe.uniforms)}return oe.uniformsList}function ds(oe,De){const Ue=Dt.get(oe);Ue.outputColorSpace=De.outputColorSpace,Ue.batching=De.batching,Ue.batchingColor=De.batchingColor,Ue.instancing=De.instancing,Ue.instancingColor=De.instancingColor,Ue.instancingMorph=De.instancingMorph,Ue.skinning=De.skinning,Ue.morphTargets=De.morphTargets,Ue.morphNormals=De.morphNormals,Ue.morphColors=De.morphColors,Ue.morphTargetsCount=De.morphTargetsCount,Ue.numClippingPlanes=De.numClippingPlanes,Ue.numIntersection=De.numClipIntersection,Ue.vertexAlphas=De.vertexAlphas,Ue.vertexTangents=De.vertexTangents,Ue.toneMapping=De.toneMapping}function nl(oe,De,Ue,Ve,Te){De.isScene!==!0&&(De=Wt),le.resetTextureUnits();const ot=De.fog,dt=Ve.isMeshStandardMaterial?De.environment:null,Rt=te===null?B.outputColorSpace:te.isXRRenderTarget===!0?te.texture.colorSpace:Dm,ft=(Ve.isMeshStandardMaterial?Oe:ne).get(Ve.envMap||dt),un=Ve.vertexColors===!0&&!!Ue.attributes.color&&Ue.attributes.color.itemSize===4,rn=!!Ue.attributes.tangent&&(!!Ve.normalMap||Ve.anisotropy>0),Yt=!!Ue.morphAttributes.position,gn=!!Ue.morphAttributes.normal,kn=!!Ue.morphAttributes.color;let Fn=dd;Ve.toneMapped&&(te===null||te.isXRRenderTarget===!0)&&(Fn=B.toneMapping);const ui=Ue.morphAttributes.position||Ue.morphAttributes.normal||Ue.morphAttributes.color,xn=ui!==void 0?ui.length:0,Xt=Dt.get(Ve),Gn=M.state.lights;if(fe===!0&&(Le===!0||oe!==H)){const Nn=oe===H&&Ve.id===V;it.setState(Ve,oe,Nn)}let Cn=!1;Ve.version===Xt.__version?(Xt.needsLights&&Xt.lightsStateVersion!==Gn.state.version||Xt.outputColorSpace!==Rt||Te.isBatchedMesh&&Xt.batching===!1||!Te.isBatchedMesh&&Xt.batching===!0||Te.isBatchedMesh&&Xt.batchingColor===!0&&Te.colorTexture===null||Te.isBatchedMesh&&Xt.batchingColor===!1&&Te.colorTexture!==null||Te.isInstancedMesh&&Xt.instancing===!1||!Te.isInstancedMesh&&Xt.instancing===!0||Te.isSkinnedMesh&&Xt.skinning===!1||!Te.isSkinnedMesh&&Xt.skinning===!0||Te.isInstancedMesh&&Xt.instancingColor===!0&&Te.instanceColor===null||Te.isInstancedMesh&&Xt.instancingColor===!1&&Te.instanceColor!==null||Te.isInstancedMesh&&Xt.instancingMorph===!0&&Te.morphTexture===null||Te.isInstancedMesh&&Xt.instancingMorph===!1&&Te.morphTexture!==null||Xt.envMap!==ft||Ve.fog===!0&&Xt.fog!==ot||Xt.numClippingPlanes!==void 0&&(Xt.numClippingPlanes!==it.numPlanes||Xt.numIntersection!==it.numIntersection)||Xt.vertexAlphas!==un||Xt.vertexTangents!==rn||Xt.morphTargets!==Yt||Xt.morphNormals!==gn||Xt.morphColors!==kn||Xt.toneMapping!==Fn||Xt.morphTargetsCount!==xn)&&(Cn=!0):(Cn=!0,Xt.__version=Ve.version);let Zi=Xt.currentProgram;Cn===!0&&(Zi=tl(Ve,De,Te));let sr=!1,Ji=!1,Ks=!1;const cn=Zi.getUniforms(),or=Xt.uniforms;if(Vt.useProgram(Zi.program)&&(sr=!0,Ji=!0,Ks=!0),Ve.id!==V&&(V=Ve.id,Ji=!0),sr||H!==oe){Vt.buffers.depth.getReversed()?(Be.copy(oe.projectionMatrix),PR(Be),RR(Be),cn.setValue(_e,"projectionMatrix",Be)):cn.setValue(_e,"projectionMatrix",oe.projectionMatrix),cn.setValue(_e,"viewMatrix",oe.matrixWorldInverse);const ar=cn.map.cameraPosition;ar!==void 0&&ar.setValue(_e,et.setFromMatrixPosition(oe.matrixWorld)),Nt.logarithmicDepthBuffer&&cn.setValue(_e,"logDepthBufFC",2/(Math.log(oe.far+1)/Math.LN2)),(Ve.isMeshPhongMaterial||Ve.isMeshToonMaterial||Ve.isMeshLambertMaterial||Ve.isMeshBasicMaterial||Ve.isMeshStandardMaterial||Ve.isShaderMaterial)&&cn.setValue(_e,"isOrthographic",oe.isOrthographicCamera===!0),H!==oe&&(H=oe,Ji=!0,Ks=!0)}if(Te.isSkinnedMesh){cn.setOptional(_e,Te,"bindMatrix"),cn.setOptional(_e,Te,"bindMatrixInverse");const Nn=Te.skeleton;Nn&&(Nn.boneTexture===null&&Nn.computeBoneTexture(),cn.setValue(_e,"boneTexture",Nn.boneTexture,le))}Te.isBatchedMesh&&(cn.setOptional(_e,Te,"batchingTexture"),cn.setValue(_e,"batchingTexture",Te._matricesTexture,le),cn.setOptional(_e,Te,"batchingIdTexture"),cn.setValue(_e,"batchingIdTexture",Te._indirectTexture,le),cn.setOptional(_e,Te,"batchingColorTexture"),Te._colorsTexture!==null&&cn.setValue(_e,"batchingColorTexture",Te._colorsTexture,le));const fi=Ue.morphAttributes;if((fi.position!==void 0||fi.normal!==void 0||fi.color!==void 0)&&tn.update(Te,Ue,Zi),(Ji||Xt.receiveShadow!==Te.receiveShadow)&&(Xt.receiveShadow=Te.receiveShadow,cn.setValue(_e,"receiveShadow",Te.receiveShadow)),Ve.isMeshGouraudMaterial&&Ve.envMap!==null&&(or.envMap.value=ft,or.flipEnvMap.value=ft.isCubeTexture&&ft.isRenderTargetTexture===!1?-1:1),Ve.isMeshStandardMaterial&&Ve.envMap===null&&De.environment!==null&&(or.envMapIntensity.value=De.environmentIntensity),Ji&&(cn.setValue(_e,"toneMappingExposure",B.toneMappingExposure),Xt.needsLights&&mu(or,Ks),ot&&Ve.fog===!0&&ht.refreshFogUniforms(or,ot),ht.refreshMaterialUniforms(or,Ve,ae,Ie,M.state.transmissionRenderTarget[oe.id]),y0.upload(_e,pu(Xt),or,le)),Ve.isShaderMaterial&&Ve.uniformsNeedUpdate===!0&&(y0.upload(_e,pu(Xt),or,le),Ve.uniformsNeedUpdate=!1),Ve.isSpriteMaterial&&cn.setValue(_e,"center",Te.center),cn.setValue(_e,"modelViewMatrix",Te.modelViewMatrix),cn.setValue(_e,"normalMatrix",Te.normalMatrix),cn.setValue(_e,"modelMatrix",Te.matrixWorld),Ve.isShaderMaterial||Ve.isRawShaderMaterial){const Nn=Ve.uniformsGroups;for(let ar=0,Tr=Nn.length;ar<Tr;ar++){const an=Nn[ar];Re.update(an,Zi),Re.bind(an,Zi)}}return Zi}function mu(oe,De){oe.ambientLightColor.needsUpdate=De,oe.lightProbe.needsUpdate=De,oe.directionalLights.needsUpdate=De,oe.directionalLightShadows.needsUpdate=De,oe.pointLights.needsUpdate=De,oe.pointLightShadows.needsUpdate=De,oe.spotLights.needsUpdate=De,oe.spotLightShadows.needsUpdate=De,oe.rectAreaLights.needsUpdate=De,oe.hemisphereLights.needsUpdate=De}function xa(oe){return oe.isMeshLambertMaterial||oe.isMeshToonMaterial||oe.isMeshPhongMaterial||oe.isMeshStandardMaterial||oe.isShadowMaterial||oe.isShaderMaterial&&oe.lights===!0}this.getActiveCubeFace=function(){return X},this.getActiveMipmapLevel=function(){return Q},this.getRenderTarget=function(){return te},this.setRenderTargetTextures=function(oe,De,Ue){Dt.get(oe.texture).__webglTexture=De,Dt.get(oe.depthTexture).__webglTexture=Ue;const Ve=Dt.get(oe);Ve.__hasExternalTextures=!0,Ve.__autoAllocateDepthBuffer=Ue===void 0,Ve.__autoAllocateDepthBuffer||on.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ve.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(oe,De){const Ue=Dt.get(oe);Ue.__webglFramebuffer=De,Ue.__useDefaultFramebuffer=De===void 0},this.setRenderTarget=function(oe,De=0,Ue=0){te=oe,X=De,Q=Ue;let Ve=!0,Te=null,ot=!1,dt=!1;if(oe){const ft=Dt.get(oe);if(ft.__useDefaultFramebuffer!==void 0)Vt.bindFramebuffer(_e.FRAMEBUFFER,null),Ve=!1;else if(ft.__webglFramebuffer===void 0)le.setupRenderTarget(oe);else if(ft.__hasExternalTextures)le.rebindTextures(oe,Dt.get(oe.texture).__webglTexture,Dt.get(oe.depthTexture).__webglTexture);else if(oe.depthBuffer){const Yt=oe.depthTexture;if(ft.__boundDepthTexture!==Yt){if(Yt!==null&&Dt.has(Yt)&&(oe.width!==Yt.image.width||oe.height!==Yt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");le.setupDepthRenderbuffer(oe)}}const un=oe.texture;(un.isData3DTexture||un.isDataArrayTexture||un.isCompressedArrayTexture)&&(dt=!0);const rn=Dt.get(oe).__webglFramebuffer;oe.isWebGLCubeRenderTarget?(Array.isArray(rn[De])?Te=rn[De][Ue]:Te=rn[De],ot=!0):oe.samples>0&&le.useMultisampledRTT(oe)===!1?Te=Dt.get(oe).__webglMultisampledFramebuffer:Array.isArray(rn)?Te=rn[Ue]:Te=rn,J.copy(oe.viewport),ce.copy(oe.scissor),he=oe.scissorTest}else J.copy(ie).multiplyScalar(ae).floor(),ce.copy(we).multiplyScalar(ae).floor(),he=ze;if(Vt.bindFramebuffer(_e.FRAMEBUFFER,Te)&&Ve&&Vt.drawBuffers(oe,Te),Vt.viewport(J),Vt.scissor(ce),Vt.setScissorTest(he),ot){const ft=Dt.get(oe.texture);_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_CUBE_MAP_POSITIVE_X+De,ft.__webglTexture,Ue)}else if(dt){const ft=Dt.get(oe.texture),un=De||0;_e.framebufferTextureLayer(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,ft.__webglTexture,Ue||0,un)}V=-1},this.readRenderTargetPixels=function(oe,De,Ue,Ve,Te,ot,dt){if(!(oe&&oe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Rt=Dt.get(oe).__webglFramebuffer;if(oe.isWebGLCubeRenderTarget&&dt!==void 0&&(Rt=Rt[dt]),Rt){Vt.bindFramebuffer(_e.FRAMEBUFFER,Rt);try{const ft=oe.texture,un=ft.format,rn=ft.type;if(!Nt.textureFormatReadable(un)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Nt.textureTypeReadable(rn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}De>=0&&De<=oe.width-Ve&&Ue>=0&&Ue<=oe.height-Te&&_e.readPixels(De,Ue,Ve,Te,nn.convert(un),nn.convert(rn),ot)}finally{const ft=te!==null?Dt.get(te).__webglFramebuffer:null;Vt.bindFramebuffer(_e.FRAMEBUFFER,ft)}}},this.readRenderTargetPixelsAsync=async function(oe,De,Ue,Ve,Te,ot,dt){if(!(oe&&oe.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Rt=Dt.get(oe).__webglFramebuffer;if(oe.isWebGLCubeRenderTarget&&dt!==void 0&&(Rt=Rt[dt]),Rt){const ft=oe.texture,un=ft.format,rn=ft.type;if(!Nt.textureFormatReadable(un))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Nt.textureTypeReadable(rn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(De>=0&&De<=oe.width-Ve&&Ue>=0&&Ue<=oe.height-Te){Vt.bindFramebuffer(_e.FRAMEBUFFER,Rt);const Yt=_e.createBuffer();_e.bindBuffer(_e.PIXEL_PACK_BUFFER,Yt),_e.bufferData(_e.PIXEL_PACK_BUFFER,ot.byteLength,_e.STREAM_READ),_e.readPixels(De,Ue,Ve,Te,nn.convert(un),nn.convert(rn),0);const gn=te!==null?Dt.get(te).__webglFramebuffer:null;Vt.bindFramebuffer(_e.FRAMEBUFFER,gn);const kn=_e.fenceSync(_e.SYNC_GPU_COMMANDS_COMPLETE,0);return _e.flush(),await AR(_e,kn,4),_e.bindBuffer(_e.PIXEL_PACK_BUFFER,Yt),_e.getBufferSubData(_e.PIXEL_PACK_BUFFER,0,ot),_e.deleteBuffer(Yt),_e.deleteSync(kn),ot}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(oe,De=null,Ue=0){oe.isTexture!==!0&&(pm("WebGLRenderer: copyFramebufferToTexture function signature has changed."),De=arguments[0]||null,oe=arguments[1]);const Ve=Math.pow(2,-Ue),Te=Math.floor(oe.image.width*Ve),ot=Math.floor(oe.image.height*Ve),dt=De!==null?De.x:0,Rt=De!==null?De.y:0;le.setTexture2D(oe,0),_e.copyTexSubImage2D(_e.TEXTURE_2D,Ue,0,0,dt,Rt,Te,ot),Vt.unbindTexture()};const Rl=_e.createFramebuffer(),vu=_e.createFramebuffer();this.copyTextureToTexture=function(oe,De,Ue=null,Ve=null,Te=0,ot=null){oe.isTexture!==!0&&(pm("WebGLRenderer: copyTextureToTexture function signature has changed."),Ve=arguments[0]||null,oe=arguments[1],De=arguments[2],ot=arguments[3]||0,Ue=null),ot===null&&(Te!==0?(pm("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ot=Te,Te=0):ot=0);let dt,Rt,ft,un,rn,Yt,gn,kn,Fn;const ui=oe.isCompressedTexture?oe.mipmaps[ot]:oe.image;if(Ue!==null)dt=Ue.max.x-Ue.min.x,Rt=Ue.max.y-Ue.min.y,ft=Ue.isBox3?Ue.max.z-Ue.min.z:1,un=Ue.min.x,rn=Ue.min.y,Yt=Ue.isBox3?Ue.min.z:0;else{const fi=Math.pow(2,-Te);dt=Math.floor(ui.width*fi),Rt=Math.floor(ui.height*fi),oe.isDataArrayTexture?ft=ui.depth:oe.isData3DTexture?ft=Math.floor(ui.depth*fi):ft=1,un=0,rn=0,Yt=0}Ve!==null?(gn=Ve.x,kn=Ve.y,Fn=Ve.z):(gn=0,kn=0,Fn=0);const xn=nn.convert(De.format),Xt=nn.convert(De.type);let Gn;De.isData3DTexture?(le.setTexture3D(De,0),Gn=_e.TEXTURE_3D):De.isDataArrayTexture||De.isCompressedArrayTexture?(le.setTexture2DArray(De,0),Gn=_e.TEXTURE_2D_ARRAY):(le.setTexture2D(De,0),Gn=_e.TEXTURE_2D),_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,De.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,De.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,De.unpackAlignment);const Cn=_e.getParameter(_e.UNPACK_ROW_LENGTH),Zi=_e.getParameter(_e.UNPACK_IMAGE_HEIGHT),sr=_e.getParameter(_e.UNPACK_SKIP_PIXELS),Ji=_e.getParameter(_e.UNPACK_SKIP_ROWS),Ks=_e.getParameter(_e.UNPACK_SKIP_IMAGES);_e.pixelStorei(_e.UNPACK_ROW_LENGTH,ui.width),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,ui.height),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,un),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,rn),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,Yt);const cn=oe.isDataArrayTexture||oe.isData3DTexture,or=De.isDataArrayTexture||De.isData3DTexture;if(oe.isDepthTexture){const fi=Dt.get(oe),Nn=Dt.get(De),ar=Dt.get(fi.__renderTarget),Tr=Dt.get(Nn.__renderTarget);Vt.bindFramebuffer(_e.READ_FRAMEBUFFER,ar.__webglFramebuffer),Vt.bindFramebuffer(_e.DRAW_FRAMEBUFFER,Tr.__webglFramebuffer);for(let an=0;an<ft;an++)cn&&(_e.framebufferTextureLayer(_e.READ_FRAMEBUFFER,_e.COLOR_ATTACHMENT0,Dt.get(oe).__webglTexture,Te,Yt+an),_e.framebufferTextureLayer(_e.DRAW_FRAMEBUFFER,_e.COLOR_ATTACHMENT0,Dt.get(De).__webglTexture,ot,Fn+an)),_e.blitFramebuffer(un,rn,dt,Rt,gn,kn,dt,Rt,_e.DEPTH_BUFFER_BIT,_e.NEAREST);Vt.bindFramebuffer(_e.READ_FRAMEBUFFER,null),Vt.bindFramebuffer(_e.DRAW_FRAMEBUFFER,null)}else if(Te!==0||oe.isRenderTargetTexture||Dt.has(oe)){const fi=Dt.get(oe),Nn=Dt.get(De);Vt.bindFramebuffer(_e.READ_FRAMEBUFFER,Rl),Vt.bindFramebuffer(_e.DRAW_FRAMEBUFFER,vu);for(let ar=0;ar<ft;ar++)cn?_e.framebufferTextureLayer(_e.READ_FRAMEBUFFER,_e.COLOR_ATTACHMENT0,fi.__webglTexture,Te,Yt+ar):_e.framebufferTexture2D(_e.READ_FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_2D,fi.__webglTexture,Te),or?_e.framebufferTextureLayer(_e.DRAW_FRAMEBUFFER,_e.COLOR_ATTACHMENT0,Nn.__webglTexture,ot,Fn+ar):_e.framebufferTexture2D(_e.DRAW_FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_2D,Nn.__webglTexture,ot),Te!==0?_e.blitFramebuffer(un,rn,dt,Rt,gn,kn,dt,Rt,_e.COLOR_BUFFER_BIT,_e.NEAREST):or?_e.copyTexSubImage3D(Gn,ot,gn,kn,Fn+ar,un,rn,dt,Rt):_e.copyTexSubImage2D(Gn,ot,gn,kn,un,rn,dt,Rt);Vt.bindFramebuffer(_e.READ_FRAMEBUFFER,null),Vt.bindFramebuffer(_e.DRAW_FRAMEBUFFER,null)}else or?oe.isDataTexture||oe.isData3DTexture?_e.texSubImage3D(Gn,ot,gn,kn,Fn,dt,Rt,ft,xn,Xt,ui.data):De.isCompressedArrayTexture?_e.compressedTexSubImage3D(Gn,ot,gn,kn,Fn,dt,Rt,ft,xn,ui.data):_e.texSubImage3D(Gn,ot,gn,kn,Fn,dt,Rt,ft,xn,Xt,ui):oe.isDataTexture?_e.texSubImage2D(_e.TEXTURE_2D,ot,gn,kn,dt,Rt,xn,Xt,ui.data):oe.isCompressedTexture?_e.compressedTexSubImage2D(_e.TEXTURE_2D,ot,gn,kn,ui.width,ui.height,xn,ui.data):_e.texSubImage2D(_e.TEXTURE_2D,ot,gn,kn,dt,Rt,xn,Xt,ui);_e.pixelStorei(_e.UNPACK_ROW_LENGTH,Cn),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,Zi),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,sr),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,Ji),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,Ks),ot===0&&De.generateMipmaps&&_e.generateMipmap(Gn),Vt.unbindTexture()},this.copyTextureToTexture3D=function(oe,De,Ue=null,Ve=null,Te=0){return oe.isTexture!==!0&&(pm("WebGLRenderer: copyTextureToTexture3D function signature has changed."),Ue=arguments[0]||null,Ve=arguments[1]||null,oe=arguments[2],De=arguments[3],Te=arguments[4]||0),pm('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(oe,De,Ue,Ve,Te)},this.initRenderTarget=function(oe){Dt.get(oe).__webglFramebuffer===void 0&&le.setupRenderTarget(oe)},this.initTexture=function(oe){oe.isCubeTexture?le.setTextureCube(oe,0):oe.isData3DTexture?le.setTexture3D(oe,0):oe.isDataArrayTexture||oe.isCompressedArrayTexture?le.setTexture2DArray(oe,0):le.setTexture2D(oe,0),Vt.unbindTexture()},this.resetState=function(){X=0,Q=0,te=null,Vt.reset(),Vn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return lf}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=Ci._getDrawingBufferColorSpace(e),t.unpackColorSpace=Ci._getUnpackColorSpace()}}const BE={type:"change"},Lw={type:"start"},eM={type:"end"},i0=new bg,zE=new ld,vk=Math.cos(70*TR.DEG2RAD),qs=new be,Sl=2*Math.PI,Ki={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Mb=1e-6;class gk extends L2{constructor(e,t=null){super(e,t),this.state=Ki.NONE,this.enabled=!0,this.target=new be,this.cursor=new be,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Xu.ROTATE,MIDDLE:Xu.DOLLY,RIGHT:Xu.PAN},this.touches={ONE:ym.ROTATE,TWO:ym.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new be,this._lastQuaternion=new Zu,this._lastTargetPosition=new be,this._quat=new Zu().setFromUnitVectors(e.up,new be(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Wx,this._sphericalDelta=new Wx,this._scale=1,this._panOffset=new be,this._rotateStart=new At,this._rotateEnd=new At,this._rotateDelta=new At,this._panStart=new At,this._panEnd=new At,this._panDelta=new At,this._dollyStart=new At,this._dollyEnd=new At,this._dollyDelta=new At,this._dollyDirection=new be,this._mouse=new At,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=yk.bind(this),this._onPointerDown=_k.bind(this),this._onPointerUp=bk.bind(this),this._onContextMenu=Mk.bind(this),this._onMouseWheel=Sk.bind(this),this._onKeyDown=Ek.bind(this),this._onTouchStart=Ck.bind(this),this._onTouchMove=Tk.bind(this),this._onMouseDown=xk.bind(this),this._onMouseMove=wk.bind(this),this._interceptControlDown=Ak.bind(this),this._interceptControlUp=Pk.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(BE),this.update(),this.state=Ki.NONE}update(e=null){const t=this.object.position;qs.copy(t).sub(this.target),qs.applyQuaternion(this._quat),this._spherical.setFromVector3(qs),this.autoRotate&&this.state===Ki.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,o=this.maxAzimuthAngle;isFinite(i)&&isFinite(o)&&(i<-Math.PI?i+=Sl:i>Math.PI&&(i-=Sl),o<-Math.PI?o+=Sl:o>Math.PI&&(o-=Sl),i<=o?this._spherical.theta=Math.max(i,Math.min(o,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+o)/2?Math.max(i,this._spherical.theta):Math.min(o,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let l=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const f=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),l=f!=this._spherical.radius}if(qs.setFromSpherical(this._spherical),qs.applyQuaternion(this._quatInverse),t.copy(this.target).add(qs),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let f=null;if(this.object.isPerspectiveCamera){const d=qs.length();f=this._clampDistance(d*this._scale);const v=d-f;this.object.position.addScaledVector(this._dollyDirection,v),this.object.updateMatrixWorld(),l=!!v}else if(this.object.isOrthographicCamera){const d=new be(this._mouse.x,this._mouse.y,0);d.unproject(this.object);const v=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),l=v!==this.object.zoom;const _=new be(this._mouse.x,this._mouse.y,0);_.unproject(this.object),this.object.position.sub(_).add(d),this.object.updateMatrixWorld(),f=qs.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;f!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(f).add(this.object.position):(i0.origin.copy(this.object.position),i0.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(i0.direction))<vk?this.object.lookAt(this.target):(zE.setFromNormalAndCoplanarPoint(this.object.up,this.target),i0.intersectPlane(zE,this.target))))}else if(this.object.isOrthographicCamera){const f=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),f!==this.object.zoom&&(this.object.updateProjectionMatrix(),l=!0)}return this._scale=1,this._performCursorZoom=!1,l||this._lastPosition.distanceToSquared(this.object.position)>Mb||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Mb||this._lastTargetPosition.distanceToSquared(this.target)>Mb?(this.dispatchEvent(BE),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Sl/60*this.autoRotateSpeed*e:Sl/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){qs.setFromMatrixColumn(t,0),qs.multiplyScalar(-e),this._panOffset.add(qs)}_panUp(e,t){this.screenSpacePanning===!0?qs.setFromMatrixColumn(t,1):(qs.setFromMatrixColumn(t,0),qs.crossVectors(this.object.up,qs)),qs.multiplyScalar(e),this._panOffset.add(qs)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const o=this.object.position;qs.copy(o).sub(this.target);let l=qs.length();l*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*l/i.clientHeight,this.object.matrix),this._panUp(2*t*l/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),o=e-i.left,l=t-i.top,f=i.width,d=i.height;this._mouse.x=o/f*2-1,this._mouse.y=-(l/d)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Sl*this._rotateDelta.x/t.clientHeight),this._rotateUp(Sl*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Sl*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Sl*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Sl*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Sl*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),o=.5*(e.pageY+t.y);this._rotateStart.set(i,o)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),o=.5*(e.pageY+t.y);this._panStart.set(i,o)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,o=e.pageY-t.y,l=Math.sqrt(i*i+o*o);this._dollyStart.set(0,l)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),o=.5*(e.pageX+i.x),l=.5*(e.pageY+i.y);this._rotateEnd.set(o,l)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Sl*this._rotateDelta.x/t.clientHeight),this._rotateUp(Sl*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),o=.5*(e.pageY+t.y);this._panEnd.set(i,o)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,o=e.pageY-t.y,l=Math.sqrt(i*i+o*o);this._dollyEnd.set(0,l),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const f=(e.pageX+t.x)*.5,d=(e.pageY+t.y)*.5;this._updateZoomParameters(f,d)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new At,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function _k(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(r)&&(this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r)))}function yk(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function bk(r){switch(this._removePointer(r),this._pointers.length){case 0:this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(eM),this.state=Ki.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function xk(r){let e;switch(r.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Xu.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(r),this.state=Ki.DOLLY;break;case Xu.ROTATE:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=Ki.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=Ki.ROTATE}break;case Xu.PAN:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=Ki.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=Ki.PAN}break;default:this.state=Ki.NONE}this.state!==Ki.NONE&&this.dispatchEvent(Lw)}function wk(r){switch(this.state){case Ki.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(r);break;case Ki.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(r);break;case Ki.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(r);break}}function Sk(r){this.enabled===!1||this.enableZoom===!1||this.state!==Ki.NONE||(r.preventDefault(),this.dispatchEvent(Lw),this._handleMouseWheel(this._customWheelEvent(r)),this.dispatchEvent(eM))}function Ek(r){this.enabled!==!1&&this._handleKeyDown(r)}function Ck(r){switch(this._trackPointer(r),this._pointers.length){case 1:switch(this.touches.ONE){case ym.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(r),this.state=Ki.TOUCH_ROTATE;break;case ym.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(r),this.state=Ki.TOUCH_PAN;break;default:this.state=Ki.NONE}break;case 2:switch(this.touches.TWO){case ym.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(r),this.state=Ki.TOUCH_DOLLY_PAN;break;case ym.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(r),this.state=Ki.TOUCH_DOLLY_ROTATE;break;default:this.state=Ki.NONE}break;default:this.state=Ki.NONE}this.state!==Ki.NONE&&this.dispatchEvent(Lw)}function Tk(r){switch(this._trackPointer(r),this.state){case Ki.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(r),this.update();break;case Ki.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(r),this.update();break;case Ki.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(r),this.update();break;case Ki.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(r),this.update();break;default:this.state=Ki.NONE}}function Mk(r){this.enabled!==!1&&r.preventDefault()}function Ak(r){r.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Pk(r){r.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}var qv={exports:{}};/*! Tweakpane 3.1.10 (c) 2016 cocopon, licensed under the MIT license. */var Rk=qv.exports,VE;function Ik(){return VE||(VE=1,function(r,e){(function(t,i){i(e)})(Rk,function(t){class i{constructor(h){const[m,T]=h.split("-"),q=m.split(".");this.major=parseInt(q[0],10),this.minor=parseInt(q[1],10),this.patch=parseInt(q[2],10),this.prerelease=T??null}toString(){const h=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[h,this.prerelease].join("-"):h}}class o{constructor(h){this.controller_=h}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(h){this.controller_.viewProps.set("disabled",h)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(h){this.controller_.viewProps.set("hidden",h)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class l{constructor(h){this.target=h}}class f extends l{constructor(h,m,T,q){super(h),this.value=m,this.presetKey=T,this.last=q??!0}}class d extends l{constructor(h,m,T){super(h),this.value=m,this.presetKey=T}}class v extends l{constructor(h,m){super(h),this.expanded=m}}class _ extends l{constructor(h,m){super(h),this.index=m}}function b(y){return y}function w(y){return y==null}function C(y,h){if(y.length!==h.length)return!1;for(let m=0;m<y.length;m++)if(y[m]!==h[m])return!1;return!0}function R(y,h){let m=y;do{const T=Object.getOwnPropertyDescriptor(m,h);if(T&&(T.set!==void 0||T.writable===!0))return!0;m=Object.getPrototypeOf(m)}while(m!==null);return!1}const z={alreadydisposed:()=>"View has been already disposed",invalidparams:y=>`Invalid parameters for '${y.name}'`,nomatchingcontroller:y=>`No matching controller for '${y.key}'`,nomatchingview:y=>`No matching view for '${JSON.stringify(y.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:y=>`Property '${y.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class O{static alreadyDisposed(){return new O({type:"alreadydisposed"})}static notBindable(){return new O({type:"notbindable"})}static propertyNotFound(h){return new O({type:"propertynotfound",context:{name:h}})}static shouldNeverHappen(){return new O({type:"shouldneverhappen"})}constructor(h){var m;this.message=(m=z[h.type](h.context))!==null&&m!==void 0?m:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=h.type}}class P{constructor(h,m,T){this.obj_=h,this.key_=m,this.presetKey_=T??m}static isBindable(h){return!(h===null||typeof h!="object"&&typeof h!="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(h){this.obj_[this.key_]=h}writeProperty(h,m){const T=this.read();if(!P.isBindable(T))throw O.notBindable();if(!(h in T))throw O.propertyNotFound(h);T[h]=m}}class M extends o{get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}get title(){var h;return(h=this.controller_.valueController.props.get("title"))!==null&&h!==void 0?h:""}set title(h){this.controller_.valueController.props.set("title",h)}on(h,m){const T=m.bind(this);return this.controller_.valueController.emitter.on(h,()=>{T(new l(this))}),this}}class U{constructor(){this.observers_={}}on(h,m){let T=this.observers_[h];return T||(T=this.observers_[h]=[]),T.push({handler:m}),this}off(h,m){const T=this.observers_[h];return T&&(this.observers_[h]=T.filter(q=>q.handler!==m)),this}emit(h,m){const T=this.observers_[h];T&&T.forEach(q=>{q.handler(m)})}}const L="tp";function B(y){return(m,T)=>[L,"-",y,"v",m?`_${m}`:"",T?`-${T}`:""].join("")}function $(y,h){return m=>h(y(m))}function X(y){return y.rawValue}function Q(y,h){y.emitter.on("change",$(X,h)),h(y.rawValue)}function te(y,h,m){Q(y.value(h),m)}function V(y,h,m){m?y.classList.add(h):y.classList.remove(h)}function H(y,h){return m=>{V(y,h,m)}}function J(y,h){Q(y,m=>{h.textContent=m??""})}const ce=B("btn");class he{constructor(h,m){this.element=h.createElement("div"),this.element.classList.add(ce()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("button");T.classList.add(ce("b")),m.viewProps.bindDisabled(T),this.element.appendChild(T),this.buttonElement=T;const q=h.createElement("div");q.classList.add(ce("t")),J(m.props.value("title"),q),this.buttonElement.appendChild(q)}}class ge{constructor(h,m){this.emitter=new U,this.onClick_=this.onClick_.bind(this),this.props=m.props,this.viewProps=m.viewProps,this.view=new he(h,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Ae{constructor(h,m){var T;this.constraint_=m==null?void 0:m.constraint,this.equals_=(T=m==null?void 0:m.equals)!==null&&T!==void 0?T:(q,ve)=>q===ve,this.emitter=new U,this.rawValue_=h}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(h){this.setRawValue(h,{forceEmit:!1,last:!0})}setRawValue(h,m){const T=m??{forceEmit:!1,last:!0},q=this.constraint_?this.constraint_.constrain(h):h,ve=this.rawValue_;this.equals_(ve,q)&&!T.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=q,this.emitter.emit("change",{options:T,previousRawValue:ve,rawValue:q,sender:this}))}}class me{constructor(h){this.emitter=new U,this.value_=h}get rawValue(){return this.value_}set rawValue(h){this.setRawValue(h,{forceEmit:!1,last:!0})}setRawValue(h,m){const T=m??{forceEmit:!1,last:!0},q=this.value_;q===h&&!T.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=h,this.emitter.emit("change",{options:T,previousRawValue:q,rawValue:this.value_,sender:this}))}}function Ie(y,h){const m=h==null?void 0:h.constraint,T=h==null?void 0:h.equals;return!m&&!T?new me(y):new Ae(y,h)}class ae{constructor(h){this.emitter=new U,this.valMap_=h;for(const m in this.valMap_)this.valMap_[m].emitter.on("change",()=>{this.emitter.emit("change",{key:m,sender:this})})}static createCore(h){return Object.keys(h).reduce((T,q)=>Object.assign(T,{[q]:Ie(h[q])}),{})}static fromObject(h){const m=this.createCore(h);return new ae(m)}get(h){return this.valMap_[h].rawValue}set(h,m){this.valMap_[h].rawValue=m}value(h){return this.valMap_[h]}}function ye(y,h){const T=Object.keys(h).reduce((q,ve)=>{if(q===void 0)return;const ke=h[ve],$e=ke(y[ve]);return $e.succeeded?Object.assign(Object.assign({},q),{[ve]:$e.value}):void 0},{});return T}function de(y,h){return y.reduce((m,T)=>{if(m===void 0)return;const q=h(T);if(!(!q.succeeded||q.value===void 0))return[...m,q.value]},[])}function ie(y){return y===null?!1:typeof y=="object"}function we(y){return h=>m=>{if(!h&&m===void 0)return{succeeded:!1,value:void 0};if(h&&m===void 0)return{succeeded:!0,value:void 0};const T=y(m);return T!==void 0?{succeeded:!0,value:T}:{succeeded:!1,value:void 0}}}function ze(y){return{custom:h=>we(h)(y),boolean:we(h=>typeof h=="boolean"?h:void 0)(y),number:we(h=>typeof h=="number"?h:void 0)(y),string:we(h=>typeof h=="string"?h:void 0)(y),function:we(h=>typeof h=="function"?h:void 0)(y),constant:h=>we(m=>m===h?h:void 0)(y),raw:we(h=>h)(y),object:h=>we(m=>{if(ie(m))return ye(m,h)})(y),array:h=>we(m=>{if(Array.isArray(m))return de(m,h)})(y)}}const se={optional:ze(!0),required:ze(!1)};function fe(y,h){const m=se.required.object(h)(y);return m.succeeded?m.value:void 0}function Le(y){console.warn([`Missing '${y.key}' of ${y.target} in ${y.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function Be(y){return y&&y.parentElement&&y.parentElement.removeChild(y),null}class He{constructor(h){this.value_=h}static create(h){return[new He(h),(m,T)=>{h.setRawValue(m,T)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const et=B("");function pt(y,h){return H(y,et(void 0,h))}class Wt extends ae{constructor(h){var m;super(h),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=He.create(Ie(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(m=this.get("parent"))===null||m===void 0||m.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(h){var m,T,q;const ve=h??{};return new Wt(ae.createCore({disabled:(m=ve.disabled)!==null&&m!==void 0?m:!1,disposed:!1,hidden:(T=ve.hidden)!==null&&T!==void 0?T:!1,parent:(q=ve.parent)!==null&&q!==void 0?q:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(h){Q(this.globalDisabled_,pt(h,"disabled")),te(this,"hidden",pt(h,"hidden"))}bindDisabled(h){Q(this.globalDisabled_,m=>{h.disabled=m})}bindTabIndex(h){Q(this.globalDisabled_,m=>{h.tabIndex=m?-1:0})}handleDispose(h){this.value("disposed").emitter.on("change",m=>{m&&h()})}getGlobalDisabled_(){const h=this.get("parent");return(h?h.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(h){var m;const T=h.previousRawValue;T==null||T.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(m=this.get("parent"))===null||m===void 0||m.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function zt(){return["veryfirst","first","last","verylast"]}const bn=B(""),_e={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Ln{constructor(h){this.parent_=null,this.blade=h.blade,this.view=h.view,this.viewProps=h.viewProps;const m=this.view.element;this.blade.value("positions").emitter.on("change",()=>{zt().forEach(T=>{m.classList.remove(bn(void 0,_e[T]))}),this.blade.get("positions").forEach(T=>{m.classList.add(bn(void 0,_e[T]))})}),this.viewProps.handleDispose(()=>{Be(m)})}get parent(){return this.parent_}set parent(h){if(this.parent_=h,!("parent"in this.viewProps.valMap_)){Le({key:"parent",target:Wt.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const on="http://www.w3.org/2000/svg";function Nt(y){y.offsetHeight}function Vt(y,h){const m=y.style.transition;y.style.transition="none",h(),y.style.transition=m}function Mn(y){return y.ontouchstart!==void 0}function Dt(){return globalThis}function le(){return Dt().document}function ne(y){const h=y.ownerDocument.defaultView;return h&&"document"in h?y.getContext("2d",{willReadFrequently:!0}):null}const Oe={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ze(y,h){const m=y.createElementNS(on,"svg");return m.innerHTML=Oe[h],m}function Je(y,h,m){y.insertBefore(h,y.children[m])}function Ye(y){y.parentElement&&y.parentElement.removeChild(y)}function Pt(y){for(;y.children.length>0;)y.removeChild(y.children[0])}function ht(y){for(;y.childNodes.length>0;)y.removeChild(y.childNodes[0])}function _t(y){return y.relatedTarget?y.relatedTarget:"explicitOriginalTarget"in y?y.explicitOriginalTarget:null}const fn=B("lbl");function it(y,h){const m=y.createDocumentFragment();return h.split(`
`).map(q=>y.createTextNode(q)).forEach((q,ve)=>{ve>0&&m.appendChild(y.createElement("br")),m.appendChild(q)}),m}class St{constructor(h,m){this.element=h.createElement("div"),this.element.classList.add(fn()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("div");T.classList.add(fn("l")),te(m.props,"label",ve=>{w(ve)?this.element.classList.add(fn(void 0,"nol")):(this.element.classList.remove(fn(void 0,"nol")),ht(T),T.appendChild(it(h,ve)))}),this.element.appendChild(T),this.labelElement=T;const q=h.createElement("div");q.classList.add(fn("v")),this.element.appendChild(q),this.valueElement=q}}class jt extends Ln{constructor(h,m){const T=m.valueController.viewProps;super(Object.assign(Object.assign({},m),{view:new St(h,{props:m.props,viewProps:T}),viewProps:T})),this.props=m.props,this.valueController=m.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const tn={id:"button",type:"blade",accept(y){const h=se,m=fe(y,{title:h.required.string,view:h.required.constant("button"),label:h.optional.string});return m?{params:m}:null},controller(y){return new jt(y.document,{blade:y.blade,props:ae.fromObject({label:y.params.label}),valueController:new ge(y.document,{props:ae.fromObject({title:y.params.title}),viewProps:y.viewProps})})},api(y){return!(y.controller instanceof jt)||!(y.controller.valueController instanceof ge)?null:new M(y.controller)}};class xt extends Ln{constructor(h){super(h),this.value=h.value}}function pn(){return new ae({positions:Ie([],{equals:C})})}class nn extends ae{constructor(h){super(h)}static create(h){const m={completed:!0,expanded:h,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},T=ae.createCore(m);return new nn(T)}get styleExpanded(){var h;return(h=this.get("temporaryExpanded"))!==null&&h!==void 0?h:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const h=this.get("expandedHeight");return this.get("shouldFixHeight")&&!w(h)?`${h}px`:"auto"}bindExpandedClass(h,m){const T=()=>{this.styleExpanded?h.classList.add(m):h.classList.remove(m)};te(this,"expanded",T),te(this,"temporaryExpanded",T)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Vn(y,h){let m=0;return Vt(h,()=>{y.set("expandedHeight",null),y.set("temporaryExpanded",!0),Nt(h),m=h.clientHeight,y.set("temporaryExpanded",null),Nt(h)}),m}function Re(y,h){h.style.height=y.styleHeight}function gt(y,h){y.value("expanded").emitter.on("beforechange",()=>{if(y.set("completed",!1),w(y.get("expandedHeight"))){const m=Vn(y,h);m>0&&y.set("expandedHeight",m)}y.set("shouldFixHeight",!0),Nt(h)}),y.emitter.on("change",()=>{Re(y,h)}),Re(y,h),h.addEventListener("transitionend",m=>{m.propertyName==="height"&&y.cleanUpTransition()})}class je extends o{constructor(h,m){super(h),this.rackApi_=m}}function Ke(y,h){return y.addBlade(Object.assign(Object.assign({},h),{view:"button"}))}function Mt(y,h){return y.addBlade(Object.assign(Object.assign({},h),{view:"folder"}))}function Et(y,h){const m=h??{};return y.addBlade(Object.assign(Object.assign({},m),{view:"separator"}))}function mn(y,h){return y.addBlade(Object.assign(Object.assign({},h),{view:"tab"}))}class Bn{constructor(h){this.emitter=new U,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=h}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(h){for(const m of this.allItems())if(h(m))return m;return null}includes(h){return this.cache_.has(h)}add(h,m){if(this.includes(h))throw O.shouldNeverHappen();const T=m!==void 0?m:this.items_.length;this.items_.splice(T,0,h),this.cache_.add(h);const q=this.extract_(h);q&&(q.emitter.on("add",this.onSubListAdd_),q.emitter.on("remove",this.onSubListRemove_),q.allItems().forEach(ve=>{this.cache_.add(ve)})),this.emitter.emit("add",{index:T,item:h,root:this,target:this})}remove(h){const m=this.items_.indexOf(h);if(m<0)return;this.items_.splice(m,1),this.cache_.delete(h);const T=this.extract_(h);T&&(T.emitter.off("add",this.onSubListAdd_),T.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:m,item:h,root:this,target:this})}onSubListAdd_(h){this.cache_.add(h.item),this.emitter.emit("add",{index:h.index,item:h.item,root:this,target:h.target})}onSubListRemove_(h){this.cache_.delete(h.item),this.emitter.emit("remove",{index:h.index,item:h.item,root:this,target:h.target})}}class Ti extends o{constructor(h){super(h),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new U,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}on(h,m){const T=m.bind(this);return this.emitter_.on(h,q=>{T(q.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(h){const m=h.sender.target.read();this.emitter_.emit("change",{event:new f(this,m,this.controller_.binding.target.presetKey,h.options.last)})}}class vn extends jt{constructor(h,m){super(h,m),this.binding=m.binding}}class yr extends o{constructor(h){super(h),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new U,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}on(h,m){const T=m.bind(this);return this.emitter_.on(h,q=>{T(q.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(h){const m=h.sender.target.read();this.emitter_.emit("update",{event:new d(this,m,this.controller_.binding.target.presetKey)})}}class _i extends jt{constructor(h,m){super(h,m),this.binding=m.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Ds(y){return y instanceof fs?y.apiSet_:y instanceof je?y.rackApi_.apiSet_:null}function hs(y,h){const m=y.find(T=>T.controller_===h);if(!m)throw O.shouldNeverHappen();return m}function zr(y,h,m){if(!P.isBindable(y))throw O.notBindable();return new P(y,h,m)}class fs extends o{constructor(h,m){super(h),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new U,this.apiSet_=new Bn(Ds),this.pool_=m;const T=this.controller_.rack;T.emitter.on("add",this.onRackAdd_),T.emitter.on("remove",this.onRackRemove_),T.emitter.on("inputchange",this.onRackInputChange_),T.emitter.on("monitorupdate",this.onRackMonitorUpdate_),T.children.forEach(q=>{this.setUpApi_(q)})}get children(){return this.controller_.rack.children.map(h=>hs(this.apiSet_,h))}addInput(h,m,T){const q=T??{},ve=this.controller_.view.element.ownerDocument,ke=this.pool_.createInput(ve,zr(h,m,q.presetKey),q),$e=new Ti(ke);return this.add($e,q.index)}addMonitor(h,m,T){const q=T??{},ve=this.controller_.view.element.ownerDocument,ke=this.pool_.createMonitor(ve,zr(h,m),q),$e=new yr(ke);return this.add($e,q.index)}addFolder(h){return Mt(this,h)}addButton(h){return Ke(this,h)}addSeparator(h){return Et(this,h)}addTab(h){return mn(this,h)}add(h,m){this.controller_.rack.add(h.controller_,m);const T=this.apiSet_.find(q=>q.controller_===h.controller_);return T&&this.apiSet_.remove(T),this.apiSet_.add(h),h}remove(h){this.controller_.rack.remove(h.controller_)}addBlade(h){const m=this.controller_.view.element.ownerDocument,T=this.pool_.createBlade(m,h),q=this.pool_.createBladeApi(T);return this.add(q,h.index)}on(h,m){const T=m.bind(this);return this.emitter_.on(h,q=>{T(q.event)}),this}setUpApi_(h){this.apiSet_.find(T=>T.controller_===h)||this.apiSet_.add(this.pool_.createBladeApi(h))}onRackAdd_(h){this.setUpApi_(h.bladeController)}onRackRemove_(h){if(h.isRoot){const m=hs(this.apiSet_,h.bladeController);this.apiSet_.remove(m)}}onRackInputChange_(h){const m=h.bladeController;if(m instanceof vn){const T=hs(this.apiSet_,m),q=m.binding;this.emitter_.emit("change",{event:new f(T,q.target.read(),q.target.presetKey,h.options.last)})}else if(m instanceof xt){const T=hs(this.apiSet_,m);this.emitter_.emit("change",{event:new f(T,m.value.rawValue,void 0,h.options.last)})}}onRackMonitorUpdate_(h){if(!(h.bladeController instanceof _i))throw O.shouldNeverHappen();const m=hs(this.apiSet_,h.bladeController),T=h.bladeController.binding;this.emitter_.emit("update",{event:new d(m,T.target.read(),T.target.presetKey)})}}class mo extends je{constructor(h,m){super(h,new fs(h.rackController,m)),this.emitter_=new U,this.controller_.foldable.value("expanded").emitter.on("change",T=>{this.emitter_.emit("fold",{event:new v(this,T.sender.rawValue)})}),this.rackApi_.on("change",T=>{this.emitter_.emit("change",{event:T})}),this.rackApi_.on("update",T=>{this.emitter_.emit("update",{event:T})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(h){this.controller_.foldable.set("expanded",h)}get title(){return this.controller_.props.get("title")}set title(h){this.controller_.props.set("title",h)}get children(){return this.rackApi_.children}addInput(h,m,T){return this.rackApi_.addInput(h,m,T)}addMonitor(h,m,T){return this.rackApi_.addMonitor(h,m,T)}addFolder(h){return this.rackApi_.addFolder(h)}addButton(h){return this.rackApi_.addButton(h)}addSeparator(h){return this.rackApi_.addSeparator(h)}addTab(h){return this.rackApi_.addTab(h)}add(h,m){return this.rackApi_.add(h,m)}remove(h){this.rackApi_.remove(h)}addBlade(h){return this.rackApi_.addBlade(h)}on(h,m){const T=m.bind(this);return this.emitter_.on(h,q=>{T(q.event)}),this}}class vo extends Ln{constructor(h){super({blade:h.blade,view:h.view,viewProps:h.rackController.viewProps}),this.rackController=h.rackController}}class Ho{constructor(h,m){const T=B(m.viewName);this.element=h.createElement("div"),this.element.classList.add(T()),m.viewProps.bindClassModifiers(this.element)}}function du(y,h){for(let m=0;m<y.length;m++){const T=y[m];if(T instanceof vn&&T.binding===h)return T}return null}function tl(y,h){for(let m=0;m<y.length;m++){const T=y[m];if(T instanceof _i&&T.binding===h)return T}return null}function pu(y,h){for(let m=0;m<y.length;m++){const T=y[m];if(T instanceof xt&&T.value===h)return T}return null}function ds(y){return y instanceof xa?y.rack:y instanceof vo?y.rackController.rack:null}function nl(y){const h=ds(y);return h?h.bcSet_:null}class mu{constructor(h){var m,T;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new U,this.blade_=(m=h.blade)!==null&&m!==void 0?m:null,(T=this.blade_)===null||T===void 0||T.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=h.viewProps,this.bcSet_=new Bn(nl),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(h,m){var T;(T=h.parent)===null||T===void 0||T.remove(h),R(h,"parent")?h.parent=this:(h.parent_=this,Le({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(h,m)}remove(h){R(h,"parent")?h.parent=null:(h.parent_=null,Le({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(h)}find(h){return this.bcSet_.allItems().filter(m=>m instanceof h)}onSetAdd_(h){this.updatePositions_();const m=h.target===h.root;if(this.emitter.emit("add",{bladeController:h.item,index:h.index,isRoot:m,sender:this}),!m)return;const T=h.item;if(T.viewProps.emitter.on("change",this.onChildViewPropsChange_),T.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),T.viewProps.handleDispose(this.onChildDispose_),T instanceof vn)T.binding.emitter.on("change",this.onChildInputChange_);else if(T instanceof _i)T.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(T instanceof xt)T.value.emitter.on("change",this.onChildValueChange_);else{const q=ds(T);if(q){const ve=q.emitter;ve.on("layout",this.onDescendantLayout_),ve.on("inputchange",this.onDescendantInputChange_),ve.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(h){this.updatePositions_();const m=h.target===h.root;if(this.emitter.emit("remove",{bladeController:h.item,isRoot:m,sender:this}),!m)return;const T=h.item;if(T instanceof vn)T.binding.emitter.off("change",this.onChildInputChange_);else if(T instanceof _i)T.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(T instanceof xt)T.value.emitter.off("change",this.onChildValueChange_);else{const q=ds(T);if(q){const ve=q.emitter;ve.off("layout",this.onDescendantLayout_),ve.off("inputchange",this.onDescendantInputChange_),ve.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const h=this.bcSet_.items.filter(q=>!q.viewProps.get("hidden")),m=h[0],T=h[h.length-1];this.bcSet_.items.forEach(q=>{const ve=[];q===m&&(ve.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&ve.push("veryfirst")),q===T&&(ve.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&ve.push("verylast")),q.blade.set("positions",ve)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(h){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(m=>m.viewProps.get("disposed")).forEach(m=>{this.bcSet_.remove(m)})}onChildInputChange_(h){const m=du(this.find(vn),h.sender);if(!m)throw O.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:m,options:h.options,sender:this})}onChildMonitorUpdate_(h){const m=tl(this.find(_i),h.sender);if(!m)throw O.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:m,sender:this})}onChildValueChange_(h){const m=pu(this.find(xt),h.sender);if(!m)throw O.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:m,options:h.options,sender:this})}onDescendantLayout_(h){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(h){this.emitter.emit("inputchange",{bladeController:h.bladeController,options:h.options,sender:this})}onDescendantMonitorUpdate_(h){this.emitter.emit("monitorupdate",{bladeController:h.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class xa extends Ln{constructor(h,m){super(Object.assign(Object.assign({},m),{view:new Ho(h,{viewName:"brk",viewProps:m.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const T=new mu({blade:m.root?void 0:m.blade,viewProps:m.viewProps});T.emitter.on("add",this.onRackAdd_),T.emitter.on("remove",this.onRackRemove_),this.rack=T,this.viewProps.handleDispose(()=>{for(let q=this.rack.children.length-1;q>=0;q--)this.rack.children[q].viewProps.set("disposed",!0)})}onRackAdd_(h){h.isRoot&&Je(this.view.element,h.bladeController.view.element,h.index)}onRackRemove_(h){h.isRoot&&Ye(h.bladeController.view.element)}}const Rl=B("cnt");class vu{constructor(h,m){var T;this.className_=B((T=m.viewName)!==null&&T!==void 0?T:"fld"),this.element=h.createElement("div"),this.element.classList.add(this.className_(),Rl()),m.viewProps.bindClassModifiers(this.element),this.foldable_=m.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),te(this.foldable_,"completed",H(this.element,this.className_(void 0,"cpl")));const q=h.createElement("button");q.classList.add(this.className_("b")),te(m.props,"title",ln=>{w(ln)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),m.viewProps.bindDisabled(q),this.element.appendChild(q),this.buttonElement=q;const ve=h.createElement("div");ve.classList.add(this.className_("i")),this.element.appendChild(ve);const ke=h.createElement("div");ke.classList.add(this.className_("t")),J(m.props.value("title"),ke),this.buttonElement.appendChild(ke),this.titleElement=ke;const $e=h.createElement("div");$e.classList.add(this.className_("m")),this.buttonElement.appendChild($e);const Ut=m.containerElement;Ut.classList.add(this.className_("c")),this.element.appendChild(Ut),this.containerElement=Ut}}class oe extends vo{constructor(h,m){var T;const q=nn.create((T=m.expanded)!==null&&T!==void 0?T:!0),ve=new xa(h,{blade:m.blade,root:m.root,viewProps:m.viewProps});super(Object.assign(Object.assign({},m),{rackController:ve,view:new vu(h,{containerElement:ve.view.element,foldable:q,props:m.props,viewName:m.root?"rot":void 0,viewProps:m.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=m.props,this.foldable=q,gt(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const De={id:"folder",type:"blade",accept(y){const h=se,m=fe(y,{title:h.required.string,view:h.required.constant("folder"),expanded:h.optional.boolean});return m?{params:m}:null},controller(y){return new oe(y.document,{blade:y.blade,expanded:y.params.expanded,props:ae.fromObject({title:y.params.title}),viewProps:y.viewProps})},api(y){return y.controller instanceof oe?new mo(y.controller,y.pool):null}};class Ue extends xt{constructor(h,m){const T=m.valueController.viewProps;super(Object.assign(Object.assign({},m),{value:m.valueController.value,view:new St(h,{props:m.props,viewProps:T}),viewProps:T})),this.props=m.props,this.valueController=m.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ve extends o{}const Te=B("spr");class ot{constructor(h,m){this.element=h.createElement("div"),this.element.classList.add(Te()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("hr");T.classList.add(Te("r")),this.element.appendChild(T)}}class dt extends Ln{constructor(h,m){super(Object.assign(Object.assign({},m),{view:new ot(h,{viewProps:m.viewProps})}))}}const Rt={id:"separator",type:"blade",accept(y){const m=fe(y,{view:se.required.constant("separator")});return m?{params:m}:null},controller(y){return new dt(y.document,{blade:y.blade,viewProps:y.viewProps})},api(y){return y.controller instanceof dt?new Ve(y.controller):null}},ft=B("tbi");class un{constructor(h,m){this.element=h.createElement("div"),this.element.classList.add(ft()),m.viewProps.bindClassModifiers(this.element),te(m.props,"selected",ve=>{ve?this.element.classList.add(ft(void 0,"sel")):this.element.classList.remove(ft(void 0,"sel"))});const T=h.createElement("button");T.classList.add(ft("b")),m.viewProps.bindDisabled(T),this.element.appendChild(T),this.buttonElement=T;const q=h.createElement("div");q.classList.add(ft("t")),J(m.props.value("title"),q),this.buttonElement.appendChild(q),this.titleElement=q}}class rn{constructor(h,m){this.emitter=new U,this.onClick_=this.onClick_.bind(this),this.props=m.props,this.viewProps=m.viewProps,this.view=new un(h,{props:m.props,viewProps:m.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Yt{constructor(h,m){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new rn(h,{props:m.itemProps,viewProps:Wt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new xa(h,{blade:pn(),viewProps:Wt.create()}),this.props=m.props,te(this.props,"selected",T=>{this.itemController.props.set("selected",T),this.contentController.viewProps.set("hidden",!T)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class gn{constructor(h,m){this.controller_=h,this.rackApi_=m}get title(){var h;return(h=this.controller_.itemController.props.get("title"))!==null&&h!==void 0?h:""}set title(h){this.controller_.itemController.props.set("title",h)}get selected(){return this.controller_.props.get("selected")}set selected(h){this.controller_.props.set("selected",h)}get children(){return this.rackApi_.children}addButton(h){return this.rackApi_.addButton(h)}addFolder(h){return this.rackApi_.addFolder(h)}addSeparator(h){return this.rackApi_.addSeparator(h)}addTab(h){return this.rackApi_.addTab(h)}add(h,m){this.rackApi_.add(h,m)}remove(h){this.rackApi_.remove(h)}addInput(h,m,T){return this.rackApi_.addInput(h,m,T)}addMonitor(h,m,T){return this.rackApi_.addMonitor(h,m,T)}addBlade(h){return this.rackApi_.addBlade(h)}}class kn extends je{constructor(h,m){super(h,new fs(h.rackController,m)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new U,this.pageApiMap_=new Map,this.rackApi_.on("change",T=>{this.emitter_.emit("change",{event:T})}),this.rackApi_.on("update",T=>{this.emitter_.emit("update",{event:T})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(T=>{this.setUpPageApi_(T)})}get pages(){return this.controller_.pageSet.items.map(h=>{const m=this.pageApiMap_.get(h);if(!m)throw O.shouldNeverHappen();return m})}addPage(h){const m=this.controller_.view.element.ownerDocument,T=new Yt(m,{itemProps:ae.fromObject({selected:!1,title:h.title}),props:ae.fromObject({selected:!1})});this.controller_.add(T,h.index);const q=this.pageApiMap_.get(T);if(!q)throw O.shouldNeverHappen();return q}removePage(h){this.controller_.remove(h)}on(h,m){const T=m.bind(this);return this.emitter_.on(h,q=>{T(q.event)}),this}setUpPageApi_(h){const m=this.rackApi_.apiSet_.find(q=>q.controller_===h.contentController);if(!m)throw O.shouldNeverHappen();const T=new gn(h,m);this.pageApiMap_.set(h,T)}onPageAdd_(h){this.setUpPageApi_(h.item)}onPageRemove_(h){if(!this.pageApiMap_.get(h.item))throw O.shouldNeverHappen();this.pageApiMap_.delete(h.item)}onSelect_(h){this.emitter_.emit("select",{event:new _(this,h.rawValue)})}}const Fn=-1;class ui{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Ie(!0),this.selectedIndex=Ie(Fn),this.items_=[]}add(h,m){const T=m??this.items_.length;this.items_.splice(T,0,h),h.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(h){const m=this.items_.indexOf(h);m<0||(this.items_.splice(m,1),h.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Fn,this.empty.rawValue=!0;return}const h=this.items_.findIndex(m=>m.rawValue);h<0?(this.items_.forEach((m,T)=>{m.rawValue=T===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((m,T)=>{m.rawValue=T===h}),this.selectedIndex.rawValue=h),this.empty.rawValue=!1}onItemSelectedChange_(h){if(h.rawValue){const m=this.items_.findIndex(T=>T===h.sender);this.items_.forEach((T,q)=>{T.rawValue=q===m}),this.selectedIndex.rawValue=m}else this.keepSelection_()}}const xn=B("tab");class Xt{constructor(h,m){this.element=h.createElement("div"),this.element.classList.add(xn(),Rl()),m.viewProps.bindClassModifiers(this.element),Q(m.empty,H(this.element,xn(void 0,"nop")));const T=h.createElement("div");T.classList.add(xn("t")),this.element.appendChild(T),this.itemsElement=T;const q=h.createElement("div");q.classList.add(xn("i")),this.element.appendChild(q);const ve=m.contentsElement;ve.classList.add(xn("c")),this.element.appendChild(ve),this.contentsElement=ve}}class Gn extends vo{constructor(h,m){const T=new xa(h,{blade:m.blade,viewProps:m.viewProps}),q=new ui;super({blade:m.blade,rackController:T,view:new Xt(h,{contentsElement:T.view.element,empty:q.empty,viewProps:m.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new Bn(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=q}get pageSet(){return this.pageSet_}add(h,m){this.pageSet_.add(h,m)}remove(h){this.pageSet_.remove(this.pageSet_.items[h])}onPageAdd_(h){const m=h.item;Je(this.view.itemsElement,m.itemController.view.element,h.index),m.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(m.contentController,h.index),this.tab.add(m.props.value("selected"))}onPageRemove_(h){const m=h.item;Ye(m.itemController.view.element),m.itemController.viewProps.set("parent",null),this.rackController.rack.remove(m.contentController),this.tab.remove(m.props.value("selected"))}}const Cn={id:"tab",type:"blade",accept(y){const h=se,m=fe(y,{pages:h.required.array(h.required.object({title:h.required.string})),view:h.required.constant("tab")});return!m||m.pages.length===0?null:{params:m}},controller(y){const h=new Gn(y.document,{blade:y.blade,viewProps:y.viewProps});return y.params.pages.forEach(m=>{const T=new Yt(y.document,{itemProps:ae.fromObject({selected:!1,title:m.title}),props:ae.fromObject({selected:!1})});h.add(T)}),h},api(y){return y.controller instanceof Gn?new kn(y.controller,y.pool):null}};function Zi(y,h){const m=y.accept(h.params);if(!m)return null;const T=se.optional.boolean(h.params.disabled).value,q=se.optional.boolean(h.params.hidden).value;return y.controller({blade:pn(),document:h.document,params:Object.assign(Object.assign({},m.params),{disabled:T,hidden:q}),viewProps:Wt.create({disabled:T,hidden:q})})}class sr{constructor(){this.disabled=!1,this.emitter=new U}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Ji{constructor(h,m){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=h,this.emitter=new U,this.interval_=m,this.setTimer_()}get disabled(){return this.disabled_}set disabled(h){this.disabled_=h,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const h=this.doc_.defaultView;h&&h.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const h=this.doc_.defaultView;h&&(this.timerId_=h.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ks{constructor(h){this.onValueChange_=this.onValueChange_.bind(this),this.reader=h.reader,this.writer=h.writer,this.emitter=new U,this.value=h.value,this.value.emitter.on("change",this.onValueChange_),this.target=h.target,this.read()}read(){const h=this.target.read();h!==void 0&&(this.value.rawValue=this.reader(h))}write_(h){this.writer(this.target,h)}onValueChange_(h){this.write_(h.rawValue),this.emitter.emit("change",{options:h.options,rawValue:h.rawValue,sender:this})}}function cn(y,h){for(;y.length<h;)y.push(void 0)}function or(y){const h=[];return cn(h,y),Ie(h)}function fi(y){const h=y.indexOf(void 0);return h<0?y:y.slice(0,h)}function Nn(y,h){const m=[...fi(y),h];return m.length>y.length?m.splice(0,m.length-y.length):cn(m,y.length),m}class ar{constructor(h){this.onTick_=this.onTick_.bind(this),this.reader_=h.reader,this.target=h.target,this.emitter=new U,this.value=h.value,this.ticker=h.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const h=this.target.read();if(h===void 0)return;const m=this.value.rawValue,T=this.reader_(h);this.value.rawValue=Nn(m,T),this.emitter.emit("update",{rawValue:T,sender:this})}onTick_(h){this.read()}}class Tr{constructor(h){this.constraints=h}constrain(h){return this.constraints.reduce((m,T)=>T.constrain(m),h)}}function an(y,h){if(y instanceof h)return y;if(y instanceof Tr){const m=y.constraints.reduce((T,q)=>T||(q instanceof h?q:null),null);if(m)return m}return null}class fr{constructor(h){this.values=ae.fromObject({max:h.max,min:h.min})}constrain(h){const m=this.values.get("max"),T=this.values.get("min");return Math.min(Math.max(h,T),m)}}class Wo{constructor(h){this.values=ae.fromObject({options:h})}get options(){return this.values.get("options")}constrain(h){const m=this.values.get("options");return m.length===0||m.filter(q=>q.value===h).length>0?h:m[0].value}}class wa{constructor(h){this.values=ae.fromObject({max:h.max,min:h.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(h){const m=this.values.get("max"),T=this.values.get("min");let q=h;return w(T)||(q=Math.max(q,T)),w(m)||(q=Math.min(q,m)),q}}class Il{constructor(h,m=0){this.step=h,this.origin=m}constrain(h){const m=this.origin%this.step,T=Math.round((h-m)/this.step);return m+T*this.step}}const go=B("lst");class Dl{constructor(h,m){this.onValueChange_=this.onValueChange_.bind(this),this.props_=m.props,this.element=h.createElement("div"),this.element.classList.add(go()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("select");T.classList.add(go("s")),m.viewProps.bindDisabled(T),this.element.appendChild(T),this.selectElement=T;const q=h.createElement("div");q.classList.add(go("m")),q.appendChild(Ze(h,"dropdown")),this.element.appendChild(q),m.value.emitter.on("change",this.onValueChange_),this.value_=m.value,te(this.props_,"options",ve=>{Pt(this.selectElement),ve.forEach(ke=>{const $e=h.createElement("option");$e.textContent=ke.text,this.selectElement.appendChild($e)}),this.update_()})}update_(){const h=this.props_.get("options").map(m=>m.value);this.selectElement.selectedIndex=h.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class _o{constructor(h,m){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=m.props,this.value=m.value,this.viewProps=m.viewProps,this.view=new Dl(h,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(h){const m=h.currentTarget;this.value.rawValue=this.props.get("options")[m.selectedIndex].value}}const Sa=B("pop");class jo{constructor(h,m){this.element=h.createElement("div"),this.element.classList.add(Sa()),m.viewProps.bindClassModifiers(this.element),Q(m.shows,H(this.element,Sa(void 0,"v")))}}class yo{constructor(h,m){this.shows=Ie(!1),this.viewProps=m.viewProps,this.view=new jo(h,{shows:this.shows,viewProps:this.viewProps})}}const bo=B("txt");class Ea{constructor(h,m){this.onChange_=this.onChange_.bind(this),this.element=h.createElement("div"),this.element.classList.add(bo()),m.viewProps.bindClassModifiers(this.element),this.props_=m.props,this.props_.emitter.on("change",this.onChange_);const T=h.createElement("input");T.classList.add(bo("i")),T.type="text",m.viewProps.bindDisabled(T),this.element.appendChild(T),this.inputElement=T,m.value.emitter.on("change",this.onChange_),this.value_=m.value,this.refresh()}refresh(){const h=this.props_.get("formatter");this.inputElement.value=h(this.value_.rawValue)}onChange_(){this.refresh()}}class Xo{constructor(h,m){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=m.parser,this.props=m.props,this.value=m.value,this.viewProps=m.viewProps,this.view=new Ea(h,{props:m.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(h){const T=h.currentTarget.value,q=this.parser_(T);w(q)||(this.value.rawValue=q),this.view.refresh()}}function qo(y){return String(y)}function Hc(y){return y==="false"?!1:!!y}function Ju(y){return qo(y)}class xo{constructor(h){this.text=h}evaluate(){return Number(this.text)}toString(){return this.text}}const Th={"**":(y,h)=>Math.pow(y,h),"*":(y,h)=>y*h,"/":(y,h)=>y/h,"%":(y,h)=>y%h,"+":(y,h)=>y+h,"-":(y,h)=>y-h,"<<":(y,h)=>y<<h,">>":(y,h)=>y>>h,">>>":(y,h)=>y>>>h,"&":(y,h)=>y&h,"^":(y,h)=>y^h,"|":(y,h)=>y|h};class Wc{constructor(h,m,T){this.left=m,this.operator=h,this.right=T}evaluate(){const h=Th[this.operator];if(!h)throw new Error(`unexpected binary operator: '${this.operator}`);return h(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ll={"+":y=>y,"-":y=>-y,"~":y=>~y};class jc{constructor(h,m){this.operator=h,this.expression=m}evaluate(){const h=Ll[this.operator];if(!h)throw new Error(`unexpected unary operator: '${this.operator}`);return h(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Qu(y){return(h,m)=>{for(let T=0;T<y.length;T++){const q=y[T](h,m);if(q!=="")return q}return""}}function $t(y,h){var m;const T=y.substr(h).match(/^\s+/);return(m=T&&T[0])!==null&&m!==void 0?m:""}function Qt(y,h){const m=y.substr(h,1);return m.match(/^[1-9]$/)?m:""}function Zs(y,h){var m;const T=y.substr(h).match(/^[0-9]+/);return(m=T&&T[0])!==null&&m!==void 0?m:""}function gu(y,h){const m=Zs(y,h);if(m!=="")return m;const T=y.substr(h,1);if(h+=1,T!=="-"&&T!=="+")return"";const q=Zs(y,h);return q===""?"":T+q}function Js(y,h){const m=y.substr(h,1);if(h+=1,m.toLowerCase()!=="e")return"";const T=gu(y,h);return T===""?"":m+T}function Xc(y,h){const m=y.substr(h,1);if(m==="0")return m;const T=Qt(y,h);return h+=T.length,T===""?"":T+Zs(y,h)}function ec(y,h){const m=Xc(y,h);if(h+=m.length,m==="")return"";const T=y.substr(h,1);if(h+=T.length,T!==".")return"";const q=Zs(y,h);return h+=q.length,m+T+q+Js(y,h)}function kl(y,h){const m=y.substr(h,1);if(h+=m.length,m!==".")return"";const T=Zs(y,h);return h+=T.length,T===""?"":m+T+Js(y,h)}function Fl(y,h){const m=Xc(y,h);return h+=m.length,m===""?"":m+Js(y,h)}const tc=Qu([ec,kl,Fl]);function yn(y,h){var m;const T=y.substr(h).match(/^[01]+/);return(m=T&&T[0])!==null&&m!==void 0?m:""}function Ca(y,h){const m=y.substr(h,2);if(h+=m.length,m.toLowerCase()!=="0b")return"";const T=yn(y,h);return T===""?"":m+T}function dr(y,h){var m;const T=y.substr(h).match(/^[0-7]+/);return(m=T&&T[0])!==null&&m!==void 0?m:""}function Mr(y,h){const m=y.substr(h,2);if(h+=m.length,m.toLowerCase()!=="0o")return"";const T=dr(y,h);return T===""?"":m+T}function $o(y,h){var m;const T=y.substr(h).match(/^[0-9a-f]+/i);return(m=T&&T[0])!==null&&m!==void 0?m:""}function ci(y,h){const m=y.substr(h,2);if(h+=m.length,m.toLowerCase()!=="0x")return"";const T=$o(y,h);return T===""?"":m+T}const il=Qu([Ca,Mr,ci]),Ar=Qu([il,tc]);function Pr(y,h){const m=Ar(y,h);return h+=m.length,m===""?null:{evaluable:new xo(m),cursor:h}}function Ta(y,h){const m=y.substr(h,1);if(h+=m.length,m!=="(")return null;const T=Aa(y,h);if(!T)return null;h=T.cursor,h+=$t(y,h).length;const q=y.substr(h,1);return h+=q.length,q!==")"?null:{evaluable:T.evaluable,cursor:h}}function Ma(y,h){var m;return(m=Pr(y,h))!==null&&m!==void 0?m:Ta(y,h)}function Ol(y,h){const m=Ma(y,h);if(m)return m;const T=y.substr(h,1);if(h+=T.length,T!=="+"&&T!=="-"&&T!=="~")return null;const q=Ol(y,h);return q?(h=q.cursor,{cursor:h,evaluable:new jc(T,q.evaluable)}):null}function si(y,h,m){m+=$t(h,m).length;const T=y.filter(q=>h.startsWith(q,m))[0];return T?(m+=T.length,m+=$t(h,m).length,{cursor:m,operator:T}):null}function wo(y,h){return(m,T)=>{const q=y(m,T);if(!q)return null;T=q.cursor;let ve=q.evaluable;for(;;){const ke=si(h,m,T);if(!ke)break;T=ke.cursor;const $e=y(m,T);if(!$e)return null;T=$e.cursor,ve=new Wc(ke.operator,ve,$e.evaluable)}return ve?{cursor:T,evaluable:ve}:null}}const Qn=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((y,h)=>wo(y,h),Ol);function Aa(y,h){return h+=$t(y,h).length,Qn(y,h)}function Nl(y){const h=Aa(y,0);return!h||h.cursor+$t(y,h.cursor).length!==y.length?null:h.evaluable}function yi(y){var h;const m=Nl(y);return(h=m==null?void 0:m.evaluate())!==null&&h!==void 0?h:null}function Rr(y){if(typeof y=="number")return y;if(typeof y=="string"){const h=yi(y);if(!w(h))return h}return 0}function Ul(y){return String(y)}function Ft(y){return h=>h.toFixed(Math.max(Math.min(y,20),0))}const br=Ft(0);function So(y){return br(y)+"%"}function nc(y){return String(y)}function ps(y){return y}function rl({primary:y,secondary:h,forward:m,backward:T}){let q=!1;function ve(ke){q||(q=!0,ke(),q=!1)}y.emitter.on("change",ke=>{ve(()=>{h.setRawValue(m(y,h),ke.options)})}),h.emitter.on("change",ke=>{ve(()=>{y.setRawValue(T(y,h),ke.options)}),ve(()=>{h.setRawValue(m(y,h),ke.options)})}),ve(()=>{h.setRawValue(m(y,h),{forceEmit:!1,last:!0})})}function pr(y,h){const m=y*(h.altKey?.1:1)*(h.shiftKey?10:1);return h.upKey?+m:h.downKey?-m:0}function Bl(y){return{altKey:y.altKey,downKey:y.key==="ArrowDown",shiftKey:y.shiftKey,upKey:y.key==="ArrowUp"}}function ms(y){return{altKey:y.altKey,downKey:y.key==="ArrowLeft",shiftKey:y.shiftKey,upKey:y.key==="ArrowRight"}}function Yo(y){return y==="ArrowUp"||y==="ArrowDown"}function Vr(y){return Yo(y)||y==="ArrowLeft"||y==="ArrowRight"}function zl(y,h){var m,T;const q=h.ownerDocument.defaultView,ve=h.getBoundingClientRect();return{x:y.pageX-(((m=q&&q.scrollX)!==null&&m!==void 0?m:0)+ve.left),y:y.pageY-(((T=q&&q.scrollY)!==null&&T!==void 0?T:0)+ve.top)}}class Eo{constructor(h){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=h,this.emitter=new U,h.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),h.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),h.addEventListener("touchend",this.onTouchEnd_),h.addEventListener("mousedown",this.onMouseDown_)}computePosition_(h){const m=this.elem_.getBoundingClientRect();return{bounds:{width:m.width,height:m.height},point:h?{x:h.x,y:h.y}:null}}onMouseDown_(h){var m;h.preventDefault(),(m=h.currentTarget)===null||m===void 0||m.focus();const T=this.elem_.ownerDocument;T.addEventListener("mousemove",this.onDocumentMouseMove_),T.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:h.altKey,data:this.computePosition_(zl(h,this.elem_)),sender:this,shiftKey:h.shiftKey})}onDocumentMouseMove_(h){this.emitter.emit("move",{altKey:h.altKey,data:this.computePosition_(zl(h,this.elem_)),sender:this,shiftKey:h.shiftKey})}onDocumentMouseUp_(h){const m=this.elem_.ownerDocument;m.removeEventListener("mousemove",this.onDocumentMouseMove_),m.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:h.altKey,data:this.computePosition_(zl(h,this.elem_)),sender:this,shiftKey:h.shiftKey})}onTouchStart_(h){h.preventDefault();const m=h.targetTouches.item(0),T=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:h.altKey,data:this.computePosition_(m?{x:m.clientX-T.left,y:m.clientY-T.top}:void 0),sender:this,shiftKey:h.shiftKey}),this.lastTouch_=m}onTouchMove_(h){const m=h.targetTouches.item(0),T=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:h.altKey,data:this.computePosition_(m?{x:m.clientX-T.left,y:m.clientY-T.top}:void 0),sender:this,shiftKey:h.shiftKey}),this.lastTouch_=m}onTouchEnd_(h){var m;const T=(m=h.targetTouches.item(0))!==null&&m!==void 0?m:this.lastTouch_,q=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:h.altKey,data:this.computePosition_(T?{x:T.clientX-q.left,y:T.clientY-q.top}:void 0),sender:this,shiftKey:h.shiftKey})}}function oi(y,h,m,T,q){const ve=(y-h)/(m-h);return T+ve*(q-T)}function Pa(y){return String(y.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function di(y,h,m){return Math.min(Math.max(y,h),m)}function Ko(y,h){return(y%h+h)%h}const rs=B("txt");class Ra{constructor(h,m){this.onChange_=this.onChange_.bind(this),this.props_=m.props,this.props_.emitter.on("change",this.onChange_),this.element=h.createElement("div"),this.element.classList.add(rs(),rs(void 0,"num")),m.arrayPosition&&this.element.classList.add(rs(void 0,m.arrayPosition)),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("input");T.classList.add(rs("i")),T.type="text",m.viewProps.bindDisabled(T),this.element.appendChild(T),this.inputElement=T,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=m.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(rs()),this.inputElement.classList.add(rs("i"));const q=h.createElement("div");q.classList.add(rs("k")),this.element.appendChild(q),this.knobElement=q;const ve=h.createElementNS(on,"svg");ve.classList.add(rs("g")),this.knobElement.appendChild(ve);const ke=h.createElementNS(on,"path");ke.classList.add(rs("gb")),ve.appendChild(ke),this.guideBodyElem_=ke;const $e=h.createElementNS(on,"path");$e.classList.add(rs("gh")),ve.appendChild($e),this.guideHeadElem_=$e;const Ut=h.createElement("div");Ut.classList.add(B("tt")()),this.knobElement.appendChild(Ut),this.tooltipElem_=Ut,m.value.emitter.on("change",this.onChange_),this.value=m.value,this.refresh()}onDraggingChange_(h){if(h.rawValue===null){this.element.classList.remove(rs(void 0,"drg"));return}this.element.classList.add(rs(void 0,"drg"));const m=h.rawValue/this.props_.get("draggingScale"),T=m+(m>0?-1:m<0?1:0),q=di(-T,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${T+q},0 L${T},4 L${T+q},8`,`M ${m},-1 L${m},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${m},4`);const ve=this.props_.get("formatter");this.tooltipElem_.textContent=ve(this.value.rawValue),this.tooltipElem_.style.left=`${m}px`}refresh(){const h=this.props_.get("formatter");this.inputElement.value=h(this.value.rawValue)}onChange_(){this.refresh()}}class Co{constructor(h,m){var T;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=m.baseStep,this.parser_=m.parser,this.props=m.props,this.sliderProps_=(T=m.sliderProps)!==null&&T!==void 0?T:null,this.value=m.value,this.viewProps=m.viewProps,this.dragging_=Ie(null),this.view=new Ra(h,{arrayPosition:m.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const q=new Eo(this.view.knobElement);q.emitter.on("down",this.onPointerDown_),q.emitter.on("move",this.onPointerMove_),q.emitter.on("up",this.onPointerUp_)}constrainValue_(h){var m,T;const q=(m=this.sliderProps_)===null||m===void 0?void 0:m.get("minValue"),ve=(T=this.sliderProps_)===null||T===void 0?void 0:T.get("maxValue");let ke=h;return q!==void 0&&(ke=Math.max(ke,q)),ve!==void 0&&(ke=Math.min(ke,ve)),ke}onInputChange_(h){const T=h.currentTarget.value,q=this.parser_(T);w(q)||(this.value.rawValue=this.constrainValue_(q)),this.view.refresh()}onInputKeyDown_(h){const m=pr(this.baseStep_,Bl(h));m!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+m),{forceEmit:!1,last:!1})}onInputKeyUp_(h){pr(this.baseStep_,Bl(h))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(h){if(!h.point)return null;const m=h.point.x-h.bounds.width/2;return this.constrainValue_(this.originRawValue_+m*this.props.get("draggingScale"))}onPointerMove_(h){const m=this.computeDraggingValue_(h.data);m!==null&&(this.value.setRawValue(m,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(h){const m=this.computeDraggingValue_(h.data);m!==null&&(this.value.setRawValue(m,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const ic=B("sld");class Ir{constructor(h,m){this.onChange_=this.onChange_.bind(this),this.props_=m.props,this.props_.emitter.on("change",this.onChange_),this.element=h.createElement("div"),this.element.classList.add(ic()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("div");T.classList.add(ic("t")),m.viewProps.bindTabIndex(T),this.element.appendChild(T),this.trackElement=T;const q=h.createElement("div");q.classList.add(ic("k")),this.trackElement.appendChild(q),this.knobElement=q,m.value.emitter.on("change",this.onChange_),this.value=m.value,this.update_()}update_(){const h=di(oi(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${h}%`}onChange_(){this.update_()}}class ai{constructor(h,m){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=m.baseStep,this.value=m.value,this.viewProps=m.viewProps,this.props=m.props,this.view=new Ir(h,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Eo(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(h,m){h.point&&this.value.setRawValue(oi(di(h.point.x,0,h.bounds.width),0,h.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),m)}onPointerDownOrMove_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.handlePointerEvent_(h.data,{forceEmit:!0,last:!0})}onKeyDown_(h){const m=pr(this.baseStep_,ms(h));m!==0&&this.value.setRawValue(this.value.rawValue+m,{forceEmit:!1,last:!1})}onKeyUp_(h){pr(this.baseStep_,ms(h))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ls=B("sldtxt");class Dr{constructor(h,m){this.element=h.createElement("div"),this.element.classList.add(Ls());const T=h.createElement("div");T.classList.add(Ls("s")),this.sliderView_=m.sliderView,T.appendChild(this.sliderView_.element),this.element.appendChild(T);const q=h.createElement("div");q.classList.add(Ls("t")),this.textView_=m.textView,q.appendChild(this.textView_.element),this.element.appendChild(q)}}class sl{constructor(h,m){this.value=m.value,this.viewProps=m.viewProps,this.sliderC_=new ai(h,{baseStep:m.baseStep,props:m.sliderProps,value:m.value,viewProps:this.viewProps}),this.textC_=new Co(h,{baseStep:m.baseStep,parser:m.parser,props:m.textProps,sliderProps:m.sliderProps,value:m.value,viewProps:m.viewProps}),this.view=new Dr(h,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Gr(y,h){y.write(h)}function ol(y){const h=se;if(Array.isArray(y))return h.required.array(h.required.object({text:h.required.string,value:h.required.raw}))(y).value;if(typeof y=="object")return h.required.raw(y).value}function _u(y){if(y==="inline"||y==="popup")return y}function Qs(y){const h=se;return h.required.object({max:h.optional.number,min:h.optional.number,step:h.optional.number})(y).value}function rc(y){if(Array.isArray(y))return y;const h=[];return Object.keys(y).forEach(m=>{h.push({text:m,value:y[m]})}),h}function Zo(y){return w(y)?null:new Wo(rc(y))}function ks(y){const h=y?an(y,Il):null;return h?h.step:null}function yu(y,h){const m=y&&an(y,Il);return m?Pa(m.step):Math.max(Pa(h),2)}function Ia(y){const h=ks(y);return h??1}function vs(y,h){var m;const T=y&&an(y,Il),q=Math.abs((m=T==null?void 0:T.step)!==null&&m!==void 0?m:h);return q===0?.1:Math.pow(10,Math.floor(Math.log10(q))-1)}const Jo=B("ckb");class Mi{constructor(h,m){this.onValueChange_=this.onValueChange_.bind(this),this.element=h.createElement("div"),this.element.classList.add(Jo()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("label");T.classList.add(Jo("l")),this.element.appendChild(T);const q=h.createElement("input");q.classList.add(Jo("i")),q.type="checkbox",T.appendChild(q),this.inputElement=q,m.viewProps.bindDisabled(this.inputElement);const ve=h.createElement("div");ve.classList.add(Jo("w")),T.appendChild(ve);const ke=Ze(h,"check");ve.appendChild(ke),m.value.emitter.on("change",this.onValueChange_),this.value=m.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class gs{constructor(h,m){this.onInputChange_=this.onInputChange_.bind(this),this.value=m.value,this.viewProps=m.viewProps,this.view=new Mi(h,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(h){const m=h.currentTarget;this.value.rawValue=m.checked}}function qc(y){const h=[],m=Zo(y.options);return m&&h.push(m),new Tr(h)}const Da={id:"input-bool",type:"input",accept:(y,h)=>{if(typeof y!="boolean")return null;const T=fe(h,{options:se.optional.custom(ol)});return T?{initialValue:y,params:T}:null},binding:{reader:y=>Hc,constraint:y=>qc(y.params),writer:y=>Gr},controller:y=>{const h=y.document,m=y.value,T=y.constraint,q=T&&an(T,Wo);return q?new _o(h,{props:new ae({options:q.values.value("options")}),value:m,viewProps:y.viewProps}):new gs(h,{value:m,viewProps:y.viewProps})}},La=B("col");class Hr{constructor(h,m){this.element=h.createElement("div"),this.element.classList.add(La()),m.foldable.bindExpandedClass(this.element,La(void 0,"expanded")),te(m.foldable,"completed",H(this.element,La(void 0,"cpl")));const T=h.createElement("div");T.classList.add(La("h")),this.element.appendChild(T);const q=h.createElement("div");q.classList.add(La("s")),T.appendChild(q),this.swatchElement=q;const ve=h.createElement("div");if(ve.classList.add(La("t")),T.appendChild(ve),this.textElement=ve,m.pickerLayout==="inline"){const ke=h.createElement("div");ke.classList.add(La("p")),this.element.appendChild(ke),this.pickerElement=ke}else this.pickerElement=null}}function Ai(y,h,m){const T=di(y/255,0,1),q=di(h/255,0,1),ve=di(m/255,0,1),ke=Math.max(T,q,ve),$e=Math.min(T,q,ve),Ut=ke-$e;let ln=0,On=0;const Pn=($e+ke)/2;return Ut!==0&&(On=Ut/(1-Math.abs(ke+$e-1)),T===ke?ln=(q-ve)/Ut:q===ke?ln=2+(ve-T)/Ut:ln=4+(T-q)/Ut,ln=ln/6+(ln<0?1:0)),[ln*360,On*100,Pn*100]}function Vl(y,h,m){const T=(y%360+360)%360,q=di(h/100,0,1),ve=di(m/100,0,1),ke=(1-Math.abs(2*ve-1))*q,$e=ke*(1-Math.abs(T/60%2-1)),Ut=ve-ke/2;let ln,On,Pn;return T>=0&&T<60?[ln,On,Pn]=[ke,$e,0]:T>=60&&T<120?[ln,On,Pn]=[$e,ke,0]:T>=120&&T<180?[ln,On,Pn]=[0,ke,$e]:T>=180&&T<240?[ln,On,Pn]=[0,$e,ke]:T>=240&&T<300?[ln,On,Pn]=[$e,0,ke]:[ln,On,Pn]=[ke,0,$e],[(ln+Ut)*255,(On+Ut)*255,(Pn+Ut)*255]}function $c(y,h,m){const T=di(y/255,0,1),q=di(h/255,0,1),ve=di(m/255,0,1),ke=Math.max(T,q,ve),$e=Math.min(T,q,ve),Ut=ke-$e;let ln;Ut===0?ln=0:ke===T?ln=60*(((q-ve)/Ut%6+6)%6):ke===q?ln=60*((ve-T)/Ut+2):ln=60*((T-q)/Ut+4);const On=ke===0?0:Ut/ke,Pn=ke;return[ln,On*100,Pn*100]}function sc(y,h,m){const T=Ko(y,360),q=di(h/100,0,1),ve=di(m/100,0,1),ke=ve*q,$e=ke*(1-Math.abs(T/60%2-1)),Ut=ve-ke;let ln,On,Pn;return T>=0&&T<60?[ln,On,Pn]=[ke,$e,0]:T>=60&&T<120?[ln,On,Pn]=[$e,ke,0]:T>=120&&T<180?[ln,On,Pn]=[0,ke,$e]:T>=180&&T<240?[ln,On,Pn]=[0,$e,ke]:T>=240&&T<300?[ln,On,Pn]=[$e,0,ke]:[ln,On,Pn]=[ke,0,$e],[(ln+Ut)*255,(On+Ut)*255,(Pn+Ut)*255]}function G(y,h,m){const T=m+h*(100-Math.abs(2*m-100))/200;return[y,T!==0?h*(100-Math.abs(2*m-100))/T:0,m+h*(100-Math.abs(2*m-100))/(2*100)]}function S(y,h,m){const T=100-Math.abs(m*(200-h)/100-100);return[y,T!==0?h*m/T:0,m*(200-h)/(2*100)]}function D(y){return[y[0],y[1],y[2]]}function j(y,h){return[y[0],y[1],y[2],h]}const k={hsl:{hsl:(y,h,m)=>[y,h,m],hsv:G,rgb:Vl},hsv:{hsl:S,hsv:(y,h,m)=>[y,h,m],rgb:sc},rgb:{hsl:Ai,hsv:$c,rgb:(y,h,m)=>[y,h,m]}};function Y(y,h){return[h==="float"?1:y==="rgb"?255:360,h==="float"?1:y==="rgb"?255:100,h==="float"?1:y==="rgb"?255:100]}function K(y,h){return y===h?h:Ko(y,h)}function Se(y,h,m){var T;const q=Y(h,m);return[h==="rgb"?di(y[0],0,q[0]):K(y[0],q[0]),di(y[1],0,q[1]),di(y[2],0,q[2]),di((T=y[3])!==null&&T!==void 0?T:1,0,1)]}function Xe(y,h,m,T){const q=Y(h,m),ve=Y(h,T);return y.map((ke,$e)=>ke/q[$e]*ve[$e])}function Ct(y,h,m){const T=Xe(y,h.mode,h.type,"int"),q=k[h.mode][m.mode](...T);return Xe(q,m.mode,"int",m.type)}function hn(y,h){return typeof y!="object"||w(y)?!1:h in y&&typeof y[h]=="number"}class ut{static black(h="int"){return new ut([0,0,0],"rgb",h)}static fromObject(h,m="int"){const T="a"in h?[h.r,h.g,h.b,h.a]:[h.r,h.g,h.b];return new ut(T,"rgb",m)}static toRgbaObject(h,m="int"){return h.toRgbaObject(m)}static isRgbColorObject(h){return hn(h,"r")&&hn(h,"g")&&hn(h,"b")}static isRgbaColorObject(h){return this.isRgbColorObject(h)&&hn(h,"a")}static isColorObject(h){return this.isRgbColorObject(h)}static equals(h,m){if(h.mode!==m.mode)return!1;const T=h.comps_,q=m.comps_;for(let ve=0;ve<T.length;ve++)if(T[ve]!==q[ve])return!1;return!0}constructor(h,m,T="int"){this.mode=m,this.type=T,this.comps_=Se(h,m,T)}getComponents(h,m="int"){return j(Ct(D(this.comps_),{mode:this.mode,type:this.type},{mode:h??this.mode,type:m}),this.comps_[3])}toRgbaObject(h="int"){const m=this.getComponents("rgb",h);return{r:m[0],g:m[1],b:m[2],a:m[3]}}}const Wr=B("colp");class Mh{constructor(h,m){this.alphaViews_=null,this.element=h.createElement("div"),this.element.classList.add(Wr()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("div");T.classList.add(Wr("hsv"));const q=h.createElement("div");q.classList.add(Wr("sv")),this.svPaletteView_=m.svPaletteView,q.appendChild(this.svPaletteView_.element),T.appendChild(q);const ve=h.createElement("div");ve.classList.add(Wr("h")),this.hPaletteView_=m.hPaletteView,ve.appendChild(this.hPaletteView_.element),T.appendChild(ve),this.element.appendChild(T);const ke=h.createElement("div");if(ke.classList.add(Wr("rgb")),this.textView_=m.textView,ke.appendChild(this.textView_.element),this.element.appendChild(ke),m.alphaViews){this.alphaViews_={palette:m.alphaViews.palette,text:m.alphaViews.text};const $e=h.createElement("div");$e.classList.add(Wr("a"));const Ut=h.createElement("div");Ut.classList.add(Wr("ap")),Ut.appendChild(this.alphaViews_.palette.element),$e.appendChild(Ut);const ln=h.createElement("div");ln.classList.add(Wr("at")),ln.appendChild(this.alphaViews_.text.element),$e.appendChild(ln),this.element.appendChild($e)}}get allFocusableElements(){const h=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(m=>m.inputElement)];return this.alphaViews_&&h.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),h}}function Ui(y){return y==="int"?"int":y==="float"?"float":void 0}function _s(y){const h=se;return fe(y,{alpha:h.optional.boolean,color:h.optional.object({alpha:h.optional.boolean,type:h.optional.custom(Ui)}),expanded:h.optional.boolean,picker:h.optional.custom(_u)})}function ka(y){return y?.1:1}function Qi(y){var h;return(h=y.color)===null||h===void 0?void 0:h.type}function Fa(y,h){return y.alpha===h.alpha&&y.mode===h.mode&&y.notation===h.notation&&y.type===h.type}function mr(y,h){const m=y.match(/^(.+)%$/);return Math.min(m?parseFloat(m[1])*.01*h:parseFloat(y),h)}const Kt={deg:y=>y,grad:y=>y*360/400,rad:y=>y*360/(2*Math.PI),turn:y=>y*360};function Gl(y){const h=y.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!h)return parseFloat(y);const m=parseFloat(h[1]),T=h[2];return Kt[T](m)}function bu(y){const h=y.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!h)return null;const m=[mr(h[1],255),mr(h[2],255),mr(h[3],255)];return isNaN(m[0])||isNaN(m[1])||isNaN(m[2])?null:m}function Oa(y){return h=>{const m=bu(h);return m?new ut(m,"rgb",y):null}}function oc(y){const h=y.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!h)return null;const m=[mr(h[1],255),mr(h[2],255),mr(h[3],255),mr(h[4],1)];return isNaN(m[0])||isNaN(m[1])||isNaN(m[2])||isNaN(m[3])?null:m}function Ah(y){return h=>{const m=oc(h);return m?new ut(m,"rgb",y):null}}function Ph(y){const h=y.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!h)return null;const m=[Gl(h[1]),mr(h[2],100),mr(h[3],100)];return isNaN(m[0])||isNaN(m[1])||isNaN(m[2])?null:m}function Na(y){return h=>{const m=Ph(h);return m?new ut(m,"hsl",y):null}}function Lr(y){const h=y.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!h)return null;const m=[Gl(h[1]),mr(h[2],100),mr(h[3],100),mr(h[4],1)];return isNaN(m[0])||isNaN(m[1])||isNaN(m[2])||isNaN(m[3])?null:m}function Ua(y){return h=>{const m=Lr(h);return m?new ut(m,"hsl",y):null}}function ac(y){const h=y.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(h)return[parseInt(h[1]+h[1],16),parseInt(h[2]+h[2],16),parseInt(h[3]+h[3],16)];const m=y.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return m?[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16)]:null}function ys(y){const h=ac(y);return h?new ut(h,"rgb","int"):null}function xu(y){const h=y.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(h)return[parseInt(h[1]+h[1],16),parseInt(h[2]+h[2],16),parseInt(h[3]+h[3],16),oi(parseInt(h[4]+h[4],16),0,255,0,1)];const m=y.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return m?[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16),oi(parseInt(m[4],16),0,255,0,1)]:null}function lc(y){const h=xu(y);return h?new ut(h,"rgb","int"):null}function al(y){const h=y.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!h)return null;const m=[parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])];return isNaN(m[0])||isNaN(m[1])||isNaN(m[2])?null:m}function Yc(y){return h=>{const m=al(h);return m?new ut(m,"rgb",y):null}}function bs(y){const h=y.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!h)return null;const m=[parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]),parseFloat(h[4])];return isNaN(m[0])||isNaN(m[1])||isNaN(m[2])||isNaN(m[3])?null:m}function xs(y){return h=>{const m=bs(h);return m?new ut(m,"rgb",y):null}}const ll=[{parser:ac,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:xu,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:bu,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:oc,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Ph,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Lr,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:al,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:bs,result:{alpha:!0,mode:"rgb",notation:"object"}}];function gf(y){return ll.reduce((h,{parser:m,result:T})=>h||(m(y)?T:null),null)}function pi(y,h="int"){const m=gf(y);return m?m.notation==="hex"&&h!=="float"?Object.assign(Object.assign({},m),{type:"int"}):m.notation==="func"?Object.assign(Object.assign({},m),{type:h}):null:null}const Kc={int:[ys,lc,Oa("int"),Ah("int"),Na("int"),Ua("int"),Yc("int"),xs("int")],float:[Oa("float"),Ah("float"),Na("float"),Ua("float"),Yc("float"),xs("float")]};function Qo(y){const h=Kc[y];return m=>{if(typeof m!="string")return ut.black(y);const T=h.reduce((q,ve)=>q||ve(m),null);return T??ut.black(y)}}function Fs(y){const h=Kc[y];return m=>h.reduce((T,q)=>T||q(m),null)}function Hl(y){const h=di(Math.floor(y),0,255).toString(16);return h.length===1?`0${h}`:h}function Zc(y,h="#"){const m=D(y.getComponents("rgb")).map(Hl).join("");return`${h}${m}`}function Ba(y,h="#"){const m=y.getComponents("rgb"),T=[m[0],m[1],m[2],m[3]*255].map(Hl).join("");return`${h}${T}`}function uc(y,h){const m=Ft(h==="float"?2:0);return`rgb(${D(y.getComponents("rgb",h)).map(q=>m(q)).join(", ")})`}function wu(y){return h=>uc(h,y)}function wn(y,h){const m=Ft(2),T=Ft(h==="float"?2:0);return`rgba(${y.getComponents("rgb",h).map((ve,ke)=>(ke===3?m:T)(ve)).join(", ")})`}function $n(y){return h=>wn(h,y)}function md(y){const h=[Ft(0),So,So];return`hsl(${D(y.getComponents("hsl")).map((T,q)=>h[q](T)).join(", ")})`}function _f(y){const h=[Ft(0),So,So,Ft(2)];return`hsla(${y.getComponents("hsl").map((T,q)=>h[q](T)).join(", ")})`}function Wl(y,h){const m=Ft(h==="float"?2:0),T=["r","g","b"];return`{${D(y.getComponents("rgb",h)).map((ve,ke)=>`${T[ke]}: ${m(ve)}`).join(", ")}}`}function Jc(y){return h=>Wl(h,y)}function ul(y,h){const m=Ft(2),T=Ft(h==="float"?2:0),q=["r","g","b","a"];return`{${y.getComponents("rgb",h).map((ke,$e)=>{const Ut=$e===3?m:T;return`${q[$e]}: ${Ut(ke)}`}).join(", ")}}`}function To(y){return h=>ul(h,y)}const jl=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Zc},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Ba},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:md},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:_f},...["int","float"].reduce((y,h)=>[...y,{format:{alpha:!1,mode:"rgb",notation:"func",type:h},stringifier:wu(h)},{format:{alpha:!0,mode:"rgb",notation:"func",type:h},stringifier:$n(h)},{format:{alpha:!1,mode:"rgb",notation:"object",type:h},stringifier:Jc(h)},{format:{alpha:!0,mode:"rgb",notation:"object",type:h},stringifier:To(h)}],[])];function ss(y){return jl.reduce((h,m)=>h||(Fa(m.format,y)?m.stringifier:null),null)}const Os=B("apl");class ea{constructor(h,m){this.onValueChange_=this.onValueChange_.bind(this),this.value=m.value,this.value.emitter.on("change",this.onValueChange_),this.element=h.createElement("div"),this.element.classList.add(Os()),m.viewProps.bindClassModifiers(this.element),m.viewProps.bindTabIndex(this.element);const T=h.createElement("div");T.classList.add(Os("b")),this.element.appendChild(T);const q=h.createElement("div");q.classList.add(Os("c")),T.appendChild(q),this.colorElem_=q;const ve=h.createElement("div");ve.classList.add(Os("m")),this.element.appendChild(ve),this.markerElem_=ve;const ke=h.createElement("div");ke.classList.add(Os("p")),this.markerElem_.appendChild(ke),this.previewElem_=ke,this.update_()}update_(){const h=this.value.rawValue,m=h.getComponents("rgb"),T=new ut([m[0],m[1],m[2],0],"rgb"),q=new ut([m[0],m[1],m[2],255],"rgb"),ve=["to right",wn(T),wn(q)];this.colorElem_.style.background=`linear-gradient(${ve.join(",")})`,this.previewElem_.style.backgroundColor=wn(h);const ke=oi(m[3],0,1,0,100);this.markerElem_.style.left=`${ke}%`}onValueChange_(){this.update_()}}class Xl{constructor(h,m){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=m.value,this.viewProps=m.viewProps,this.view=new ea(h,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Eo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(h,m){if(!h.point)return;const T=h.point.x/h.bounds.width,q=this.value.rawValue,[ve,ke,$e]=q.getComponents("hsv");this.value.setRawValue(new ut([ve,ke,$e,T],"hsv"),m)}onPointerDown_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerMove_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.handlePointerEvent_(h.data,{forceEmit:!0,last:!0})}onKeyDown_(h){const m=pr(ka(!0),ms(h));if(m===0)return;const T=this.value.rawValue,[q,ve,ke,$e]=T.getComponents("hsv");this.value.setRawValue(new ut([q,ve,ke,$e+m],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(h){pr(ka(!0),ms(h))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const jr=B("coltxt");function Rh(y){const h=y.createElement("select"),m=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return h.appendChild(m.reduce((T,q)=>{const ve=y.createElement("option");return ve.textContent=q.text,ve.value=q.value,T.appendChild(ve),T},y.createDocumentFragment())),h}class cl{constructor(h,m){this.element=h.createElement("div"),this.element.classList.add(jr()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("div");T.classList.add(jr("m")),this.modeElem_=Rh(h),this.modeElem_.classList.add(jr("ms")),T.appendChild(this.modeSelectElement),m.viewProps.bindDisabled(this.modeElem_);const q=h.createElement("div");q.classList.add(jr("mm")),q.appendChild(Ze(h,"dropdown")),T.appendChild(q),this.element.appendChild(T);const ve=h.createElement("div");ve.classList.add(jr("w")),this.element.appendChild(ve),this.textsElem_=ve,this.textViews_=m.textViews,this.applyTextViews_(),Q(m.colorMode,ke=>{this.modeElem_.value=ke})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(h){this.textViews_=h,this.applyTextViews_()}applyTextViews_(){Pt(this.textsElem_);const h=this.element.ownerDocument;this.textViews_.forEach(m=>{const T=h.createElement("div");T.classList.add(jr("c")),T.appendChild(m.element),this.textsElem_.appendChild(T)})}}function yf(y){return Ft(y==="float"?2:0)}function Su(y,h,m){const T=Y(y,h)[m];return new fr({min:0,max:T})}function eo(y,h,m){return new Co(y,{arrayPosition:m===0?"fst":m===2?"lst":"mid",baseStep:ka(!1),parser:h.parser,props:ae.fromObject({draggingScale:h.colorType==="float"?.01:1,formatter:yf(h.colorType)}),value:Ie(0,{constraint:Su(h.colorMode,h.colorType,m)}),viewProps:h.viewProps})}class Mo{constructor(h,m){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=m.colorType,this.parser_=m.parser,this.value=m.value,this.viewProps=m.viewProps,this.colorMode=Ie(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(h),this.view=new cl(h,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(h){const m={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},T=[eo(h,m,0),eo(h,m,1),eo(h,m,2)];return T.forEach((q,ve)=>{rl({primary:this.value,secondary:q.value,forward:ke=>ke.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[ve],backward:(ke,$e)=>{const Ut=this.colorMode.rawValue,ln=ke.rawValue.getComponents(Ut,this.colorType_);return ln[ve]=$e.rawValue,new ut(j(D(ln),ln[3]),Ut,this.colorType_)}})}),T}onModeSelectChange_(h){const m=h.currentTarget;this.colorMode.rawValue=m.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const vr=B("hpl");class cc{constructor(h,m){this.onValueChange_=this.onValueChange_.bind(this),this.value=m.value,this.value.emitter.on("change",this.onValueChange_),this.element=h.createElement("div"),this.element.classList.add(vr()),m.viewProps.bindClassModifiers(this.element),m.viewProps.bindTabIndex(this.element);const T=h.createElement("div");T.classList.add(vr("c")),this.element.appendChild(T);const q=h.createElement("div");q.classList.add(vr("m")),this.element.appendChild(q),this.markerElem_=q,this.update_()}update_(){const h=this.value.rawValue,[m]=h.getComponents("hsv");this.markerElem_.style.backgroundColor=uc(new ut([m,100,100],"hsv"));const T=oi(m,0,360,0,100);this.markerElem_.style.left=`${T}%`}onValueChange_(){this.update_()}}class I{constructor(h,m){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=m.value,this.viewProps=m.viewProps,this.view=new cc(h,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Eo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(h,m){if(!h.point)return;const T=oi(di(h.point.x,0,h.bounds.width),0,h.bounds.width,0,360),q=this.value.rawValue,[,ve,ke,$e]=q.getComponents("hsv");this.value.setRawValue(new ut([T,ve,ke,$e],"hsv"),m)}onPointerDown_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerMove_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.handlePointerEvent_(h.data,{forceEmit:!0,last:!0})}onKeyDown_(h){const m=pr(ka(!1),ms(h));if(m===0)return;const T=this.value.rawValue,[q,ve,ke,$e]=T.getComponents("hsv");this.value.setRawValue(new ut([q+m,ve,ke,$e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(h){pr(ka(!1),ms(h))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ns=B("svp"),ws=64;class mi{constructor(h,m){this.onValueChange_=this.onValueChange_.bind(this),this.value=m.value,this.value.emitter.on("change",this.onValueChange_),this.element=h.createElement("div"),this.element.classList.add(Ns()),m.viewProps.bindClassModifiers(this.element),m.viewProps.bindTabIndex(this.element);const T=h.createElement("canvas");T.height=ws,T.width=ws,T.classList.add(Ns("c")),this.element.appendChild(T),this.canvasElement=T;const q=h.createElement("div");q.classList.add(Ns("m")),this.element.appendChild(q),this.markerElem_=q,this.update_()}update_(){const h=ne(this.canvasElement);if(!h)return;const T=this.value.rawValue.getComponents("hsv"),q=this.canvasElement.width,ve=this.canvasElement.height,ke=h.getImageData(0,0,q,ve),$e=ke.data;for(let On=0;On<ve;On++)for(let Pn=0;Pn<q;Pn++){const Vs=oi(Pn,0,q,0,100),ua=oi(On,0,ve,100,0),ca=sc(T[0],Vs,ua),Fo=(On*q+Pn)*4;$e[Fo]=ca[0],$e[Fo+1]=ca[1],$e[Fo+2]=ca[2],$e[Fo+3]=255}h.putImageData(ke,0,0);const Ut=oi(T[1],0,100,0,100);this.markerElem_.style.left=`${Ut}%`;const ln=oi(T[2],0,100,100,0);this.markerElem_.style.top=`${ln}%`}onValueChange_(){this.update_()}}class wt{constructor(h,m){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=m.value,this.viewProps=m.viewProps,this.view=new mi(h,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Eo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(h,m){if(!h.point)return;const T=oi(h.point.x,0,h.bounds.width,0,100),q=oi(h.point.y,0,h.bounds.height,100,0),[ve,,,ke]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ut([ve,T,q,ke],"hsv"),m)}onPointerDown_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerMove_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.handlePointerEvent_(h.data,{forceEmit:!0,last:!0})}onKeyDown_(h){Vr(h.key)&&h.preventDefault();const[m,T,q,ve]=this.value.rawValue.getComponents("hsv"),ke=ka(!1),$e=pr(ke,ms(h)),Ut=pr(ke,Bl(h));$e===0&&Ut===0||this.value.setRawValue(new ut([m,T+$e,q+Ut,ve],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(h){const m=ka(!1),T=pr(m,ms(h)),q=pr(m,Bl(h));T===0&&q===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Qc{constructor(h,m){this.value=m.value,this.viewProps=m.viewProps,this.hPaletteC_=new I(h,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new wt(h,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=m.supportsAlpha?{palette:new Xl(h,{value:this.value,viewProps:this.viewProps}),text:new Co(h,{parser:yi,baseStep:.1,props:ae.fromObject({draggingScale:.01,formatter:Ft(2)}),value:Ie(0,{constraint:new fr({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&rl({primary:this.value,secondary:this.alphaIcs_.text.value,forward:T=>T.rawValue.getComponents()[3],backward:(T,q)=>{const ve=T.rawValue.getComponents();return ve[3]=q.rawValue,new ut(ve,T.rawValue.mode)}}),this.textC_=new Mo(h,{colorType:m.colorType,parser:yi,value:this.value,viewProps:this.viewProps}),this.view=new Mh(h,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:m.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const hc=B("colsw");class Eu{constructor(h,m){this.onValueChange_=this.onValueChange_.bind(this),m.value.emitter.on("change",this.onValueChange_),this.value=m.value,this.element=h.createElement("div"),this.element.classList.add(hc()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("div");T.classList.add(hc("sw")),this.element.appendChild(T),this.swatchElem_=T;const q=h.createElement("button");q.classList.add(hc("b")),m.viewProps.bindDisabled(q),this.element.appendChild(q),this.buttonElement=q,this.update_()}update_(){const h=this.value.rawValue;this.swatchElem_.style.backgroundColor=Ba(h)}onValueChange_(){this.update_()}}class lr{constructor(h,m){this.value=m.value,this.viewProps=m.viewProps,this.view=new Eu(h,{value:this.value,viewProps:this.viewProps})}}class vi{constructor(h,m){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=m.value,this.viewProps=m.viewProps,this.foldable_=nn.create(m.expanded),this.swatchC_=new lr(h,{value:this.value,viewProps:this.viewProps});const T=this.swatchC_.view.buttonElement;T.addEventListener("blur",this.onButtonBlur_),T.addEventListener("click",this.onButtonClick_),this.textC_=new Xo(h,{parser:m.parser,props:ae.fromObject({formatter:m.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Hr(h,{foldable:this.foldable_,pickerLayout:m.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=m.pickerLayout==="popup"?new yo(h,{viewProps:this.viewProps}):null;const q=new Qc(h,{colorType:m.colorType,supportsAlpha:m.supportsAlpha,value:this.value,viewProps:this.viewProps});q.view.allFocusableElements.forEach(ve=>{ve.addEventListener("blur",this.onPopupChildBlur_),ve.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=q,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(q.view.element),rl({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:ve=>ve.rawValue,backward:(ve,ke)=>ke.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),gt(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(h){if(!this.popC_)return;const m=this.view.element,T=h.relatedTarget;(!T||!m.contains(T))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(h){if(!this.popC_)return;const m=this.popC_.view.element,T=_t(h);T&&m.contains(T)||T&&T===this.swatchC_.view.buttonElement&&!Mn(m.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(h){this.popC_?h.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&h.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function bi(y,h){return ut.isColorObject(y)?ut.fromObject(y,h):ut.black(h)}function hl(y){return D(y.getComponents("rgb")).reduce((h,m)=>h<<8|Math.floor(m)&255,0)}function Xr(y){return y.getComponents("rgb").reduce((h,m,T)=>{const q=Math.floor(T===3?m*255:m)&255;return h<<8|q},0)>>>0}function Ss(y){return new ut([y>>16&255,y>>8&255,y&255],"rgb")}function Bi(y){return new ut([y>>24&255,y>>16&255,y>>8&255,oi(y&255,0,255,0,1)],"rgb")}function Cu(y){return typeof y!="number"?ut.black():Ss(y)}function Es(y){return typeof y!="number"?ut.black():Bi(y)}function eh(y){const h=ss(y);return h?(m,T)=>{Gr(m,h(T))}:null}function bf(y){const h=y?Xr:hl;return(m,T)=>{Gr(m,h(T))}}function xf(y,h,m){const T=h.toRgbaObject(m);y.writeProperty("r",T.r),y.writeProperty("g",T.g),y.writeProperty("b",T.b),y.writeProperty("a",T.a)}function ur(y,h,m){const T=h.toRgbaObject(m);y.writeProperty("r",T.r),y.writeProperty("g",T.g),y.writeProperty("b",T.b)}function wf(y,h){return(m,T)=>{y?xf(m,T,h):ur(m,T,h)}}function Ao(y){var h;return!!(y!=null&&y.alpha||!((h=y==null?void 0:y.color)===null||h===void 0)&&h.alpha)}function th(y){return y?h=>Ba(h,"0x"):h=>Zc(h,"0x")}function Ih(y){return"color"in y||"view"in y&&y.view==="color"}const Sf={id:"input-color-number",type:"input",accept:(y,h)=>{if(typeof y!="number"||!Ih(h))return null;const m=_s(h);return m?{initialValue:y,params:m}:null},binding:{reader:y=>Ao(y.params)?Es:Cu,equals:ut.equals,writer:y=>bf(Ao(y.params))},controller:y=>{const h=Ao(y.params),m="expanded"in y.params?y.params.expanded:void 0,T="picker"in y.params?y.params.picker:void 0;return new vi(y.document,{colorType:"int",expanded:m??!1,formatter:th(h),parser:Fs("int"),pickerLayout:T??"popup",supportsAlpha:h,value:y.value,viewProps:y.viewProps})}};function Us(y){return ut.isRgbaColorObject(y)}function fl(y){return h=>bi(h,y)}function Tu(y,h){return m=>y?ul(m,h):Wl(m,h)}const xi={id:"input-color-object",type:"input",accept:(y,h)=>{if(!ut.isColorObject(y))return null;const m=_s(h);return m?{initialValue:y,params:m}:null},binding:{reader:y=>fl(Qi(y.params)),equals:ut.equals,writer:y=>wf(Us(y.initialValue),Qi(y.params))},controller:y=>{var h;const m=ut.isRgbaColorObject(y.initialValue),T="expanded"in y.params?y.params.expanded:void 0,q="picker"in y.params?y.params.picker:void 0,ve=(h=Qi(y.params))!==null&&h!==void 0?h:"int";return new vi(y.document,{colorType:ve,expanded:T??!1,formatter:Tu(m,ve),parser:Fs(ve),pickerLayout:q??"popup",supportsAlpha:m,value:y.value,viewProps:y.viewProps})}},nh={id:"input-color-string",type:"input",accept:(y,h)=>{if(typeof y!="string"||"view"in h&&h.view==="text")return null;const m=pi(y,Qi(h));if(!m||!ss(m))return null;const q=_s(h);return q?{initialValue:y,params:q}:null},binding:{reader:y=>{var h;return Qo((h=Qi(y.params))!==null&&h!==void 0?h:"int")},equals:ut.equals,writer:y=>{const h=pi(y.initialValue,Qi(y.params));if(!h)throw O.shouldNeverHappen();const m=eh(h);if(!m)throw O.notBindable();return m}},controller:y=>{const h=pi(y.initialValue,Qi(y.params));if(!h)throw O.shouldNeverHappen();const m=ss(h);if(!m)throw O.shouldNeverHappen();const T="expanded"in y.params?y.params.expanded:void 0,q="picker"in y.params?y.params.picker:void 0;return new vi(y.document,{colorType:h.type,expanded:T??!1,formatter:m,parser:Fs(h.type),pickerLayout:q??"popup",supportsAlpha:h.alpha,value:y.value,viewProps:y.viewProps})}};class Po{constructor(h){this.components=h.components,this.asm_=h.assembly}constrain(h){const m=this.asm_.toComponents(h).map((T,q)=>{var ve,ke;return(ke=(ve=this.components[q])===null||ve===void 0?void 0:ve.constrain(T))!==null&&ke!==void 0?ke:T});return this.asm_.fromComponents(m)}}const Bs=B("pndtxt");class to{constructor(h,m){this.textViews=m.textViews,this.element=h.createElement("div"),this.element.classList.add(Bs()),this.textViews.forEach(T=>{const q=h.createElement("div");q.classList.add(Bs("a")),q.appendChild(T.element),this.element.appendChild(q)})}}function ql(y,h,m){return new Co(y,{arrayPosition:m===0?"fst":m===h.axes.length-1?"lst":"mid",baseStep:h.axes[m].baseStep,parser:h.parser,props:h.axes[m].textProps,value:Ie(0,{constraint:h.axes[m].constraint}),viewProps:h.viewProps})}class zs{constructor(h,m){this.value=m.value,this.viewProps=m.viewProps,this.acs_=m.axes.map((T,q)=>ql(h,m,q)),this.acs_.forEach((T,q)=>{rl({primary:this.value,secondary:T.value,forward:ve=>m.assembly.toComponents(ve.rawValue)[q],backward:(ve,ke)=>{const $e=m.assembly.toComponents(ve.rawValue);return $e[q]=ke.rawValue,m.assembly.fromComponents($e)}})}),this.view=new to(h,{textViews:this.acs_.map(T=>T.view)})}}function no(y,h){return"step"in y&&!w(y.step)?new Il(y.step,h):null}function dl(y){return!w(y.max)&&!w(y.min)?new fr({max:y.max,min:y.min}):!w(y.max)||!w(y.min)?new wa({max:y.max,min:y.min}):null}function Ef(y){const h=an(y,fr);if(h)return[h.values.get("min"),h.values.get("max")];const m=an(y,wa);return m?[m.minValue,m.maxValue]:[void 0,void 0]}function $l(y,h){const m=[],T=no(y,h);T&&m.push(T);const q=dl(y);q&&m.push(q);const ve=Zo(y.options);return ve&&m.push(ve),new Tr(m)}const Ro={id:"input-number",type:"input",accept:(y,h)=>{if(typeof y!="number")return null;const m=se,T=fe(h,{format:m.optional.function,max:m.optional.number,min:m.optional.number,options:m.optional.custom(ol),step:m.optional.number});return T?{initialValue:y,params:T}:null},binding:{reader:y=>Rr,constraint:y=>$l(y.params,y.initialValue),writer:y=>Gr},controller:y=>{var h;const m=y.value,T=y.constraint,q=T&&an(T,Wo);if(q)return new _o(y.document,{props:new ae({options:q.values.value("options")}),value:m,viewProps:y.viewProps});const ve=(h="format"in y.params?y.params.format:void 0)!==null&&h!==void 0?h:Ft(yu(T,m.rawValue)),ke=T&&an(T,fr);return ke?new sl(y.document,{baseStep:Ia(T),parser:yi,sliderProps:new ae({maxValue:ke.values.value("max"),minValue:ke.values.value("min")}),textProps:ae.fromObject({draggingScale:vs(T,m.rawValue),formatter:ve}),value:m,viewProps:y.viewProps}):new Co(y.document,{baseStep:Ia(T),parser:yi,props:ae.fromObject({draggingScale:vs(T,m.rawValue),formatter:ve}),value:m,viewProps:y.viewProps})}};class wi{constructor(h=0,m=0){this.x=h,this.y=m}getComponents(){return[this.x,this.y]}static isObject(h){if(w(h))return!1;const m=h.x,T=h.y;return!(typeof m!="number"||typeof T!="number")}static equals(h,m){return h.x===m.x&&h.y===m.y}toObject(){return{x:this.x,y:this.y}}}const Cs={toComponents:y=>y.getComponents(),fromComponents:y=>new wi(...y)},Yn=B("p2d");class Io{constructor(h,m){this.element=h.createElement("div"),this.element.classList.add(Yn()),m.viewProps.bindClassModifiers(this.element),Q(m.expanded,H(this.element,Yn(void 0,"expanded")));const T=h.createElement("div");T.classList.add(Yn("h")),this.element.appendChild(T);const q=h.createElement("button");q.classList.add(Yn("b")),q.appendChild(Ze(h,"p2dpad")),m.viewProps.bindDisabled(q),T.appendChild(q),this.buttonElement=q;const ve=h.createElement("div");if(ve.classList.add(Yn("t")),T.appendChild(ve),this.textElement=ve,m.pickerLayout==="inline"){const ke=h.createElement("div");ke.classList.add(Yn("p")),this.element.appendChild(ke),this.pickerElement=ke}else this.pickerElement=null}}const Pi=B("p2dp");class Mu{constructor(h,m){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=m.invertsY,this.maxValue_=m.maxValue,this.element=h.createElement("div"),this.element.classList.add(Pi()),m.layout==="popup"&&this.element.classList.add(Pi(void 0,"p")),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("div");T.classList.add(Pi("p")),m.viewProps.bindTabIndex(T),this.element.appendChild(T),this.padElement=T;const q=h.createElementNS(on,"svg");q.classList.add(Pi("g")),this.padElement.appendChild(q),this.svgElem_=q;const ve=h.createElementNS(on,"line");ve.classList.add(Pi("ax")),ve.setAttributeNS(null,"x1","0"),ve.setAttributeNS(null,"y1","50%"),ve.setAttributeNS(null,"x2","100%"),ve.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(ve);const ke=h.createElementNS(on,"line");ke.classList.add(Pi("ax")),ke.setAttributeNS(null,"x1","50%"),ke.setAttributeNS(null,"y1","0"),ke.setAttributeNS(null,"x2","50%"),ke.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(ke);const $e=h.createElementNS(on,"line");$e.classList.add(Pi("l")),$e.setAttributeNS(null,"x1","50%"),$e.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild($e),this.lineElem_=$e;const Ut=h.createElement("div");Ut.classList.add(Pi("m")),this.padElement.appendChild(Ut),this.markerElem_=Ut,m.value.emitter.on("change",this.onValueChange_),this.value=m.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[h,m]=this.value.rawValue.getComponents(),T=this.maxValue_,q=oi(h,-T,+T,0,100),ve=oi(m,-T,+T,0,100),ke=this.invertsY_?100-ve:ve;this.lineElem_.setAttributeNS(null,"x2",`${q}%`),this.lineElem_.setAttributeNS(null,"y2",`${ke}%`),this.markerElem_.style.left=`${q}%`,this.markerElem_.style.top=`${ke}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function qr(y,h,m){return[pr(h[0],ms(y)),pr(h[1],Bl(y))*(m?1:-1)]}class Ri{constructor(h,m){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=m.value,this.viewProps=m.viewProps,this.baseSteps_=m.baseSteps,this.maxValue_=m.maxValue,this.invertsY_=m.invertsY,this.view=new Mu(h,{invertsY:this.invertsY_,layout:m.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Eo(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(h,m){if(!h.point)return;const T=this.maxValue_,q=oi(h.point.x,0,h.bounds.width,-T,+T),ve=oi(this.invertsY_?h.bounds.height-h.point.y:h.point.y,0,h.bounds.height,-T,+T);this.value.setRawValue(new wi(q,ve),m)}onPointerDown_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerMove_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.handlePointerEvent_(h.data,{forceEmit:!0,last:!0})}onPadKeyDown_(h){Vr(h.key)&&h.preventDefault();const[m,T]=qr(h,this.baseSteps_,this.invertsY_);m===0&&T===0||this.value.setRawValue(new wi(this.value.rawValue.x+m,this.value.rawValue.y+T),{forceEmit:!1,last:!1})}onPadKeyUp_(h){const[m,T]=qr(h,this.baseSteps_,this.invertsY_);m===0&&T===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Cf{constructor(h,m){var T,q;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=m.value,this.viewProps=m.viewProps,this.foldable_=nn.create(m.expanded),this.popC_=m.pickerLayout==="popup"?new yo(h,{viewProps:this.viewProps}):null;const ve=new Ri(h,{baseSteps:[m.axes[0].baseStep,m.axes[1].baseStep],invertsY:m.invertsY,layout:m.pickerLayout,maxValue:m.maxValue,value:this.value,viewProps:this.viewProps});ve.view.allFocusableElements.forEach(ke=>{ke.addEventListener("blur",this.onPopupChildBlur_),ke.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=ve,this.textC_=new zs(h,{assembly:Cs,axes:m.axes,parser:m.parser,value:this.value,viewProps:this.viewProps}),this.view=new Io(h,{expanded:this.foldable_.value("expanded"),pickerLayout:m.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(T=this.view.buttonElement)===null||T===void 0||T.addEventListener("blur",this.onPadButtonBlur_),(q=this.view.buttonElement)===null||q===void 0||q.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),rl({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:ke=>ke.rawValue,backward:(ke,$e)=>$e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),gt(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(h){if(!this.popC_)return;const m=this.view.element,T=h.relatedTarget;(!T||!m.contains(T))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(h){if(!this.popC_)return;const m=this.popC_.view.element,T=_t(h);T&&m.contains(T)||T&&T===this.view.buttonElement&&!Mn(m.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(h){this.popC_?h.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&h.key==="Escape"&&this.view.buttonElement.focus()}}class Do{constructor(h=0,m=0,T=0){this.x=h,this.y=m,this.z=T}getComponents(){return[this.x,this.y,this.z]}static isObject(h){if(w(h))return!1;const m=h.x,T=h.y,q=h.z;return!(typeof m!="number"||typeof T!="number"||typeof q!="number")}static equals(h,m){return h.x===m.x&&h.y===m.y&&h.z===m.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const fc={toComponents:y=>y.getComponents(),fromComponents:y=>new Do(...y)};function Ts(y){return Do.isObject(y)?new Do(y.x,y.y,y.z):new Do}function kr(y,h){y.writeProperty("x",h.x),y.writeProperty("y",h.y),y.writeProperty("z",h.z)}function Dh(y,h){return new Po({assembly:fc,components:[io("x"in y?y.x:void 0,h.x),io("y"in y?y.y:void 0,h.y),io("z"in y?y.z:void 0,h.z)]})}function Yl(y,h){return{baseStep:Ia(h),constraint:h,textProps:ae.fromObject({draggingScale:vs(h,y),formatter:Ft(yu(h,y))})}}const ta={id:"input-point3d",type:"input",accept:(y,h)=>{if(!Do.isObject(y))return null;const m=se,T=fe(h,{x:m.optional.custom(Qs),y:m.optional.custom(Qs),z:m.optional.custom(Qs)});return T?{initialValue:y,params:T}:null},binding:{reader:y=>Ts,constraint:y=>Dh(y.params,y.initialValue),equals:Do.equals,writer:y=>kr},controller:y=>{const h=y.value,m=y.constraint;if(!(m instanceof Po))throw O.shouldNeverHappen();return new zs(y.document,{assembly:fc,axes:[Yl(h.rawValue.x,m.components[0]),Yl(h.rawValue.y,m.components[1]),Yl(h.rawValue.z,m.components[2])],parser:yi,value:h,viewProps:y.viewProps})}};class Kl{constructor(h=0,m=0,T=0,q=0){this.x=h,this.y=m,this.z=T,this.w=q}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(h){if(w(h))return!1;const m=h.x,T=h.y,q=h.z,ve=h.w;return!(typeof m!="number"||typeof T!="number"||typeof q!="number"||typeof ve!="number")}static equals(h,m){return h.x===m.x&&h.y===m.y&&h.z===m.z&&h.w===m.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const dc={toComponents:y=>y.getComponents(),fromComponents:y=>new Kl(...y)};function An(y){return Kl.isObject(y)?new Kl(y.x,y.y,y.z,y.w):new Kl}function Au(y,h){y.writeProperty("x",h.x),y.writeProperty("y",h.y),y.writeProperty("z",h.z),y.writeProperty("w",h.w)}function Pu(y,h){return new Po({assembly:dc,components:[io("x"in y?y.x:void 0,h.x),io("y"in y?y.y:void 0,h.y),io("z"in y?y.z:void 0,h.z),io("w"in y?y.w:void 0,h.w)]})}function qi(y,h){return{baseStep:Ia(h),constraint:h,textProps:ae.fromObject({draggingScale:vs(h,y),formatter:Ft(yu(h,y))})}}const na={id:"input-point4d",type:"input",accept:(y,h)=>{if(!Kl.isObject(y))return null;const m=se,T=fe(h,{x:m.optional.custom(Qs),y:m.optional.custom(Qs),z:m.optional.custom(Qs),w:m.optional.custom(Qs)});return T?{initialValue:y,params:T}:null},binding:{reader:y=>An,constraint:y=>Pu(y.params,y.initialValue),equals:Kl.equals,writer:y=>Au},controller:y=>{const h=y.value,m=y.constraint;if(!(m instanceof Po))throw O.shouldNeverHappen();return new zs(y.document,{assembly:dc,axes:h.rawValue.getComponents().map((T,q)=>qi(T,m.components[q])),parser:yi,value:h,viewProps:y.viewProps})}};function za(y){const h=[],m=Zo(y.options);return m&&h.push(m),new Tr(h)}const os={id:"input-string",type:"input",accept:(y,h)=>{if(typeof y!="string")return null;const T=fe(h,{options:se.optional.custom(ol)});return T?{initialValue:y,params:T}:null},binding:{reader:y=>nc,constraint:y=>za(y.params),writer:y=>Gr},controller:y=>{const h=y.document,m=y.value,T=y.constraint,q=T&&an(T,Wo);return q?new _o(h,{props:new ae({options:q.values.value("options")}),value:m,viewProps:y.viewProps}):new Xo(h,{parser:ve=>ve,props:ae.fromObject({formatter:ps}),value:m,viewProps:y.viewProps})}},Va={monitor:{defaultInterval:200,defaultLineCount:3}},Hn=B("mll");class ia{constructor(h,m){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=m.formatter,this.element=h.createElement("div"),this.element.classList.add(Hn()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("textarea");T.classList.add(Hn("i")),T.style.height=`calc(var(--bld-us) * ${m.lineCount})`,T.readOnly=!0,m.viewProps.bindDisabled(T),this.element.appendChild(T),this.textareaElem_=T,m.value.emitter.on("change",this.onValueUpdate_),this.value=m.value,this.update_()}update_(){const h=this.textareaElem_,m=h.scrollTop===h.scrollHeight-h.clientHeight,T=[];this.value.rawValue.forEach(q=>{q!==void 0&&T.push(this.formatter_(q))}),h.textContent=T.join(`
`),m&&(h.scrollTop=h.scrollHeight)}onValueUpdate_(){this.update_()}}class Ms{constructor(h,m){this.value=m.value,this.viewProps=m.viewProps,this.view=new ia(h,{formatter:m.formatter,lineCount:m.lineCount,value:this.value,viewProps:this.viewProps})}}const pl=B("sgl");class Lh{constructor(h,m){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=m.formatter,this.element=h.createElement("div"),this.element.classList.add(pl()),m.viewProps.bindClassModifiers(this.element);const T=h.createElement("input");T.classList.add(pl("i")),T.readOnly=!0,T.type="text",m.viewProps.bindDisabled(T),this.element.appendChild(T),this.inputElement=T,m.value.emitter.on("change",this.onValueUpdate_),this.value=m.value,this.update_()}update_(){const h=this.value.rawValue,m=h[h.length-1];this.inputElement.value=m!==void 0?this.formatter_(m):""}onValueUpdate_(){this.update_()}}class ml{constructor(h,m){this.value=m.value,this.viewProps=m.viewProps,this.view=new Lh(h,{formatter:m.formatter,value:this.value,viewProps:this.viewProps})}}const Ga={id:"monitor-bool",type:"monitor",accept:(y,h)=>{if(typeof y!="boolean")return null;const T=fe(h,{lineCount:se.optional.number});return T?{initialValue:y,params:T}:null},binding:{reader:y=>Hc},controller:y=>{var h;return y.value.rawValue.length===1?new ml(y.document,{formatter:Ju,value:y.value,viewProps:y.viewProps}):new Ms(y.document,{formatter:Ju,lineCount:(h=y.params.lineCount)!==null&&h!==void 0?h:Va.monitor.defaultLineCount,value:y.value,viewProps:y.viewProps})}},zi=B("grl");class pc{constructor(h,m){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=h.createElement("div"),this.element.classList.add(zi()),m.viewProps.bindClassModifiers(this.element),this.formatter_=m.formatter,this.props_=m.props,this.cursor_=m.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const T=h.createElementNS(on,"svg");T.classList.add(zi("g")),T.style.height=`calc(var(--bld-us) * ${m.lineCount})`,this.element.appendChild(T),this.svgElem_=T;const q=h.createElementNS(on,"polyline");this.svgElem_.appendChild(q),this.lineElem_=q;const ve=h.createElement("div");ve.classList.add(zi("t"),B("tt")()),this.element.appendChild(ve),this.tooltipElem_=ve,m.value.emitter.on("change",this.onValueUpdate_),this.value=m.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const h=this.svgElem_.getBoundingClientRect(),m=this.value.rawValue.length-1,T=this.props_.get("minValue"),q=this.props_.get("maxValue"),ve=[];this.value.rawValue.forEach((On,Pn)=>{if(On===void 0)return;const Vs=oi(Pn,0,m,0,h.width),ua=oi(On,T,q,h.height,0);ve.push([Vs,ua].join(","))}),this.lineElem_.setAttributeNS(null,"points",ve.join(" "));const ke=this.tooltipElem_,$e=this.value.rawValue[this.cursor_.rawValue];if($e===void 0){ke.classList.remove(zi("t","a"));return}const Ut=oi(this.cursor_.rawValue,0,m,0,h.width),ln=oi($e,T,q,h.height,0);ke.style.left=`${Ut}px`,ke.style.top=`${ln}px`,ke.textContent=`${this.formatter_($e)}`,ke.classList.contains(zi("t","a"))||(ke.classList.add(zi("t","a"),zi("t","in")),Nt(ke),ke.classList.remove(zi("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Tf{constructor(h,m){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=m.props,this.value=m.value,this.viewProps=m.viewProps,this.cursor_=Ie(-1),this.view=new pc(h,{cursor:this.cursor_,formatter:m.formatter,lineCount:m.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!Mn(h))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const T=new Eo(this.view.element);T.emitter.on("down",this.onGraphPointerDown_),T.emitter.on("move",this.onGraphPointerMove_),T.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(h){const m=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(oi(h.offsetX,0,m.width,0,this.value.rawValue.length))}onGraphPointerDown_(h){this.onGraphPointerMove_(h)}onGraphPointerMove_(h){if(!h.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(oi(h.data.point.x,0,h.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Lo(y){return"format"in y&&!w(y.format)?y.format:Ft(2)}function $r(y){var h;return y.value.rawValue.length===1?new ml(y.document,{formatter:Lo(y.params),value:y.value,viewProps:y.viewProps}):new Ms(y.document,{formatter:Lo(y.params),lineCount:(h=y.params.lineCount)!==null&&h!==void 0?h:Va.monitor.defaultLineCount,value:y.value,viewProps:y.viewProps})}function ih(y){var h,m,T;return new Tf(y.document,{formatter:Lo(y.params),lineCount:(h=y.params.lineCount)!==null&&h!==void 0?h:Va.monitor.defaultLineCount,props:ae.fromObject({maxValue:(m="max"in y.params?y.params.max:null)!==null&&m!==void 0?m:100,minValue:(T="min"in y.params?y.params.min:null)!==null&&T!==void 0?T:0}),value:y.value,viewProps:y.viewProps})}function kh(y){return"view"in y&&y.view==="graph"}const vl={id:"monitor-number",type:"monitor",accept:(y,h)=>{if(typeof y!="number")return null;const m=se,T=fe(h,{format:m.optional.function,lineCount:m.optional.number,max:m.optional.number,min:m.optional.number,view:m.optional.string});return T?{initialValue:y,params:T}:null},binding:{defaultBufferSize:y=>kh(y)?64:1,reader:y=>Rr},controller:y=>kh(y.params)?ih(y):$r(y)},rh={id:"monitor-string",type:"monitor",accept:(y,h)=>{if(typeof y!="string")return null;const m=se,T=fe(h,{lineCount:m.optional.number,multiline:m.optional.boolean});return T?{initialValue:y,params:T}:null},binding:{reader:y=>nc},controller:y=>{var h;const m=y.value;return m.rawValue.length>1||"multiline"in y.params&&y.params.multiline?new Ms(y.document,{formatter:ps,lineCount:(h=y.params.lineCount)!==null&&h!==void 0?h:Va.monitor.defaultLineCount,value:m,viewProps:y.viewProps}):new ml(y.document,{formatter:ps,value:m,viewProps:y.viewProps})}};function mc(y,h){var m;const T=y.accept(h.target.read(),h.params);if(w(T))return null;const q=se,ve={target:h.target,initialValue:T.initialValue,params:T.params},ke=y.binding.reader(ve),$e=y.binding.constraint?y.binding.constraint(ve):void 0,Ut=Ie(ke(T.initialValue),{constraint:$e,equals:y.binding.equals}),ln=new Ks({reader:ke,target:h.target,value:Ut,writer:y.binding.writer(ve)}),On=q.optional.boolean(h.params.disabled).value,Pn=q.optional.boolean(h.params.hidden).value,Vs=y.controller({constraint:$e,document:h.document,initialValue:T.initialValue,params:T.params,value:ln.value,viewProps:Wt.create({disabled:On,hidden:Pn})});return new vn(h.document,{binding:ln,blade:pn(),props:ae.fromObject({label:"label"in h.params?(m=q.optional.string(h.params.label).value)!==null&&m!==void 0?m:null:h.target.key}),valueController:Vs})}function ra(y,h){return h===0?new sr:new Ji(y,h??Va.monitor.defaultInterval)}function vc(y,h){var m,T,q;const ve=se,ke=y.accept(h.target.read(),h.params);if(w(ke))return null;const $e={target:h.target,initialValue:ke.initialValue,params:ke.params},Ut=y.binding.reader($e),ln=(T=(m=ve.optional.number(h.params.bufferSize).value)!==null&&m!==void 0?m:y.binding.defaultBufferSize&&y.binding.defaultBufferSize(ke.params))!==null&&T!==void 0?T:1,On=ve.optional.number(h.params.interval).value,Pn=new ar({reader:Ut,target:h.target,ticker:ra(h.document,On),value:or(ln)}),Vs=ve.optional.boolean(h.params.disabled).value,ua=ve.optional.boolean(h.params.hidden).value,ca=y.controller({document:h.document,params:ke.params,value:Pn.value,viewProps:Wt.create({disabled:Vs,hidden:ua})});return new _i(h.document,{binding:Pn,blade:pn(),props:ae.fromObject({label:"label"in h.params?(q=ve.optional.string(h.params.label).value)!==null&&q!==void 0?q:null:h.target.key}),valueController:ca})}class Zl{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(h){h.type==="blade"?this.pluginsMap_.blades.unshift(h):h.type==="input"?this.pluginsMap_.inputs.unshift(h):h.type==="monitor"&&this.pluginsMap_.monitors.unshift(h)}createInput(h,m,T){const q=m.read();if(w(q))throw new O({context:{key:m.key},type:"nomatchingcontroller"});const ve=this.pluginsMap_.inputs.reduce((ke,$e)=>ke??mc($e,{document:h,target:m,params:T}),null);if(ve)return ve;throw new O({context:{key:m.key},type:"nomatchingcontroller"})}createMonitor(h,m,T){const q=this.pluginsMap_.monitors.reduce((ve,ke)=>ve??vc(ke,{document:h,params:T,target:m}),null);if(q)return q;throw new O({context:{key:m.key},type:"nomatchingcontroller"})}createBlade(h,m){const T=this.pluginsMap_.blades.reduce((q,ve)=>q??Zi(ve,{document:h,params:m}),null);if(!T)throw new O({type:"nomatchingview",context:{params:m}});return T}createBladeApi(h){if(h instanceof vn)return new Ti(h);if(h instanceof _i)return new yr(h);if(h instanceof xa)return new fs(h,this);const m=this.pluginsMap_.blades.reduce((T,q)=>T??q.api({controller:h,pool:this}),null);if(!m)throw O.shouldNeverHappen();return m}}function ko(){const y=new Zl;return[Ru,ta,na,os,Ro,nh,xi,Sf,Da,Ga,rh,vl,tn,De,Rt,Cn].forEach(h=>{y.register(h)}),y}function Fh(y){return wi.isObject(y)?new wi(y.x,y.y):new wi}function sa(y,h){y.writeProperty("x",h.x),y.writeProperty("y",h.y)}function io(y,h){if(!y)return;const m=[],T=no(y,h);T&&m.push(T);const q=dl(y);return q&&m.push(q),new Tr(m)}function gc(y,h){return new Po({assembly:Cs,components:[io("x"in y?y.x:void 0,h.x),io("y"in y?y.y:void 0,h.y)]})}function Si(y,h){const[m,T]=y?Ef(y):[];if(!w(m)||!w(T))return Math.max(Math.abs(m??0),Math.abs(T??0));const q=Ia(y);return Math.max(Math.abs(q)*10,Math.abs(h)*10)}function oa(y,h){const m=h instanceof Po?h.components[0]:void 0,T=h instanceof Po?h.components[1]:void 0,q=Si(m,y.x),ve=Si(T,y.y);return Math.max(q,ve)}function sh(y,h){return{baseStep:Ia(h),constraint:h,textProps:ae.fromObject({draggingScale:vs(h,y),formatter:Ft(yu(h,y))})}}function _c(y){if(!("y"in y))return!1;const h=y.y;return h&&"inverted"in h?!!h.inverted:!1}const Ru={id:"input-point2d",type:"input",accept:(y,h)=>{if(!wi.isObject(y))return null;const m=se,T=fe(h,{expanded:m.optional.boolean,picker:m.optional.custom(_u),x:m.optional.custom(Qs),y:m.optional.object({inverted:m.optional.boolean,max:m.optional.number,min:m.optional.number,step:m.optional.number})});return T?{initialValue:y,params:T}:null},binding:{reader:y=>Fh,constraint:y=>gc(y.params,y.initialValue),equals:wi.equals,writer:y=>sa},controller:y=>{const h=y.document,m=y.value,T=y.constraint;if(!(T instanceof Po))throw O.shouldNeverHappen();const q="expanded"in y.params?y.params.expanded:void 0,ve="picker"in y.params?y.params.picker:void 0;return new Cf(h,{axes:[sh(m.rawValue.x,T.components[0]),sh(m.rawValue.y,T.components[1])],expanded:q??!1,invertsY:_c(y.params),maxValue:oa(m.rawValue,T),parser:yi,pickerLayout:ve??"popup",value:m,viewProps:y.viewProps})}};class oh extends o{constructor(h){super(h),this.emitter_=new U,this.controller_.valueController.value.emitter.on("change",m=>{this.emitter_.emit("change",{event:new f(this,m.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}get options(){return this.controller_.valueController.props.get("options")}set options(h){this.controller_.valueController.props.set("options",h)}get value(){return this.controller_.valueController.value.rawValue}set value(h){this.controller_.valueController.value.rawValue=h}on(h,m){const T=m.bind(this);return this.emitter_.on(h,q=>{T(q.event)}),this}}class aa extends o{constructor(h){super(h),this.emitter_=new U,this.controller_.valueController.value.emitter.on("change",m=>{this.emitter_.emit("change",{event:new f(this,m.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(h){this.controller_.valueController.sliderController.props.set("maxValue",h)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(h){this.controller_.valueController.sliderController.props.set("minValue",h)}get value(){return this.controller_.valueController.value.rawValue}set value(h){this.controller_.valueController.value.rawValue=h}on(h,m){const T=m.bind(this);return this.emitter_.on(h,q=>{T(q.event)}),this}}class Fi extends o{constructor(h){super(h),this.emitter_=new U,this.controller_.valueController.value.emitter.on("change",m=>{this.emitter_.emit("change",{event:new f(this,m.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(h){this.controller_.valueController.props.set("formatter",h)}get value(){return this.controller_.valueController.value.rawValue}set value(h){this.controller_.valueController.value.rawValue=h}on(h,m){const T=m.bind(this);return this.emitter_.on(h,q=>{T(q.event)}),this}}const Vi=function(){return{id:"list",type:"blade",accept(y){const h=se,m=fe(y,{options:h.required.custom(ol),value:h.required.raw,view:h.required.constant("list"),label:h.optional.string});return m?{params:m}:null},controller(y){const h=new Wo(rc(y.params.options)),m=Ie(y.params.value,{constraint:h}),T=new _o(y.document,{props:new ae({options:h.values.value("options")}),value:m,viewProps:y.viewProps});return new Ue(y.document,{blade:y.blade,props:ae.fromObject({label:y.params.label}),valueController:T})},api(y){return!(y.controller instanceof Ue)||!(y.controller.valueController instanceof _o)?null:new oh(y.controller)}}}();function cr(y){return y.reduce((h,m)=>Object.assign(h,{[m.presetKey]:m.read()}),{})}function gl(y,h){y.forEach(m=>{const T=h[m.target.presetKey];T!==void 0&&m.writer(m.target,m.reader(T))})}class yc extends mo{constructor(h,m){super(h,m)}get element(){return this.controller_.view.element}importPreset(h){const m=this.controller_.rackController.rack.find(vn).map(T=>T.binding);gl(m,h),this.refresh()}exportPreset(){const h=this.controller_.rackController.rack.find(vn).map(m=>m.binding.target);return cr(h)}refresh(){this.controller_.rackController.rack.find(vn).forEach(h=>{h.binding.read()}),this.controller_.rackController.rack.find(_i).forEach(h=>{h.binding.read()})}}class Ha extends oe{constructor(h,m){super(h,{expanded:m.expanded,blade:m.blade,props:m.props,root:!0,viewProps:m.viewProps})}}const yt={id:"slider",type:"blade",accept(y){const h=se,m=fe(y,{max:h.required.number,min:h.required.number,view:h.required.constant("slider"),format:h.optional.function,label:h.optional.string,value:h.optional.number});return m?{params:m}:null},controller(y){var h,m;const T=(h=y.params.value)!==null&&h!==void 0?h:0,q=new fr({max:y.params.max,min:y.params.min}),ve=new sl(y.document,{baseStep:1,parser:yi,sliderProps:new ae({maxValue:q.values.value("max"),minValue:q.values.value("min")}),textProps:ae.fromObject({draggingScale:vs(void 0,T),formatter:(m=y.params.format)!==null&&m!==void 0?m:Ul}),value:Ie(T,{constraint:q}),viewProps:y.viewProps});return new Ue(y.document,{blade:y.blade,props:ae.fromObject({label:y.params.label}),valueController:ve})},api(y){return!(y.controller instanceof Ue)||!(y.controller.valueController instanceof sl)?null:new aa(y.controller)}},Yr=function(){return{id:"text",type:"blade",accept(y){const h=se,m=fe(y,{parse:h.required.function,value:h.required.raw,view:h.required.constant("text"),format:h.optional.function,label:h.optional.string});return m?{params:m}:null},controller(y){var h;const m=new Xo(y.document,{parser:y.params.parse,props:ae.fromObject({formatter:(h=y.params.format)!==null&&h!==void 0?h:T=>String(T)}),value:Ie(y.params.value),viewProps:y.viewProps});return new Ue(y.document,{blade:y.blade,props:ae.fromObject({label:y.params.label}),valueController:m})},api(y){return!(y.controller instanceof Ue)||!(y.controller.valueController instanceof Xo)?null:new Fi(y.controller)}}}();function Oh(y){const h=y.createElement("div");return h.classList.add(B("dfw")()),y.body&&y.body.appendChild(h),h}function ro(y,h,m){if(y.querySelector(`style[data-tp-style=${h}]`))return;const T=y.createElement("style");T.dataset.tpStyle=h,T.textContent=m,y.head.appendChild(T)}class bc extends yc{constructor(h){var m,T;const q=h??{},ve=(m=q.document)!==null&&m!==void 0?m:le(),ke=ko(),$e=new Ha(ve,{expanded:q.expanded,blade:pn(),props:ae.fromObject({title:q.title}),viewProps:Wt.create()});super($e,ke),this.pool_=ke,this.containerElem_=(T=q.container)!==null&&T!==void 0?T:Oh(ve),this.containerElem_.appendChild(this.element),this.doc_=ve,this.usesDefaultWrapper_=!q.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw O.alreadyDisposed();return this.doc_}dispose(){const h=this.containerElem_;if(!h)throw O.alreadyDisposed();if(this.usesDefaultWrapper_){const m=h.parentElement;m&&m.removeChild(h)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(h){("plugin"in h?[h.plugin]:"plugins"in h?h.plugins:[]).forEach(T=>{this.pool_.register(T),this.embedPluginStyle_(T)})}embedPluginStyle_(h){h.css&&ro(this.document,`plugin-${h.id}`,h.css)}setUpDefaultPlugins_(){ro(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(h=>{this.embedPluginStyle_(h)}),this.registerPlugin({plugins:[yt,Vi,Cn,Yr]})}}const la=new i("3.1.10");t.BladeApi=o,t.ButtonApi=M,t.FolderApi=mo,t.InputBindingApi=Ti,t.ListApi=oh,t.MonitorBindingApi=yr,t.Pane=bc,t.SeparatorApi=Ve,t.SliderApi=aa,t.TabApi=kn,t.TabPageApi=gn,t.TextApi=Fi,t.TpChangeEvent=f,t.VERSION=la,Object.defineProperty(t,"__esModule",{value:!0})})}(qv,qv.exports)),qv.exports}var Dk=Ik(),$v={exports:{}},Lk=$v.exports,GE;function kk(){return GE||(GE=1,function(r,e){(function(t,i){i(e)})(Lk,function(t){class i{constructor(S){this.controller_=S}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(S){this.controller_.viewProps.set("disabled",S)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(S){this.controller_.viewProps.set("hidden",S)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class o{constructor(S){this.target=S}}class l extends o{constructor(S,D,j,k){super(S),this.value=D,this.presetKey=j,this.last=k??!0}}function f(G){return G}function d(G){return G==null}const v={alreadydisposed:()=>"View has been already disposed",invalidparams:G=>`Invalid parameters for '${G.name}'`,nomatchingcontroller:G=>`No matching controller for '${G.key}'`,nomatchingview:G=>`No matching view for '${JSON.stringify(G.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:G=>`Property '${G.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class _{constructor(S){var D;this.message=(D=v[S.type](S.context))!==null&&D!==void 0?D:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=S.type}static alreadyDisposed(){return new _({type:"alreadydisposed"})}static notBindable(){return new _({type:"notbindable"})}static propertyNotFound(S){return new _({type:"propertynotfound",context:{name:S}})}static shouldNeverHappen(){return new _({type:"shouldneverhappen"})}}class b{constructor(){this.observers_={}}on(S,D){let j=this.observers_[S];return j||(j=this.observers_[S]=[]),j.push({handler:D}),this}off(S,D){const j=this.observers_[S];return j&&(this.observers_[S]=j.filter(k=>k.handler!==D)),this}emit(S,D){const j=this.observers_[S];j&&j.forEach(k=>{k.handler(D)})}}const w="tp";function C(G){return(D,j)=>[w,"-",G,"v",D?`_${D}`:"",j?`-${j}`:""].join("")}function R(G,S){return D=>S(G(D))}function z(G){return G.rawValue}function O(G,S){G.emitter.on("change",R(z,S)),S(G.rawValue)}function P(G,S,D){O(G.value(S),D)}function M(G,S,D){D?G.classList.add(S):G.classList.remove(S)}function U(G,S){return D=>{M(G,S,D)}}function L(G,S){O(G,D=>{S.textContent=D??""})}const B=C("btn");class ${constructor(S,D){this.element=S.createElement("div"),this.element.classList.add(B()),D.viewProps.bindClassModifiers(this.element);const j=S.createElement("button");j.classList.add(B("b")),D.viewProps.bindDisabled(j),this.element.appendChild(j),this.buttonElement=j;const k=S.createElement("div");k.classList.add(B("t")),L(D.props.value("title"),k),this.buttonElement.appendChild(k)}}class X{constructor(S,D){this.emitter=new b,this.onClick_=this.onClick_.bind(this),this.props=D.props,this.viewProps=D.viewProps,this.view=new $(S,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Q{constructor(S,D){var j;this.constraint_=D==null?void 0:D.constraint,this.equals_=(j=D==null?void 0:D.equals)!==null&&j!==void 0?j:(k,Y)=>k===Y,this.emitter=new b,this.rawValue_=S}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(S){this.setRawValue(S,{forceEmit:!1,last:!0})}setRawValue(S,D){const j=D??{forceEmit:!1,last:!0},k=this.constraint_?this.constraint_.constrain(S):S,Y=this.rawValue_;this.equals_(Y,k)&&!j.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=k,this.emitter.emit("change",{options:j,previousRawValue:Y,rawValue:k,sender:this}))}}class te{constructor(S){this.emitter=new b,this.value_=S}get rawValue(){return this.value_}set rawValue(S){this.setRawValue(S,{forceEmit:!1,last:!0})}setRawValue(S,D){const j=D??{forceEmit:!1,last:!0},k=this.value_;k===S&&!j.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=S,this.emitter.emit("change",{options:j,previousRawValue:k,rawValue:this.value_,sender:this}))}}function V(G,S){const D=S==null?void 0:S.constraint,j=S==null?void 0:S.equals;return!D&&!j?new te(G):new Q(G,S)}class H{constructor(S){this.emitter=new b,this.valMap_=S;for(const D in this.valMap_)this.valMap_[D].emitter.on("change",()=>{this.emitter.emit("change",{key:D,sender:this})})}static createCore(S){return Object.keys(S).reduce((j,k)=>Object.assign(j,{[k]:V(S[k])}),{})}static fromObject(S){const D=this.createCore(S);return new H(D)}get(S){return this.valMap_[S].rawValue}set(S,D){this.valMap_[S].rawValue=D}value(S){return this.valMap_[S]}}function J(G,S){const j=Object.keys(S).reduce((k,Y)=>{if(k===void 0)return;const K=S[Y],Se=K(G[Y]);return Se.succeeded?Object.assign(Object.assign({},k),{[Y]:Se.value}):void 0},{});return j}function ce(G,S){return G.reduce((D,j)=>{if(D===void 0)return;const k=S(j);if(!(!k.succeeded||k.value===void 0))return[...D,k.value]},[])}function he(G){return G===null?!1:typeof G=="object"}function ge(G){return S=>D=>{if(!S&&D===void 0)return{succeeded:!1,value:void 0};if(S&&D===void 0)return{succeeded:!0,value:void 0};const j=G(D);return j!==void 0?{succeeded:!0,value:j}:{succeeded:!1,value:void 0}}}function Ae(G){return{custom:S=>ge(S)(G),boolean:ge(S=>typeof S=="boolean"?S:void 0)(G),number:ge(S=>typeof S=="number"?S:void 0)(G),string:ge(S=>typeof S=="string"?S:void 0)(G),function:ge(S=>typeof S=="function"?S:void 0)(G),constant:S=>ge(D=>D===S?S:void 0)(G),raw:ge(S=>S)(G),object:S=>ge(D=>{if(he(D))return J(D,S)})(G),array:S=>ge(D=>{if(Array.isArray(D))return ce(D,S)})(G)}}const me={optional:Ae(!0),required:Ae(!1)};function Ie(G,S){const D=me.required.object(S)(G);return D.succeeded?D.value:void 0}function ae(G){console.warn([`Missing '${G.key}' of ${G.target} in ${G.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function ye(G){return G&&G.parentElement&&G.parentElement.removeChild(G),null}class de{constructor(S){this.value_=S}static create(S){return[new de(S),(D,j)=>{S.setRawValue(D,j)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const ie=C("");function we(G,S){return U(G,ie(void 0,S))}class ze extends H{constructor(S){var D;super(S),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=de.create(V(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(D=this.get("parent"))===null||D===void 0||D.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(S){var D,j,k;const Y=S??{};return new ze(H.createCore({disabled:(D=Y.disabled)!==null&&D!==void 0?D:!1,disposed:!1,hidden:(j=Y.hidden)!==null&&j!==void 0?j:!1,parent:(k=Y.parent)!==null&&k!==void 0?k:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(S){O(this.globalDisabled_,we(S,"disabled")),P(this,"hidden",we(S,"hidden"))}bindDisabled(S){O(this.globalDisabled_,D=>{S.disabled=D})}bindTabIndex(S){O(this.globalDisabled_,D=>{S.tabIndex=D?-1:0})}handleDispose(S){this.value("disposed").emitter.on("change",D=>{D&&S()})}getGlobalDisabled_(){const S=this.get("parent");return(S?S.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(S){var D;const j=S.previousRawValue;j==null||j.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(D=this.get("parent"))===null||D===void 0||D.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function se(){return["veryfirst","first","last","verylast"]}const fe=C(""),Le={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Be{constructor(S){this.parent_=null,this.blade=S.blade,this.view=S.view,this.viewProps=S.viewProps;const D=this.view.element;this.blade.value("positions").emitter.on("change",()=>{se().forEach(j=>{D.classList.remove(fe(void 0,Le[j]))}),this.blade.get("positions").forEach(j=>{D.classList.add(fe(void 0,Le[j]))})}),this.viewProps.handleDispose(()=>{ye(D)})}get parent(){return this.parent_}set parent(S){if(this.parent_=S,!("parent"in this.viewProps.valMap_)){ae({key:"parent",target:ze.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const He="http://www.w3.org/2000/svg";function et(G){G.offsetHeight}function pt(G,S){const D=G.style.transition;G.style.transition="none",S(),G.style.transition=D}function Wt(G){return G.ontouchstart!==void 0}function zt(G){for(;G.childNodes.length>0;)G.removeChild(G.childNodes[0])}function bn(G){return G.relatedTarget?G.relatedTarget:"explicitOriginalTarget"in G?G.explicitOriginalTarget:null}const _e=C("lbl");function Ln(G,S){const D=G.createDocumentFragment();return S.split(`
`).map(k=>G.createTextNode(k)).forEach((k,Y)=>{Y>0&&D.appendChild(G.createElement("br")),D.appendChild(k)}),D}class on{constructor(S,D){this.element=S.createElement("div"),this.element.classList.add(_e()),D.viewProps.bindClassModifiers(this.element);const j=S.createElement("div");j.classList.add(_e("l")),P(D.props,"label",Y=>{d(Y)?this.element.classList.add(_e(void 0,"nol")):(this.element.classList.remove(_e(void 0,"nol")),zt(j),j.appendChild(Ln(S,Y)))}),this.element.appendChild(j),this.labelElement=j;const k=S.createElement("div");k.classList.add(_e("v")),this.element.appendChild(k),this.valueElement=k}}class Nt extends Be{constructor(S,D){const j=D.valueController.viewProps;super(Object.assign(Object.assign({},D),{view:new on(S,{props:D.props,viewProps:j}),viewProps:j})),this.props=D.props,this.valueController=D.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Vt extends Be{constructor(S){super(S),this.value=S.value}}class Mn extends H{constructor(S){super(S)}static create(S){const D={completed:!0,expanded:S,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},j=H.createCore(D);return new Mn(j)}get styleExpanded(){var S;return(S=this.get("temporaryExpanded"))!==null&&S!==void 0?S:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const S=this.get("expandedHeight");return this.get("shouldFixHeight")&&!d(S)?`${S}px`:"auto"}bindExpandedClass(S,D){const j=()=>{this.styleExpanded?S.classList.add(D):S.classList.remove(D)};P(this,"expanded",j),P(this,"temporaryExpanded",j)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Dt(G){return Mn.create(G)}function le(G,S){let D=0;return pt(S,()=>{G.set("expandedHeight",null),G.set("temporaryExpanded",!0),et(S),D=S.clientHeight,G.set("temporaryExpanded",null),et(S)}),D}function ne(G,S){S.style.height=G.styleHeight}function Oe(G,S){G.value("expanded").emitter.on("beforechange",()=>{G.set("completed",!1),d(G.get("expandedHeight"))&&G.set("expandedHeight",le(G,S)),G.set("shouldFixHeight",!0),et(S)}),G.emitter.on("change",()=>{ne(G,S)}),ne(G,S),S.addEventListener("transitionend",D=>{D.propertyName==="height"&&G.cleanUpTransition()})}class Ze{constructor(S,D){const j=C(D.viewName);this.element=S.createElement("div"),this.element.classList.add(j()),D.viewProps.bindClassModifiers(this.element)}}class Je extends Vt{constructor(S,D){const j=D.valueController.viewProps;super(Object.assign(Object.assign({},D),{value:D.valueController.value,view:new on(S,{props:D.props,viewProps:j}),viewProps:j})),this.props=D.props,this.valueController=D.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ye{constructor(){this.disabled=!1,this.emitter=new b}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Pt{constructor(S,D){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=S,this.emitter=new b,this.interval_=D,this.setTimer_()}get disabled(){return this.disabled_}set disabled(S){this.disabled_=S,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const S=this.doc_.defaultView;S&&S.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const S=this.doc_.defaultView;S&&(this.timerId_=S.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class ht{constructor(S){this.constraints=S}constrain(S){return this.constraints.reduce((D,j)=>j.constrain(D),S)}}function _t(G,S){if(G instanceof S)return G;if(G instanceof ht){const D=G.constraints.reduce((j,k)=>j||(k instanceof S?k:null),null);if(D)return D}return null}class fn{constructor(S){this.values=H.fromObject({max:S.max,min:S.min})}constrain(S){const D=this.values.get("max"),j=this.values.get("min");return Math.min(Math.max(S,j),D)}}class it{constructor(S){this.values=H.fromObject({max:S.max,min:S.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(S){const D=this.values.get("max"),j=this.values.get("min");let k=S;return d(j)||(k=Math.max(k,j)),d(D)||(k=Math.min(k,D)),k}}class St{constructor(S,D=0){this.step=S,this.origin=D}constrain(S){const D=this.origin%this.step,j=Math.round((S-D)/this.step);return D+j*this.step}}const jt=C("pop");class tn{constructor(S,D){this.element=S.createElement("div"),this.element.classList.add(jt()),D.viewProps.bindClassModifiers(this.element),O(D.shows,U(this.element,jt(void 0,"v")))}}class xt{constructor(S,D){this.shows=V(!1),this.viewProps=D.viewProps,this.view=new tn(S,{shows:this.shows,viewProps:this.viewProps})}}const pn=C("txt");class nn{constructor(S,D){this.onChange_=this.onChange_.bind(this),this.element=S.createElement("div"),this.element.classList.add(pn()),D.viewProps.bindClassModifiers(this.element),this.props_=D.props,this.props_.emitter.on("change",this.onChange_);const j=S.createElement("input");j.classList.add(pn("i")),j.type="text",D.viewProps.bindDisabled(j),this.element.appendChild(j),this.inputElement=j,D.value.emitter.on("change",this.onChange_),this.value_=D.value,this.refresh()}refresh(){const S=this.props_.get("formatter");this.inputElement.value=S(this.value_.rawValue)}onChange_(){this.refresh()}}class Vn{constructor(S,D){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=D.parser,this.props=D.props,this.value=D.value,this.viewProps=D.viewProps,this.view=new nn(S,{props:D.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(S){const j=S.currentTarget.value,k=this.parser_(j);d(k)||(this.value.rawValue=k),this.view.refresh()}}function Re(G){return G==="false"?!1:!!G}class gt{constructor(S){this.text=S}evaluate(){return Number(this.text)}toString(){return this.text}}const je={"**":(G,S)=>Math.pow(G,S),"*":(G,S)=>G*S,"/":(G,S)=>G/S,"%":(G,S)=>G%S,"+":(G,S)=>G+S,"-":(G,S)=>G-S,"<<":(G,S)=>G<<S,">>":(G,S)=>G>>S,">>>":(G,S)=>G>>>S,"&":(G,S)=>G&S,"^":(G,S)=>G^S,"|":(G,S)=>G|S};class Ke{constructor(S,D,j){this.left=D,this.operator=S,this.right=j}evaluate(){const S=je[this.operator];if(!S)throw new Error(`unexpected binary operator: '${this.operator}`);return S(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Mt={"+":G=>G,"-":G=>-G,"~":G=>~G};class Et{constructor(S,D){this.operator=S,this.expression=D}evaluate(){const S=Mt[this.operator];if(!S)throw new Error(`unexpected unary operator: '${this.operator}`);return S(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function mn(G){return(S,D)=>{for(let j=0;j<G.length;j++){const k=G[j](S,D);if(k!=="")return k}return""}}function Bn(G,S){var D;const j=G.substr(S).match(/^\s+/);return(D=j&&j[0])!==null&&D!==void 0?D:""}function Ti(G,S){const D=G.substr(S,1);return D.match(/^[1-9]$/)?D:""}function vn(G,S){var D;const j=G.substr(S).match(/^[0-9]+/);return(D=j&&j[0])!==null&&D!==void 0?D:""}function yr(G,S){const D=vn(G,S);if(D!=="")return D;const j=G.substr(S,1);if(S+=1,j!=="-"&&j!=="+")return"";const k=vn(G,S);return k===""?"":j+k}function _i(G,S){const D=G.substr(S,1);if(S+=1,D.toLowerCase()!=="e")return"";const j=yr(G,S);return j===""?"":D+j}function Ds(G,S){const D=G.substr(S,1);if(D==="0")return D;const j=Ti(G,S);return S+=j.length,j===""?"":j+vn(G,S)}function hs(G,S){const D=Ds(G,S);if(S+=D.length,D==="")return"";const j=G.substr(S,1);if(S+=j.length,j!==".")return"";const k=vn(G,S);return S+=k.length,D+j+k+_i(G,S)}function zr(G,S){const D=G.substr(S,1);if(S+=D.length,D!==".")return"";const j=vn(G,S);return S+=j.length,j===""?"":D+j+_i(G,S)}function fs(G,S){const D=Ds(G,S);return S+=D.length,D===""?"":D+_i(G,S)}const mo=mn([hs,zr,fs]);function vo(G,S){var D;const j=G.substr(S).match(/^[01]+/);return(D=j&&j[0])!==null&&D!==void 0?D:""}function Ho(G,S){const D=G.substr(S,2);if(S+=D.length,D.toLowerCase()!=="0b")return"";const j=vo(G,S);return j===""?"":D+j}function du(G,S){var D;const j=G.substr(S).match(/^[0-7]+/);return(D=j&&j[0])!==null&&D!==void 0?D:""}function tl(G,S){const D=G.substr(S,2);if(S+=D.length,D.toLowerCase()!=="0o")return"";const j=du(G,S);return j===""?"":D+j}function pu(G,S){var D;const j=G.substr(S).match(/^[0-9a-f]+/i);return(D=j&&j[0])!==null&&D!==void 0?D:""}function ds(G,S){const D=G.substr(S,2);if(S+=D.length,D.toLowerCase()!=="0x")return"";const j=pu(G,S);return j===""?"":D+j}const nl=mn([Ho,tl,ds]),mu=mn([nl,mo]);function xa(G,S){const D=mu(G,S);return S+=D.length,D===""?null:{evaluable:new gt(D),cursor:S}}function Rl(G,S){const D=G.substr(S,1);if(S+=D.length,D!=="(")return null;const j=Te(G,S);if(!j)return null;S=j.cursor,S+=Bn(G,S).length;const k=G.substr(S,1);return S+=k.length,k!==")"?null:{evaluable:j.evaluable,cursor:S}}function vu(G,S){var D;return(D=xa(G,S))!==null&&D!==void 0?D:Rl(G,S)}function oe(G,S){const D=vu(G,S);if(D)return D;const j=G.substr(S,1);if(S+=j.length,j!=="+"&&j!=="-"&&j!=="~")return null;const k=oe(G,S);return k?(S=k.cursor,{cursor:S,evaluable:new Et(j,k.evaluable)}):null}function De(G,S,D){D+=Bn(S,D).length;const j=G.filter(k=>S.startsWith(k,D))[0];return j?(D+=j.length,D+=Bn(S,D).length,{cursor:D,operator:j}):null}function Ue(G,S){return(D,j)=>{const k=G(D,j);if(!k)return null;j=k.cursor;let Y=k.evaluable;for(;;){const K=De(S,D,j);if(!K)break;j=K.cursor;const Se=G(D,j);if(!Se)return null;j=Se.cursor,Y=new Ke(K.operator,Y,Se.evaluable)}return Y?{cursor:j,evaluable:Y}:null}}const Ve=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((G,S)=>Ue(G,S),oe);function Te(G,S){return S+=Bn(G,S).length,Ve(G,S)}function ot(G){const S=Te(G,0);return!S||S.cursor+Bn(G,S.cursor).length!==G.length?null:S.evaluable}function dt(G){var S;const D=ot(G);return(S=D==null?void 0:D.evaluate())!==null&&S!==void 0?S:null}function Rt(G){if(typeof G=="number")return G;if(typeof G=="string"){const S=dt(G);if(!d(S))return S}return 0}function ft(G){return S=>S.toFixed(Math.max(Math.min(G,20),0))}const un=ft(0);function rn(G){return un(G)+"%"}function Yt(G){return String(G)}function gn(G,S){for(;G.length<S;)G.push(void 0)}function kn(G){const S=[];return gn(S,G),V(S)}function Fn(G){const S=G.indexOf(void 0);return S<0?G:G.slice(0,S)}function ui(G,S){const D=[...Fn(G),S];return D.length>G.length?D.splice(0,D.length-G.length):gn(D,G.length),D}function xn({primary:G,secondary:S,forward:D,backward:j}){let k=!1;function Y(K){k||(k=!0,K(),k=!1)}G.emitter.on("change",K=>{Y(()=>{S.setRawValue(D(G,S),K.options)})}),S.emitter.on("change",K=>{Y(()=>{G.setRawValue(j(G,S),K.options)}),Y(()=>{S.setRawValue(D(G,S),K.options)})}),Y(()=>{S.setRawValue(D(G,S),{forceEmit:!1,last:!0})})}function Xt(G,S){const D=G*(S.altKey?.1:1)*(S.shiftKey?10:1);return S.upKey?+D:S.downKey?-D:0}function Gn(G){return{altKey:G.altKey,downKey:G.key==="ArrowDown",shiftKey:G.shiftKey,upKey:G.key==="ArrowUp"}}function Cn(G){return{altKey:G.altKey,downKey:G.key==="ArrowLeft",shiftKey:G.shiftKey,upKey:G.key==="ArrowRight"}}function Zi(G){return G==="ArrowUp"||G==="ArrowDown"}function sr(G){return Zi(G)||G==="ArrowLeft"||G==="ArrowRight"}function Ji(G,S){var D,j;const k=S.ownerDocument.defaultView,Y=S.getBoundingClientRect();return{x:G.pageX-(((D=k&&k.scrollX)!==null&&D!==void 0?D:0)+Y.left),y:G.pageY-(((j=k&&k.scrollY)!==null&&j!==void 0?j:0)+Y.top)}}class Ks{constructor(S){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=S,this.emitter=new b,S.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),S.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),S.addEventListener("touchend",this.onTouchEnd_),S.addEventListener("mousedown",this.onMouseDown_)}computePosition_(S){const D=this.elem_.getBoundingClientRect();return{bounds:{width:D.width,height:D.height},point:S?{x:S.x,y:S.y}:null}}onMouseDown_(S){var D;S.preventDefault(),(D=S.currentTarget)===null||D===void 0||D.focus();const j=this.elem_.ownerDocument;j.addEventListener("mousemove",this.onDocumentMouseMove_),j.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:S.altKey,data:this.computePosition_(Ji(S,this.elem_)),sender:this,shiftKey:S.shiftKey})}onDocumentMouseMove_(S){this.emitter.emit("move",{altKey:S.altKey,data:this.computePosition_(Ji(S,this.elem_)),sender:this,shiftKey:S.shiftKey})}onDocumentMouseUp_(S){const D=this.elem_.ownerDocument;D.removeEventListener("mousemove",this.onDocumentMouseMove_),D.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:S.altKey,data:this.computePosition_(Ji(S,this.elem_)),sender:this,shiftKey:S.shiftKey})}onTouchStart_(S){S.preventDefault();const D=S.targetTouches.item(0),j=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:S.altKey,data:this.computePosition_(D?{x:D.clientX-j.left,y:D.clientY-j.top}:void 0),sender:this,shiftKey:S.shiftKey}),this.lastTouch_=D}onTouchMove_(S){const D=S.targetTouches.item(0),j=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:S.altKey,data:this.computePosition_(D?{x:D.clientX-j.left,y:D.clientY-j.top}:void 0),sender:this,shiftKey:S.shiftKey}),this.lastTouch_=D}onTouchEnd_(S){var D;const j=(D=S.targetTouches.item(0))!==null&&D!==void 0?D:this.lastTouch_,k=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:S.altKey,data:this.computePosition_(j?{x:j.clientX-k.left,y:j.clientY-k.top}:void 0),sender:this,shiftKey:S.shiftKey})}}function cn(G,S,D,j,k){const Y=(G-S)/(D-S);return j+Y*(k-j)}function or(G){return String(G.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function fi(G,S,D){return Math.min(Math.max(G,S),D)}const Nn=C("txt");class ar{constructor(S,D){this.onChange_=this.onChange_.bind(this),this.props_=D.props,this.props_.emitter.on("change",this.onChange_),this.element=S.createElement("div"),this.element.classList.add(Nn(),Nn(void 0,"num")),D.arrayPosition&&this.element.classList.add(Nn(void 0,D.arrayPosition)),D.viewProps.bindClassModifiers(this.element);const j=S.createElement("input");j.classList.add(Nn("i")),j.type="text",D.viewProps.bindDisabled(j),this.element.appendChild(j),this.inputElement=j,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=D.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Nn()),this.inputElement.classList.add(Nn("i"));const k=S.createElement("div");k.classList.add(Nn("k")),this.element.appendChild(k),this.knobElement=k;const Y=S.createElementNS(He,"svg");Y.classList.add(Nn("g")),this.knobElement.appendChild(Y);const K=S.createElementNS(He,"path");K.classList.add(Nn("gb")),Y.appendChild(K),this.guideBodyElem_=K;const Se=S.createElementNS(He,"path");Se.classList.add(Nn("gh")),Y.appendChild(Se),this.guideHeadElem_=Se;const Xe=S.createElement("div");Xe.classList.add(C("tt")()),this.knobElement.appendChild(Xe),this.tooltipElem_=Xe,D.value.emitter.on("change",this.onChange_),this.value=D.value,this.refresh()}onDraggingChange_(S){if(S.rawValue===null){this.element.classList.remove(Nn(void 0,"drg"));return}this.element.classList.add(Nn(void 0,"drg"));const D=S.rawValue/this.props_.get("draggingScale"),j=D+(D>0?-1:D<0?1:0),k=fi(-j,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${j+k},0 L${j},4 L${j+k},8`,`M ${D},-1 L${D},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${D},4`);const Y=this.props_.get("formatter");this.tooltipElem_.textContent=Y(this.value.rawValue),this.tooltipElem_.style.left=`${D}px`}refresh(){const S=this.props_.get("formatter");this.inputElement.value=S(this.value.rawValue)}onChange_(){this.refresh()}}class Tr{constructor(S,D){var j;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=D.baseStep,this.parser_=D.parser,this.props=D.props,this.sliderProps_=(j=D.sliderProps)!==null&&j!==void 0?j:null,this.value=D.value,this.viewProps=D.viewProps,this.dragging_=V(null),this.view=new ar(S,{arrayPosition:D.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const k=new Ks(this.view.knobElement);k.emitter.on("down",this.onPointerDown_),k.emitter.on("move",this.onPointerMove_),k.emitter.on("up",this.onPointerUp_)}constrainValue_(S){var D,j;const k=(D=this.sliderProps_)===null||D===void 0?void 0:D.get("minValue"),Y=(j=this.sliderProps_)===null||j===void 0?void 0:j.get("maxValue");let K=S;return k!==void 0&&(K=Math.max(K,k)),Y!==void 0&&(K=Math.min(K,Y)),K}onInputChange_(S){const j=S.currentTarget.value,k=this.parser_(j);d(k)||(this.value.rawValue=this.constrainValue_(k)),this.view.refresh()}onInputKeyDown_(S){const D=Xt(this.baseStep_,Gn(S));D!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+D),{forceEmit:!1,last:!1})}onInputKeyUp_(S){Xt(this.baseStep_,Gn(S))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(S){if(!S.point)return null;const D=S.point.x-S.bounds.width/2;return this.constrainValue_(this.originRawValue_+D*this.props.get("draggingScale"))}onPointerMove_(S){const D=this.computeDraggingValue_(S.data);D!==null&&(this.value.setRawValue(D,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(S){const D=this.computeDraggingValue_(S.data);D!==null&&(this.value.setRawValue(D,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function an(G,S){G.write(S)}function fr(G){const S=G?_t(G,St):null;return S?S.step:null}function Wo(G,S){const D=G&&_t(G,St);return D?or(D.step):Math.max(or(S),2)}function wa(G){const S=fr(G);return S??1}function Il(G,S){var D;const j=G&&_t(G,St),k=Math.abs((D=j==null?void 0:j.step)!==null&&D!==void 0?D:S);return k===0?.1:Math.pow(10,Math.floor(Math.log10(k))-1)}function go(G){return[G[0],G[1],G[2]]}function Dl(G){const S=fi(Math.floor(G),0,255).toString(16);return S.length===1?`0${S}`:S}function _o(G,S="#"){const D=go(G.getComponents("rgb")).map(Dl).join("");return`${S}${D}`}function Sa(G,S="#"){const D=G.getComponents("rgb"),j=[D[0],D[1],D[2],D[3]*255].map(Dl).join("");return`${S}${j}`}function jo(G,S){const D=ft(S==="float"?2:0);return`rgb(${go(G.getComponents("rgb",S)).map(k=>D(k)).join(", ")})`}function yo(G){return S=>jo(S,G)}function bo(G,S){const D=ft(2),j=ft(S==="float"?2:0);return`rgba(${G.getComponents("rgb",S).map((Y,K)=>(K===3?D:j)(Y)).join(", ")})`}function Ea(G){return S=>bo(S,G)}function Xo(G){const S=[ft(0),rn,rn];return`hsl(${go(G.getComponents("hsl")).map((j,k)=>S[k](j)).join(", ")})`}function qo(G){const S=[ft(0),rn,rn,ft(2)];return`hsla(${G.getComponents("hsl").map((j,k)=>S[k](j)).join(", ")})`}function Hc(G,S){const D=ft(S==="float"?2:0),j=["r","g","b"];return`{${go(G.getComponents("rgb",S)).map((Y,K)=>`${j[K]}: ${D(Y)}`).join(", ")}}`}function Ju(G){return S=>Hc(S,G)}function xo(G,S){const D=ft(2),j=ft(S==="float"?2:0),k=["r","g","b","a"];return`{${G.getComponents("rgb",S).map((K,Se)=>{const Xe=Se===3?D:j;return`${k[Se]}: ${Xe(K)}`}).join(", ")}}`}function Th(G){return S=>xo(S,G)}[...["int","float"].reduce((G,S)=>[...G,{format:{alpha:!1,mode:"rgb",notation:"func",type:S},stringifier:yo(S)},{format:{alpha:!0,mode:"rgb",notation:"func",type:S},stringifier:Ea(S)},{format:{alpha:!1,mode:"rgb",notation:"object",type:S},stringifier:Ju(S)},{format:{alpha:!0,mode:"rgb",notation:"object",type:S},stringifier:Th(S)}],[])];class Wc{constructor(S){this.components=S.components,this.asm_=S.assembly}constrain(S){const D=this.asm_.toComponents(S).map((j,k)=>{var Y,K;return(K=(Y=this.components[k])===null||Y===void 0?void 0:Y.constrain(j))!==null&&K!==void 0?K:j});return this.asm_.fromComponents(D)}}const Ll=C("pndtxt");class jc{constructor(S,D){this.textViews=D.textViews,this.element=S.createElement("div"),this.element.classList.add(Ll()),this.textViews.forEach(j=>{const k=S.createElement("div");k.classList.add(Ll("a")),k.appendChild(j.element),this.element.appendChild(k)})}}function Qu(G,S,D){return new Tr(G,{arrayPosition:D===0?"fst":D===S.axes.length-1?"lst":"mid",baseStep:S.axes[D].baseStep,parser:S.parser,props:S.axes[D].textProps,value:V(0,{constraint:S.axes[D].constraint}),viewProps:S.viewProps})}class $t{constructor(S,D){this.value=D.value,this.viewProps=D.viewProps,this.acs_=D.axes.map((j,k)=>Qu(S,D,k)),this.acs_.forEach((j,k)=>{xn({primary:this.value,secondary:j.value,forward:Y=>D.assembly.toComponents(Y.rawValue)[k],backward:(Y,K)=>{const Se=D.assembly.toComponents(Y.rawValue);return Se[k]=K.rawValue,D.assembly.fromComponents(Se)}})}),this.view=new jc(S,{textViews:this.acs_.map(j=>j.view)})}}function Qt(G,S){return"step"in G&&!d(G.step)?new St(G.step,S):null}function Zs(G){return!d(G.max)&&!d(G.min)?new fn({max:G.max,min:G.min}):!d(G.max)||!d(G.min)?new it({max:G.max,min:G.min}):null}const gu={monitor:{defaultInterval:200}},Js=C("grl");class Xc{constructor(S,D){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=S.createElement("div"),this.element.classList.add(Js()),D.viewProps.bindClassModifiers(this.element),this.formatter_=D.formatter,this.props_=D.props,this.cursor_=D.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const j=S.createElementNS(He,"svg");j.classList.add(Js("g")),j.style.height=`calc(var(--bld-us) * ${D.lineCount})`,this.element.appendChild(j),this.svgElem_=j;const k=S.createElementNS(He,"polyline");this.svgElem_.appendChild(k),this.lineElem_=k;const Y=S.createElement("div");Y.classList.add(Js("t"),C("tt")()),this.element.appendChild(Y),this.tooltipElem_=Y,D.value.emitter.on("change",this.onValueUpdate_),this.value=D.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const S=this.svgElem_.getBoundingClientRect(),D=this.value.rawValue.length-1,j=this.props_.get("minValue"),k=this.props_.get("maxValue"),Y=[];this.value.rawValue.forEach((hn,ut)=>{if(hn===void 0)return;const Wr=cn(ut,0,D,0,S.width),Mh=cn(hn,j,k,S.height,0);Y.push([Wr,Mh].join(","))}),this.lineElem_.setAttributeNS(null,"points",Y.join(" "));const K=this.tooltipElem_,Se=this.value.rawValue[this.cursor_.rawValue];if(Se===void 0){K.classList.remove(Js("t","a"));return}const Xe=cn(this.cursor_.rawValue,0,D,0,S.width),Ct=cn(Se,j,k,S.height,0);K.style.left=`${Xe}px`,K.style.top=`${Ct}px`,K.textContent=`${this.formatter_(Se)}`,K.classList.contains(Js("t","a"))||(K.classList.add(Js("t","a"),Js("t","in")),et(K),K.classList.remove(Js("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class ec{constructor(S,D){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=D.props,this.value=D.value,this.viewProps=D.viewProps,this.cursor_=V(-1),this.view=new Xc(S,{cursor:this.cursor_,formatter:D.formatter,lineCount:D.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!Wt(S))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const j=new Ks(this.view.element);j.emitter.on("down",this.onGraphPointerDown_),j.emitter.on("move",this.onGraphPointerMove_),j.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(S){const D=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(cn(S.offsetX,0,D.width,0,this.value.rawValue.length))}onGraphPointerDown_(S){this.onGraphPointerMove_(S)}onGraphPointerMove_(S){if(!S.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(cn(S.data.point.x,0,S.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}class kl{constructor(S){this.controller_=S}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(S){this.controller_.viewProps.set("disabled",S)}get title(){var S;return(S=this.controller_.props.get("title"))!==null&&S!==void 0?S:""}set title(S){this.controller_.props.set("title",S)}on(S,D){const j=D.bind(this);return this.controller_.emitter.on(S,()=>{j(new o(this))}),this}}class Fl extends o{constructor(S,D,j){super(S),this.cell=D,this.index=j}}class tc extends i{constructor(S){super(S),this.cellToApiMap_=new Map,this.emitter_=new b;const D=this.controller_.valueController;D.cellControllers.forEach((j,k)=>{const Y=new kl(j);this.cellToApiMap_.set(j,Y),j.emitter.on("click",()=>{const K=k%D.size[0],Se=Math.floor(k/D.size[0]);this.emitter_.emit("click",{event:new Fl(this,Y,[K,Se])})})})}cell(S,D){const j=this.controller_.valueController,k=j.cellControllers[D*j.size[0]+S];return this.cellToApiMap_.get(k)}on(S,D){const j=D.bind(this);return this.emitter_.on(S,k=>{j(k.event)}),this}}class yn{constructor(S,D){this.size=D.size;const[j,k]=this.size,Y=[];for(let K=0;K<k;K++)for(let Se=0;Se<j;Se++){const Xe=new X(S,{props:H.fromObject(Object.assign({},D.cellConfig(Se,K))),viewProps:ze.create()});Y.push(Xe)}this.cellCs_=Y,this.viewProps=ze.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(K=>{K.viewProps.set("disposed",!0)})}),this.view=new Ze(S,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${j}, 1fr)`,this.cellCs_.forEach(K=>{this.view.element.appendChild(K.view.element)})}get cellControllers(){return this.cellCs_}}const Ca={id:"buttongrid",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(G){const S=me,D=Ie(G,{cells:S.required.function,size:S.required.array(S.required.number),view:S.required.constant("buttongrid"),label:S.optional.string});return D?{params:D}:null},controller(G){return new Nt(G.document,{blade:G.blade,props:H.fromObject({label:G.params.label}),valueController:new yn(G.document,{cellConfig:G.params.cells,size:G.params.size})})},api(G){return!(G.controller instanceof Nt)||!(G.controller.valueController instanceof yn)?null:new tc(G.controller)}};class dr extends i{get label(){return this.controller_.props.get("label")}set label(S){this.controller_.props.set("label",S)}get value(){return this.controller_.valueController.value.rawValue}set value(S){this.controller_.valueController.value.rawValue=S}on(S,D){const j=D.bind(this);return this.controller_.valueController.value.emitter.on(S,k=>{j(new l(this,k.rawValue,void 0,k.options.last))}),this}}function Mr(G,S,D){return G*(1-D)+S*D}const $o=20,ci=.001,il=100;function Ar(G,S){let D=.25,j=.5,k=-1;for(let Y=0;Y<$o;Y++){const[K,Se]=G.curve(j);if(j+=D*(K<S?1:-1),k=Se,D*=.5,Math.abs(S-K)<ci)break}return k}class Pr{constructor(S=0,D=0,j=1,k=1){this.cache_=[],this.comps_=[S,D,j,k]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(S){return d(S)||!Array.isArray(S)?!1:typeof S[0]=="number"&&typeof S[1]=="number"&&typeof S[2]=="number"&&typeof S[3]=="number"}static equals(S,D){return S.x1===D.x1&&S.y1===D.y1&&S.x2===D.x2&&S.y2===D.y2}curve(S){const D=Mr(0,this.x1,S),j=Mr(0,this.y1,S),k=Mr(this.x1,this.x2,S),Y=Mr(this.y1,this.y2,S),K=Mr(this.x2,1,S),Se=Mr(this.y2,1,S),Xe=Mr(D,k,S),Ct=Mr(j,Y,S),hn=Mr(k,K,S),ut=Mr(Y,Se,S);return[Mr(Xe,hn,S),Mr(Ct,ut,S)]}y(S){if(this.cache_.length===0){const D=[];for(let j=0;j<il;j++)D.push(Ar(this,cn(j,0,il-1,0,1)));this.cache_=D}return this.cache_[Math.round(cn(fi(S,0,1),0,1,0,il-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const Ta={toComponents:G=>G.toObject(),fromComponents:G=>new Pr(...G)};function Ma(G){const S=ft(2);return`cubic-bezier(${G.toObject().map(j=>S(j)).join(", ")})`}const Ol=[0,.5,.5,1];function si(G){const S=G.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!S)return new Pr(...Ol);const D=[S[1],S[2],S[3],S[4]].reduce((j,k)=>{if(!j)return null;const Y=Number(k);return isNaN(Y)?null:[...j,Y]},[]);return new Pr(...D??Ol)}const wo=C("cbz");class Qn{constructor(S,D){this.element=S.createElement("div"),this.element.classList.add(wo()),D.viewProps.bindClassModifiers(this.element),D.foldable.bindExpandedClass(this.element,wo(void 0,"expanded")),P(D.foldable,"completed",U(this.element,wo(void 0,"cpl")));const j=S.createElement("div");j.classList.add(wo("h")),this.element.appendChild(j);const k=S.createElement("button");k.classList.add(wo("b")),D.viewProps.bindDisabled(k);const Y=S.createElementNS(He,"svg");Y.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',k.appendChild(Y),j.appendChild(k),this.buttonElement=k;const K=S.createElement("div");if(K.classList.add(wo("t")),j.appendChild(K),this.textElement=K,D.pickerLayout==="inline"){const Se=S.createElement("div");Se.classList.add(wo("p")),this.element.appendChild(Se),this.pickerElement=Se}else this.pickerElement=null}}const Aa=C("cbzp");class Nl{constructor(S,D){this.element=S.createElement("div"),this.element.classList.add(Aa()),D.viewProps.bindClassModifiers(this.element);const j=S.createElement("div");j.classList.add(Aa("g")),this.element.appendChild(j),this.graphElement=j;const k=S.createElement("div");k.classList.add(Aa("t")),this.element.appendChild(k),this.textElement=k}}function yi(G,S){const D=new MutationObserver(k=>{for(const Y of k)Y.type==="childList"&&Y.addedNodes.forEach(K=>{K.contains(K)&&(S(),D.disconnect())})}),j=G.ownerDocument;D.observe(j.body,{attributes:!0,childList:!0,subtree:!0})}const Rr=C("cbzg");function Ul(G,S){return D=>S(G(D))}class Ft{constructor(S,D){this.element=S.createElement("div"),this.element.classList.add(Rr()),D.viewProps.bindClassModifiers(this.element),D.viewProps.bindTabIndex(this.element);const j=S.createElement("div");j.classList.add(Rr("p")),this.element.appendChild(j),this.previewElement=j;const k=S.createElementNS(He,"svg");k.classList.add(Rr("g")),this.element.appendChild(k),this.svgElem_=k;const Y=S.createElementNS(He,"path");Y.classList.add(Rr("u")),this.svgElem_.appendChild(Y),this.guideElem_=Y;const K=S.createElementNS(He,"polyline");K.classList.add(Rr("l")),this.svgElem_.appendChild(K),this.lineElem_=K,this.handleElems_=[S.createElement("div"),S.createElement("div")],this.handleElems_.forEach(Se=>{Se.classList.add(Rr("h")),this.element.appendChild(Se)}),this.vectorElems_=[S.createElementNS(He,"line"),S.createElementNS(He,"line")],this.vectorElems_.forEach(Se=>{Se.classList.add(Rr("v")),this.svgElem_.appendChild(Se)}),this.value_=D.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=D.selection,this.handleElems_.forEach((Se,Xe)=>{O(this.sel_,Ul(Ct=>Ct===Xe,U(Se,Rr("h","sel"))))}),yi(this.element,()=>{this.refresh()})}getVertMargin_(S){return S*.25}valueToPosition(S,D){const j=this.element.getBoundingClientRect(),k=j.width,Y=j.height,K=this.getVertMargin_(Y);return{x:cn(S,0,1,0,k),y:cn(D,0,1,Y-K,K)}}positionToValue(S,D){const j=this.element.getBoundingClientRect(),k=j.width,Y=j.height,K=this.getVertMargin_(Y);return{x:fi(cn(S,0,k,0,1),0,1),y:cn(D,Y-K,K,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(Y=>{const K=this.valueToPosition(0,Y),Se=this.valueToPosition(1,Y);return[`M ${K.x},${K.y}`,`L ${Se.x},${Se.y}`].join(" ")}).join(" "));const S=this.value_.rawValue,D=[];let j=0;for(;;){const Y=this.valueToPosition(...S.curve(j));if(D.push([Y.x,Y.y].join(",")),j>=1)break;j=Math.min(j+.05,1)}this.lineElem_.setAttributeNS(null,"points",D.join(" "));const k=S.toObject();[0,1].forEach(Y=>{const K=this.valueToPosition(Y,Y),Se=this.valueToPosition(k[Y*2],k[Y*2+1]),Xe=this.vectorElems_[Y];Xe.setAttributeNS(null,"x1",String(K.x)),Xe.setAttributeNS(null,"y1",String(K.y)),Xe.setAttributeNS(null,"x2",String(Se.x)),Xe.setAttributeNS(null,"y2",String(Se.y));const Ct=this.handleElems_[Y];Ct.style.left=`${Se.x}px`,Ct.style.top=`${Se.y}px`})}onValueChange_(){this.refresh()}}const br=24,So=400,nc=1e3,ps=C("cbzprv");class rl{constructor(S,D){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=S.createElement("div"),this.element.classList.add(ps()),D.viewProps.bindClassModifiers(this.element);const j=S.createElementNS(He,"svg");j.classList.add(ps("g")),this.element.appendChild(j),this.svgElem_=j;const k=S.createElementNS(He,"path");k.classList.add(ps("t")),this.svgElem_.appendChild(k),this.ticksElem_=k;const Y=S.createElement("div");Y.classList.add(ps("m")),this.element.appendChild(Y),this.markerElem_=Y,this.value_=D.value,this.value_.emitter.on("change",this.onValueChange_),D.viewProps.handleDispose(this.onDispose_),yi(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(ps("m","a")),this.startTime_=new Date().getTime()+So,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(ps("m","a"))}onDispose_(){this.stop()}updateMarker_(S){const D=this.value_.rawValue.y(fi(S,0,1));this.markerElem_.style.left=`${D*100}%`}refresh(){const S=this.svgElem_.getBoundingClientRect(),D=S.width,j=S.height,k=[],Y=this.value_.rawValue;for(let K=0;K<br;K++){const Se=cn(K,0,br-1,0,1),Xe=cn(Y.y(Se),0,1,0,D);k.push(`M ${Xe},0 v${j}`)}this.ticksElem_.setAttributeNS(null,"d",k.join(" "))}onTimer_(){if(this.startTime_===null)return;const S=new Date().getTime()-this.startTime_,D=S/nc;this.updateMarker_(D),S>nc+So&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function pr(G,S,D,j){const k=D-G,Y=j-S;return Math.sqrt(k*k+Y*Y)}function Bl(G,S,D,j){const k=pr(G,S,D,j),Y=Math.atan2(j-S,D-G),K=Math.round(Y/(Math.PI/4))*Math.PI/4;return{x:G+Math.cos(K)*k,y:S+Math.sin(K)*k}}class ms{constructor(S,D){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=D.baseStep,this.value=D.value,this.sel_=V(0),this.viewProps=D.viewProps,this.view=new Ft(S,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new rl(S,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",k=>{k.stopImmediatePropagation(),k.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);const j=new Ks(this.view.element);j.emitter.on("down",this.onPointerDown_),j.emitter.on("move",this.onPointerMove_),j.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(S,D,j){const k=this.sel_.rawValue,Y=this.value.rawValue.toObject(),K=this.view.positionToValue(S.x,S.y),Se=D?Bl(k,k,K.x,K.y):K;Y[k*2]=Se.x,Y[k*2+1]=Se.y,this.value.setRawValue(new Pr(...Y),j)}onPointerDown_(S){const D=S.data;if(!D.point)return;const j=this.value.rawValue,k=this.view.valueToPosition(j.x1,j.y1),Y=pr(D.point.x,D.point.y,k.x,k.y),K=this.view.valueToPosition(j.x2,j.y2),Se=pr(D.point.x,D.point.y,K.x,K.y);this.sel_.rawValue=Y<=Se?0:1,this.updateValue_(D.point,S.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(S){const D=S.data;D.point&&this.updateValue_(D.point,S.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(S){const D=S.data;D.point&&this.updateValue_(D.point,S.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(S){sr(S.key)&&S.preventDefault();const D=this.sel_.rawValue,j=this.value.rawValue.toObject();j[D*2]+=Xt(this.baseStep_,Cn(S)),j[D*2+1]+=Xt(this.baseStep_,Gn(S)),this.value.setRawValue(new Pr(...j),{forceEmit:!1,last:!1})}onKeyUp_(S){sr(S.key)&&S.preventDefault();const D=Xt(this.baseStep_,Cn(S)),j=Xt(this.baseStep_,Gn(S));D===0&&j===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Yo{constructor(S,D){this.value=D.value,this.viewProps=D.viewProps,this.view=new Nl(S,{viewProps:this.viewProps}),this.gc_=new ms(S,{baseStep:D.axis.baseStep,value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const j=Object.assign(Object.assign({},D.axis),{constraint:new it({max:1,min:0})}),k=Object.assign(Object.assign({},D.axis),{constraint:void 0});this.tc_=new $t(S,{assembly:Ta,axes:[j,k,j,k],parser:dt,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(S=>S.inputElement)]}refresh(){this.gc_.refresh()}}class Vr{constructor(S,D){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=D.value,this.viewProps=D.viewProps,this.foldable_=Dt(D.expanded),this.view=new Qn(S,{foldable:this.foldable_,pickerLayout:D.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new Vn(S,{parser:si,props:H.fromObject({formatter:Ma}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=D.pickerLayout==="popup"?new xt(S,{viewProps:this.viewProps}):null;const j=new Yo(S,{axis:D.axis,value:this.value,viewProps:this.viewProps});j.allFocusableElements.forEach(k=>{k.addEventListener("blur",this.onPopupChildBlur_),k.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=j,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),O(this.popC_.shows,k=>{k&&j.refresh()}),xn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:k=>k.rawValue,backward:(k,Y)=>Y.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Oe(this.foldable_,this.view.pickerElement))}onButtonBlur_(S){if(!this.popC_)return;const D=S.relatedTarget;(!D||!this.popC_.view.element.contains(D))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(S){if(!this.popC_)return;const D=this.popC_.view.element,j=bn(S);j&&D.contains(j)||j&&j===this.view.buttonElement&&!Wt(D.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(S){this.popC_&&S.key==="Escape"&&(this.popC_.shows.rawValue=!1)}}function zl(){return new Wc({assembly:Ta,components:[0,1,2,3].map(G=>G%2===0?new it({min:0,max:1}):void 0)})}const Eo={id:"cubic-bezier",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(G){const S=me,D=Ie(G,{value:S.required.array(S.required.number),view:S.required.constant("cubicbezier"),expanded:S.optional.boolean,label:S.optional.string,picker:S.optional.custom(j=>j==="inline"||j==="popup"?j:void 0)});return D?{params:D}:null},controller(G){var S,D;const j=new Pr(...G.params.value),k=V(j,{constraint:zl(),equals:Pr.equals}),Y=new Vr(G.document,{axis:{baseStep:.1,textProps:H.fromObject({draggingScale:.01,formatter:ft(2)})},expanded:(S=G.params.expanded)!==null&&S!==void 0?S:!1,pickerLayout:(D=G.params.picker)!==null&&D!==void 0?D:"popup",value:k,viewProps:G.viewProps});return new Je(G.document,{blade:G.blade,props:H.fromObject({label:G.params.label}),valueController:Y})},api(G){return!(G.controller instanceof Je)||!(G.controller.valueController instanceof Vr)?null:new dr(G.controller)}};class oi extends i{begin(){this.controller_.valueController.begin()}end(){this.controller_.valueController.end()}}const Pa=20;class di{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(S){this.start_=S.getTime()}calculateFps_(S){if(this.timestamps_.length===0)return null;const D=this.timestamps_[0];return 1e3*(this.frameCount_-D.frameCount)/(S-D.time)}compactTimestamps_(){if(this.timestamps_.length<=Pa)return;const S=this.timestamps_.length-Pa;this.timestamps_.splice(0,S);const D=this.timestamps_[0].frameCount;this.timestamps_.forEach(j=>{j.frameCount-=D}),this.frameCount_-=D}end(S){if(this.start_===null)return;const D=S.getTime();this.duration_=D-this.start_,this.start_=null,this.fps_=this.calculateFps_(D),this.timestamps_.push({frameCount:this.frameCount_,time:D}),++this.frameCount_,this.compactTimestamps_()}}const Ko=C("fps");class rs{constructor(S,D){this.element=S.createElement("div"),this.element.classList.add(Ko()),D.viewProps.bindClassModifiers(this.element),this.graphElement=S.createElement("div"),this.graphElement.classList.add(Ko("g")),this.element.appendChild(this.graphElement);const j=S.createElement("div");j.classList.add(Ko("l")),this.element.appendChild(j);const k=S.createElement("span");k.classList.add(Ko("v")),k.textContent="--",j.appendChild(k),this.valueElement=k;const Y=S.createElement("span");Y.classList.add(Ko("u")),Y.textContent="FPS",j.appendChild(Y)}}class Ra{constructor(S,D){this.stopwatch_=new di,this.onTick_=this.onTick_.bind(this),this.ticker_=D.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.value_=D.value,this.viewProps=D.viewProps,this.view=new rs(S,{viewProps:this.viewProps}),this.graphC_=new ec(S,{formatter:ft(0),lineCount:D.lineCount,props:H.fromObject({maxValue:D.maxValue,minValue:D.minValue}),value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker_.dispose()})}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const S=this.stopwatch_.fps;if(S!==null){const D=this.value_.rawValue;this.value_.rawValue=ui(D,S),this.view.valueElement.textContent=S.toFixed(0)}}}function Co(G,S){return S===0?new Ye:new Pt(G,S??gu.monitor.defaultInterval)}const ic={id:"fpsgraph",type:"blade",accept(G){const S=me,D=Ie(G,{view:S.required.constant("fpsgraph"),interval:S.optional.number,label:S.optional.string,lineCount:S.optional.number,max:S.optional.number,min:S.optional.number});return D?{params:D}:null},controller(G){var S,D,j,k;const Y=(S=G.params.interval)!==null&&S!==void 0?S:500;return new Nt(G.document,{blade:G.blade,props:H.fromObject({label:G.params.label}),valueController:new Ra(G.document,{lineCount:(D=G.params.lineCount)!==null&&D!==void 0?D:2,maxValue:(j=G.params.max)!==null&&j!==void 0?j:90,minValue:(k=G.params.min)!==null&&k!==void 0?k:0,ticker:Co(G.document,Y),value:kn(80),viewProps:G.viewProps})})},api(G){return!(G.controller instanceof Nt)||!(G.controller.valueController instanceof Ra)?null:new oi(G.controller)}};class Ir{constructor(S,D){this.min=S,this.max=D}static isObject(S){if(typeof S!="object"||S===null)return!1;const D=S.min,j=S.max;return!(typeof D!="number"||typeof j!="number")}static equals(S,D){return S.min===D.min&&S.max===D.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const ai={fromComponents:G=>new Ir(G[0],G[1]),toComponents:G=>[G.min,G.max]};class Ls{constructor(S){this.edge=S}constrain(S){var D,j,k,Y,K,Se,Xe,Ct;if(S.min<=S.max)return new Ir((j=(D=this.edge)===null||D===void 0?void 0:D.constrain(S.min))!==null&&j!==void 0?j:S.min,(Y=(k=this.edge)===null||k===void 0?void 0:k.constrain(S.max))!==null&&Y!==void 0?Y:S.max);const hn=(S.min+S.max)/2;return new Ir((Se=(K=this.edge)===null||K===void 0?void 0:K.constrain(hn))!==null&&Se!==void 0?Se:hn,(Ct=(Xe=this.edge)===null||Xe===void 0?void 0:Xe.constrain(hn))!==null&&Ct!==void 0?Ct:hn)}}const Dr=C("rsltxt");class sl{constructor(S,D){this.sliderView_=D.sliderView,this.textView_=D.textView,this.element=S.createElement("div"),this.element.classList.add(Dr());const j=S.createElement("div");j.classList.add(Dr("s")),j.appendChild(this.sliderView_.element),this.element.appendChild(j);const k=S.createElement("div");k.classList.add(Dr("t")),k.appendChild(this.textView_.element),this.element.appendChild(k)}}const Gr=C("rsl");class ol{constructor(S,D){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=D.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=S.createElement("div"),this.element.classList.add(Gr()),D.viewProps.bindClassModifiers(this.element),this.value_=D.value,this.value_.emitter.on("change",this.onValueChange_);const j=S.createElement("div");j.classList.add(Gr("t")),this.element.appendChild(j),this.trackElement=j;const k=S.createElement("div");k.classList.add(Gr("b")),j.appendChild(k),this.barElement=k;const Y=["min","max"].map(K=>{const Se=S.createElement("div");return Se.classList.add(Gr("k"),Gr("k",K)),j.appendChild(Se),Se});this.knobElements=[Y[0],Y[1]],this.update_()}valueToX_(S){const D=this.sliderProps_.get("minValue"),j=this.sliderProps_.get("maxValue");return fi(cn(S,D,j,0,1),0,1)*100}update_(){const S=this.value_.rawValue;S.length===0?this.element.classList.add(Gr(void 0,"zero")):this.element.classList.remove(Gr(void 0,"zero"));const D=[this.valueToX_(S.min),this.valueToX_(S.max)];this.barElement.style.left=`${D[0]}%`,this.barElement.style.right=`${100-D[1]}%`,this.knobElements.forEach((j,k)=>{j.style.left=`${D[k]}%`})}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class _u{constructor(S,D){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=D.sliderProps,this.viewProps=D.viewProps,this.value=D.value,this.view=new ol(S,{sliderProps:this.sliderProps,value:this.value,viewProps:D.viewProps});const j=new Ks(this.view.trackElement);j.emitter.on("down",this.onPointerDown_),j.emitter.on("move",this.onPointerMove_),j.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(S){if(!S.point)return null;const D=(S.point.x+this.ofs_())/S.bounds.width,j=this.sliderProps.get("minValue"),k=this.sliderProps.get("maxValue");return cn(D,0,1,j,k)}onPointerDown_(S){if(!S.data.point)return;const D=S.data.point.x/S.data.bounds.width,j=this.value.rawValue,k=this.sliderProps.get("minValue"),Y=this.sliderProps.get("maxValue"),K=cn(j.min,k,Y,0,1),Se=cn(j.max,k,Y,0,1);Math.abs(Se-D)<=.025?this.grabbing_="max":Math.abs(K-D)<=.025?this.grabbing_="min":D>=K&&D<=Se?(this.grabbing_="length",this.grabOffset_=cn(D-K,0,1,0,Y-k)):D<K?(this.grabbing_="min",this.onPointerMove_(S)):D>Se&&(this.grabbing_="max",this.onPointerMove_(S))}applyPointToValue_(S,D){const j=this.valueFromData_(S);if(j===null)return;const k=this.sliderProps.get("minValue"),Y=this.sliderProps.get("maxValue");if(this.grabbing_==="min")this.value.setRawValue(new Ir(j,this.value.rawValue.max),D);else if(this.grabbing_==="max")this.value.setRawValue(new Ir(this.value.rawValue.min,j),D);else if(this.grabbing_==="length"){const K=this.value.rawValue.length;let Se=j-this.grabOffset_,Xe=Se+K;Se<k?(Se=k,Xe=k+K):Xe>Y&&(Se=Y-K,Xe=Y),this.value.setRawValue(new Ir(Se,Xe),D)}}onPointerMove_(S){this.applyPointToValue_(S.data,{forceEmit:!1,last:!1})}onPointerUp_(S){this.applyPointToValue_(S.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class Qs{constructor(S,D){this.value=D.value,this.viewProps=D.viewProps,this.sc_=new _u(S,D);const j={baseStep:D.baseStep,constraint:D.constraint,textProps:H.fromObject({draggingScale:D.draggingScale,formatter:D.formatter})};this.tc_=new $t(S,{assembly:ai,axes:[j,j],parser:D.parser,value:this.value,viewProps:D.viewProps}),this.view=new sl(S,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function rc(G){return Ir.isObject(G)?new Ir(G.min,G.max):new Ir(0,0)}function Zo(G,S){G.writeProperty("max",S.max),G.writeProperty("min",S.min)}function ks(G){const S=[],D=Zs(G);D&&S.push(D);const j=Qt(G);return j&&S.push(j),new Ls(new ht(S))}const yu={id:"input-interval",type:"input",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept:(G,S)=>{if(!Ir.isObject(G))return null;const D=me,j=Ie(S,{format:D.optional.function,max:D.optional.number,min:D.optional.number,step:D.optional.number});return j?{initialValue:new Ir(G.min,G.max),params:j}:null},binding:{reader:G=>rc,constraint:G=>ks(G.params),equals:Ir.equals,writer:G=>Zo},controller(G){var S;const D=G.value,j=G.constraint;if(!(j instanceof Ls))throw _.shouldNeverHappen();const k=(D.rawValue.min+D.rawValue.max)/2,Y=(S=G.params.format)!==null&&S!==void 0?S:ft(Wo(j.edge,k)),K=j.edge&&_t(j.edge,fn);if(K)return new Qs(G.document,{baseStep:wa(j.edge),constraint:j.edge,draggingScale:Il(j.edge,k),formatter:Y,parser:dt,sliderProps:new H({maxValue:K.values.value("max"),minValue:K.values.value("min")}),value:D,viewProps:G.viewProps});const Se={baseStep:wa(j.edge),constraint:j.edge,textProps:H.fromObject({draggingScale:k,formatter:Y})};return new $t(G.document,{assembly:ai,axes:[Se,Se],parser:dt,value:D,viewProps:G.viewProps})}};class Ia{constructor(S){this.controller_=S}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(S){this.controller_.viewProps.set("disabled",S)}get title(){var S;return(S=this.controller_.props.get("title"))!==null&&S!==void 0?S:""}set title(S){this.controller_.props.set("title",S)}}class vs extends l{constructor(S,D,j,k,Y){super(S,k,Y),this.cell=D,this.index=j}}class Jo extends i{constructor(S){super(S),this.cellToApiMap_=new Map,this.controller_.valueController.cellControllers.forEach(j=>{const k=new Ia(j);this.cellToApiMap_.set(j,k)})}get value(){return this.controller_.value}cell(S,D){const j=this.controller_.valueController,k=j.cellControllers[D*j.size[0]+S];return this.cellToApiMap_.get(k)}on(S,D){const j=D.bind(this);this.controller_.value.emitter.on(S,k=>{const Y=this.controller_.valueController,K=Y.findCellByValue(k.rawValue);if(!K)return;const Se=this.cellToApiMap_.get(K);if(!Se)return;const Xe=Y.cellControllers.indexOf(K);j(new vs(this,Se,[Xe%Y.size[0],Math.floor(Xe/Y.size[0])],k.rawValue,void 0))})}}const Mi=C("rad");class gs{constructor(S,D){this.element=S.createElement("div"),this.element.classList.add(Mi()),D.viewProps.bindClassModifiers(this.element);const j=S.createElement("label");j.classList.add(Mi("l")),this.element.appendChild(j);const k=S.createElement("input");k.classList.add(Mi("i")),k.name=D.name,k.type="radio",D.viewProps.bindDisabled(k),j.appendChild(k),this.inputElement=k;const Y=S.createElement("div");Y.classList.add(Mi("b")),j.appendChild(Y);const K=S.createElement("div");K.classList.add(Mi("t")),Y.appendChild(K),P(D.props,"title",Se=>{K.textContent=Se})}}class qc{constructor(S,D){this.props=D.props,this.viewProps=D.viewProps,this.view=new gs(S,{name:D.name,props:this.props,viewProps:this.viewProps})}}class Da{constructor(S,D){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=D.size;const[j,k]=this.size;for(let Y=0;Y<k;Y++)for(let K=0;K<j;K++){const Se=new qc(S,{name:D.groupName,props:H.fromObject(Object.assign({},D.cellConfig(K,Y))),viewProps:ze.create()});this.cellCs_.push(Se),this.cellValues_.push(D.cellConfig(K,Y).value)}this.value=D.value,O(this.value,Y=>{const K=this.findCellByValue(Y);K&&(K.view.inputElement.checked=!0)}),this.viewProps=ze.create(),this.view=new Ze(S,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${j}, 1fr)`,this.cellCs_.forEach(Y=>{Y.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(Y.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(S){const D=this.cellValues_.findIndex(j=>j===S);return D<0?null:this.cellCs_[D]}onCellInputChange_(S){const D=S.currentTarget,j=this.cellCs_.findIndex(k=>k.view.inputElement===D);j<0||(this.value.rawValue=this.cellValues_[j])}}const La=function(){return{id:"radiogrid",type:"blade",accept(G){const S=me,D=Ie(G,{cells:S.required.function,groupName:S.required.string,size:S.required.array(S.required.number),value:S.required.raw,view:S.required.constant("radiogrid"),label:S.optional.string});return D?{params:D}:null},controller(G){return new Je(G.document,{blade:G.blade,props:H.fromObject({label:G.params.label}),valueController:new Da(G.document,{groupName:G.params.groupName,cellConfig:G.params.cells,size:G.params.size,value:V(G.params.value)})})},api(G){return!(G.controller instanceof Je)||!(G.controller.valueController instanceof Da)?null:new Jo(G.controller)}}}();function Hr(G){return{id:"input-radiogrid",type:"input",accept(S,D){if(!G.isType(S))return null;const j=me,k=Ie(D,{cells:j.required.function,groupName:j.required.string,size:j.required.array(j.required.number),view:j.required.constant("radiogrid")});return k?{initialValue:S,params:k}:null},binding:G.binding,controller:S=>new Da(S.document,{cellConfig:S.params.cells,groupName:S.params.groupName,size:S.params.size,value:S.value})}}const Ai=Hr({isType:G=>typeof G=="number",binding:{reader:G=>Rt,writer:G=>an}}),Vl=Hr({isType:G=>typeof G=="string",binding:{reader:G=>Yt,writer:G=>an}}),$c=Hr({isType:G=>typeof G=="boolean",binding:{reader:G=>Re,writer:G=>an}}),sc=[Ca,Eo,ic,yu,La,$c,Ai,Vl];t.ButtonCellApi=kl,t.ButtonGridApi=tc,t.ButtonGridController=yn,t.CubicBezier=Pr,t.CubicBezierApi=dr,t.CubicBezierAssembly=Ta,t.CubicBezierController=Vr,t.CubicBezierGraphController=ms,t.CubicBezierGraphView=Ft,t.CubicBezierPickerController=Yo,t.CubicBezierPickerView=Nl,t.CubicBezierPreviewView=rl,t.CubicBezierView=Qn,t.FpsGraphBladeApi=oi,t.FpsGraphController=Ra,t.FpsView=rs,t.Fpswatch=di,t.Interval=Ir,t.IntervalAssembly=ai,t.IntervalConstraint=Ls,t.RadioCellApi=Ia,t.RadioController=qc,t.RadioGridApi=Jo,t.RadioGridController=Da,t.RadioView=gs,t.RangeSliderController=_u,t.RangeSliderTextController=Qs,t.RangeSliderTextView=sl,t.RangeSliderView=ol,t.TpRadioGridChangeEvent=vs,t.plugins=sc,Object.defineProperty(t,"__esModule",{value:!0})})}($v,$v.exports)),$v.exports}var tM=kk();const Fk=Fm(tM),Ok=GM({__proto__:null,default:Fk},[tM]);var fu=Object.freeze({ID_VIS_TYPE_DEFAULT:1e3,ID_VIS_TYPE_FIBER:1001}),HE=-1,kw=function(){function r(e){Xn(this,r),ue(this,"agentData",void 0),ue(this,"fiberCurve",void 0),ue(this,"colorIndex",void 0),ue(this,"active",void 0),ue(this,"color",void 0),ue(this,"name",void 0),ue(this,"followed",void 0),ue(this,"highlighted",void 0),ue(this,"hidden",void 0),this.agentData={x:0,y:0,z:0,xrot:0,yrot:0,zrot:0,instanceId:HE,visType:fu.ID_VIS_TYPE_DEFAULT,type:0,cr:1,subpoints:[]},this.name=e,this.color=new Ht(r.UNASSIGNED_MESH_COLOR),this.active=!1,this.colorIndex=0,this.followed=!1,this.hidden=!1,this.highlighted=!1,this.fiberCurve=void 0}return qn(r,[{key:"resetAgent",value:function(){this.active=!1,this.hidden=!1,this.followed=!1,this.fiberCurve=void 0}},{key:"resetMesh",value:function(){this.followed=!1,this.highlighted=!1,this.setColor({color:new Ht(r.UNASSIGNED_MESH_COLOR),colorId:0}),this.agentData={x:0,y:0,z:0,xrot:0,yrot:0,zrot:0,instanceId:HE,visType:fu.ID_VIS_TYPE_DEFAULT,type:0,cr:1,subpoints:[]}}},{key:"setColor",value:function(t){this.color=t.color,this.colorIndex=t.colorId}},{key:"setHidden",value:function(t){this.hidden=t}},{key:"setFollowed",value:function(t){this.followed=t}},{key:"setHighlighted",value:function(t){t!==this.highlighted&&(this.highlighted=t)}},{key:"signedTypeId",value:function(){return(this.colorIndex+1)*(this.highlighted?1:-1)}},{key:"onPdbBeforeRender",value:function(t,i,o,l,f){if(f.uniforms&&(f.uniforms.typeId&&(f.uniforms.typeId.value=this.signedTypeId(),f.uniformsNeedUpdate=!0),f.uniforms.instanceId&&(f.uniforms.instanceId.value=Number(this.agentData.instanceId),f.uniformsNeedUpdate=!0),f.uniforms.radius)){var d=0;f.uniforms.radius.value=(d+1)*.25,f.uniformsNeedUpdate=!0}}},{key:"hideAndDeactivate",value:function(){this.active=!1}},{key:"updateFiber",value:function(t){var i=t.length,o=i/3;if(i%3!==0){console.warn("Warning, subpoints array does not contain a multiple of 3");return}if(o<2){console.warn("Warning, subpoints array does not have enough points for a curve");return}for(var l=[],f=0;f<i;f+=3){var d=t[f],v=t[f+1],_=t[f+2];l.push(new be(d,v,_))}this.fiberCurve=new XT(l)}},{key:"getFollowPosition",value:function(){var t=new be(this.agentData.x,this.agentData.y,this.agentData.z);return this.agentData.visType===fu.ID_VIS_TYPE_FIBER&&this.fiberCurve?this.fiberCurve.getPoint(.5).add(t):t}}])}();ue(kw,"UNASSIGNED_MESH_COLOR",16711935);ue(kw,"UNASSIGNED_NAME_PREFIX","Unassigned");var Nk=32;function cm(r,e,t){return r+(e-r)*t}var Uk=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Nk;Xn(this,r),ue(this,"numSegments",void 0),ue(this,"maxSegments",void 0),ue(this,"color",void 0),ue(this,"points",void 0),ue(this,"colors",void 0),ue(this,"geometry",void 0),ue(this,"material",void 0),ue(this,"line",void 0);var i=new Float32Array(t*3*2),o=new Float32Array(t*3*2),l=new is;l.setAttribute("position",new ns(i,3)),l.setAttribute("color",new ns(o,3)),l.setDrawRange(0,0);var f=new _p({vertexColors:!0}),d=new dg(l,f);d.frustumCulled=!1,this.numSegments=0,this.maxSegments=t,this.color=e||new Ht(16777215),this.points=i,this.colors=o,this.geometry=l,this.material=f,this.line=d}return qn(r,[{key:"show",value:function(t){this.line.visible=t}},{key:"addPointToPath",value:function(t,i,o,l,f,d,v){if(this.numSegments===this.maxSegments)this.points.copyWithin(0,3*2,this.maxSegments*3*2),this.numSegments=this.maxSegments-1;else{for(var _=0;_<this.numSegments+1;++_){var b=1-_/(this.numSegments+1);this.colors[_*6+0]=cm(this.color.r,v.r,b),this.colors[_*6+1]=cm(this.color.g,v.g,b),this.colors[_*6+2]=cm(this.color.b,v.b,b);var w=1-(_+1)/(this.numSegments+1);this.colors[_*6+3]=cm(this.color.r,v.r,w),this.colors[_*6+4]=cm(this.color.g,v.g,w),this.colors[_*6+5]=cm(this.color.b,v.b,w)}this.line.geometry.attributes.color.needsUpdate=!0}this.points[this.numSegments*2*3+0]=t-l,this.points[this.numSegments*2*3+1]=i-f,this.points[this.numSegments*2*3+2]=o-d,this.points[this.numSegments*2*3+3]=t,this.points[this.numSegments*2*3+4]=i,this.points[this.numSegments*2*3+5]=o,this.numSegments++,this.line.geometry.setDrawRange(0,this.numSegments*2),this.line.geometry.attributes.position.needsUpdate=!0}}])}();function WE(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,i)}return t}function jE(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?WE(Object(t),!0).forEach(function(i){ue(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):WE(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}var Xx=120,nM={position:{x:0,y:0,z:Xx},lookAtPosition:{x:0,y:0,z:0},upVector:{x:0,y:1,z:0},fovDegrees:75},Uc=jE(jE({},nM),{},{orthographic:!1}),Bk=function(r){return r.SMOLDYN="Smoldyn",r}({}),iM=60,Fw=3,zk=8,wg=function(){function r(e){Xn(this,r),ue(this,"scene",void 0),ue(this,"geometry",void 0),ue(this,"material",void 0),ue(this,"camera",void 0),ue(this,"mesh",void 0),this.scene=new n_,this.geometry=new Um(2,2),this.material=new Vc({vertexShader:["varying vec2 vUv;","void main()","{","vUv = uv;","gl_Position = vec4( position, 1.0 );","}"].join(`
`),fragmentShader:e.fragmentShader,uniforms:e.uniforms,defines:e.defines||{}}),this.material.depthWrite=!1,this.material.depthTest=!1,this.mesh=new Cr(this.geometry,this.material),this.scene.add(this.mesh),this.camera=new xg(-1,1,1,-1,0,1)}return qn(r,[{key:"render",value:function(t,i){t.setRenderTarget(i),t.render(this.scene,this.camera)}}])}(),Vk=function(){function r(){Xn(this,r),ue(this,"pass",void 0),this.pass=new wg({defines:{NUM_SAMPLES:7,NUM_RINGS:4},uniforms:{normalTex:{value:null},viewPosTex:{value:null},iResolution:{value:new At(2,2)},cameraFar:{value:100},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0},beginFalloffDistance:{value:0},endFalloffDistance:{value:100}},fragmentShader:`

                #include <common> // for pow2 and PI2

                varying vec2 vUv;

                uniform sampler2D viewPosTex;
                uniform sampler2D normalTex;

                uniform float cameraFar;

                uniform float scale;
                uniform float intensity;
                uniform float bias;
                uniform float kernelRadius;
                uniform float minResolution;
                uniform vec2 iResolution;// size;
                uniform float randomSeed;
                uniform float beginFalloffDistance;
                uniform float endFalloffDistance;

                vec3 getViewNormal( const in vec2 screenPosition ) {
                    vec3 n = texture2D( normalTex, screenPosition ).xyz;
                    return 2.0 * n - 1.0;
                }

                float scaleDividedByCameraFar;
                float minResolutionMultipliedByCameraFar;

                float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {
                    vec3 viewDelta = sampleViewPosition - centerViewPosition;
                    float viewDistance = length( viewDelta );
                    float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;

                    return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );
                }

                // moving costly divides into consts
                const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );
                const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );

                float getAmbientOcclusion( const in vec3 centerViewPosition, const in float depthInterpolant ) {
                    // precompute some variables require in getOcclusion.
                    scaleDividedByCameraFar = scale / cameraFar;
                    minResolutionMultipliedByCameraFar = minResolution * cameraFar;
                    vec3 centerViewNormal = getViewNormal( vUv );

                    // jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/
                    float angle = rand( vUv + randomSeed ) * PI2;
                    vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / iResolution; // size;
                    vec2 radiusStep = radius;

                    float occlusionSum = 0.0;
                    float weightSum = 0.0;

                    for( int i = 0; i < NUM_SAMPLES; i ++ ) {
                        vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;
                        radius += radiusStep;
                        angle += ANGLE_STEP;

                        vec4 viewPos4 = texture(viewPosTex, sampleUv).xyzw;
                        // test if this fragment has any geometry rendered on it, otherwise it's bg
                        if (viewPos4.w < 1.0) continue;
                        vec3 sampleViewPosition = viewPos4.xyz;

                        occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );
                        weightSum += 1.0;
                    }

                    if( weightSum == 0.0 ) discard;

                    float ambientOcclusion = occlusionSum * ( intensity / weightSum ) * (1.0-depthInterpolant);
                    return clamp(ambientOcclusion, 0.0, 1.0);
                }

                void main() {
                    vec4 viewPos4 = texture(viewPosTex, vUv).xyzw;
                    // test if this fragment has any geometry rendered on it, otherwise it's bg
                    if (viewPos4.w < 1.0) discard;

                    vec3 viewPosition = viewPos4.xyz;
                    float eyeZ = -viewPosition.z;
                    float depthInterpolant = mix(0.0, 1.0, clamp((eyeZ-beginFalloffDistance)/(endFalloffDistance-beginFalloffDistance), 0.0, 1.0));
                    //float depthInterpolant = smoothstep(beginFalloffDistance, endFalloffDistance, eyeZ);

                    float ambientOcclusion = getAmbientOcclusion( viewPosition, depthInterpolant );

                    gl_FragColor = vec4(vec3(1.0-ambientOcclusion), 1.0);
                }`})}return qn(r,[{key:"resize",value:function(t,i){this.pass.material.uniforms.iResolution.value=new At(t,i)}},{key:"render",value:function(t,i,o,l,f){this.pass.material.uniforms.viewPosTex.value=f,this.pass.material.uniforms.normalTex.value=l;var d=t.getClearColor(new Ht).clone(),v=t.getClearAlpha();t.setClearColor(new Ht(1,0,0),1),this.pass.render(t,o),t.setClearColor(d,v)}}])}(),Gk=`
precision highp float;

    uniform vec2 iResolution;
    uniform float scale;
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    in vec4 position;

    out vec3 IN_viewPos;
    out float IN_radius;
    out vec2 IN_instanceAndTypeId;

    // per instance attributes
    in vec4 translateAndScale; // xyz trans, w scale
    in vec4 rotation; // quaternion
    // instanceID, typeId, lod_scale
    in vec3 instanceAndTypeId; 

    vec3 applyQuaternionToVector( vec4 q, vec3 v ) {
        return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
    }
    
    void main()	{
        vec3 p = position.xyz;
    
        // per-instance transform
        p *= translateAndScale.w;
        p = applyQuaternionToVector(rotation, p);
        p += translateAndScale.xyz;
    
        float radius = instanceAndTypeId.z;

        vec4 modelViewPosition = modelViewMatrix * vec4(p, 1.0);
        IN_viewPos = modelViewPosition.xyz;
        IN_instanceAndTypeId = instanceAndTypeId.xy;

        gl_Position = projectionMatrix * modelViewPosition;

        gl_PointSize = iResolution.y * projectionMatrix[1][1] * radius * scale / gl_Position.w;
        IN_radius = radius;
    }
`,Hk=`
precision highp float;

in vec3 IN_viewPos;
in float IN_radius;
in vec2 IN_instanceAndTypeId;

layout(location = 0) out vec4 gAgentInfo;
layout(location = 1) out vec4 gNormal;
layout(location = 2) out vec4 gPos;

    uniform vec2 iResolution;
    
    uniform float scale;
    uniform mat4 projectionMatrix;
    
    void main()	{
        // gl_PointCoord spans (0,0)..(1,1)
        // uv spans (-1,-1)..(1,1)
        vec2 uv = (gl_PointCoord - vec2(.5, .5)) * 2.0;
        float lensqr = dot(uv, uv);
        if (lensqr > 1.0) discard;

        vec3 normal = vec3(uv.x, uv.y, sqrt(1.0 - lensqr));
        normal = normalize(normal);

        vec3 fragViewPos = IN_viewPos;
        // adding pushes Z back. so "center" of sphere is "frontmost"
        fragViewPos.z += IN_radius * scale * sqrt(1.0 - lensqr);
      
        vec4 fragPosClip = projectionMatrix * vec4(fragViewPos, 1.0);
        vec3 fragPosNDC = fragPosClip.xyz / fragPosClip.w;
        float n = gl_DepthRange.near;
        float f = gl_DepthRange.far;
        float fragPosDepth = (((f - n) * fragPosNDC.z) + n + f) / 2.0;

        gl_FragDepth = fragPosDepth;

        // uncomment the following line to test LOD.  IN_radius is a measure of lod.
        //gAgentInfo = vec4(IN_radius*4.0, IN_instanceAndTypeId.x, fragViewPos.z, fragPosDepth);

        gAgentInfo = vec4(IN_instanceAndTypeId.y, IN_instanceAndTypeId.x, fragViewPos.z, fragPosDepth);
        
        gNormal = vec4(normal * 0.5 + 0.5, 1.0);
        gPos = vec4(fragViewPos.x, fragViewPos.y, fragViewPos.z, 1.0);
    }

`,Wk=new i_({glslVersion:Lm,uniforms:{iResolution:{value:new At},scale:{value:1},modelViewMatrix:{value:new hi},projectionMatrix:{value:new hi}},vertexShader:Gk,fragmentShader:Hk,side:Ku,transparent:!1}),jk={mat:Wk};const rM={shaderSet:jk};function XE(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,i)}return t}function Xk(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?XE(Object(t),!0).forEach(function(i){ue(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):XE(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}var qk=`
precision highp float;

// attributes of our mesh
in float position;
in float angle;
in vec2 uv;

// per instance attributes
in vec4 translateAndScale; // xyz trans, w scale
in vec4 rotation; // quaternion
// instanceID, typeId, and which row of texture contains this curve
in vec3 instanceAndTypeId;

out vec3 IN_viewPos;
out vec3 IN_viewNormal;
out vec2 IN_instanceAndTypeId;

// built-in uniforms from ThreeJS camera and Object3D
uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform mat3 normalMatrix;

uniform sampler2D curveData;

// Some constants for the robust version
#ifdef ROBUST
  const float MAX_NUMBER = 1.79769313e+308;
  const float EPSILON = 1.19209290e-7;
#endif

// the curve itself; to be loaded at beginning of main
vec3 points[NUM_POINTS];

// Angles to spherical coordinates
vec3 spherical (float r, float phi, float theta) {
  return r * vec3(
    cos(phi) * cos(theta),
    cos(phi) * sin(theta),
    sin(phi)
  );
}

vec4 initCubicPolynomial(float x0, float x1, float t0, float t1) {
  return vec4(x0, t0, - 3.0 * x0 + 3.0 * x1 - 2.0 * t0 - t1, 2.0 * x0 - 2.0 * x1 + t0 + t1);
}
float calcCubicPolynomial( float t, vec4 c ) {

			float t2 = t * t;
			float t3 = t2 * t;
			return c[0] + c[1] * t + c[2] * t2 + c[3] * t3;
		}
vec4 initNonuniformCatmullRom( float x0, float x1, float x2, float x3, float dt0, float dt1, float dt2 ) {

			// compute tangents when parameterized in [t1,t2]
			float t1 = ( x1 - x0 ) / dt0 - ( x2 - x0 ) / ( dt0 + dt1 ) + ( x2 - x1 ) / dt1;
			float t2 = ( x2 - x1 ) / dt1 - ( x3 - x1 ) / ( dt1 + dt2 ) + ( x3 - x2 ) / dt2;

			// rescale tangents for parametrization in [0,1]
			t1 *= dt1;
			t2 *= dt1;

			return initCubicPolynomial( x1, x2, t1, t2 );

		}

vec3 getCurvePoint(int i) {
  // instanceAndTypeId.z is which curve in this set of curves
  return texelFetch(curveData,ivec2(i, int(instanceAndTypeId.z)), 0).rgb;
}

vec3 sampleCurve(float t) {
		vec3 point = vec3(0,0,0);

		int l = NUM_POINTS;

		float p = float( l - 1 ) * t;
		int intPoint = int(floor( p ));
		float weight = p - float(intPoint);

		if ( weight == 0.0 && intPoint == (l - 1) ) {

			intPoint = l - 2;
			weight = 1.0;

		}

		vec3 p0, p3; // 4 points (p1 & p2 defined below)

		if ( intPoint > 0 ) {

			p0 = points[ ( intPoint - 1 ) % l ];

		} else {

			// extrapolate first point
			//tmp.subVectors( points[ 0 ], points[ 1 ] ).add( points[ 0 ] );
      p0 = (points[0]-points[1]) + points[0];

		}

		vec3 p1 = points[ intPoint % l ];
		vec3 p2 = points[ ( intPoint + 1 ) % l ];

		if ( intPoint + 2 < l ) {

			p3 = points[ ( intPoint + 2 ) % l ];

		} else {

			// extrapolate last point
			//tmp.subVectors( points[ l - 1 ], points[ l - 2 ] ).add( points[ l - 1 ] );
			p3 = (points[l-1]-points[l-2])+points[l-1];

		}

    // init Centripetal / Chordal Catmull-Rom
    const float exponent = 0.25;
    float dt0 = dot(p0-p1, p0-p1);
    float dt1 = dot(p1-p2, p1-p2);
    float dt2 = dot(p2-p3, p2-p3);
    dt0 = pow( dt0, exponent );
    dt1 = pow( dt1, exponent );
    dt2 = pow( dt2, exponent );

    // safety check for repeated points
    if ( dt1 < 1e-4 ) dt1 = 1.0;
    if ( dt0 < 1e-4 ) dt0 = dt1;
    if ( dt2 < 1e-4 ) dt2 = dt1;

    vec4 px = initNonuniformCatmullRom( p0.x, p1.x, p2.x, p3.x, dt0, dt1, dt2 );
    vec4 py = initNonuniformCatmullRom( p0.y, p1.y, p2.y, p3.y, dt0, dt1, dt2 );
    vec4 pz = initNonuniformCatmullRom( p0.z, p1.z, p2.z, p3.z, dt0, dt1, dt2 );

		point = vec3(
			calcCubicPolynomial( weight, px ),
			calcCubicPolynomial( weight, py ),
			calcCubicPolynomial( weight, pz )
		);

		return point;
	}


#ifdef ROBUST
// ------
// Robust handling of Frenet-Serret frames with Parallel Transport
// ------
vec3 getTangent (vec3 a, vec3 b) {
  return normalize(b - a);
}

void rotateByAxisAngle (inout vec3 normal, vec3 axis, float rotAngle) {
  // http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm
  // assumes axis is normalized
  float halfAngle = rotAngle / 2.0;
  float s = sin(halfAngle);
  vec4 quat = vec4(axis * s, cos(halfAngle));
  normal = normal + 2.0 * cross(quat.xyz, cross(quat.xyz, normal) + quat.w * normal);
}

void createTube (float t, vec2 volume, out vec3 outPosition, out vec3 outNormal) {
  // Reference:
  // https://github.com/mrdoob/three.js/blob/b07565918713771e77b8701105f2645b1e5009a7/src/extras/core/Curve.js#L268
  float nextT = t + (1.0 / float(lengthSegments));

  // find first tangent
  vec3 point0 = sampleCurve(0.0);
  vec3 point1 = sampleCurve(1.0 / float(lengthSegments));

  vec3 lastTangent = getTangent(point0, point1);
  vec3 absTangent = abs(lastTangent);
  #ifdef ROBUST_NORMAL
    float min = MAX_NUMBER;
    vec3 tmpNormal = vec3(0.0);
    if (absTangent.x <= min) {
      min = absTangent.x;
      tmpNormal.x = 1.0;
    }
    if (absTangent.y <= min) {
      min = absTangent.y;
      tmpNormal.y = 1.0;
    }
    if (absTangent.z <= min) {
      tmpNormal.z = 1.0;
    }
  #else
    vec3 tmpNormal = vec3(1.0, 0.0, 0.0);
  #endif
  vec3 tmpVec = normalize(cross(lastTangent, tmpNormal));
  vec3 lastNormal = cross(lastTangent, tmpVec);
  vec3 lastBinormal = cross(lastTangent, lastNormal);
  vec3 lastPoint = point0;

  vec3 normal;
  vec3 tangent;
  vec3 binormal;
  vec3 point;
  float maxLen = (float(lengthSegments) - 1.0);
  float epSq = EPSILON * EPSILON;
  for (float i = 1.0; i < float(lengthSegments); i += 1.0) {
    float u = i / maxLen;
    // could avoid additional sample here at expense of ternary
    // point = i == 1.0 ? point1 : sampleCurve(u);
    point = sampleCurve(u);
    tangent = getTangent(lastPoint, point);
    normal = lastNormal;
    binormal = lastBinormal;

    tmpVec = cross(lastTangent, tangent);
    if ((tmpVec.x * tmpVec.x + tmpVec.y * tmpVec.y + tmpVec.z * tmpVec.z) > epSq) {
      tmpVec = normalize(tmpVec);
      float tangentDot = dot(lastTangent, tangent);
      float theta = acos(clamp(tangentDot, -1.0, 1.0)); // clamp for floating pt errors
      rotateByAxisAngle(normal, tmpVec, theta);
    }

    binormal = cross(tangent, normal);
    if (u >= t) break;

    lastPoint = point;
    lastTangent = tangent;
    lastNormal = normal;
    lastBinormal = binormal;
  }

  // extrude outward to create a tube
  float tubeAngle = angle;
  float circX = cos(tubeAngle);
  float circY = sin(tubeAngle);

  // compute the TBN matrix
  vec3 T = tangent;
  vec3 B = binormal;
  vec3 N = -normal;

  // extrude the path & create a new normal
  outNormal.xyz = normalize(B * circX + N * circY);
  outPosition.xyz = point + B * volume.x * circX + N * volume.y * circY;
}
#else
// ------
// Fast version; computes the local Frenet-Serret frame
// ------
void createTube (float t, vec2 volume, out vec3 offset, out vec3 normal) {
  // find prev and next sample along curve

  float delta = 0.0001;
	float t1 = max(t - delta, 0.0);
	float t2 = min(t + delta, 1.0);

  // sample the curve in two places
  vec3 prev = sampleCurve(t1);
  vec3 next = sampleCurve(t2);

  // compute the TBN matrix (aka the Frenet-Serret frame)

  // tangent is just the direction along our small delta
  vec3 T = normalize(next - prev);

  vec3 B = vec3(0, 0, 0);

  // if next-prev and next+prev are parallel, then
  // our normal and binormal will be ill-defined so we need to check for that
  // check parallel by dot the unit vectors and check close to +/-1
  float check = dot(T, normalize(next + prev));
  if (abs(check) < 0.999) {
    // cross product of parallel vectors is 0, so T must not be parallel to next+prev
    // hence the above check.
    B = normalize(cross(T, next + prev));
  }
  else {
    // special case for which N and B are not well defined. 
    // so we will just pick something
    float min = 1.0;
    if (abs(T.x) <= min) {
      min = abs(T.x);
      B.x = 1.0;
    }
    if (abs(T.y) <= min) {
      min = abs(T.y);
      B.y = 1.0;
    }
    if (abs(T.z) <= min) {
      B.z = 1.0;
    }
    vec3 tmpVec = normalize(cross(T, B));
    B = normalize(cross(T, tmpVec));
  }

  // now that we have T and B perpendicular, we can easily make N
  vec3 N = -normalize(cross(B, T));

  // extrude outward to create a tube
  float tubeAngle = angle;
  float circX = cos(tubeAngle);
  float circY = sin(tubeAngle);

  // compute position and normal
  normal.xyz = normalize(B * circX + N * circY);
  offset.xyz = sampleCurve(t) + B * volume.x * circX + N * volume.y * circY;
}
#endif

vec3 applyQuaternionToVector( vec4 q, vec3 v ) {
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

void main() {
  // load the curve
  for (int i = 0; i < NUM_POINTS; ++i) {
    points[i] = getCurvePoint(i);
  }

  // current position to sample at
  // [-0.5 .. 0.5] to [0.0 .. 1.0]
  float t = (position * 2.0) * 0.5 + 0.5;

  // build our tube geometry
  vec2 volume = vec2(translateAndScale.w);

  // build our geometry
  vec3 transformed;
  vec3 objectNormal;
  createTube(t, volume, transformed, objectNormal);

  // pass the normal and UV along
  vec3 transformedNormal = normalMatrix * objectNormal;
  //vNormal = normalize(transformedNormal);
  // vUv = uv.yx; // swizzle this to match expectations

  // project our vertex position
  transformed = applyQuaternionToVector(rotation, transformed);
  transformed += translateAndScale.xyz;
  vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);

  IN_viewPos = mvPosition.xyz;
  IN_viewNormal = normalize(transformedNormal);
  IN_instanceAndTypeId = instanceAndTypeId.xy;

  gl_Position = projectionMatrix * mvPosition;
}

`,$k=`
precision highp float;

in vec3 IN_viewPos;
in vec3 IN_viewNormal;
in vec2 IN_instanceAndTypeId;

layout(location = 0) out vec4 gAgentInfo;
layout(location = 1) out vec4 gNormal;
layout(location = 2) out vec4 gPos;

uniform mat4 projectionMatrix;

void main()	{
    vec3 fragViewPos = IN_viewPos;
  
    vec4 fragPosClip = projectionMatrix * vec4(fragViewPos, 1.0);
    vec3 fragPosNDC = fragPosClip.xyz / fragPosClip.w;
    float n = gl_DepthRange.near;
    float f = gl_DepthRange.far;
    // TODO: is this the same as gl_FragCoord.z ???
    float fragPosDepth = (((f - n) * fragPosNDC.z) + n + f) / 2.0;

    // type id, instance id, zEye, zFragDepth
    gAgentInfo = vec4(IN_instanceAndTypeId.y, IN_instanceAndTypeId.x, fragViewPos.z, fragPosDepth);

    vec3 normal = IN_viewNormal;
    normal = normalize(normal);
    gNormal = vec4(normal * 0.5 + 0.5, 1.0);

    gPos = vec4(fragViewPos.x, fragViewPos.y, fragViewPos.z, 1.0);
}
`;function Yk(r,e){var t={lengthSegments:r,ROBUST:!1,ROBUST_NORMAL:!0,FLAT_SHADED:!1,NUM_POINTS:e},i=new i_({glslVersion:Lm,vertexShader:qk,fragmentShader:$k,side:Ku,transparent:!1,defines:Xk({},t),uniforms:{curveData:{value:null},projectionMatrix:{value:new hi},modelViewMatrix:{value:new hi}}});return{mat:i}}function qx(r,e){r.mat.uniforms.projectionMatrix.value=e}function Kk(r,e,t){r.mat.uniforms.iResolution.value=new At(e,t)}function sM(r,e){r.material=e.mat}var Zk=new Zu,Jk=new Pl;function Qk(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:8,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:50,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=1,o=1,l=new Aw(i,i,o,r,e,t);l.rotateZ(Math.PI/2);for(var f=new At,d=[],v=[],_=[],b=l.attributes.position.array,w=l.attributes.uv.array,C=l.index.array,R=function(){var te=C[z],V=C[z+1],H=C[z+2],J=new be(b[te*3+0],b[te*3+1],b[te*3+2]),ce=new be(b[V*3+0],b[V*3+1],b[V*3+2]),he=new be(b[H*3+0],b[H*3+1],b[H*3+2]),ge=[J,ce,he],Ae=[new At(w[te*2+0],w[te*2+1]),new At(w[V*2+0],w[V*2+1]),new At(w[H*2+0],w[H*2+1])];ge.forEach(function(me,Ie){f.set(me.y,me.z).normalize();var ae=Math.atan2(f.y,f.x);v.push(ae),d.push(me.x),_.push(Ae[Ie].toArray())})},z=0;z<C.length;z+=3)R();for(var O=new Float32Array(d),P=new Float32Array(v),M=new Float32Array(_.length*2),U=0;U<O.length;U++){var L=dm(_[U],2),B=L[0],$=L[1];M[U*2+0]=B,M[U*2+1]=$}var X=new is;return X.setAttribute("position",new ns(O,1)),X.setAttribute("angle",new ns(P,1)),X.setAttribute("uv",new ns(M,2)),l.dispose(),X}var eF=function(){function r(e,t){Xn(this,r),ue(this,"nCurvePoints",void 0),ue(this,"nRadialSections",void 0),ue(this,"nSegments",void 0),ue(this,"curveGeometry",void 0),ue(this,"mesh",void 0),ue(this,"shaderSet",void 0),ue(this,"instancedGeometry",void 0),ue(this,"positionAttribute",void 0),ue(this,"rotationAttribute",void 0),ue(this,"instanceAttribute",void 0),ue(this,"curveData",void 0),ue(this,"currentInstance",void 0),ue(this,"isUpdating",void 0),this.nRadialSections=8,this.nSegments=(e-1)*4,this.nCurvePoints=e,this.currentInstance=0,this.isUpdating=!1,this.instancedGeometry=new V0,this.instancedGeometry.instanceCount=0,this.shaderSet=Yk(this.nSegments,this.nCurvePoints),this.curveGeometry=new is,this.positionAttribute=new $u(Uint8Array.from([]),1),this.rotationAttribute=new $u(Uint8Array.from([]),1),this.instanceAttribute=new $u(Uint8Array.from([]),1),this.curveData=new Vx(Uint8Array.from([]),0,0),this.mesh=new Cr(this.instancedGeometry),this.mesh.name="fibers_".concat(e),this.mesh.frustumCulled=!1,this.reallocate(t)}return qn(r,[{key:"getMesh",value:function(){return this.mesh}},{key:"getShaders",value:function(){return this.shaderSet}},{key:"getCapacity",value:function(){return this.curveData.image.height}},{key:"updateInstanceCount",value:function(t){this.instancedGeometry.instanceCount=t}},{key:"reallocate",value:function(t){this.dispose();var i=new Float32Array(t*this.nCurvePoints*4),o=this.curveData.image.data;i.set(o),this.curveData=new Vx(i,this.nCurvePoints,t,Is,fo),this.curveData.needsUpdate=!0,this.curveGeometry=Qk(this.nRadialSections,this.nSegments,!1),this.instancedGeometry=new V0().copy(this.curveGeometry),this.mesh.geometry=this.instancedGeometry,this.instancedGeometry.setDrawRange(0,this.curveGeometry.getAttribute("position").count),this.shaderSet.mat.uniforms.curveData.value=this.curveData;var l=new Float32Array(4*t);l.set(this.positionAttribute.array),this.positionAttribute=new $u(l,4,!1),this.instancedGeometry.setAttribute("translateAndScale",this.positionAttribute);var f=new Float32Array(4*t);f.set(this.rotationAttribute.array),this.rotationAttribute=new $u(f,4,!1),this.instancedGeometry.setAttribute("rotation",this.rotationAttribute);var d=new Float32Array(3*t);d.set(this.instanceAttribute.array),this.instanceAttribute=new $u(d,3,!1),this.instancedGeometry.setAttribute("instanceAndTypeId",this.instanceAttribute)}},{key:"dispose",value:function(){this.instancedGeometry.dispose(),this.curveData.dispose(),this.curveGeometry.dispose()}},{key:"beginUpdate",value:function(){this.isUpdating=!0,this.currentInstance=0}},{key:"checkRealloc",value:function(t){var i=256,o=this.instanceAttribute.count,l=t;if(l>o){var f=(Math.trunc(l/i)+1)*i;this.reallocate(f)}}},{key:"addInstance",value:function(t,i,o,l,f,d,v,_,b,w){var C=this.currentInstance;this.checkRealloc(this.currentInstance+1),this.positionAttribute.setXYZW(C,i,o,l,f);var R=Zk.setFromEuler(Jk.set(d,v,_));this.rotationAttribute.setXYZW(C,R.x,R.y,R.z,R.w),this.instanceAttribute.setXYZ(C,b,w,this.currentInstance);for(var z=Math.min(t.length/3,this.nCurvePoints),O=0;O<z;++O){var P=this.currentInstance*this.nCurvePoints*4+O*4;this.curveData.image.data[P+0]=t[O*3+0],this.curveData.image.data[P+1]=t[O*3+1],this.curveData.image.data[P+2]=t[O*3+2],this.curveData.image.data[P+3]=1}this.currentInstance++}},{key:"endUpdate",value:function(){this.updateInstanceCount(this.currentInstance),this.instanceAttribute.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.rotationAttribute.needsUpdate=!0,this.curveData.needsUpdate=!0,this.isUpdating=!1}}])}(),ng=function(){function r(){Xn(this,r),ue(this,"fibers",void 0),ue(this,"fibersGroup",void 0),ue(this,"isUpdating",void 0),this.fibersGroup=new cu,this.fibers=[],this.isUpdating=!1}return qn(r,[{key:"getGroup",value:function(){for(var t=this,i=this.fibersGroup.children.length-1;i>=0;i--)this.fibersGroup.remove(this.fibersGroup.children[i]);return this.fibers.forEach(function(o){t.fibersGroup.add(o.getMesh())}),this.fibersGroup.name=r.GROUP_NAME,this.fibersGroup}},{key:"clear",value:function(){this.fibers.forEach(function(t){t.dispose()}),this.fibers=[]}},{key:"beginUpdate",value:function(){this.fibers.forEach(function(t){t.beginUpdate()}),this.isUpdating=!0}},{key:"addInstance",value:function(t,i,o,l,f,d,v,_,b,w,C){this.fibers[t]||(this.fibers[t]=new eF(t,256)),this.fibers[t].addInstance(i,o,l,f,d,v,_,b,w,C)}},{key:"endUpdate",value:function(){this.fibers.forEach(function(t){t.endUpdate()}),this.isUpdating=!1}},{key:"setRenderPass",value:function(){this.fibers.forEach(function(t){sM(t.getMesh(),t.getShaders())})}},{key:"updateProjectionMatrix",value:function(t){this.fibers.forEach(function(i){qx(i.getShaders(),t)})}}])}();ue(ng,"GROUP_NAME","fibers");var tF=function(){function r(){Xn(this,r),ue(this,"pdbGbufferMaterials",void 0),ue(this,"scene",void 0),ue(this,"instancedMeshGroup",void 0),ue(this,"fibers",void 0),ue(this,"meshTypes",void 0),this.instancedMeshGroup=new cu,this.fibers=new ng,this.meshTypes=[],this.pdbGbufferMaterials=rM.shaderSet,this.scene=new n_}return qn(r,[{key:"setMeshGroups",value:function(t,i,o){this.instancedMeshGroup=t,this.fibers=i,this.meshTypes=o}},{key:"resize",value:function(t,i){Kk(this.pdbGbufferMaterials,t,i)}},{key:"render",value:function(t,i,o,l){var f=t.getClearColor(new Ht).clone(),d=t.getClearAlpha();qx(this.pdbGbufferMaterials,o.projectionMatrix),this.fibers.updateProjectionMatrix(o.projectionMatrix);for(var v=0;v<this.meshTypes.length;++v){var _=this.meshTypes[v].getShaders();qx(_,o.projectionMatrix)}var b=new Ht(0,-1,0),w=-1;t.setClearColor(b,w),t.setRenderTarget(l),t.clear(),t.autoClear=!1;{this.instancedMeshGroup.visible=!0,this.fibers.setRenderPass();for(var C=0;C<this.meshTypes.length;++C)sM(this.meshTypes[C].getMesh(),this.meshTypes[C].getShaders());t.render(i,o),t.autoClear=!1,i.overrideMaterial=null}i.overrideMaterial=null,t.autoClear=!0,t.setClearColor(f,d)}}])}(),qE=function(){function r(e,t,i){Xn(this,r),ue(this,"pass",void 0),ue(this,"uvOffset",void 0),ue(this,"radius",void 0),ue(this,"stdDev",void 0),this.uvOffset=e,this.radius=0,this.stdDev=0,this.pass=new wg({defines:{KERNEL_RADIUS:8},uniforms:{colorTex:{value:null},viewPosTex:{value:null},size:{value:new At(512,512)},sampleUvOffsets:{value:[new At(0,0)]},sampleWeights:{value:[1]},depthCutoff:{value:.1}},fragmentShader:`

        uniform sampler2D colorTex;
        uniform sampler2D viewPosTex;

        uniform float depthCutoff;

        uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];
        uniform float sampleWeights[ KERNEL_RADIUS + 1 ];

        varying vec2 vUv;
        uniform vec2 size; // iResolution.xy

        void main() {
            vec4 viewPos4 = texture2D(viewPosTex, vUv);
            if (viewPos4.w < 1.0) discard;

            float centerViewZ = -viewPos4.z;
            bool rBreak = false, lBreak = false;

            float weightSum = sampleWeights[0];
            vec4 diffuseSum = texture2D( colorTex, vUv ) * weightSum;

            vec2 vInvSize = 1.0 / size;

            for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {

                float sampleWeight = sampleWeights[i];
                vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;

                vec2 sampleUv = vUv + sampleUvOffset;
                float viewZ = -texture2D(viewPosTex, sampleUv).z;

                if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;

                if( ! rBreak ) {
                    diffuseSum += texture2D( colorTex, sampleUv ) * sampleWeight;
                    weightSum += sampleWeight;
                }

                sampleUv = vUv - sampleUvOffset;
                viewZ = -texture2D(viewPosTex, sampleUv).z;

                if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;

                if( ! lBreak ) {
                    diffuseSum += texture2D( colorTex, sampleUv ) * sampleWeight;
                    weightSum += sampleWeight;
                }

            }

            gl_FragColor = diffuseSum / weightSum;
        }`}),this.configure(t,i)}return qn(r,[{key:"resize",value:function(t,i){this.pass.material.uniforms.size.value=new At(t,i)}},{key:"render",value:function(t,i){this.pass.render(t,i)}},{key:"createSampleWeights",value:function(t,i){for(var o=[],l=0;l<=t;l++)o.push(nF(l,i));return o}},{key:"createSampleOffsets",value:function(t,i){for(var o=[],l=0;l<=t;l++)o.push(i.clone().multiplyScalar(l));return o}},{key:"configure",value:function(t,i){(t!==this.radius||i!==this.stdDev)&&(this.pass.material.defines.KERNEL_RADIUS=t,this.pass.material.uniforms.sampleUvOffsets.value=this.createSampleOffsets(t,this.uvOffset),this.pass.material.uniforms.sampleWeights.value=this.createSampleWeights(t,i),this.pass.material.needsUpdate=!0,this.radius=t,this.stdDev=i)}}])}();function nF(r,e){return Math.exp(-(r*r)/(2*(e*e)))/(Math.sqrt(2*Math.PI)*e)}var iF=function(){function r(e,t){Xn(this,r),ue(this,"blurXpass",void 0),ue(this,"blurYpass",void 0),this.blurXpass=new qE(new At(1,0),e,t),this.blurYpass=new qE(new At(0,1),e,t)}return qn(r,[{key:"resize",value:function(t,i){this.blurXpass.resize(t,i),this.blurYpass.resize(t,i)}},{key:"configure",value:function(t,i,o){this.blurXpass.configure(t,i),this.blurXpass.pass.material.uniforms.depthCutoff.value=o,this.blurYpass.configure(t,i),this.blurYpass.pass.material.uniforms.depthCutoff.value=o}},{key:"render",value:function(t,i,o,l,f){var d=t.getClearColor(new Ht).clone(),v=t.getClearAlpha();t.setClearColor(new Ht(1,1,1),1),this.blurXpass.pass.material.uniforms.colorTex.value=o.texture,this.blurXpass.pass.material.uniforms.viewPosTex.value=l,this.blurXpass.render(t,f),this.blurYpass.pass.material.uniforms.colorTex.value=f.texture,this.blurYpass.pass.material.uniforms.viewPosTex.value=l,this.blurYpass.render(t,i),t.setClearColor(d,v)}}])}(),rF=function(){function r(e){Xn(this,r),ue(this,"pass",void 0),this.pass=new wg({uniforms:{colorTex:{value:null},ssaoTex1:{value:null},colorsBuffer:{value:null},backgroundColor:{value:new Ht(1,1,1)},bgHCLoffset:e?{value:new be(e.x,e.y,e.z)}:{value:new be(1,0,.2)},zNear:{value:.1},zFar:{value:1e3},atomicBeginDistance:{value:75},chainBeginDistance:{value:150},followedInstance:{value:-1}},fragmentShader:`
            in vec2 vUv;

            uniform sampler2D colorTex;
            uniform sampler2D ssaoTex1;

            uniform sampler2D colorsBuffer;

            uniform float zNear;
            uniform float zFar;
            uniform vec3 backgroundColor;
            uniform vec3 bgHCLoffset;

            // a single instance to get a special highlight
            uniform float followedInstance;

            uniform float atomicBeginDistance; // = 100.0;
            uniform float chainBeginDistance; // = 150.0;

            const float HCLgamma_ = 3.0;
            const float HCLy0_ = 100.0;
            const float HCLmaxL_ = 0.530454533953517;

            vec3 hcl2rgb(in vec3 HCL)
            {
              vec3 RGB = vec3(0.0, 0.0, 0.0);
              if (HCL.z != 0.0) {
                float H = HCL.x;
                float C = HCL.y;
                float L = HCL.z * HCLmaxL_;
                float Q = exp((1.0 - C / (2.0 * L)) * (HCLgamma_ / HCLy0_));
                float U = (2.0 * L - C) / (2.0 * Q - 1.0);
                float V = C / Q;
                float T = tan((H + min(fract(2.0 * H) / 4.0, fract(-2.0 * H) / 8.0)) * 6.283185307);
                H *= 6.0;
                if (H <= 1.0) {
                  RGB.r = 1.0;
                  RGB.g = T / (1.0 + T);
                }
                else if (H <= 2.0) {
                  RGB.r = (1.0 + T) / T;
                  RGB.g = 1.0;
                }
                else if (H <= 3.0) {
                  RGB.g = 1.0;
                  RGB.b = 1.0 + T;
                }
                else if (H <= 4.0) {
                  RGB.g = 1.0 / (1.0 + T);
                  RGB.b = 1.0;
                }
                else if (H <= 5.0) {
                  RGB.r = -1.0 / T;
                  RGB.b = 1.0;
                }
                else {
                  RGB.r = 1.0;
                  RGB.b = -T;
                }
                return RGB * V + U;
              }
              return RGB;
            }

            vec3 rgb2hcl(in vec3 RGB) {
              vec3 HCL = vec3(0.0, 0.0, 0.0);
              float H = 0.0;
              float U, V;
              U = -min(RGB.r, min(RGB.g, RGB.b));
              V = max(RGB.r, max(RGB.g, RGB.b));
              float Q = HCLgamma_ / HCLy0_;
              HCL.y = V + U;
              if (HCL.y != 0.0)
              {
                H = atan(RGB.g - RGB.b, RGB.r - RGB.g) / 3.14159265;
                Q *= -U / V;
              }
              Q = exp(Q);
              HCL.x = fract(H / 2.0 - min(fract(H), fract(-H)) / 6.0);
              HCL.y *= Q;
              HCL.z = mix(U, V, Q) / (HCLmaxL_ * 2.0);
              return HCL;
            }

            float LinearEyeDepth(float z_b)
            {
                float z_n = 2.0 * z_b - 1.0;
                float z_e = 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
                return z_e;
            }

            void main(void)
            {
                vec2 texCoords = vUv;
                // contains IDs.  index into data buffer.
                // typeId, instanceId, viewZ
                vec4 col0 = texture(colorTex, texCoords);
                // check for uninitialized (set to clear value which was negative to indicate nothing drawn here to colorize)
                if (col0.w < 0.0) {
                    discard;
                }
                float occ1 = texture(ssaoTex1, texCoords).r;

                float instanceId = (col0.y);

                if(instanceId < 0.0)
                    discard;

                // Subtracting 1 because we added 1 before setting this, to account for id 0 being highlighted.
                // rounding because on some platforms (at least one nvidia+windows) int(abs(...)) is returning values that fluctuate
                int agentColorIndex = int(round(abs(col0.x))-1.0);
                // future: can use this value to do other rendering
                //float highlighted = (sign(col0.x) + 1.0) * 0.5;

                ivec2 ncols = textureSize(colorsBuffer, 0);
                vec4 col = texelFetch(colorsBuffer, ivec2(agentColorIndex % ncols.x, 0), 0);

                float eyeDepth = -col0.z;

                // atomColor is the "true" color
                vec3 atomColor = col.xyz;

                //inital Hue-Chroma-Luminance

                // atom color in HCL
                vec3 hcl = rgb2hcl(col.xyz * occ1);
                float h = hcl.r;
                float c = hcl.g;
                float l = hcl.b;

                // background color as HCL
                vec3 bghcl = rgb2hcl(backgroundColor);
                // per-pixel BG is related to atom color
                bghcl = mix(bghcl, hcl, bgHCLoffset);
                h = bghcl.r;
                c = bghcl.g;
                l = bghcl.b;

                // distance ranges:
                // 0---near-----atomBeginDistance------chainBeginDistance------far

                // anything farther than chainBeginDistance will get the bg color

                // chainBeginDistance should be > atomicBeginDistance
                if(eyeDepth < chainBeginDistance)
                {
                    float cc = max(eyeDepth - atomicBeginDistance, 0.0);
                    float dd = chainBeginDistance - atomicBeginDistance;
                    // t is 0.0 at atomicBeginDistance, 1.0 at chainBeginDistance
                    // interpolate from hcl at near atomBeginDistance,
                    // to bghcl at far chainBeginDistance.
                    // beyond chainBeginDistance, color will be bghcl
                    float t = cc/dd;
                    t = clamp(t, 0.0, 1.0);
                    l = mix(hcl.z, bghcl.z, t);
                    c = mix(hcl.y, bghcl.y, t);
                    h = mix(hcl.x, bghcl.x, t);
                }

                // h,c,l now contains current color.

                vec3 color;
                color = hcl2rgb(vec3(h, c, l));

                color = clamp(color, vec3(0.0,0.0,0.0), vec3(1.0,1.0,1.0));

                // The following code does nothing because of the clamping
                // nothing will be interpolated and we end up with color
                // being the atom color.
                // if(eyeDepth < atomicBeginDistance)
                // {
                //     // small t = near, large t = far(close to atomBeginDistance)
                //     float t = (eyeDepth/atomicBeginDistance);
                //     t = clamp(t, 0.0, 1.0);
                //     // inside of atomicBeginDistance:
                //     // near is atomColor, far is color.xyz
                //     // linear RGB interp? not HCL?
                //     color.xyz = mix(atomColor, color.xyz, t);
                //     //color.xyz = atomColor;
                //     //color.xyz = vec3(0.0, 1.0, 0.0);
                // }
                //gl_FragColor = vec4(occ,occ,occ,1.0);
                gl_FragColor = vec4( color.xyz , 1.0);
            }
            `})}return qn(r,[{key:"updateColors",value:function(t,i){this.pass.material.uniforms.colorsBuffer.value=new Vx(i,t,1,Is,fo),this.pass.material.uniforms.colorsBuffer.value.needsUpdate=!0}},{key:"setBgHueOffset",value:function(t){this.pass.material.uniforms.bgHCLoffset.value.x=t}},{key:"setBgChromaOffset",value:function(t){this.pass.material.uniforms.bgHCLoffset.value.y=t}},{key:"setBgLuminanceOffset",value:function(t){this.pass.material.uniforms.bgHCLoffset.value.z=t}},{key:"setBackgroundColor",value:function(t){this.pass.material.uniforms.backgroundColor.value=t}},{key:"setFollowedInstance",value:function(t){this.pass.material.uniforms.followedInstance.value=t}},{key:"resize",value:function(t,i){}},{key:"render",value:function(t,i,o,l,f,d){this.pass.material.uniforms.zNear.value=i.near,this.pass.material.uniforms.zFar.value=i.far,this.pass.material.uniforms.colorTex.value=d,this.pass.material.uniforms.ssaoTex1.value=l.texture,this.pass.render(t,o)}}])}(),sF=function(){function r(){Xn(this,r),ue(this,"pass",void 0),this.pass=new wg({uniforms:{colorTex:{value:null},instanceIdTex:{value:null},normalsTex:{value:null},followedInstance:{value:-1},outlineThickness:{value:2},outlineAlpha:{value:.8},outlineColor:{value:new Ht(1,1,1)},followThickness:{value:3},followAlpha:{value:.8},followColor:{value:new Ht(.14,1,0)}},fragmentShader:`
            in vec2 vUv;
            
            uniform sampler2D colorTex;
            uniform sampler2D instanceIdTex;
            uniform sampler2D normalsTex;
            uniform float followedInstance;
            uniform float outlineThickness;
            uniform float followThickness;
            uniform float followAlpha;
            uniform float outlineAlpha;
            uniform vec3 followColor;
            uniform vec3 outlineColor;

            bool isHighlighted(float typevalue) {
              return (sign(typevalue) > 0.0);
            }

            bool isSameInstance(float x, float y) {
              // typeIds and instanceIds are integers written to float gpu buffers.
              // This fudge factor is working around a strange float bug on nvidia/Windows hardware.
              // The numbers read are noisy and not uniform across faces.
              // I can't tell if the bug occurs on read or on write, but the workaround is
              // needed here at read time when we need to do comparisons.
              // (TODO: dump buffer after read to inspec?)
              // Straight equality works on MacOS and Intel/Windows gpu 
              // This should be tested periodically with new nvidia drivers on windows
              // TODO: try "round(abs(x-y)) == 0" here
              return abs(x-y) < 0.1;
            }
            bool isAdjacentToSame(float x, float l, float r, float b, float t) {
              return isSameInstance(x, l) && isSameInstance(x, r) && isSameInstance(x, b) && isSameInstance(x, t);
            }

            void main(void)
            {
              vec4 col = texture(colorTex, vUv);
           
              ivec2 resolution = textureSize(colorTex, 0);
            
              vec2 pixelPos = vUv * vec2(float(resolution.x), float(resolution.y));
              float wStep = 1.0 / float(resolution.x);
              float hStep = 1.0 / float(resolution.y);
            
              vec4 instance = texture(instanceIdTex, vUv);
              // instance.g is the agent id
              float X = instance.g;
              float R = texture(instanceIdTex, vUv + vec2(wStep, 0)).g;
              float L = texture(instanceIdTex, vUv + vec2(-wStep, 0)).g;
              float T = texture(instanceIdTex, vUv + vec2(0, hStep)).g;
              float B = texture(instanceIdTex, vUv + vec2(0, -hStep)).g;
            
              vec4 finalColor = col;
              if (isAdjacentToSame(X, R, L, T, B) )
              {
                // current pixel is NOT on the edge
                finalColor = col;
              }
              else
              {
                // current pixel lies on the edge of an agent
                // outline pixel color is a darkened version of the color
                finalColor = mix(vec4(0.0,0.0,0.0,1.0), col, 0.8);

              }

              // instance.r is the type id
              bool highlighted = isHighlighted(instance.r);
              if (highlighted) {
                float thickness = outlineThickness;
                mat3 sx = mat3( 
                    1.0, 2.0, 1.0, 
                    0.0, 0.0, 0.0, 
                   -1.0, -2.0, -1.0 
                );
                mat3 sy = mat3( 
                    1.0, 0.0, -1.0, 
                    2.0, 0.0, -2.0, 
                    1.0, 0.0, -1.0 
                );
                mat3 I;
                for (int i=0; i<3; i++) {
                  for (int j=0; j<3; j++) {
                    bool v = isHighlighted(
                      texelFetch(instanceIdTex, 
                        ivec2(gl_FragCoord) + 
                        ivec2(
                          (i-1)*int(thickness),
                          (j-1)*int(thickness)
                        ), 
                        0 ).r
                    );
                    I[i][j] = v ? 1.0 : 0.0; 
                  }
                }
                float gx = dot(sx[0], I[0]) + dot(sx[1], I[1]) + dot(sx[2], I[2]); 
                float gy = dot(sy[0], I[0]) + dot(sy[1], I[1]) + dot(sy[2], I[2]);

                float g = sqrt(pow(gx, 2.0)+pow(gy, 2.0));
                finalColor = mix(finalColor, vec4(outlineColor.rgb,1), g*outlineAlpha);

              }

              if (X >= 0.0 && isSameInstance(X, followedInstance)) {
                float thickness = followThickness;
                R = (texture(instanceIdTex, vUv + vec2(wStep*thickness, 0)).g);
                L = (texture(instanceIdTex, vUv + vec2(-wStep*thickness, 0)).g);
                T = (texture(instanceIdTex, vUv + vec2(0, hStep*thickness)).g);
                B = (texture(instanceIdTex, vUv + vec2(0, -hStep*thickness)).g);
                if ( !isAdjacentToSame(X, R, L, T, B) )
                {
                  // current pixel lies on the edge of the followed agent
                  // outline pixel color is blended toward the followColor
                  finalColor = mix(vec4(followColor.rgb,1), col, 1.0-followAlpha);
                }
              }
        
              gl_FragDepth = instance.w >= 0.0 ? instance.w : 1.0;
              gl_FragColor = finalColor;
            }
            `})}return qn(r,[{key:"resize",value:function(t,i){}},{key:"setOutlineColor",value:function(t){this.pass.material.uniforms.outlineColor.value=new Ht(t[0]/255,t[1]/255,t[2]/255)}},{key:"setOutlineAlpha",value:function(t){this.pass.material.uniforms.outlineAlpha.value=t}},{key:"setOutlineThickness",value:function(t){this.pass.material.uniforms.outlineThickness.value=t}},{key:"setFollowColor",value:function(t){this.pass.material.uniforms.followColor.value=new Ht(t[0]/255,t[1]/255,t[2]/255)}},{key:"setFollowAlpha",value:function(t){this.pass.material.uniforms.followAlpha.value=t}},{key:"setFollowOutlineThickness",value:function(t){this.pass.material.uniforms.followThickness.value=t}},{key:"setFollowedInstance",value:function(t){this.pass.material.uniforms.followedInstance.value=t}},{key:"render",value:function(t,i,o,l,f){this.pass.material.depthWrite=!0,this.pass.material.depthTest=!0,this.pass.material.uniforms.colorTex.value=o.texture,this.pass.material.uniforms.instanceIdTex.value=l,this.pass.material.uniforms.normalsTex.value=f,this.pass.render(t,i)}}])}(),oF=function(){function r(){Xn(this,r),ue(this,"pass",void 0),this.pass=new wg({uniforms:{colorTex:{value:null},scale:{value:new Xi(1,1,1,1)},bias:{value:new Xi(0,0,0,0)}},fragmentShader:`
            in vec2 vUv;
            
            uniform sampler2D colorTex;
            uniform vec4 scale;
            uniform vec4 bias;
            
            void main(void)
            {
                vec2 texCoords = vUv;
                vec4 col = texture(colorTex, texCoords);
                gl_FragColor = col*scale + bias;
            }
            `})}return qn(r,[{key:"resize",value:function(t,i){}},{key:"setScale",value:function(t,i,o,l){this.pass.material.uniforms.scale.value=new Xi(t,i,o,l)}},{key:"setBias",value:function(t,i,o,l){this.pass.material.uniforms.bias.value=new Xi(t,i,o,l)}},{key:"render",value:function(t,i,o){this.pass.material.uniforms.colorTex.value=o.texture;var l=t.getClearColor(new Ht).clone(),f=t.getClearAlpha();t.setClearColor(new Ht(1,0,0),1),this.pass.render(t,i),t.setClearColor(l,f)}}])}(),aF=function(){function r(){Xn(this,r),ue(this,"hitTestBuffer",void 0),ue(this,"hitTestScene",void 0),ue(this,"hitTestCamera",void 0),ue(this,"hitTestVertexShader",void 0),ue(this,"hitTestFragmentShader",void 0),ue(this,"hitTestMesh",void 0),this.hitTestBuffer=new El(1,1,{minFilter:ir,magFilter:ir,format:Is,type:fo,depthBuffer:!1,stencilBuffer:!1}),this.hitTestScene=new n_,this.hitTestCamera=new xg,this.hitTestVertexShader=`
  
    void main() {
      gl_Position = vec4(position, 1.0);
    }
    `,this.hitTestFragmentShader=`
    uniform vec2 pixel;
    uniform sampler2D objectIdTexture;

    void main() {
      gl_FragColor = texture(objectIdTexture, pixel);
    }
    `,this.hitTestMesh=new Cr(new Um(2,2),new Vc({vertexShader:this.hitTestVertexShader,fragmentShader:this.hitTestFragmentShader,depthWrite:!1,depthTest:!1,uniforms:{pixel:{value:new At(.5,.5)},objectIdTexture:{value:null}}})),this.hitTestScene.add(this.hitTestMesh)}return qn(r,[{key:"hitTest",value:function(t,i,o,l){var f=new Float32Array(4).fill(-1);return this.hitTestMesh.material.uniforms.objectIdTexture.value=i,this.hitTestMesh.material.uniforms.pixel.value=new At(o,l),t.setRenderTarget(this.hitTestBuffer),t.render(this.hitTestScene,this.hitTestCamera),t.setRenderTarget(null),t.readRenderTargetPixels(this.hitTestBuffer,0,0,1,1,f),f}}])}(),r0=0,Ab=1,Pb=2,lF=function(){function r(){Xn(this,r),ue(this,"gbufferPass",void 0),ue(this,"ssao1Pass",void 0),ue(this,"blur1Pass",void 0),ue(this,"compositePass",void 0),ue(this,"contourPass",void 0),ue(this,"drawBufferPass",void 0),ue(this,"gbuffer",void 0),ue(this,"hitTestHelper",void 0),ue(this,"blurIntermediateBuffer",void 0),ue(this,"ssaoBuffer",void 0),ue(this,"ssaoBuffer2",void 0),ue(this,"ssaoBufferBlurred",void 0),ue(this,"ssaoBufferBlurred2",void 0),ue(this,"parameters",void 0),ue(this,"boundsNear",void 0),ue(this,"boundsFar",void 0),ue(this,"boundsMaxDim",void 0),ue(this,"cameraZoom",void 0),this.parameters={ao1:{bias:.5,intensity:.05,scale:10,kernelRadius:15,minResolution:0,blurRadius:4,blurStdDev:3,blurDepthCutoff:.1},atomBeginDistance:.6666,chainBeginDistance:1,bghueoffset:1,bgchromaoffset:.45,bgluminanceoffset:.45,outlineThickness:2,followThickness:3,outlineAlpha:.8,followAlpha:.8,followColor:{r:35,g:255,b:0},outlineColor:{r:255,g:255,b:255}},this.boundsNear=0,this.boundsFar=100,this.boundsMaxDim=100,this.cameraZoom=1,this.gbufferPass=new tF,this.ssao1Pass=new Vk,this.blur1Pass=new iF(this.parameters.ao1.blurRadius,this.parameters.ao1.blurStdDev),this.compositePass=new rF({x:this.parameters.bghueoffset,y:this.parameters.bgchromaoffset,z:this.parameters.bgluminanceoffset}),this.contourPass=new sF,this.drawBufferPass=new oF,this.gbuffer=new El(2,2,{count:3,minFilter:ir,magFilter:ir,format:Is,type:fo,generateMipmaps:!1}),this.gbuffer.textures[r0].name="agentinfo",this.gbuffer.textures[Ab].name="normal",this.gbuffer.textures[Pb].name="position",this.hitTestHelper=new aF,this.blurIntermediateBuffer=new El(2,2,{minFilter:ir,magFilter:ir,format:Is,type:fo,depthBuffer:!1,stencilBuffer:!1}),this.blurIntermediateBuffer.texture.generateMipmaps=!1,this.ssaoBuffer=new El(2,2,{minFilter:ir,magFilter:ir,format:Is,type:fo,depthBuffer:!1,stencilBuffer:!1}),this.ssaoBuffer.texture.generateMipmaps=!1,this.ssaoBuffer2=new El(2,2,{minFilter:ir,magFilter:ir,format:Is,type:fo,depthBuffer:!1,stencilBuffer:!1}),this.ssaoBuffer2.texture.generateMipmaps=!1,this.ssaoBufferBlurred=new El(2,2,{minFilter:ir,magFilter:ir,format:Is,type:fo,depthBuffer:!1,stencilBuffer:!1}),this.ssaoBufferBlurred.texture.generateMipmaps=!1,this.ssaoBufferBlurred2=new El(2,2,{minFilter:ir,magFilter:ir,format:Is,type:fo,depthBuffer:!1,stencilBuffer:!1}),this.ssaoBufferBlurred2.texture.generateMipmaps=!1}return qn(r,[{key:"setupGui",value:function(t){var i=this,o=this.parameters,l=t.addFolder({title:"AO pass 1",expanded:!1});l.addInput(o.ao1,"bias",{min:-1,max:1}),l.addInput(o.ao1,"intensity",{min:0,max:1}),l.addInput(o.ao1,"scale",{min:0,max:40}),l.addInput(o.ao1,"kernelRadius",{min:1,max:100}),l.addInput(o.ao1,"minResolution",{min:0,max:1}),l.addInput(o.ao1,"blurRadius",{min:0,max:200}),l.addInput(o.ao1,"blurStdDev",{min:.5,max:150}),l.addInput(o.ao1,"blurDepthCutoff",{min:0,max:.1});var f=t.addFolder({title:"DepthCueing",expanded:!1});f.addInput(o,"atomBeginDistance",{min:0,max:2}),f.addInput(o,"chainBeginDistance",{min:0,max:2}),f.addInput(o,"bghueoffset",{min:0,max:1}).on("change",function(v){i.compositePass.setBgHueOffset(v.value)}),f.addInput(o,"bgchromaoffset",{min:0,max:1}).on("change",function(v){i.compositePass.setBgChromaOffset(v.value)}),f.addInput(o,"bgluminanceoffset",{min:0,max:1}).on("change",function(v){i.compositePass.setBgLuminanceOffset(v.value)});var d=t.addFolder({title:"Outlines",expanded:!1});d.addInput(o,"outlineThickness",{min:1,max:8,step:1}).on("change",function(v){i.contourPass.setOutlineThickness(v.value)}),d.addInput(o,"outlineColor").on("change",function(v){i.contourPass.setOutlineColor([v.value.r,v.value.g,v.value.b])}),d.addInput(o,"outlineAlpha",{min:0,max:1}).on("change",function(v){i.contourPass.setOutlineAlpha(v.value)}),d.addInput(o,"followThickness",{min:1,max:8,step:1}).on("change",function(v){i.contourPass.setFollowOutlineThickness(v.value)}),d.addInput(o,"followColor").on("change",function(v){i.contourPass.setFollowColor([v.value.r,v.value.g,v.value.b])}),d.addInput(o,"followAlpha",{min:0,max:1}).on("change",function(v){i.contourPass.setFollowAlpha(v.value)})}},{key:"setBackgroundColor",value:function(t){this.compositePass.setBackgroundColor(t)}},{key:"setFollowedInstance",value:function(t){this.compositePass.setFollowedInstance(t),this.contourPass.setFollowedInstance(t)}},{key:"hitTest",value:function(t,i,o){var l=this.gbuffer.textures[r0],f=this.hitTestHelper.hitTest(t,l,i/l.image.width,o/l.image.height);if(f[3]===-1)return-1;var d=Math.round(f[1]);return d}},{key:"updateColors",value:function(t,i){this.compositePass.updateColors(t,i)}},{key:"setMeshGroups",value:function(t,i,o){this.gbufferPass.setMeshGroups(t,i,o)}},{key:"resize",value:function(t,i){this.gbuffer.setSize(t,i),this.blurIntermediateBuffer.setSize(t,i),this.ssaoBuffer.setSize(t,i),this.ssaoBufferBlurred.setSize(t,i),this.gbufferPass.resize(t,i),this.ssao1Pass.resize(t,i),this.blur1Pass.resize(t,i),this.compositePass.resize(t,i),this.contourPass.resize(t,i),this.drawBufferPass.resize(t,i)}},{key:"setNearFar",value:function(t,i,o,l){this.boundsNear=t,this.boundsFar=i,this.boundsMaxDim=o,this.cameraZoom=l}},{key:"render",value:function(t,i,o,l){var f=this.boundsMaxDim;this.ssao1Pass.pass.material.uniforms.bias.value=this.parameters.ao1.bias,this.ssao1Pass.pass.material.uniforms.intensity.value=this.parameters.ao1.intensity,this.ssao1Pass.pass.material.uniforms.scale.value=this.parameters.ao1.scale*f*this.cameraZoom/100,this.ssao1Pass.pass.material.uniforms.kernelRadius.value=this.parameters.ao1.kernelRadius,this.ssao1Pass.pass.material.uniforms.minResolution.value=this.parameters.ao1.minResolution,this.ssao1Pass.pass.material.uniforms.beginFalloffDistance.value=this.parameters.atomBeginDistance*f+Math.max(this.boundsNear,0),this.ssao1Pass.pass.material.uniforms.endFalloffDistance.value=this.parameters.chainBeginDistance*f+Math.max(this.boundsNear,0),this.ssao1Pass.pass.material.uniforms.cameraFar.value=o.far,this.blur1Pass.configure(this.parameters.ao1.blurRadius,this.parameters.ao1.blurStdDev,this.parameters.ao1.blurDepthCutoff),this.compositePass.pass.material.uniforms.atomicBeginDistance.value=this.parameters.atomBeginDistance*f+Math.max(this.boundsNear,0),this.compositePass.pass.material.uniforms.chainBeginDistance.value=this.parameters.chainBeginDistance*f+Math.max(this.boundsNear,0),this.gbufferPass.render(t,i,o,this.gbuffer),this.ssao1Pass.render(t,o,this.ssaoBuffer,this.gbuffer.textures[Ab],this.gbuffer.textures[Pb]),this.blur1Pass.render(t,this.ssaoBufferBlurred,this.ssaoBuffer,this.gbuffer.textures[Pb],this.blurIntermediateBuffer);var d=this.blurIntermediateBuffer;this.compositePass.render(t,o,d,this.ssaoBufferBlurred,this.ssaoBufferBlurred2,this.gbuffer.textures[r0]),this.contourPass.render(t,l,d,this.gbuffer.textures[r0],this.gbuffer.textures[Ab])}}])}(),$E=new Ht(16776960),YE=new Ht(16777215),uF=function(){function r(){Xn(this,r),ue(this,"baseMaterial",void 0),ue(this,"highlightMaterial",void 0),ue(this,"followMaterial",void 0),ue(this,"agentMeshGroup",void 0),this.baseMaterial=new y2({color:new Ht(16711935)}),this.highlightMaterial=new U0({color:new Ht(YE),transparent:!0,opacity:.6}),this.followMaterial=new U0({color:new Ht($E)}),this.agentMeshGroup=new cu}return qn(r,[{key:"beginUpdate",value:function(t){t.remove(this.agentMeshGroup),this.agentMeshGroup=new cu,this.agentMeshGroup.name="legacy mesh group"}},{key:"addFiber",value:function(t,i,o){if(!t.fiberCurve){console.warn("no curve provided");return}var l=new Rw(t.fiberCurve,4*(t.fiberCurve.points.length-1),i*.5,8,!1),f=new Cr(l,this.selectMaterial(t,o));f.userData={id:t.agentData.instanceId},this.agentMeshGroup.add(f)}},{key:"selectMaterial",value:function(t,i){if(t.followed)return this.followMaterial;if(t.highlighted)return this.highlightMaterial;var o=this.baseMaterial.clone();return o.color=i,o}},{key:"selectColor",value:function(t,i){return t.followed?$E:t.highlighted?YE:i}},{key:"addMesh",value:function(t,i,o,l){var f=new Cr(t,this.selectMaterial(i,l));f.position.x=i.agentData.x,f.position.y=i.agentData.y,f.position.z=i.agentData.z,f.rotation.x=i.agentData.xrot,f.rotation.y=i.agentData.yrot,f.rotation.z=i.agentData.zrot,f.scale.x=o,f.scale.y=o,f.scale.z=o,f.userData={id:i.agentData.instanceId},this.agentMeshGroup.add(f)}},{key:"addPdb",value:function(t,i,o,l){for(var f=new QR,d=t.instantiate(),v=d.length-1;v>=0;--v){var _=d[v];_.userData={id:i.agentData.instanceId},_.material=new bm({color:this.selectColor(i,o)}),f.addLevel(_,l[v])}f.position.x=i.agentData.x,f.position.y=i.agentData.y,f.position.z=i.agentData.z,f.rotation.x=i.agentData.xrot,f.rotation.y=i.agentData.yrot,f.rotation.z=i.agentData.zrot,f.scale.x=1,f.scale.y=1,f.scale.z=1,f.userData={id:i.agentData.instanceId},this.agentMeshGroup.add(f)}},{key:"endUpdate",value:function(t){this.agentMeshGroup.children.length>0&&t.add(this.agentMeshGroup)}},{key:"hitTest",value:function(t,i){var o=new I2;o.setFromCamera(t,i);var l=o.intersectObjects(this.agentMeshGroup.children,!0);if(l.sort(function(v,_){return v.distance-_.distance}),l&&l.length){var f=l[0].object;return(!f.userData||!f.userData.id)&&f.parent&&f.parent!==this.agentMeshGroup&&(f=f.parent),f.userData.id}else{var d=-1;return d}}}])}();const cF=/^[og]\s*(.+)?/,hF=/^mtllib /,fF=/^usemtl /,dF=/^usemap /,KE=/\s+/,ZE=new be,Rb=new be,JE=new be,QE=new be,Gu=new be,s0=new Ht;function pF(){const r={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(o,l){const f=this._finalize(!1);f&&(f.inherited||f.groupCount<=0)&&this.materials.splice(f.index,1);const d={index:this.materials.length,name:o||"",mtllib:Array.isArray(l)&&l.length>0?l[l.length-1]:"",smooth:f!==void 0?f.smooth:this.smooth,groupStart:f!==void 0?f.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(v){const _={index:typeof v=="number"?v:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return _.clone=this.clone.bind(_),_}};return this.materials.push(d),d},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(o){const l=this.currentMaterial();if(l&&l.groupEnd===-1&&(l.groupEnd=this.geometry.vertices.length/3,l.groupCount=l.groupEnd-l.groupStart,l.inherited=!1),o&&this.materials.length>1)for(let f=this.materials.length-1;f>=0;f--)this.materials[f].groupCount<=0&&this.materials.splice(f,1);return o&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),l}},i&&i.name&&typeof i.clone=="function"){const o=i.clone(0);o.inherited=!0,this.object.materials.push(o)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){const o=this.vertices,l=this.object.geometry.vertices;l.push(o[e+0],o[e+1],o[e+2]),l.push(o[t+0],o[t+1],o[t+2]),l.push(o[i+0],o[i+1],o[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const o=this.normals,l=this.object.geometry.normals;l.push(o[e+0],o[e+1],o[e+2]),l.push(o[t+0],o[t+1],o[t+2]),l.push(o[i+0],o[i+1],o[i+2])},addFaceNormal:function(e,t,i){const o=this.vertices,l=this.object.geometry.normals;ZE.fromArray(o,e),Rb.fromArray(o,t),JE.fromArray(o,i),Gu.subVectors(JE,Rb),QE.subVectors(ZE,Rb),Gu.cross(QE),Gu.normalize(),l.push(Gu.x,Gu.y,Gu.z),l.push(Gu.x,Gu.y,Gu.z),l.push(Gu.x,Gu.y,Gu.z)},addColor:function(e,t,i){const o=this.colors,l=this.object.geometry.colors;o[e]!==void 0&&l.push(o[e+0],o[e+1],o[e+2]),o[t]!==void 0&&l.push(o[t+0],o[t+1],o[t+2]),o[i]!==void 0&&l.push(o[i+0],o[i+1],o[i+2])},addUV:function(e,t,i){const o=this.uvs,l=this.object.geometry.uvs;l.push(o[e+0],o[e+1]),l.push(o[t+0],o[t+1]),l.push(o[i+0],o[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,o,l,f,d,v,_){const b=this.vertices.length;let w=this.parseVertexIndex(e,b),C=this.parseVertexIndex(t,b),R=this.parseVertexIndex(i,b);if(this.addVertex(w,C,R),this.addColor(w,C,R),d!==void 0&&d!==""){const z=this.normals.length;w=this.parseNormalIndex(d,z),C=this.parseNormalIndex(v,z),R=this.parseNormalIndex(_,z),this.addNormal(w,C,R)}else this.addFaceNormal(w,C,R);if(o!==void 0&&o!==""){const z=this.uvs.length;w=this.parseUVIndex(o,z),C=this.parseUVIndex(l,z),R=this.parseUVIndex(f,z),this.addUV(w,C,R),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,o=e.length;i<o;i++){const l=this.parseVertexIndex(e[i],t);this.addVertexPoint(l),this.addColor(l)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,o=this.uvs.length;for(let l=0,f=e.length;l<f;l++)this.addVertexLine(this.parseVertexIndex(e[l],i));for(let l=0,f=t.length;l<f;l++)this.addUVLine(this.parseUVIndex(t[l],o))}};return r.startObject("",!1),r}class eC extends Iw{constructor(e){super(e),this.materials=null}load(e,t,i,o){const l=this,f=new C2(this.manager);f.setPath(this.path),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials),f.load(e,function(d){try{t(l.parse(d))}catch(v){o?o(v):console.error(v),l.manager.itemError(e)}},i,o)}setMaterials(e){return this.materials=e,this}parse(e){const t=new pF;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const i=e.split(`
`);let o=[];for(let d=0,v=i.length;d<v;d++){const _=i[d].trimStart();if(_.length===0)continue;const b=_.charAt(0);if(b!=="#")if(b==="v"){const w=_.split(KE);switch(w[0]){case"v":t.vertices.push(parseFloat(w[1]),parseFloat(w[2]),parseFloat(w[3])),w.length>=7?(s0.setRGB(parseFloat(w[4]),parseFloat(w[5]),parseFloat(w[6]),au),t.colors.push(s0.r,s0.g,s0.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(w[1]),parseFloat(w[2]),parseFloat(w[3]));break;case"vt":t.uvs.push(parseFloat(w[1]),parseFloat(w[2]));break}}else if(b==="f"){const C=_.slice(1).trim().split(KE),R=[];for(let O=0,P=C.length;O<P;O++){const M=C[O];if(M.length>0){const U=M.split("/");R.push(U)}}const z=R[0];for(let O=1,P=R.length-1;O<P;O++){const M=R[O],U=R[O+1];t.addFace(z[0],M[0],U[0],z[1],M[1],U[1],z[2],M[2],U[2])}}else if(b==="l"){const w=_.substring(1).trim().split(" ");let C=[];const R=[];if(_.indexOf("/")===-1)C=w;else for(let z=0,O=w.length;z<O;z++){const P=w[z].split("/");P[0]!==""&&C.push(P[0]),P[1]!==""&&R.push(P[1])}t.addLineGeometry(C,R)}else if(b==="p"){const C=_.slice(1).trim().split(" ");t.addPointGeometry(C)}else if((o=cF.exec(_))!==null){const w=(" "+o[0].slice(1).trim()).slice(1);t.startObject(w)}else if(fF.test(_))t.object.startMaterial(_.substring(7).trim(),t.materialLibraries);else if(hF.test(_))t.materialLibraries.push(_.substring(7).trim());else if(dF.test(_))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(b==="s"){if(o=_.split(" "),o.length>1){const C=o[1].trim().toLowerCase();t.object.smooth=C!=="0"&&C!=="off"}else t.object.smooth=!0;const w=t.object.currentMaterial();w&&(w.smooth=t.object.smooth)}else{if(_==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+_+'"')}}t.finalize();const l=new cu;if(l.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let d=0,v=t.objects.length;d<v;d++){const _=t.objects[d],b=_.geometry,w=_.materials,C=b.type==="Line",R=b.type==="Points";let z=!1;if(b.vertices.length===0)continue;const O=new is;O.setAttribute("position",new hr(b.vertices,3)),b.normals.length>0&&O.setAttribute("normal",new hr(b.normals,3)),b.colors.length>0&&(z=!0,O.setAttribute("color",new hr(b.colors,3))),b.hasUVIndices===!0&&O.setAttribute("uv",new hr(b.uvs,2));const P=[];for(let U=0,L=w.length;U<L;U++){const B=w[U],$=B.name+"_"+B.smooth+"_"+z;let X=t.materials[$];if(this.materials!==null){if(X=this.materials.create(B.name),C&&X&&!(X instanceof _p)){const Q=new _p;Ch.prototype.copy.call(Q,X),Q.color.copy(X.color),X=Q}else if(R&&X&&!(X instanceof bm)){const Q=new bm({size:10,sizeAttenuation:!1});Ch.prototype.copy.call(Q,X),Q.color.copy(X.color),Q.map=X.map,X=Q}}X===void 0&&(C?X=new _p:R?X=new bm({size:1,sizeAttenuation:!1}):X=new _2,X.name=B.name,X.flatShading=!B.smooth,X.vertexColors=z,t.materials[$]=X),P.push(X)}let M;if(P.length>1){for(let U=0,L=w.length;U<L;U++){const B=w[U];O.addGroup(B.groupStart,B.groupCount,U)}C?M=new dg(O,P):R?M=new Qv(O,P):M=new Cr(O,P)}else C?M=new dg(O,P[0]):R?M=new Qv(O,P[0]):M=new Cr(O,P[0]);M.name=_.name,l.add(M)}else if(t.vertices.length>0){const d=new bm({size:1,sizeAttenuation:!1}),v=new is;v.setAttribute("position",new hr(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(v.setAttribute("color",new hr(t.colors,3)),d.vertexColors=!0);const _=new Qv(v,d);l.add(_)}return l}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const oM=Symbol("Comlink.proxy"),mF=Symbol("Comlink.endpoint"),vF=Symbol("Comlink.releaseProxy"),Ib=Symbol("Comlink.finalizer"),b0=Symbol("Comlink.thrown"),aM=r=>typeof r=="object"&&r!==null||typeof r=="function",gF={canHandle:r=>aM(r)&&r[oM],serialize(r){const{port1:e,port2:t}=new MessageChannel;return uM(r,e),[t,[t]]},deserialize(r){return r.start(),hM(r)}},_F={canHandle:r=>aM(r)&&b0 in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},lM=new Map([["proxy",gF],["throw",_F]]);function yF(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function uM(r,e=globalThis,t=["*"]){e.addEventListener("message",function i(o){if(!o||!o.data)return;if(!yF(t,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:l,type:f,path:d}=Object.assign({path:[]},o.data),v=(o.data.argumentList||[]).map(cp);let _;try{const b=d.slice(0,-1).reduce((C,R)=>C[R],r),w=d.reduce((C,R)=>C[R],r);switch(f){case"GET":_=w;break;case"SET":b[d.slice(-1)[0]]=cp(o.data.value),_=!0;break;case"APPLY":_=w.apply(b,v);break;case"CONSTRUCT":{const C=new w(...v);_=EF(C)}break;case"ENDPOINT":{const{port1:C,port2:R}=new MessageChannel;uM(r,R),_=pM(C,[C])}break;case"RELEASE":_=void 0;break;default:return}}catch(b){_={value:b,[b0]:0}}Promise.resolve(_).catch(b=>({value:b,[b0]:0})).then(b=>{const[w,C]=W0(b);e.postMessage(Object.assign(Object.assign({},w),{id:l}),C),f==="RELEASE"&&(e.removeEventListener("message",i),cM(e),Ib in r&&typeof r[Ib]=="function"&&r[Ib]())}).catch(b=>{const[w,C]=W0({value:new TypeError("Unserializable return value"),[b0]:0});e.postMessage(Object.assign(Object.assign({},w),{id:l}),C)})}),e.start&&e.start()}function bF(r){return r.constructor.name==="MessagePort"}function cM(r){bF(r)&&r.close()}function hM(r,e){const t=new Map;return r.addEventListener("message",function(o){const{data:l}=o;if(!l||!l.id)return;const f=t.get(l.id);if(f)try{f(l)}finally{t.delete(l.id)}}),$x(r,t,[],e)}function o0(r){if(r)throw new Error("Proxy has been released and is not useable")}function fM(r){return mm(r,new Map,{type:"RELEASE"}).then(()=>{cM(r)})}const G0=new WeakMap,H0="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(G0.get(r)||0)-1;G0.set(r,e),e===0&&fM(r)});function xF(r,e){const t=(G0.get(e)||0)+1;G0.set(e,t),H0&&H0.register(r,e,r)}function wF(r){H0&&H0.unregister(r)}function $x(r,e,t=[],i=function(){}){let o=!1;const l=new Proxy(i,{get(f,d){if(o0(o),d===vF)return()=>{wF(l),fM(r),e.clear(),o=!0};if(d==="then"){if(t.length===0)return{then:()=>l};const v=mm(r,e,{type:"GET",path:t.map(_=>_.toString())}).then(cp);return v.then.bind(v)}return $x(r,e,[...t,d])},set(f,d,v){o0(o);const[_,b]=W0(v);return mm(r,e,{type:"SET",path:[...t,d].map(w=>w.toString()),value:_},b).then(cp)},apply(f,d,v){o0(o);const _=t[t.length-1];if(_===mF)return mm(r,e,{type:"ENDPOINT"}).then(cp);if(_==="bind")return $x(r,e,t.slice(0,-1));const[b,w]=tC(v);return mm(r,e,{type:"APPLY",path:t.map(C=>C.toString()),argumentList:b},w).then(cp)},construct(f,d){o0(o);const[v,_]=tC(d);return mm(r,e,{type:"CONSTRUCT",path:t.map(b=>b.toString()),argumentList:v},_).then(cp)}});return xF(l,r),l}function SF(r){return Array.prototype.concat.apply([],r)}function tC(r){const e=r.map(W0);return[e.map(t=>t[0]),SF(e.map(t=>t[1]))]}const dM=new WeakMap;function pM(r,e){return dM.set(r,e),r}function EF(r){return Object.assign(r,{[oM]:!0})}function W0(r){for(const[e,t]of lM)if(t.canHandle(r)){const[i,o]=t.serialize(r);return[{type:"HANDLER",name:e,value:i},o]}return[{type:"RAW",value:r},dM.get(r)||[]]}function cp(r){switch(r.type){case"HANDLER":return lM.get(r.name).deserialize(r.value);case"RAW":return r.value}}function mm(r,e,t,i){return new Promise(o=>{const l=CF();e.set(l,o),r.start&&r.start(),r.postMessage(Object.assign({id:l},t),i)})}function CF(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Db,nC;function TF(){if(nC)return Db;nC=1;const r="ATOM  ",e="SEQRES";return Db=function(i){const o=i.split(`
`),l=[],f=[];let d=[];const v=new Map;return o.forEach(_=>{if(_.substr(0,6)===r)l.push({serial:parseInt(_.substring(6,11)),name:_.substring(12,16).trim(),altLoc:_.substring(16,17).trim(),resName:_.substring(17,20).trim(),chainID:_.substring(21,22).trim(),resSeq:parseInt(_.substring(22,26)),iCode:_.substring(26,27).trim(),x:parseFloat(_.substring(30,38)),y:parseFloat(_.substring(38,46)),z:parseFloat(_.substring(46,54)),occupancy:parseFloat(_.substring(54,60)),tempFactor:parseFloat(_.substring(60,66)),element:_.substring(76,78).trim(),charge:_.substring(78,80).trim()});else if(_.substr(0,6)===e){const b={serNum:parseInt(_.substring(7,10)),chainID:_.substring(11,12).trim(),numRes:parseInt(_.substring(13,17)),resNames:_.substring(19,70).trim().split(" ")};f.push(b),d=d.concat(b.resNames.map(w=>({id:d.length,serNum:b.serNum,chainID:b.chainID,resName:w}))),v.get(b.chainID)||v.set(b.chainID,{id:v.size,chainID:b.chainID})}}),v.forEach(_=>{_.residues=d.filter(b=>b.chainID===_.chainID)}),d.forEach(_=>{_.atoms=l.filter(b=>b.chainID===_.chainID&&b.resSeq===_.serNum)}),{atoms:l,seqRes:f,residues:d,chains:v}},Db}var MF=TF();const AF=Fm(MF);function iC(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,i)}return t}function hm(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?iC(Object(t),!0).forEach(function(i){ue(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):iC(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function PF(r){for(var e=r.split(`
`).map(function(w){return w.trim()}).filter(function(w){return w!=""}).filter(function(w){return!w.startsWith("#")}),t=!1,i="",o=0;o<e.length;o++)e[o].startsWith(";")&&t===!1?(t=!0,e[o]=e[o].substring(1,e[o].length),i=i+e[o],e[o]=""):e[o].startsWith(";")&&t===!0?(t=!1,e[o]=i,i=""):t===!0&&(i=i+e[o],e[o]="");e=e.filter(function(w){return w!=""});var l={},f={},d=!0,v=!1,_="",b=[];return e.forEach(function(w){w=w.trim(),w.startsWith("data_")&&d?(f.datablock=w.split("data_").join(""),d=!1):w.startsWith("data_")&&!d?(l[f.datablock]=f,f={},f.datablock=w.split("data_").join("")):w==="loop_"?(_="",b.length>0&&(f=hm(hm({},f),Lb(b,v))),b=[],v=!0):_===""&&w.startsWith("_")?(_=w.split(".")[0],b=[],b.push(w)):_!==""&&_!==w.split(".")[0]&&w.startsWith("_")?(_=w.split(".")[0],f=hm(hm({},f),Lb(b,v)),b=[],b.push(w),v=!1):b.push(w)}),b.length>0&&(f=hm(hm({},f),Lb(b,v))),l[f.datablock]=f,l}function Lb(r,e){var t=[],i=[],o="",l={};if(e){var f=[];r.forEach(function(C){if(C=C.trim(),C.startsWith("_"))o=C.split(".")[0],i.push(C.split(".")[1]);else{for(var R="",z=" ",O=!1,P=0;P<C.length;P++)z===" "&&C.charAt(P)==="'"?(z="'",O=!1):z===" "&&C.charAt(P)==='"'?(z='"',O=!1):z===" "&&C.charAt(P)===" "?(R.trim()!==""&&t.push(R),R="",O=!0):z==="'"&&C.charAt(P)==="'"||z==='"'&&C.charAt(P)==='"'?(t.push(R),R="",z=" ",O=!0):(R=R+C.charAt(P),O=!1);O||t.push(R)}});for(var d=0,v={},_=0;_<t.length;_++)d===i.length&&(d=0,f.push(v),v={}),v[i[d]]=t[_],d++;f.push(v),l[o]=f}else{var b=r.join("").trim().split(".")[0];r=r.join(" ").trim().split(b+".").filter(function(C){return C!=""});var w={};r.forEach(function(C){C=C.trim();var R=C.split(" ")[0];C=C.replace(R,"").trim(),C=C.split("'").join(""),w[R]=C}),l[b]=w}return l}function RF(r,e,t){for(var i=0;i<r.length;++i)if(Math.abs(r[i]-e[i])>t)return!1;return!0}function IF(r){for(var e=Number.MAX_VALUE,t=0;t<r.length;++t)r[t]<e&&(e=r[t]);return e}var DF=function(){function r(e){Xn(this,r),ue(this,"k",void 0),ue(this,"data",void 0),ue(this,"assignments",void 0),ue(this,"extents",void 0),ue(this,"ranges",void 0),ue(this,"means",void 0),ue(this,"iterations",void 0),ue(this,"drawDelay",void 0),ue(this,"timer",void 0),ue(this,"tmpDistances",void 0),this.k=e.k,this.tmpDistances=new Float32Array(this.k),this.data=e.data,this.assignments=new Int32Array(this.data.length/3),this.extents=this.dataDimensionExtents(this.data),this.ranges=this.dataExtentRanges(),this.means=r.randomSeeds(this.k,this.data),this.iterations=0,this.drawDelay=1,this.timer=-1,this.run()}return qn(r,[{key:"dataDimensionExtents",value:function(t){for(var i=[1e6,1e6,1e6,-1e6,-1e6,-1e6],o=0;o<t.length/3;o++){var l=t[o*3],f=t[o*3+1],d=t[o*3+2];l<i[0]&&(i[0]=l),l>i[3]&&(i[3]=l),f<i[1]&&(i[1]=f),f>i[4]&&(i[4]=f),d<i[2]&&(i[2]=d),d>i[5]&&(i[5]=d)}return i}},{key:"dataExtentRanges",value:function(){return[this.extents[3]-this.extents[0],this.extents[4]-this.extents[1],this.extents[5]-this.extents[2]]}},{key:"seeds",value:function(){for(var t=new Float32Array(this.k*3),i=0;i<this.k;++i)t[i*3]=this.extents[0]+Math.random()*this.ranges[0],t[i*3+1]=this.extents[1]+Math.random()*this.ranges[1],t[i*3+2]=this.extents[2]+Math.random()*this.ranges[2];return t}},{key:"assignClusterToDataPoints",value:function(){for(var t=0;t<this.data.length/3;t++){for(var i=this.data[t*3],o=this.data[t*3+1],l=this.data[t*3+2],f=0;f<this.means.length/3;f++){var d=this.means[f*3],v=this.means[f*3+1],_=this.means[f*3+2],b=(i-d)*(i-d)+(o-v)*(o-v)+(l-_)*(l-_);this.tmpDistances[f]=Math.sqrt(b)}var w=IF(this.tmpDistances);this.assignments[t]=this.tmpDistances.indexOf(w)}}},{key:"moveMeans",value:function(){for(var t=new Float32Array(this.means.length).fill(0),i=new Int32Array(this.means.length/3).fill(0),o=!1,l,f,d=0;d<this.assignments.length;d++){l=this.assignments[d];var v=this.data[d*3],_=this.data[d*3+1],b=this.data[d*3+2];i[l]++,t[l*3]+=v,t[l*3+1]+=_,t[l*3+2]+=b}for(l=0;l<t.length/3;l++){if(i[l]===0){t[l*3]=this.extents[0]+Math.random()*this.ranges[0],t[l*3+1]=this.extents[1]+Math.random()*this.ranges[1],t[l*3+2]=this.extents[2]+Math.random()*this.ranges[2];continue}t[l*3]/=i[l],t[l*3]=Math.round(100*t[l*3])/100,t[l*3+1]/=i[l],t[l*3+1]=Math.round(100*t[l*3+1])/100,t[l*3+2]/=i[l],t[l*3+2]=Math.round(100*t[l*3+2])/100}if(!RF(this.means,t,.01)){var w;for(o=!0,l=0;l<t.length/3;l++)for(f=0;f<3;f++)if(w=t[l*3+f]-this.means[l*3+f],Math.abs(w)>.1){var C=10;this.means[l*3+f]+=w/C,this.means[l*3+f]=Math.round(100*this.means[l*3+f])/100}else this.means[l*3+f]=t[l*3+f]}return o}},{key:"run",value:function(){var t=!0,i=150,o=5e3,l=Date.now(),f=0;do++this.iterations,this.assignClusterToDataPoints(),t=this.moveMeans(),f=Date.now()-l;while(t&&this.iterations<i&&!(f>o))}}],[{key:"randomSeeds",value:function(t,i){for(var o=i.length/3,l=new Set;l.add(Math.floor(Math.random()*o)|0).size<t;);for(var f=af(l),d=new Float32Array(t*3),v=0;v<t;++v)d[v*3]=i[f[v]*3],d[v*3+1]=i[f[v]*3+1],d[v*3+2]=i[f[v]*3+2];return d}}])}(),LF=4,kF="Cancelled",FF=function(){function r(){Xn(this,r),ue(this,"queue",[]),ue(this,"numActiveWorkers",0)}return qn(r,[{key:"enqueue",value:function(t){var i=this;return new Promise(function(o,l){i.queue.push({promise:t,resolve:o,reject:l}),i.dequeue()})}},{key:"getLength",value:function(){return this.queue.length}},{key:"getNumActive",value:function(){return this.numActiveWorkers}},{key:"stopAll",value:function(){for(;this.queue.length>0;){var t=this.queue.pop();t&&t.reject(kF)}}},{key:"dequeue",value:function(){var t=this;if(this.numActiveWorkers>=LF)return!1;var i=this.queue.shift();if(!i)return!1;try{this.numActiveWorkers++,i.promise().then(function(o){t.numActiveWorkers--,i.resolve(o),t.dequeue()}).catch(function(o){t.numActiveWorkers--,i.reject(o),t.dequeue()})}catch(o){this.numActiveWorkers--,i.reject(o),this.dequeue()}return!0}}])}(),mM=new FF,OF=`
precision highp float;

out vec3 IN_viewPos;
out vec3 IN_viewNormal;
out vec2 IN_instanceAndTypeId;

in vec4 position;
in vec3 normal;

// per instance attributes
in vec4 translateAndScale; // xyz trans, w scale
in vec4 rotation; // quaternion
// instanceID, typeId
in vec3 instanceAndTypeId;

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat3 normalMatrix;

vec3 applyQuaternionToVector( vec4 q, vec3 v ) {
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

void main() {
    vec3 p = position.xyz;
    
    // per-instance transform
    p *= translateAndScale.w;
    p = applyQuaternionToVector(rotation, p);
    p += translateAndScale.xyz;

    vec4 modelViewPosition = modelViewMatrix * vec4(p, 1.0);
    IN_viewPos = modelViewPosition.xyz;
    IN_viewNormal = normalMatrix * normal.xyz;
    IN_instanceAndTypeId = instanceAndTypeId.xy;
  
    gl_Position = projectionMatrix * modelViewPosition;

}
`,NF=`
precision highp float;

in vec3 IN_viewPos;
in vec3 IN_viewNormal;
in vec2 IN_instanceAndTypeId;

layout(location = 0) out vec4 gAgentInfo;
layout(location = 1) out vec4 gNormal;
layout(location = 2) out vec4 gPos;

uniform mat4 projectionMatrix;

void main() {
    vec3 fragViewPos = IN_viewPos;

    vec4 fragPosClip = projectionMatrix * vec4(fragViewPos, 1.0);
    vec3 fragPosNDC = fragPosClip.xyz / fragPosClip.w;
    float n = gl_DepthRange.near;
    float f = gl_DepthRange.far;
    // TODO: is this the same as gl_FragCoord.z ???
    float fragPosDepth = (((f - n) * fragPosNDC.z) + n + f) / 2.0;

    gAgentInfo = vec4(IN_instanceAndTypeId.y, IN_instanceAndTypeId.x, fragViewPos.z, fragPosDepth);

    vec3 normal = IN_viewNormal;
    normal = normalize(normal);
    gNormal = vec4(normal * 0.5 + 0.5, 1.0);

    gPos = vec4(fragViewPos.x, fragViewPos.y, fragViewPos.z, 1.0);

}
`,UF=new i_({glslVersion:Lm,vertexShader:OF,fragmentShader:NF,side:Ku,transparent:!1,defines:{},uniforms:{modelViewMatrix:{value:new hi},normalMatrix:{value:new Dn},projectionMatrix:{value:new hi}}}),BF={mat:UF};const zF={shaderSet:BF};var VF=new Zu,GF=new Pl,uf=function(r){return r[r.MESH=0]="MESH",r[r.POINTS=1]="POINTS",r}({}),vp=function(){function r(e,t,i,o){Xn(this,r),ue(this,"baseGeometry",void 0),ue(this,"drawable",void 0),ue(this,"shaderSet",void 0),ue(this,"instancedGeometry",void 0),ue(this,"positionAttribute",void 0),ue(this,"rotationAttribute",void 0),ue(this,"instanceAttribute",void 0),ue(this,"currentInstance",void 0),ue(this,"isUpdating",void 0),this.baseGeometry=t,this.drawable=e===uf.MESH?new Cr(t):new Qv(t),this.drawable.name=i,this.currentInstance=0,this.isUpdating=!1,this.instancedGeometry=new V0,this.instancedGeometry.instanceCount=0,this.shaderSet=e===uf.MESH?zF.shaderSet:rM.shaderSet,this.positionAttribute=new $u(Uint8Array.from([]),1),this.rotationAttribute=new $u(Uint8Array.from([]),1),this.instanceAttribute=new $u(Uint8Array.from([]),1),this.drawable.frustumCulled=!1,this.reallocate(o)}return qn(r,[{key:"getMesh",value:function(){return this.drawable}},{key:"getShaders",value:function(){return this.shaderSet}},{key:"getCapacity",value:function(){return this.instanceAttribute.count}},{key:"instanceCount",value:function(){return this.instancedGeometry.instanceCount}},{key:"updateInstanceCount",value:function(t){this.instancedGeometry.instanceCount=t}},{key:"replaceGeometry",value:function(t,i){this.drawable.name=i,this.baseGeometry=t,this.reallocate(this.getCapacity())}},{key:"reallocate",value:function(t){this.dispose(),this.instancedGeometry=new V0().copy(this.baseGeometry),this.drawable.geometry=this.instancedGeometry;var i=new Float32Array(4*t);i.set(this.positionAttribute.array),this.positionAttribute=new $u(i,4,!1),this.instancedGeometry.setAttribute("translateAndScale",this.positionAttribute);var o=new Float32Array(4*t);o.set(this.rotationAttribute.array),this.rotationAttribute=new $u(o,4,!1),this.instancedGeometry.setAttribute("rotation",this.rotationAttribute);var l=new Float32Array(3*t);l.set(this.instanceAttribute.array),this.instanceAttribute=new $u(l,3,!1),this.instancedGeometry.setAttribute("instanceAndTypeId",this.instanceAttribute)}},{key:"dispose",value:function(){this.instancedGeometry.dispose()}},{key:"beginUpdate",value:function(){this.isUpdating=!0,this.currentInstance=0,this.updateInstanceCount(0)}},{key:"checkRealloc",value:function(t){var i=256,o=this.instanceAttribute.count,l=t;if(l>o){var f=(Math.trunc(l/i)+1)*i;this.reallocate(f)}}},{key:"addInstance",value:function(t,i,o,l,f,d,v,_,b){var w=arguments.length>9&&arguments[9]!==void 0?arguments[9]:1,C=this.currentInstance;this.checkRealloc(this.currentInstance+1),this.positionAttribute.setXYZW(C,t,i,o,l);var R=VF.setFromEuler(GF.set(f,d,v));this.rotationAttribute.setXYZW(C,R.x,R.y,R.z,R.w),this.instanceAttribute.setXYZ(C,_,b,w),this.currentInstance++}},{key:"endUpdate",value:function(){this.updateInstanceCount(this.currentInstance),this.instanceAttribute.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.rotationAttribute.needsUpdate=!0,this.isUpdating=!1}}])}(),rC=function(){function r(e){Xn(this,r),ue(this,"filePath",void 0),ue(this,"name",void 0),ue(this,"pdb",void 0),ue(this,"lodSizes",void 0),ue(this,"lods",void 0),ue(this,"bounds",void 0),ue(this,"_cancelled",void 0),this.filePath=e,this.name=e,this.pdb=null,this.lods=[],this.lodSizes=[],this._cancelled=!1,this.bounds=new Eh}return qn(r,[{key:"cancelled",get:function(){return this._cancelled},set:function(t){this._cancelled=t}},{key:"getNumAtoms",value:function(){return this.pdb?this.pdb.atoms.length:0}},{key:"parse",value:function(t,i){if(i==="pdb")this.parsePDBData(t);else if(i==="cif")this.parseCIFData(t);else throw new Error("Expected .cif or .pdb file extension to parse PDB data, but got ".concat(i))}},{key:"parseCIFData",value:function(t){var i=PF(t);for(var o in i){var l=i[o],f=l._atom_site;if(f.length>0){this.pdb={atoms:[],seqRes:[],residues:[],chains:new Map},this.pdb.atoms=[];for(var d=0;d<f.length;++d){var v;(v=this.pdb)===null||v===void 0||v.atoms.push({x:f[d].Cartn_x,y:f[d].Cartn_y,z:f[d].Cartn_z})}return this.fixupCoordinates(),console.log("PDB ".concat(this.name," has ").concat(this.pdb.atoms.length," atoms")),this.checkChains(),this.initializeLOD()}break}}},{key:"parsePDBData",value:function(t){if(this.pdb=AF(t),this.pdb.atoms.length>0)return this.fixupCoordinates(),console.log("PDB ".concat(this.name," has ").concat(this.pdb.atoms.length," atoms")),this.checkChains(),this.initializeLOD()}},{key:"create",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,o=[];o.push({x:0,y:0,z:0});for(var l=1;l<t;++l)o.push({x:(Math.random()-.5)*i,y:(Math.random()-.5)*i,z:(Math.random()-.5)*i});return this.pdb={atoms:o,seqRes:[],residues:[],chains:new Map},this.fixupCoordinates(),this.initializeLOD(),Promise.resolve()}},{key:"fixupCoordinates",value:function(){if(this.pdb){for(var t=new be(.1,.1,.1),i=0;i<this.pdb.atoms.length;++i)this.pdb.atoms[i].x*=t.x,this.pdb.atoms[i].y*=t.y,this.pdb.atoms[i].z*=t.z;for(var o=this.pdb.atoms[0].x,l=this.pdb.atoms[0].x,f=this.pdb.atoms[0].x,d=this.pdb.atoms[0].x,v=this.pdb.atoms[0].x,_=this.pdb.atoms[0].x,b=1;b<this.pdb.atoms.length;++b)d=Math.max(d,this.pdb.atoms[b].x),v=Math.max(v,this.pdb.atoms[b].y),_=Math.max(_,this.pdb.atoms[b].z),o=Math.min(o,this.pdb.atoms[b].x),l=Math.min(l,this.pdb.atoms[b].y),f=Math.min(f,this.pdb.atoms[b].z);this.bounds=new Eh(new be(o,l,f),new be(d,v,_))}}},{key:"checkChains",value:function(){if(this.pdb&&(this.pdb.chains||(this.pdb.chains=new Map),!this.pdb.chains.size))for(var t=0;t<this.pdb.atoms.length;++t){var i=this.pdb.atoms[t];i.chainID&&!this.pdb.chains.get(i.chainID)&&this.pdb.chains.set(i.chainID,{id:this.pdb.chains.size,chainID:i.chainID,residues:[]})}}},{key:"createGPUBuffer",value:function(t){for(var i=new is,o=t.length/3,l=new Float32Array(o*4),f=0;f<o;f++)l[f*4]=t[f*3],l[f*4+1]=t[f*3+1],l[f*4+2]=t[f*3+2],l[f*4+3]=1;return i.setAttribute("position",new hr(l,4)),i}},{key:"makeFlatPositionArray",value:function(){if(!this.pdb)return console.error("makeFlatPositionArray: pdb not loaded yet"),new Float32Array;for(var t=this.pdb.atoms.length,i=new Float32Array(t*3),o=0;o<t;o++)i[o*3]=this.pdb.atoms[o].x,i[o*3+1]=this.pdb.atoms[o].y,i[o*3+2]=this.pdb.atoms[o].z;return i}},{key:"initializeLOD",value:function(){if(!this.pdb){console.error("initializeLOD called with no pdb data");return}var t=this.pdb.atoms.length;this.lodSizes=[t,Math.max(Math.floor(t/4),1),Math.max(Math.floor(t/16),1),Math.max(Math.floor(t/64),1)];var i=this.makeFlatPositionArray(),o=i.slice(),l=this.createGPUBuffer(o);this.lods.push({geometry:l,vertices:o,instances:new vp(uf.POINTS,l,this.name+"_LOD0",0)});for(var f=1;f<this.lodSizes.length;++f){var d=DF.randomSeeds(this.lodSizes[f],i),v=this.createGPUBuffer(d);this.lods.push({geometry:v,vertices:d,instances:new vp(uf.POINTS,v,this.name+"_LOD"+f,0)})}}},{key:"generateLOD",value:function(){var e=po(ii.mark(function i(){var o=this,l,f,d,v,_,b,w;return ii.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(!(!this.pdb||this.lods.length<4)){R.next=3;break}return console.log("generateLOD called with no pdb data or uninitialized LODs"),R.abrupt("return",Promise.resolve());case 3:return l=this.pdb.atoms.length,f=this.makeFlatPositionArray(),d=this.lodSizes.slice(1),R.next=8,mM.enqueue(function(){return o.processPdbLod(l,d,f)});case 8:for(v=R.sent,_=0;_<d.length;++_)b=_+1,this.lods[b]&&this.lods[b].instances.dispose(),w=this.createGPUBuffer(v[_]),this.lods[b]={geometry:w,vertices:v[_],instances:new vp(uf.POINTS,w,this.name+"_LOD"+b,0)};case 10:case"end":return R.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"numLODs",value:function(){return this.lods.length}},{key:"getLOD",value:function(t){return(t<0||t>=this.lods.length)&&(t=this.lods.length-1),this.lods[t].instances}},{key:"beginUpdate",value:function(){for(var t=0;t<this.lods.length;++t)this.lods[t].instances.beginUpdate()}},{key:"endUpdate",value:function(){for(var t=0;t<this.lods.length;++t)this.lods[t].instances.endUpdate()}},{key:"instantiate",value:function(){for(var t=[],i=0;i<this.lods.length;++i){var o=new Qv(this.lods[i].geometry);o.visible=!1,t.push(o)}return t}},{key:"processPdbLod",value:function(){var e=po(ii.mark(function i(o,l,f){var d,v,_,b;return ii.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return d=new Worker(new URL("/assets/KMeansWorker-CiosJbcc.js",import.meta.url),{type:"module"}),v=hM(d),C.next=4,new v;case 4:return _=C.sent,C.next=7,_.run(o,l,pM(f,[f.buffer]));case 7:return b=C.sent,d.terminate(),C.abrupt("return",b);case 10:case"end":return C.stop()}},i)}));function t(i,o,l){return e.apply(this,arguments)}return t}()}])}(),Di=function(r){return r.PDB="PDB",r.OBJ="OBJ",r.SPHERE="SPHERE",r.CUBE="CUBE",r.GIZMO="GIZMO",r.SPHERE_GROUP="SPHERE_GROUP",r}({});class HF extends Cr{constructor(e,t,i=!1,o=!1,l=1e4){const f=new is;super(f,t),this.isMarchingCubes=!0;const d=this,v=new Float32Array(12*3),_=new Float32Array(12*3),b=new Float32Array(12*3);this.enableUvs=i,this.enableColors=o,this.init=function(U){this.resolution=U,this.isolation=80,this.size=U,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(this.size3*3),this.palette=new Float32Array(this.size3*3),this.count=0;const L=l*3;this.positionArray=new Float32Array(L*3);const B=new ns(this.positionArray,3);B.setUsage(Rg),f.setAttribute("position",B),this.normalArray=new Float32Array(L*3);const $=new ns(this.normalArray,3);if($.setUsage(Rg),f.setAttribute("normal",$),this.enableUvs){this.uvArray=new Float32Array(L*2);const X=new ns(this.uvArray,2);X.setUsage(Rg),f.setAttribute("uv",X)}if(this.enableColors){this.colorArray=new Float32Array(L*3);const X=new ns(this.colorArray,3);X.setUsage(Rg),f.setAttribute("color",X)}f.boundingSphere=new Om(new be,1)};function w(U,L,B){return U+(L-U)*B}function C(U,L,B,$,X,Q,te,V,H,J){const ce=(B-te)/(V-te),he=d.normal_cache;v[L+0]=$+ce*d.delta,v[L+1]=X,v[L+2]=Q,_[L+0]=w(he[U+0],he[U+3],ce),_[L+1]=w(he[U+1],he[U+4],ce),_[L+2]=w(he[U+2],he[U+5],ce),b[L+0]=w(d.palette[H*3+0],d.palette[J*3+0],ce),b[L+1]=w(d.palette[H*3+1],d.palette[J*3+1],ce),b[L+2]=w(d.palette[H*3+2],d.palette[J*3+2],ce)}function R(U,L,B,$,X,Q,te,V,H,J){const ce=(B-te)/(V-te),he=d.normal_cache;v[L+0]=$,v[L+1]=X+ce*d.delta,v[L+2]=Q;const ge=U+d.yd*3;_[L+0]=w(he[U+0],he[ge+0],ce),_[L+1]=w(he[U+1],he[ge+1],ce),_[L+2]=w(he[U+2],he[ge+2],ce),b[L+0]=w(d.palette[H*3+0],d.palette[J*3+0],ce),b[L+1]=w(d.palette[H*3+1],d.palette[J*3+1],ce),b[L+2]=w(d.palette[H*3+2],d.palette[J*3+2],ce)}function z(U,L,B,$,X,Q,te,V,H,J){const ce=(B-te)/(V-te),he=d.normal_cache;v[L+0]=$,v[L+1]=X,v[L+2]=Q+ce*d.delta;const ge=U+d.zd*3;_[L+0]=w(he[U+0],he[ge+0],ce),_[L+1]=w(he[U+1],he[ge+1],ce),_[L+2]=w(he[U+2],he[ge+2],ce),b[L+0]=w(d.palette[H*3+0],d.palette[J*3+0],ce),b[L+1]=w(d.palette[H*3+1],d.palette[J*3+1],ce),b[L+2]=w(d.palette[H*3+2],d.palette[J*3+2],ce)}function O(U){const L=U*3;d.normal_cache[L]===0&&(d.normal_cache[L+0]=d.field[U-1]-d.field[U+1],d.normal_cache[L+1]=d.field[U-d.yd]-d.field[U+d.yd],d.normal_cache[L+2]=d.field[U-d.zd]-d.field[U+d.zd])}function P(U,L,B,$,X){const Q=$+1,te=$+d.yd,V=$+d.zd,H=Q+d.yd,J=Q+d.zd,ce=$+d.yd+d.zd,he=Q+d.yd+d.zd;let ge=0;const Ae=d.field[$],me=d.field[Q],Ie=d.field[te],ae=d.field[H],ye=d.field[V],de=d.field[J],ie=d.field[ce],we=d.field[he];Ae<X&&(ge|=1),me<X&&(ge|=2),Ie<X&&(ge|=8),ae<X&&(ge|=4),ye<X&&(ge|=16),de<X&&(ge|=32),ie<X&&(ge|=128),we<X&&(ge|=64);const ze=WF[ge];if(ze===0)return 0;const se=d.delta,fe=U+se,Le=L+se,Be=B+se;ze&1&&(O($),O(Q),C($*3,0,X,U,L,B,Ae,me,$,Q)),ze&2&&(O(Q),O(H),R(Q*3,3,X,fe,L,B,me,ae,Q,H)),ze&4&&(O(te),O(H),C(te*3,6,X,U,Le,B,Ie,ae,te,H)),ze&8&&(O($),O(te),R($*3,9,X,U,L,B,Ae,Ie,$,te)),ze&16&&(O(V),O(J),C(V*3,12,X,U,L,Be,ye,de,V,J)),ze&32&&(O(J),O(he),R(J*3,15,X,fe,L,Be,de,we,J,he)),ze&64&&(O(ce),O(he),C(ce*3,18,X,U,Le,Be,ie,we,ce,he)),ze&128&&(O(V),O(ce),R(V*3,21,X,U,L,Be,ye,ie,V,ce)),ze&256&&(O($),O(V),z($*3,24,X,U,L,B,Ae,ye,$,V)),ze&512&&(O(Q),O(J),z(Q*3,27,X,fe,L,B,me,de,Q,J)),ze&1024&&(O(H),O(he),z(H*3,30,X,fe,Le,B,ae,we,H,he)),ze&2048&&(O(te),O(ce),z(te*3,33,X,U,Le,B,Ie,ie,te,ce)),ge<<=4;let He,et,pt,Wt=0,zt=0;for(;a0[ge+zt]!=-1;)He=ge+zt,et=He+1,pt=He+2,M(v,_,b,3*a0[He],3*a0[et],3*a0[pt]),zt+=3,Wt++;return Wt}function M(U,L,B,$,X,Q){const te=d.count*3;if(d.positionArray[te+0]=U[$],d.positionArray[te+1]=U[$+1],d.positionArray[te+2]=U[$+2],d.positionArray[te+3]=U[X],d.positionArray[te+4]=U[X+1],d.positionArray[te+5]=U[X+2],d.positionArray[te+6]=U[Q],d.positionArray[te+7]=U[Q+1],d.positionArray[te+8]=U[Q+2],d.material.flatShading===!0){const V=(L[$+0]+L[X+0]+L[Q+0])/3,H=(L[$+1]+L[X+1]+L[Q+1])/3,J=(L[$+2]+L[X+2]+L[Q+2])/3;d.normalArray[te+0]=V,d.normalArray[te+1]=H,d.normalArray[te+2]=J,d.normalArray[te+3]=V,d.normalArray[te+4]=H,d.normalArray[te+5]=J,d.normalArray[te+6]=V,d.normalArray[te+7]=H,d.normalArray[te+8]=J}else d.normalArray[te+0]=L[$+0],d.normalArray[te+1]=L[$+1],d.normalArray[te+2]=L[$+2],d.normalArray[te+3]=L[X+0],d.normalArray[te+4]=L[X+1],d.normalArray[te+5]=L[X+2],d.normalArray[te+6]=L[Q+0],d.normalArray[te+7]=L[Q+1],d.normalArray[te+8]=L[Q+2];if(d.enableUvs){const V=d.count*2;d.uvArray[V+0]=U[$+0],d.uvArray[V+1]=U[$+2],d.uvArray[V+2]=U[X+0],d.uvArray[V+3]=U[X+2],d.uvArray[V+4]=U[Q+0],d.uvArray[V+5]=U[Q+2]}d.enableColors&&(d.colorArray[te+0]=B[$+0],d.colorArray[te+1]=B[$+1],d.colorArray[te+2]=B[$+2],d.colorArray[te+3]=B[X+0],d.colorArray[te+4]=B[X+1],d.colorArray[te+5]=B[X+2],d.colorArray[te+6]=B[Q+0],d.colorArray[te+7]=B[Q+1],d.colorArray[te+8]=B[Q+2]),d.count+=3}this.addBall=function(U,L,B,$,X,Q){const te=Math.sign($);$=Math.abs($);const V=Q!=null;let H=new Ht(U,L,B);if(V)try{H=Q instanceof Ht?Q:Array.isArray(Q)?new Ht(Math.min(Math.abs(Q[0]),1),Math.min(Math.abs(Q[1]),1),Math.min(Math.abs(Q[2]),1)):new Ht(Q)}catch{H=new Ht(U,L,B)}const J=this.size*Math.sqrt($/X),ce=B*this.size,he=L*this.size,ge=U*this.size;let Ae=Math.floor(ce-J);Ae<1&&(Ae=1);let me=Math.floor(ce+J);me>this.size-1&&(me=this.size-1);let Ie=Math.floor(he-J);Ie<1&&(Ie=1);let ae=Math.floor(he+J);ae>this.size-1&&(ae=this.size-1);let ye=Math.floor(ge-J);ye<1&&(ye=1);let de=Math.floor(ge+J);de>this.size-1&&(de=this.size-1);let ie,we,ze,se,fe,Le,Be,He,et,pt,Wt;for(ze=Ae;ze<me;ze++)for(fe=this.size2*ze,He=ze/this.size-B,et=He*He,we=Ie;we<ae;we++)for(se=fe+this.size*we,Be=we/this.size-L,pt=Be*Be,ie=ye;ie<de;ie++)if(Le=ie/this.size-U,Wt=$/(1e-6+Le*Le+pt+et)-X,Wt>0){this.field[se+ie]+=Wt*te;const zt=Math.sqrt((ie-ge)*(ie-ge)+(we-he)*(we-he)+(ze-ce)*(ze-ce))/J,bn=1-zt*zt*zt*(zt*(zt*6-15)+10);this.palette[(se+ie)*3+0]+=H.r*bn,this.palette[(se+ie)*3+1]+=H.g*bn,this.palette[(se+ie)*3+2]+=H.b*bn}},this.addPlaneX=function(U,L){const B=this.size,$=this.yd,X=this.zd,Q=this.field;let te,V,H,J,ce,he,ge,Ae=B*Math.sqrt(U/L);for(Ae>B&&(Ae=B),te=0;te<Ae;te++)if(he=te/B,J=he*he,ce=U/(1e-4+J)-L,ce>0)for(V=0;V<B;V++)for(ge=te+V*$,H=0;H<B;H++)Q[X*H+ge]+=ce},this.addPlaneY=function(U,L){const B=this.size,$=this.yd,X=this.zd,Q=this.field;let te,V,H,J,ce,he,ge,Ae,me=B*Math.sqrt(U/L);for(me>B&&(me=B),V=0;V<me;V++)if(he=V/B,J=he*he,ce=U/(1e-4+J)-L,ce>0)for(ge=V*$,te=0;te<B;te++)for(Ae=ge+te,H=0;H<B;H++)Q[X*H+Ae]+=ce},this.addPlaneZ=function(U,L){const B=this.size,$=this.yd,X=this.zd,Q=this.field;let te,V,H,J,ce,he,ge,Ae,me=B*Math.sqrt(U/L);for(me>B&&(me=B),H=0;H<me;H++)if(he=H/B,J=he*he,ce=U/(1e-4+J)-L,ce>0)for(ge=X*H,V=0;V<B;V++)for(Ae=ge+V*$,te=0;te<B;te++)Q[Ae+te]+=ce},this.setCell=function(U,L,B,$){const X=this.size2*B+this.size*L+U;this.field[X]=$},this.getCell=function(U,L,B){const $=this.size2*B+this.size*L+U;return this.field[$]},this.blur=function(U=1){const L=this.field,B=L.slice(),$=this.size,X=this.size2;for(let Q=0;Q<$;Q++)for(let te=0;te<$;te++)for(let V=0;V<$;V++){const H=X*V+$*te+Q;let J=B[H],ce=1;for(let he=-1;he<=1;he+=2){const ge=he+Q;if(!(ge<0||ge>=$))for(let Ae=-1;Ae<=1;Ae+=2){const me=Ae+te;if(!(me<0||me>=$))for(let Ie=-1;Ie<=1;Ie+=2){const ae=Ie+V;if(ae<0||ae>=$)continue;const ye=X*ae+$*me+ge,de=B[ye];ce++,J+=U*(de-J)/ce}}}L[H]=J}},this.reset=function(){for(let U=0;U<this.size3;U++)this.normal_cache[U*3]=0,this.field[U]=0,this.palette[U*3]=this.palette[U*3+1]=this.palette[U*3+2]=0},this.update=function(){this.count=0;const U=this.size-2;for(let L=1;L<U;L++){const B=this.size2*L,$=(L-this.halfsize)/this.halfsize;for(let X=1;X<U;X++){const Q=B+this.size*X,te=(X-this.halfsize)/this.halfsize;for(let V=1;V<U;V++){const H=(V-this.halfsize)/this.halfsize,J=Q+V;P(H,te,$,J,this.isolation)}}}this.geometry.setDrawRange(0,this.count),f.getAttribute("position").needsUpdate=!0,f.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(f.getAttribute("uv").needsUpdate=!0),this.enableColors&&(f.getAttribute("color").needsUpdate=!0),this.count/3>l&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(e)}}const WF=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),a0=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);var jF=`
precision highp float;

out vec3 IN_viewPos;
out vec3 IN_viewNormal;
out vec2 IN_instanceAndTypeId;

in vec4 position;
in vec3 normal;

// per instance attributes
uniform vec4 translateAndScale; // xyz trans, w scale
uniform vec4 rotation; // quaternion
// instanceID, typeId
uniform vec3 instanceAndTypeId;

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat3 normalMatrix;

vec3 applyQuaternionToVector( vec4 q, vec3 v ) {
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

void main() {
    vec3 p = position.xyz;
    
    // per-instance transform
    p *= translateAndScale.w;
    p = applyQuaternionToVector(rotation, p);
    p += translateAndScale.xyz;

    vec4 modelViewPosition = modelViewMatrix * vec4(p, 1.0);
    IN_viewPos = modelViewPosition.xyz;
    IN_viewNormal = normalMatrix * normal.xyz;
    IN_instanceAndTypeId = instanceAndTypeId.xy;
  
    gl_Position = projectionMatrix * modelViewPosition;

}
`,XF=`
precision highp float;

in vec3 IN_viewPos;
in vec3 IN_viewNormal;
in vec2 IN_instanceAndTypeId;

layout(location = 0) out vec4 gAgentInfo;
layout(location = 1) out vec4 gNormal;
layout(location = 2) out vec4 gPos;

uniform mat4 projectionMatrix;

void main() {
    vec3 fragViewPos = IN_viewPos;

    vec4 fragPosClip = projectionMatrix * vec4(fragViewPos, 1.0);
    vec3 fragPosNDC = fragPosClip.xyz / fragPosClip.w;
    float n = gl_DepthRange.near;
    float f = gl_DepthRange.far;
    // TODO: is this the same as gl_FragCoord.z ???
    float fragPosDepth = (((f - n) * fragPosNDC.z) + n + f) / 2.0;

    gAgentInfo = vec4(IN_instanceAndTypeId.y, IN_instanceAndTypeId.x, fragViewPos.z, fragPosDepth);

    vec3 normal = IN_viewNormal;
    normal = normalize(normal);
    vec3 normalOut = normal * 0.5 + 0.5;
    gNormal = vec4(normalOut, 1.0);

    gPos = vec4(fragViewPos.x, fragViewPos.y, fragViewPos.z, 1.0);

}
`,qF=new i_({glslVersion:Lm,vertexShader:jF,fragmentShader:XF,side:Ku,transparent:!1,defines:{},uniforms:{modelViewMatrix:{value:new hi},normalMatrix:{value:new Dn},projectionMatrix:{value:new hi},translateAndScale:{value:new Xi(0,0,0,1)},rotation:{value:new Xi(0,0,0,0)},instanceAndTypeId:{value:new be(0,0,0)}}}),$F={mat:qF};const YF={shaderSet:$F};var KF=function(){function r(e){Xn(this,r),ue(this,"drawable",void 0),ue(this,"shaderSet",void 0),this.drawable=new cu,this.drawable.name=e,this.shaderSet=YF.shaderSet}return qn(r,[{key:"getMesh",value:function(){return this.drawable}},{key:"getShaders",value:function(){return this.shaderSet}},{key:"instanceCount",value:function(){return this.drawable.children.length}},{key:"beginUpdate",value:function(){for(var t=this.drawable.children.length-1;t>=0;t--)this.drawable.remove(this.drawable.children[t])}},{key:"endUpdate",value:function(){}},{key:"replaceGeometry",value:function(t,i){}},{key:"addInstance",value:function(t,i,o,l,f,d,v,_,b){var w=arguments.length>9&&arguments[9]!==void 0?arguments[9]:1,C=arguments.length>10&&arguments[10]!==void 0?arguments[10]:[],R=this.shaderSet.mat.clone();R.uniforms.translateAndScale.value=new Xi(t,i,o,l),R.uniforms.rotation.value=new Zu().setFromEuler(new Pl(f,d,v)),R.uniforms.instanceAndTypeId.value=new be(_,b,w);var z=28,O=!0,P=!1,M=!1,U=65535,L=new HF(z,R,O,P,U);L.position.set(0,0,0),L.scale.set(1,1,1),L.enableUvs=M,L.enableColors=P;for(var B=new Eh,$=0,X=0;X<C.length;X+=4)B.expandByPoint(new be(C[X],C[X+1],C[X+2])),C[X+3]>$&&($=C[X+3]);B.expandByScalar($);var Q=new be;B.getSize(Q);var te=new be;B.getCenter(te);for(var V=0;V<C.length;V+=4){var H=C[V+3],J=1,ce=(C[V+0]-B.min.x)/Q.x,he=(C[V+1]-B.min.y)/Q.y,ge=(C[V+2]-B.min.z)/Q.z;L.addBall(ce,he,ge,H,J)}L.visible=!0,L.onBeforeRender(void 0,void 0,void 0,L.geometry,R,void 0),this.drawable.add(L)}}])}(),l0="SPHERE",s_=function(){function r(e){Xn(this,r),ue(this,"_geoLoadAttempted",void 0),ue(this,"_cachedAssets",void 0),ue(this,"_registry",void 0),ue(this,"mlogger",void 0),this._geoLoadAttempted=new Map,this._cachedAssets=new Map,this._registry=new Map,this.mlogger=Al.get("geometry-store"),this._registry.set(l0,{displayType:Di.SPHERE,geometry:{mesh:new Cr(r.sphereGeometry),cancelled:!1,instances:new vp(uf.MESH,r.sphereGeometry,l0,1)}}),e&&this.mlogger.setLevel(e)}return qn(r,[{key:"reset",value:function(){this._geoLoadAttempted.clear(),this._registry.clear(),this._registry.set(l0,{displayType:Di.SPHERE,geometry:{mesh:new Cr(r.sphereGeometry),cancelled:!1,instances:new vp(uf.MESH,r.sphereGeometry,l0,1)}})}},{key:"registry",get:function(){return this._registry}},{key:"forEachMesh",value:function(t){this._registry.forEach(function(i){var o=i.displayType;if(o!==Di.PDB){var l=i;t(l)}})}},{key:"forEachPDB",value:function(t){this._registry.forEach(function(i){var o=i.displayType;if(o===Di.PDB){var l=i.geometry;t(l)}})}},{key:"getGeoForAgentType",value:function(t){var i=this._registry.get(t);return i||null}},{key:"cancelAll",value:function(){mM.stopAll(),this._registry.forEach(function(t){t.geometry.cancelled=!0})}},{key:"cacheLocalAssets",value:function(t){var i=this;ri.forEach(t,function(o,l){var f=Kx(l);i._cachedAssets.set(f,o)})}},{key:"createNewSphereGeometry",value:function(t){return{mesh:new Cr(r.sphereGeometry),cancelled:!1,instances:new vp(uf.MESH,r.sphereGeometry,t,1)}}},{key:"createNewCubeGeometry",value:function(t){return{mesh:new Cr(r.cubeGeometry),cancelled:!1,instances:new vp(uf.MESH,r.cubeGeometry,t,1)}}},{key:"setGeometryInRegistry",value:function(t,i,o){this._registry.set(t,{geometry:i,displayType:o})}},{key:"fetchPdb",value:function(t){var i=this,o=new rC(t);this.setGeometryInRegistry(t,o,Di.PDB);var l=t.slice(),f="";return l.startsWith("http")||(f=l,l="https://files.rcsb.org/download/".concat(f,"-assembly1.cif")),fetch(l).then(function(d){if(d.ok)return d.text();if(f)return l="https://files.rcsb.org/download/".concat(f,".pdb1"),fetch(l).then(function(v){if(!v.ok)throw new Error("Failed to fetch ".concat(o.filePath," from ").concat(l));return v.text()});throw new Error("Failed to fetch ".concat(o.filePath," from ").concat(t))}).then(function(d){if(o.cancelled)return i._registry.delete(t),Promise.resolve(void 0);o.parse(d,mC(l));var v=i._registry.get(t);return v&&v.geometry===o?(i.mlogger.info("Finished downloading pdb: ",t),o):(i.mlogger.warn("After download, GeometryStore PDB entry not found for ".concat(t)),Promise.resolve(void 0))})}},{key:"prepMeshRegistryForNewObj",value:function(t){if(this._registry.has(t)){var i=this._registry.get(t);if(!i)return;var o=i.geometry,l=i.displayType;if(o&&l!==Di.PDB&&l!==Di.SPHERE_GROUP){var f=o;f.mesh=new Cr(r.sphereGeometry),f.instances.replaceGeometry(r.sphereGeometry,t)}}else this.setGeometryInRegistry(t,this.createNewSphereGeometry(t),Di.SPHERE)}},{key:"handleObjResponse",value:function(t,i){var o=this._registry.get(t);if(o){var l=o.geometry;if(l&&l.cancelled||!l){this._registry.delete(t);return}this.mlogger.debug("Finished loading mesh: ",t);var f=null;return i.traverse(function(d){if(!f&&d instanceof Cr)return f=d.geometry,!1}),f?(l.mesh=i,l.instances.replaceGeometry(f,t)):console.error("Mesh loaded but could not find instanceable geometry in it"),i.name||(i.name=t),l}}},{key:"fetchObj",value:function(t){var i=this,o=new eC;return this.prepMeshRegistryForNewObj(t),new Promise(function(l,f){try{o.load(t,function(d){var v=i.handleObjResponse(t,d);v?l(v):f("Failed to load mesh, or cancelled: ".concat(t))},function(d){i.mlogger.info(t," ","".concat(d.loaded/d.total*100,"% loaded"))},function(d){return i.mlogger.warn("Failed to load mesh: ",d,t),f("Failed to load mesh: ".concat(t))})}catch{return f("Failed to load mesh: ".concat(t))}})}},{key:"attemptToLoadGeometry",value:function(t,i){if(this._cachedAssets.has(t)){var o=this._cachedAssets.get(t),l;if(o&&i===Di.PDB){var f=new rC(t);f.parse(o,mC(t)),this.setGeometryInRegistry(t,f,i),l=f}else if(o&&i===Di.OBJ){this.prepMeshRegistryForNewObj(t);var d=new eC,v=d.parse(o);l=this.handleObjResponse(t,v)}return this._geoLoadAttempted.set(t,!0),this._cachedAssets.delete(t),l?Promise.resolve(l):Promise.reject("Tried to load from cache ".concat(t,", but something went wrong, check that the file formats provided match the displayType"))}else if(!this._registry.has(t)&&!this._geoLoadAttempted.get(t))switch(this._geoLoadAttempted.set(t,!0),i){case Di.PDB:return this.fetchPdb(t).then(function(_){return _});case Di.OBJ:return this.fetchObj(t);default:return Promise.reject(`Don't know how to load this geometry: 
                        `.concat(i,`,
                        `).concat(t))}return Promise.resolve(void 0)}},{key:"mapKeyToGeom",value:function(){var e=po(ii.mark(function i(o,l){var f=this,d,v,_,b,w;return ii.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(d=l.displayType,v=l.url,this.mlogger.debug("Geo for id ".concat(o," set to '").concat(v,"'")),!r.shouldLoadPrimitive(d,v)){R.next=8;break}return _=d,d===Di.SPHERE_GROUP?(b={mesh:new cs,cancelled:!1,instances:new KF(_)},this.setGeometryInRegistry(_,b,d)):d===Di.CUBE?(b=this.createNewCubeGeometry(_),this.setGeometryInRegistry(_,b,Di.CUBE)):(b=this.createNewSphereGeometry(_),this.setGeometryInRegistry(_,b,Di.SPHERE)),R.abrupt("return",Promise.resolve({geometry:b}));case 8:return w=Kx(v),R.abrupt("return",this.attemptToLoadGeometry(w,d).then(function(z){if(z)return{geometry:z}}).catch(function(z){var O=f.createNewSphereGeometry(w);return f.setGeometryInRegistry(w,O,Di.SPHERE),Promise.resolve({geometry:O,displayType:Di.SPHERE,errorMessage:z})}));case 10:case"end":return R.stop()}},i,this)}));function t(i,o){return e.apply(this,arguments)}return t}()}])}();ue(s_,"sphereGeometry",new Pw(1,32,32));ue(s_,"cubeGeometry",new Nm(1,1,1));ue(s_,"shouldLoadPrimitive",function(r,e){return e?!(r===Di.PDB||r===Di.OBJ):!0});function sC(r){return typeof r!="string"?r:parseInt(r.toString().replace(/^#/,"0x"),16)}function Yx(r){return typeof r=="string"?r:"#"+new Ht(r).getHexString()}var ZF=function(){function r(){Xn(this,r),ue(this,"agentTypeToColorId",void 0),ue(this,"colorsData",void 0),this.agentTypeToColorId=new Map,this.colorsData=new Float32Array(0)}return qn(r,[{key:"numberOfColors",get:function(){return this.colorsData.length/4}},{key:"makeColorDataArray",value:function(t){for(var i=t.map(sC),o=t.length,l=new Float32Array(o*4),f=0;f<o;f+=1)l[f*4+0]=((i[f]&16711680)>>16)/255,l[f*4+1]=((i[f]&65280)>>8)/255,l[f*4+2]=((i[f]&255)>>0)/255,l[f*4+3]=1;return l}},{key:"convertDataColorIndexToId",value:function(t){if(t%4!==0)return-1;var i=t/4;return i%this.numberOfColors}},{key:"getColorDataIndex",value:function(t){for(var i=this.colorsData,o=ri.map(t,function(v){return ri.round(v,6)}),l=0;l<i.length-3;l+=4){var f=l,d=[ri.round(this.colorsData[l],6),ri.round(this.colorsData[l+1],6),ri.round(this.colorsData[l+2],6),this.colorsData[l+3]];if(ri.isEqual(d,o))return f}return-1}},{key:"getColorIdForAgentType",value:function(t){var i=this.agentTypeToColorId.get(t);if(i===void 0)return-1;var o=i%this.numberOfColors;return o}},{key:"setColorForAgentType",value:function(t,i){this.agentTypeToColorId.set(t,i)}},{key:"getColorById",value:function(t){return t<0&&(t=0),t>=this.numberOfColors&&(t=t%this.numberOfColors),new Ht(this.colorsData[t*4],this.colorsData[t*4+1],this.colorsData[t*4+2])}},{key:"addNewColor",value:function(t){var i=sC(t),o=[((i&16711680)>>16)/255,((i&65280)>>8)/255,((i&255)>>0)/255,1],l=this.getColorDataIndex(o);if(l!==-1)return this.convertDataColorIndexToId(l);var f=this.colorsData.length,d=[].concat(af(this.colorsData),o),v=new Float32Array(d.length);return v.set(d),this.colorsData=v,this.convertDataColorIndexToId(f)}},{key:"getColorId",value:function(t){return this.addNewColor(t)}},{key:"updateColorArray",value:function(t){return this.colorsData=this.makeColorDataArray(t),{colorArray:this.colorsData,numberOfColors:this.numberOfColors}}},{key:"clearColorMapping",value:function(){this.agentTypeToColorId.clear()}},{key:"setColorForAgentTypes",value:function(t,i){var o=this,l=Yx(i),f=this.getColorId(l);return t.forEach(function(d){o.setColorForAgentType(d,f)}),{colorArray:this.colorsData,numberOfColors:this.numberOfColors}}},{key:"getColorInfoForAgentType",value:function(t){var i=this.getColorIdForAgentType(t),o=this.getColorById(i);return{color:o,colorId:i}}},{key:"resetDefaultColorsData",value:function(t){this.clearColorMapping(),this.updateColorArray(t)}}])}();function kb(r,e){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=JF(r))||e){t&&(r=t);var i=0,o=function(){};return{s:o,n:function(){return i>=r.length?{done:!0}:{done:!1,value:r[i++]}},e:function(_){throw _},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l,f=!0,d=!1;return{s:function(){t=t.call(r)},n:function(){var _=t.next();return f=_.done,_},e:function(_){d=!0,l=_},f:function(){try{f||t.return==null||t.return()}finally{if(d)throw l}}}}function JF(r,e){if(r){if(typeof r=="string")return oC(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?oC(r,e):void 0}}function oC(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=Array(e);t<e;t++)i[t]=r[t];return i}function aC(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,i)}return t}function Lv(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?aC(Object(t),!0).forEach(function(i){ue(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):aC(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}var QF=32,Fb=1e5,lC=new Ht(0,0,0),uC=[300,300,300],eO=10,tO=100,cC=new Ht(7237230),Za=-1,nO=10,Ob=1,Nb=1e3,hC=120,fC=.16,dC=100,pC=100,iO={visType:-1,instanceId:Za,type:-1,x:0,y:0,z:0,xrot:0,yrot:0,zrot:0,cr:0,subpoints:[]},Ka=function(r){return r[r.WEBGL1_FALLBACK=0]="WEBGL1_FALLBACK",r[r.WEBGL2_PREFERRED=1]="WEBGL2_PREFERRED",r}({});function rO(r,e){var t=[];r.traverse(function(i){i.name==e&&t.push(i)}),t.forEach(function(i){return r.remove(i)})}var ip=function(e){var t=e.x,i=e.y,o=e.z;return new be(t,i,o)},vM=function(){function r(e){Xn(this,r),ue(this,"onError",void 0),ue(this,"renderStyle",void 0),ue(this,"backgroundColor",void 0),ue(this,"pathEndColor",void 0),ue(this,"visGeomMap",void 0),ue(this,"geometryStore",void 0),ue(this,"scaleMapping",void 0),ue(this,"followObjectId",void 0),ue(this,"visAgents",void 0),ue(this,"visAgentInstances",void 0),ue(this,"availableAgentPool",[]),ue(this,"fixLightsToCamera",void 0),ue(this,"highlightedIds",void 0),ue(this,"hiddenIds",void 0),ue(this,"agentPaths",void 0),ue(this,"mlogger",void 0),ue(this,"threejsrenderer",void 0),ue(this,"scene",void 0),ue(this,"perspectiveCamera",void 0),ue(this,"orthographicCamera",void 0),ue(this,"camera",void 0),ue(this,"controls",void 0),ue(this,"dl",void 0),ue(this,"hemiLight",void 0),ue(this,"boundingBox",void 0),ue(this,"boundingBoxMesh",void 0),ue(this,"showBounds",void 0),ue(this,"tickMarksMesh",void 0),ue(this,"tickIntervalLength",void 0),ue(this,"boxNearZ",void 0),ue(this,"boxFarZ",void 0),ue(this,"colorHandler",void 0),ue(this,"renderer",void 0),ue(this,"legacyRenderer",void 0),ue(this,"currentSceneData",void 0),ue(this,"colorsData",void 0),ue(this,"lightsGroup",void 0),ue(this,"agentPathGroup",void 0),ue(this,"instancedMeshGroup",void 0),ue(this,"supportsWebGL2Rendering",void 0),ue(this,"lodBias",void 0),ue(this,"lodDistanceStops",void 0),ue(this,"needToCenterCamera",void 0),ue(this,"needToReOrientCamera",void 0),ue(this,"rotateDistance",void 0),ue(this,"initCameraPosition",void 0),ue(this,"cameraDefault",void 0),ue(this,"fibers",void 0),ue(this,"focusMode",void 0),ue(this,"gui",void 0),ue(this,"cam1",void 0),ue(this,"cam2",void 0),ue(this,"cam3",void 0),ue(this,"agentsWithPdbsToDraw",void 0),ue(this,"agentPdbsToDraw",void 0),this.cam1=ri.cloneDeep(Uc),this.cam2=ri.cloneDeep(Uc),this.cam3=ri.cloneDeep(Uc),this.renderStyle=Ka.WEBGL1_FALLBACK,this.supportsWebGL2Rendering=!1,this.visGeomMap=new Map,this.geometryStore=new s_(e),this.scaleMapping=new Map,this.followObjectId=Za,this.visAgents=[],this.visAgentInstances=new Map,this.availableAgentPool=[],this.fixLightsToCamera=!0,this.highlightedIds=[],this.hiddenIds=[],this.needToCenterCamera=!1,this.needToReOrientCamera=!1,this.rotateDistance=Xx,this.agentPaths=new Map,this.fibers=new ng,this.legacyRenderer=new uF,this.renderer=new lF,this.backgroundColor=lC,this.pathEndColor=this.backgroundColor.clone(),this.renderer.setBackgroundColor(this.backgroundColor),this.colorHandler=new ZF,this.scene=new n_,this.lightsGroup=new cu,this.lightsGroup.name="lights",this.scene.add(this.lightsGroup),this.agentPathGroup=new cu,this.agentPathGroup.name="agent paths",this.scene.add(this.agentPathGroup),this.instancedMeshGroup=new cu,this.instancedMeshGroup.name="instanced meshes for agents",this.scene.add(this.instancedMeshGroup),this.showBounds=!0,this.resetBounds(uC),this.dl=new P2(16777215,.6),this.dl.position.set(0,0,1),this.lightsGroup.add(this.dl),this.hemiLight=new T2(16777215,0,.5),this.hemiLight.color.setHSL(.095,1,.75),this.hemiLight.groundColor.setHSL(.6,1,.6),this.hemiLight.position.set(0,1,0),this.lightsGroup.add(this.hemiLight),this.mlogger=Al.get("visgeometry"),this.mlogger.setLevel(e),this.cameraDefault=ri.cloneDeep(Uc);var t=dC/pC;this.perspectiveCamera=new qu(75,t,Ob,Nb),this.orthographicCamera=new xg,this.orthographicCamera.near=Ob,this.orthographicCamera.far=Nb,this.updateOrthographicFrustum(),this.camera=this.perspectiveCamera,this.camera.position.z=Xx,this.initCameraPosition=this.camera.position.clone(),this.focusMode=!0,this.tickIntervalLength=0,this.boxNearZ=0,this.boxFarZ=100,this.currentSceneData=j0(),this.colorsData=new Float32Array(0),this.lodBias=0,this.lodDistanceStops=[100,200,400,Number.MAX_VALUE],this.agentsWithPdbsToDraw=[],this.agentPdbsToDraw=[],this.onError=ri.noop}return qn(r,[{key:"setOnErrorCallBack",value:function(t){this.onError=t}},{key:"setBackgroundColor",value:function(t){t===void 0?this.backgroundColor=lC.clone():this.backgroundColor=Array.isArray(t)?new Ht(t[0],t[1],t[2]):new Ht(t),this.pathEndColor=this.backgroundColor.clone(),this.renderer.setBackgroundColor(this.backgroundColor),this.threejsrenderer.setClearColor(this.backgroundColor,1)}},{key:"getDefaultOrbitRadius",value:function(){var t=this.cameraDefault,i=t.position,o=t.lookAtPosition,l=ip(i).distanceTo(ip(o));return this.cameraDefault.orthographic?l/this.cameraDefault.zoom:l}},{key:"updateOrthographicFrustum",value:function(){var t=this.perspectiveCamera,i=t.fov,o=t.aspect,l=i*Math.PI/360,f=this.getDefaultOrbitRadius(),d=Math.tan(l)*f,v=d*o;this.orthographicCamera.left=-v,this.orthographicCamera.right=v,this.orthographicCamera.top=d,this.orthographicCamera.bottom=-d,this.orthographicCamera.updateProjectionMatrix()}},{key:"loadCamera",value:function(t){this.perspectiveCamera.fov=t.fovDegrees,this.updateOrthographicFrustum(),this.setCameraType(t.orthographic),this.camera.position.copy(ip(t.position)),this.camera.up.copy(ip(t.upVector)),this.controls.target.copy(ip(t.lookAtPosition)),t.orthographic&&(this.orthographicCamera.zoom=t.zoom)}},{key:"storeCamera",value:function(t){var i=t||Lv(Lv({},ri.cloneDeep(Uc)),{},{orthographic:!1});return i.position=this.camera.position.clone(),i.upVector=this.camera.up.clone(),i.lookAtPosition=this.controls.target.clone(),i.fovDegrees=this.perspectiveCamera.fov,i.orthographic=!!this.camera.isOrthographicCamera,i.orthographic&&(i.zoom=this.orthographicCamera.zoom),i}},{key:"setupGui",value:function(t){var i=this;this.gui=new Dk.Pane({title:"Advanced Settings",container:t}),this.gui.registerPlugin(Ok);var o=this.gui.addFolder({title:"Camera"}),l=new Proxy(this.camera,{get:function(b,w){return i.camera[w]}});o.addInput(l,"position"),o.addInput(this.controls,"target");var f=o.addInput(this.perspectiveCamera,"fov");f.on("change",function(){return i.updateOrthographicFrustum()}),[{camera:this.cam1,label:"Cam 1"},{camera:this.cam2,label:"Cam 2"},{camera:this.cam3,label:"Cam 3"}].forEach(function(_){var b,w=_.camera,C=_.label,R=(b=i.gui)===null||b===void 0?void 0:b.addBlade({view:"buttongrid",size:[2,1],cells:function(O,P){return{title:[["Activate","Save"]][P][O]}},label:C});R.on("click",function(z){z.index[0]===0?i.loadCamera(w):z.index[0]===1&&i.storeCamera(w)})}),this.gui.addButton({title:"Export Cam"}).on("click",function(){var _=i.storeCamera(),b=document.createElement("a");b.href=URL.createObjectURL(new Blob([JSON.stringify(_,null,2)],{type:"text/plain"})),b.download="camera.json",b.click()}),this.gui.addButton({title:"Import Cam"}).on("click",function(){var _=document.createElement("input");_.type="file",_.style.display="none",_.addEventListener("change",function(b){var w=new FileReader;w.onload=function(R){var z,O=JSON.parse(R==null||(z=R.target)===null||z===void 0?void 0:z.result);i.loadCamera(O)};var C=b.target.files;C!==null&&w.readAsText(C[0])}),_.click()});var d={lodBias:this.lodBias,lod0:this.lodDistanceStops[0],lod1:this.lodDistanceStops[1],lod2:this.lodDistanceStops[2],bgcolor:{r:this.backgroundColor.r*255,g:this.backgroundColor.g*255,b:this.backgroundColor.b*255},showBounds:!0};this.gui.addInput(d,"bgcolor").on("change",function(_){i.setBackgroundColor([_.value.r/255,_.value.g/255,_.value.b/255])}),this.gui.addInput(d,"showBounds").on("change",function(_){i.setShowBounds(_.value)}),this.gui.addButton({title:"Capture Frame"}).on("click",function(){i.render(0);var _=i.threejsrenderer.domElement.toDataURL("image/png"),b=document.createElement("a");b.href=_,b.download="screenshot.png",b.click(),b.remove()}),this.gui.addSeparator();var v=this.gui.addFolder({title:"LoD",expanded:!1});v.addInput(d,"lodBias",{min:0,max:4,step:1}).on("change",function(_){i.lodBias=_.value,i.updateScene(i.currentSceneData)}),v.addInput(d,"lod0").on("change",function(_){i.lodDistanceStops[0]=_.value,i.updateScene(i.currentSceneData)}),v.addInput(d,"lod1").on("change",function(_){i.lodDistanceStops[1]=_.value,i.updateScene(i.currentSceneData)}),v.addInput(d,"lod2").on("change",function(_){i.lodDistanceStops[2]=_.value,i.updateScene(i.currentSceneData)}),this.renderer.setupGui(this.gui)}},{key:"destroyGui",value:function(){this.gui&&(this.gui.hidden=!0,this.gui.dispose(),this.gui=void 0)}},{key:"setRenderStyle",value:function(t){if(t===Ka.WEBGL2_PREFERRED&&!this.supportsWebGL2Rendering){this.logger.warn("Warning: WebGL2 rendering not supported");return}var i=this.renderStyle!==t;this.renderStyle=t,i&&this.constructInstancedFibers(),this.updateScene(this.currentSceneData)}},{key:"constructInstancedFibers",value:function(){this.fibers.clear(),rO(this.instancedMeshGroup,ng.GROUP_NAME),this.renderStyle===Ka.WEBGL2_PREFERRED&&(this.fibers=new ng),this.instancedMeshGroup.add(this.fibers.getGroup())}},{key:"logger",get:function(){return this.mlogger}},{key:"renderDom",get:function(){return this.threejsrenderer.domElement}},{key:"handleCameraData",value:function(t){t?(this.cameraDefault=Lv(Lv({},t),{},{orthographic:!1}),this.updateOrthographicFrustum(),this.updateControlsZoomBounds()):(this.logger.info("Using default camera settings since none were provided"),this.cameraDefault=ri.cloneDeep(Uc)),this.resetCamera()}},{key:"resetCamera",value:function(){this.followObjectId=Za,this.controls.reset(),this.resetCameraPosition()}},{key:"resetCameraPosition",value:function(){var t=this.cameraDefault,i=t.position,o=t.upVector,l=t.lookAtPosition,f=t.fovDegrees;this.camera.position.set(i.x,i.y,i.z),this.initCameraPosition=this.camera.position.clone();var d=ip(o).normalize();this.camera.up.copy(d);var v=ip(l);this.camera.lookAt(v),this.controls.target.copy(v),this.perspectiveCamera.fov=f,this.perspectiveCamera.updateProjectionMatrix(),this.updateOrthographicFrustum()}},{key:"centerCamera",value:function(){this.followObjectId=Za,this.needToCenterCamera=!0}},{key:"reOrientCamera",value:function(){this.followObjectId=Za,this.needToReOrientCamera=!0,this.rotateDistance=this.camera.position.distanceTo(new be)}},{key:"dolly",value:function(t){var i=this.controls,o=i.minDistance,l=i.maxDistance;if(this.camera.isOrthographicCamera){var f=this.getDefaultOrbitRadius(),d=f/this.camera.zoom+t;if(d<=o||d>=l)return;this.camera.zoom=f/d}else{var v=this.camera.position.clone(),_=this.controls.target.clone(),b=v.distanceTo(_),w=b+t;if(w<=o||w>=l)return;var C=new be().subVectors(v,_).setLength(w);this.camera.position.copy(new be().addVectors(C,_))}this.controls.update()}},{key:"zoomIn",value:function(){var t=-10;this.dolly(t)}},{key:"zoomOut",value:function(){var t=nO;this.dolly(t)}},{key:"setPanningMode",value:function(t){t?(this.controls.enablePan=!0,this.controls.enableRotate=!0,this.controls.mouseButtons={LEFT:Xu.PAN,MIDDLE:Xu.DOLLY,RIGHT:Xu.ROTATE}):(this.controls.enablePan=!0,this.controls.enableRotate=!0,this.controls.mouseButtons={LEFT:Xu.ROTATE,MIDDLE:Xu.DOLLY,RIGHT:Xu.PAN})}},{key:"setAllowViewPanning",value:function(t){this.controls.enablePan=t}},{key:"setFocusMode",value:function(t){this.focusMode=t}},{key:"getObjectData",value:function(t){if(t===Za)return r.getNullAgent();var i=this.visAgentInstances.get(t);return i?i.agentData:r.getNullAgent()}},{key:"getFollowObject",value:function(){return this.followObjectId}},{key:"setFollowObject",value:function(t){if(this.visAgentInstances.size!==0){if(this.followObjectId!==Za){var i=this.visAgentInstances.get(this.followObjectId);i?i.setFollowed(!1):console.error("NO AGENT FOR INSTANCE "+this.followObjectId)}if(this.followObjectId=t,t!==Za){var o=this.visAgentInstances.get(t);o?o.setFollowed(!0):console.error("NO AGENT FOR INSTANCE "+this.followObjectId)}this.updateScene(this.currentSceneData)}}},{key:"unfollow",value:function(){this.setFollowObject(Za)}},{key:"setVisibleByIds",value:function(t){this.hiddenIds=t,this.updateScene(this.currentSceneData)}},{key:"setHighlightByIds",value:function(t){this.highlightedIds=t,this.updateScene(this.currentSceneData)}},{key:"dehighlight",value:function(){this.setHighlightByIds([])}},{key:"getAllTypeIdsForGeometryName",value:function(t){return af(this.visGeomMap.entries()).filter(function(i){var o=i[1];return o===t}).map(function(i){var o=dm(i,1),l=o[0];return l})}},{key:"onNewRuntimeGeometryType",value:function(t,i,o){var l=this.getAllTypeIdsForGeometryName(t);if(o===void 0){console.error("Mesh name ".concat(t," not found in mesh registry"));return}for(var f=this.visAgents.length,d=0;d<Fb&&d<f;d+=1){var v=this.visAgents[d];l.includes(v.agentData.type)&&v.setColor(this.colorHandler.getColorInfoForAgentType(v.agentData.type))}this.updateScene(this.currentSceneData)}},{key:"setupControls",value:function(t){var i=this;this.controls=new gk(this.camera,this.threejsrenderer.domElement),this.controls.addEventListener("change",function(){i.gui&&i.gui.refresh()}),this.controls.zoomSpeed=1,this.updateControlsZoomBounds(),this.setPanningMode(!1),this.controls.saveState(),t&&this.disableControls(),t||(this.threejsrenderer.domElement.onmouseenter=function(){return i.enableControls()},this.threejsrenderer.domElement.onmouseleave=function(){return i.disableControls()})}},{key:"updateControlsZoomBounds",value:function(){var t=this.getDefaultOrbitRadius();this.controls.minDistance=t/hC,this.controls.maxDistance=t/fC,this.controls.maxZoom=hC,this.controls.minZoom=fC}},{key:"resize",value:function(t,i){t=Math.max(t,2),i=Math.max(i,2),this.perspectiveCamera.aspect=t/i,this.perspectiveCamera.updateProjectionMatrix(),this.updateOrthographicFrustum(),this.threejsrenderer.setSize(t,i),this.renderer.resize(t,i)}},{key:"setCameraType",value:function(t){var i=t?this.orthographicCamera:this.perspectiveCamera;if(i!==this.camera){var o=this.getDefaultOrbitRadius(),l=this.camera.position.clone().sub(this.controls.target),f=new Wx().setFromVector3(l),d=1;t?(d=o/f.radius,f.radius=o):f.radius=o/this.camera.zoom,i.position.setFromSpherical(f).add(this.controls.target),i.up.copy(this.camera.up),i.zoom=d,this.controls.object=i,this.controls.update(),this.camera=i}}},{key:"createWebGL",value:function(){if(NP.isWebGL2Available()===!1)this.renderStyle=Ka.WEBGL1_FALLBACK,this.supportsWebGL2Rendering=!1,this.threejsrenderer=new UE({premultipliedAlpha:!1});else{this.renderStyle=Ka.WEBGL2_PREFERRED,this.supportsWebGL2Rendering=!0;var t=document.createElement("canvas"),i=t.getContext("webgl2",{alpha:!1}),o={canvas:t,context:i,premultipliedAlpha:!1};this.threejsrenderer=new UE(o)}return this.constructInstancedFibers(),this.threejsrenderer.setSize(dC,pC),this.threejsrenderer.setClearColor(this.backgroundColor,1),this.threejsrenderer.clear(),this.threejsrenderer}},{key:"setCanvasOnTheDom",value:function(t,i){t===void 0||t==null||t["data-has-simularium-viewer-canvas"]||(this.threejsrenderer=this.createWebGL(),t.appendChild(this.threejsrenderer.domElement),t["data-has-simularium-viewer-canvas"]=!0,this.setupControls(i),this.resize(Number(t.dataset.width),Number(t.dataset.height)),this.threejsrenderer.setClearColor(this.backgroundColor,1),this.threejsrenderer.clear(),this.threejsrenderer.domElement.setAttribute("style","top: 0px; left: 0px"))}},{key:"toggleControls",value:function(t){t?this.disableControls():this.enableControls()}},{key:"disableControls",value:function(){this.controls.enabled=!1}},{key:"enableControls",value:function(){this.controls.enabled=!0}},{key:"setPdbLods",value:function(){this.geometryStore.forEachPDB(function(w){w.beginUpdate()});for(var t=new be,i=0;i<this.agentsWithPdbsToDraw.length;++i){var o=this.agentsWithPdbsToDraw[i],l=o.agentData,f=this.agentPdbsToDraw[i];t.set(l.x,l.y,l.z);for(var d=this.camera.position.distanceTo(t),v=0;v<this.lodDistanceStops.length;++v)if(d<this.lodDistanceStops[v]){var _=v+this.lodBias,b=f.getLOD(_);b.addInstance(l.x,l.y,l.z,1,l.xrot,l.yrot,l.zrot,o.agentData.instanceId,o.signedTypeId(),.25+_*.25);break}}this.geometryStore.forEachPDB(function(w){w.endUpdate()})}},{key:"render",value:function(t){if(this.visAgents.length===0){this.threejsrenderer.clear();return}this.controls.update(),this.animateCamera(),this.camera.updateMatrixWorld(),this.transformBoundingBox(),this.camera.near=Math.max(this.boxNearZ*.66,Ob),this.camera.far=Math.min(this.boxFarZ*1.33,Nb),this.camera.updateProjectionMatrix(),this.dl&&this.fixLightsToCamera&&this.dl.position.setFromMatrixColumn(this.camera.matrixWorld,2),this.hemiLight&&this.fixLightsToCamera&&this.hemiLight.position.setFromMatrixColumn(this.camera.matrixWorld,1);for(var i=this.instancedMeshGroup.children.length-1;i>=0;i--)this.instancedMeshGroup.remove(this.instancedMeshGroup.children[i]);if(this.instancedMeshGroup.add(this.fibers.getGroup()),this.renderStyle===Ka.WEBGL1_FALLBACK)this.threejsrenderer.render(this.scene,this.camera);else{this.setPdbLods(),this.scene.updateMatrixWorld(),this.scene.matrixAutoUpdate=!1;var o=[],l=kb(this.geometryStore.registry.values()),f;try{for(l.s();!(f=l.n()).done;){var d=f.value,v=d.displayType;if(v!==Di.PDB){var _=d;_.geometry.instances.instanceCount()>0&&(o.push(_.geometry.instances),this.instancedMeshGroup.add(_.geometry.instances.getMesh()))}else for(var b=d,w=0;w<b.geometry.numLODs();++w){var C=b.geometry.getLOD(w);C.instanceCount()>0&&(o.push(C),this.instancedMeshGroup.add(C.getMesh()))}}}catch(O){l.e(O)}finally{l.f()}this.renderer.setMeshGroups(this.instancedMeshGroup,this.fibers,o),this.renderer.setFollowedInstance(this.followObjectId);var R=new be;this.boundingBox.getSize(R);var z=Math.max(R.x,R.y,R.z);this.renderer.setNearFar(this.boxNearZ,this.boxFarZ,z,this.camera.zoom),this.boundingBoxMesh.visible=!1,this.tickMarksMesh.visible=!1,this.agentPathGroup.visible=!1,this.renderer.render(this.threejsrenderer,this.scene,this.camera,null),this.boundingBoxMesh.visible=this.showBounds,this.tickMarksMesh.visible=this.showBounds,this.agentPathGroup.visible=!0,this.threejsrenderer.autoClear=!1,this.instancedMeshGroup.visible=!1,this.threejsrenderer.render(this.scene,this.camera),this.instancedMeshGroup.visible=!0,this.threejsrenderer.autoClear=!0,this.scene.matrixAutoUpdate=!0}}},{key:"transformBoundingBox",value:function(){var t=new Eh().copy(this.boundingBox);t.applyMatrix4(this.camera.matrixWorldInverse),this.boxNearZ=-t.max.z,this.boxFarZ=-t.min.z}},{key:"hitTest",value:function(t,i){var o=new At;if(this.threejsrenderer.getSize(o),this.renderStyle===Ka.WEBGL1_FALLBACK){var l=new At(t/o.x*2-1,-(i/o.y)*2+1);return this.legacyRenderer.hitTest(l,this.camera)}else return this.renderer.hitTest(this.threejsrenderer,t,o.y-i)}},{key:"setAgentColors",value:function(){var t=this;this.visAgents.forEach(function(i){i.setColor(t.colorHandler.getColorInfoForAgentType(i.agentData.type))})}},{key:"createMaterials",value:function(t){var i=this.colorHandler.updateColorArray(t);this.renderer.updateColors(i.numberOfColors,i.colorArray),this.setAgentColors()}},{key:"applyColorToAgents",value:function(t){var i=this;t.forEach(function(o){var l=i.colorHandler.setColorForAgentTypes(o.agentIds,o.color);i.renderer.updateColors(l.numberOfColors,l.colorArray)}),this.updateScene(this.currentSceneData)}},{key:"resetMapping",value:function(){this.resetAllGeometry(),this.visGeomMap.clear(),this.geometryStore.reset(),this.scaleMapping.clear()}},{key:"getGeoForAgentType",value:function(t){var i=this.visGeomMap.get(t);return i?this.geometryStore.getGeoForAgentType(i):(this.logger.error("not in visGeomMap",t),null)}},{key:"handleAgentGeometry",value:function(t){this.clearForNewTrajectory(),this.setGeometryData(t)}},{key:"setGeometryData",value:function(t){var i=this;this.logger.info("Received type mapping data: ",t),Object.keys(t).forEach(function(o){var l=t[o],f=l.geometry,d=f.url,v=f.displayType,_=d?Kx(d):v;i.visGeomMap.set(Number(o),_),i.geometryStore.mapKeyToGeom(Number(o),l.geometry).then(function(b){if(b){var w=b.displayType,C=b.geometry,R=b.errorMessage,z=w||v;if(i.onNewRuntimeGeometryType(_,z,C),z===Di.PDB&&C){var O=C;return O.generateLOD().then(function(){i.logger.info("Finished loading pdb LODs: ",_),i.onNewRuntimeGeometryType(_,z,C)})}R&&(i.onError(new el(R,Tl.WARNING)),i.logger.info(R))}}).catch(function(b){i.onError(new el(b)),i.logger.info(b)})}),this.updateScene(this.currentSceneData)}},{key:"setTickIntervalLength",value:function(t){var i=t/eO;this.tickIntervalLength=i}},{key:"createTickMarks",value:function(t,i){var o=dm(i,6),l=o[0],f=o[1],d=o[2],v=o[3],_=o[4],b=o[5],w=Math.max.apply(Math,af(t));this.setTickIntervalLength(w);for(var C=w/tO,R=new is,z=[],O=l;O<=v;)z.push(O,f,d+C,O,f,d-C,O,f,b+C,O,f,b-C,O,_,d+C,O,_,d-C,O,_,b+C,O,_,b-C),O+=this.tickIntervalLength;for(var P=f;P<=_;)z.push(l+C,P,d,l-C,P,d,l+C,P,b,l-C,P,b,v+C,P,d,v-C,P,d,v+C,P,b,v-C,P,b),P+=this.tickIntervalLength;for(var M=d;M<=b;)z.push(l,f+C,M,l,f-C,M,l,_+C,M,l,_-C,M,v,f+C,M,v,f-C,M,v,_+C,M,v,_-C,M),M+=this.tickIntervalLength;var U=new Float32Array(z);R.setAttribute("position",new ns(U,3));var L=new _p({color:cC});this.tickMarksMesh=new dg(R,L),this.tickMarksMesh.visible=this.showBounds}},{key:"createBoundingBox",value:function(t){var i=dm(t,6),o=i[0],l=i[1],f=i[2],d=i[3],v=i[4],_=i[5];this.boundingBox=new Eh(new be(o,l,f),new be(d,v,_)),this.boundingBoxMesh=new D2(this.boundingBox,cC),this.boundingBoxMesh.visible=this.showBounds}},{key:"resetBounds",value:function(t){this.scene.remove(this.boundingBoxMesh,this.tickMarksMesh),t||(this.logger.warn("Invalid volume dimensions received: ".concat(t,"; using defaults.")),t=uC);var i=t,o=dm(i,3),l=o[0],f=o[1],d=o[2],v=[-l/2,-f/2,-d/2,l/2,f/2,d/2];this.createBoundingBox(v),this.createTickMarks(t,v),this.scene.add(this.boundingBoxMesh,this.tickMarksMesh),this.controls&&(this.controls.maxDistance=this.boundingBox.max.distanceTo(this.boundingBox.min)*1.414)}},{key:"setScaleForId",value:function(t,i){this.logger.debug("Scale for id ",t," set to ",i),this.scaleMapping.set(t,i)}},{key:"getScaleForId",value:function(t){if(this.scaleMapping.has(t)){var i=this.scaleMapping.get(t);if(i)return i}return 1}},{key:"createAgent",value:function(){var t=this.visAgents.length,i=new kw("Agent_".concat(t));return this.visAgents.push(i),i}},{key:"addPdbToDrawList",value:function(t,i,o){this.renderStyle===Ka.WEBGL1_FALLBACK?this.legacyRenderer.addPdb(o,i,this.colorHandler.getColorInfoForAgentType(t).color,this.lodDistanceStops):o&&o.numLODs()>0&&(this.agentsWithPdbsToDraw.push(i),this.agentPdbsToDraw.push(o))}},{key:"addMeshToDrawList",value:function(t,i,o,l){var f=l.cr?l.cr:1,d=this.getScaleForId(t),v=o.mesh;v||console.warn("MeshEntry is present but mesh unavailable. Not rendering agent."),this.renderStyle===Ka.WEBGL1_FALLBACK?this.legacyRenderer.addMesh(v.geometry,i,f*d,this.colorHandler.getColorInfoForAgentType(t).color):o&&o.instances&&o.instances.addInstance(l.x,l.y,l.z,f*d,l.xrot,l.yrot,l.zrot,i.agentData.instanceId,i.signedTypeId(),1,l.subpoints)}},{key:"addFiberToDrawList",value:function(t,i,o){i.updateFiber(o.subpoints);var l=this.getScaleForId(t);this.renderStyle===Ka.WEBGL1_FALLBACK?this.legacyRenderer.addFiber(i,o.cr*l,this.colorHandler.getColorInfoForAgentType(t).color):this.fibers.addInstance(o.subpoints.length/3,o.subpoints,o.x,o.y,o.z,o.cr*l*.5,o.xrot,o.yrot,o.zrot,i.agentData.instanceId,i.signedTypeId())}},{key:"updateScene",value:function(t){this.currentSceneData=t;var i=new Float32Array(t.data),o=t.agentCount,l=0,f=0,d=0,v=0,_=0,b=0;this.legacyRenderer.beginUpdate(this.scene),this.fibers.beginUpdate(),this.geometryStore.forEachMesh(function(Ie){Ie.geometry.instances.beginUpdate()}),this.agentsWithPdbsToDraw=[],this.agentPdbsToDraw=[];for(var w=0;w<Fb&&w<this.visAgents.length;w++)this.visAgents[w].hideAndDeactivate();for(var C=Fw,R=new Map,z=0;z<o;z++){var O=sO(i,C),P=O.visType,M=O.instanceId,U=O.type;v=O.x,_=O.y,b=O.z;var L=this.visAgentInstances.get(M),B=this.findPathForAgent(M);B&&L&&(v=L.agentData.x,_=L.agentData.y,b=L.agentData.z),L||(this.availableAgentPool.length>0?L=this.availableAgentPool.pop():L=this.createAgent(),L.agentData.instanceId=M,this.visAgentInstances.set(M,L),L.hidden=!0),L.agentData.instanceId!==M&&this.logger.warn("incoming instance id ".concat(M," mismatched with visagent ").concat(L.agentData.instanceId)),L.active=!0,L.agentData=O;var $=this.highlightedIds.includes(L.agentData.type);L.setHighlighted($);var X=this.hiddenIds.includes(L.agentData.type);if(L.setHidden(X),L.hidden){C=Ub(i,C);continue}if(L.setColor(this.colorHandler.getColorInfoForAgentType(U)),P===fu.ID_VIS_TYPE_DEFAULT){var Q=this.getGeoForAgentType(U);if(!Q){this.logger.warn("No mesh nor pdb available for ".concat(U,"? Should be unreachable code")),C=Ub(i,C);continue}var te=Q.geometry,V=Q.displayType;if(te&&V===Di.PDB){var H=te;this.addPdbToDrawList(U,L,H)}else{var J=te;this.addMeshToDrawList(U,L,J,O)}l=O.x-v,f=O.y-_,d=O.z-b,B&&this.addPointToPath(B,O.x,O.y,O.z,l,f,d)}else P===fu.ID_VIS_TYPE_FIBER&&this.addFiberToDrawList(U,L,O);R.set(M,L),C=Ub(i,C)}var ce=kb(this.visAgentInstances),he;try{for(ce.s();!(he=ce.n()).done;){var ge=dm(he.value,2),Ae=ge[0],me=ge[1];R.has(Ae)||(me.resetAgent(),this.availableAgentPool.push(me))}}catch(Ie){ce.e(Ie)}finally{ce.f()}this.visAgentInstances=R,this.fibers.endUpdate(),this.geometryStore.forEachMesh(function(Ie){Ie.geometry.instances.endUpdate()}),this.legacyRenderer.endUpdate(this.scene)}},{key:"animateCamera",value:function(){var t=.2,i=.002,o=.01;if(this.followObjectId!==Za&&this.focusMode){var l=new be().subVectors(this.camera.position,this.controls.target),f=l.length();l.normalize();var d=this.visAgentInstances.get(this.followObjectId);if(!d)return;var v=d.getFollowPosition();this.controls.target.lerp(v,t);var _=new be;_.subVectors(v,l.multiplyScalar(-f)),this.camera.position.lerp(_,t)}else if(this.needToCenterCamera)this.controls.target.lerp(new be,t),this.controls.target.distanceTo(new be)<i&&(this.controls.target.copy(new be),this.needToCenterCamera=!1);else if(this.needToReOrientCamera){this.controls.target.copy(new be);var b=this.camera.position,w=this.rotateDistance,C=this.initCameraPosition.clone().setLength(w),R=b.clone(),z=new Zu().setFromAxisAngle(C,0),O=new Zu().copy(this.camera.quaternion),P=O.angleTo(z),M=t*P,U=R.clone().cross(C).normalize();this.camera.position.applyAxisAngle(U,M),this.camera.lookAt(new be),this.camera.position.angleTo(C)<o&&(this.needToReOrientCamera=!1)}}},{key:"findPathForAgent",value:function(t){var i=this.agentPaths.get(t);return i||null}},{key:"addPathForAgent",value:function(t,i,o){var l=this.findPathForAgent(t);if(l)return l.show(!0),l;if(i||(i=QF),!o){var f=this.visAgentInstances.get(t);f?o=f.color.clone():this.visAgentInstances.size>0&&console.error("COULD NOT FIND AGENT INSTANCE "+t)}var d=new Uk(o,i);return this.agentPathGroup.add(d.line),this.agentPaths.set(t,d),d}},{key:"removePathForAgent",value:function(t){this.agentPaths.delete(t)||this.logger.warn("attempted to remove path for agent "+t+" that doesn't exist.")}},{key:"removeAllPaths",value:function(){this.agentPaths.clear()}},{key:"addPointToPath",value:function(t,i,o,l,f,d,v){if(!(i===f&&o===d&&l===v)){var _=new be;this.boundingBox.getSize(_),(Math.abs(f)>_.x/2||Math.abs(d)>_.y/2||Math.abs(v)>_.z/2)&&(f=0,d=0,v=0),t.addPointToPath(i,o,l,f,d,v,this.pathEndColor)}}},{key:"setShowPaths",value:function(t){this.agentPaths.forEach(function(i){i.show(t)})}},{key:"toggleAllAgentsHidden",value:function(t){for(var i=this.visAgents.length,o=0;o<Fb&&o<i;o+=1){var l=this.visAgents[o];l.active&&l.setHidden(t)}}},{key:"setShowBounds",value:function(t){this.showBounds=t}},{key:"showPathForAgent",value:function(t,i){var o=this.findPathForAgent(t);o&&o.show(i)}},{key:"clearForNewTrajectory",value:function(){this.legacyRenderer.beginUpdate(this.scene),this.legacyRenderer.endUpdate(this.scene),this.resetMapping(),this.visAgentInstances.clear(),this.visAgents=[],this.currentSceneData=j0(),this.dehighlight()}},{key:"resetAllGeometry",value:function(){this.geometryStore.cancelAll(),this.unfollow(),this.removeAllPaths(),this.legacyRenderer.beginUpdate(this.scene),this.legacyRenderer.endUpdate(this.scene);for(var t=this.instancedMeshGroup.children.length-1;t>=0;t--)this.instancedMeshGroup.remove(this.instancedMeshGroup.children[t]);this.constructInstancedFibers();var i=kb(this.visAgentInstances.values()),o;try{for(i.s();!(o=i.n()).done;){var l=o.value;l.resetMesh()}}catch(f){i.e(f)}finally{i.f()}}},{key:"update",value:function(t){this.updateScene(t)}}],[{key:"getNullAgent",value:function(){return Lv({},iO)}}])}(),ig=function(e,t,i){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.01,l=i*o;return e-l>t?1:e+l<t?-1:0},Kx=function(e){var t=/(https?:\/\/)([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)/g;if(t.test(e)){var i=e;return i.includes("dropbox")&&(i=i.replace("www.dropbox.com","dl.dropboxusercontent.com")),i}else if(/\B\//g.test(e))return e;return"/".concat(e)};function mC(r){return r.substring(r.lastIndexOf(".")+1,r.length)||r}function vC(r){return RS.isBinarySimulariumFile(r).then(function(e){return e?r.arrayBuffer():r.text()}).then(function(e){return typeof e=="string"?new MP(JSON.parse(e)):new RS(e)})}var j0=function(){return{data:new ArrayBuffer(0),frameNumber:-1,time:-1,agentCount:-1,size:-1}},sO=function(e,t){if(t+ju.length>e.length)throw new el("Invalid offset: Not enough data in the buffer for agent data.");for(var i=vM.getNullAgent(),o=0;o<ju.length;o++)i[ju[o]]=e[t+o];var l=i.nSubPoints,f=t+ju.length,d=f+l;if(d>e.length)throw new el("Invalid offset: Not enough data in the buffer for subpoints.");return i.subpoints=Array.from(e.subarray(t+ju.length,t+ju.length+l)),i},Ub=function(e,t){var i=e[t+ju.length-1];return t+ju.length+i},hp=ju.length;function oO(r){for(var e=r.bundleData[0],t=af(e.data),i=t[ju.indexOf("nSubPoints")],o=hp+i,l=aO(e.data),f=new ArrayBuffer(l),d=new Float32Array(f),v=0,_=0,b=t.slice(_,_+o);b.length;){var w=Fw+_,C=_;if(b.length<o)throw new el("Your data is malformed, there are too few entries. Found ".concat(b.length," entries, expected ").concat(o,"."),Tl.ERROR);v++;var R=e.data.slice(C,C+hp);if(d.set(R,w),C+=hp,w+=hp,C+i>e.data.length)throw new el("Your data is malformed, there are too few entries. Found ".concat(e.data.length,", expected ").concat(C+i,"."),Tl.ERROR);var z=e.data.slice(C,C+i);d.set(z,w),C+=i,w+=i,_+=o,i=t[_+ju.indexOf("nSubPoints")],o=hp+i,b=t.slice(_,_+o)}d[0]=e.frameNumber,d[1]=e.time,d[2]=v;var O=d.buffer,P={data:O,frameNumber:e.frameNumber,time:e.time,agentCount:v,size:l};return P}function aO(r){for(var e=Fw*4,t=0;t<r.length;){e+=hp*4;var i=r[t+ju.indexOf("nSubPoints")];e+=i*4,t+=hp+i}return e}var lO=function(){function r(e){Xn(this,r),ue(this,"head",void 0),ue(this,"tail",void 0),ue(this,"numFrames",void 0),ue(this,"size",void 0),ue(this,"_maxSize",void 0),ue(this,"_cacheEnabled",void 0),this.head=null,this.tail=null,this.numFrames=0,this.size=0,this._maxSize=1/0,this._cacheEnabled=!0,e&&this.changeSettings(e)}return qn(r,[{key:"changeSettings",value:function(t){var i=t.maxSize,o=t.cacheEnabled;o!==void 0&&(this._cacheEnabled=o),i!==void 0&&(this._maxSize=i)}},{key:"maxSize",get:function(){return this._maxSize}},{key:"cacheEnabled",get:function(){return this._cacheEnabled}},{key:"cacheSizeLimited",get:function(){return this._maxSize!==1/0}},{key:"hasFrames",value:function(){return this.numFrames>0&&this.head!==null&&this.tail!==null}},{key:"findInLinkedList",value:function(t,i){for(var o=i||this.head;o;){if(t(o))return o;o=o.next}}},{key:"containsTime",value:function(t){return ig(t,this.getFirstFrameTime(),.1)===-1||ig(t,this.getLastFrameTime(),.1)===1||t<this.getFirstFrameTime()||t>this.getLastFrameTime()?!1:!!this.findInLinkedList(function(i){return i.data.time===t})}},{key:"containsFrameAtFrameNumber",value:function(t){return t<this.getFirstFrameNumber()||t>this.getLastFrameNumber()?!1:!!this.findInLinkedList(function(i){return i.data.frameNumber===t})}},{key:"getFirstFrame",value:function(){var t;return(t=this.head)===null||t===void 0?void 0:t.data}},{key:"getFirstFrameNumber",value:function(){var t;return((t=this.head)===null||t===void 0?void 0:t.data.frameNumber)||-1}},{key:"getFirstFrameTime",value:function(){var t;return((t=this.head)===null||t===void 0?void 0:t.data.time)||-1}},{key:"getLastFrame",value:function(){var t;return(t=this.tail)===null||t===void 0?void 0:t.data}},{key:"getLastFrameNumber",value:function(){var t;return((t=this.tail)===null||t===void 0?void 0:t.data.frameNumber)||-1}},{key:"getLastFrameTime",value:function(){var t;return((t=this.tail)===null||t===void 0?void 0:t.data.time)||-1}},{key:"getFrameAtCondition",value:function(t){if(this.head){var i=this.findInLinkedList(t);if(i)return i.data}}},{key:"getFrameAtTime",value:function(t){var i=this.getFrameAtCondition(function(o){return ig(o.data.time,t,0)===0});return i||void 0}},{key:"getFrameAtFrameNumber",value:function(t){var i=this.getFrameAtCondition(function(o){return o.data.frameNumber===t});return i||void 0}},{key:"assignSingleFrameToCache",value:function(t){var i={data:t,next:null,prev:null};this.head=i,this.tail=i,this.size=t.size,this.numFrames=1}},{key:"addFrameToEndOfCache",value:function(t){var i={data:t,next:null,prev:null};if(!this.hasFrames()){this.assignSingleFrameToCache(t);return}this.tail&&(i.prev=this.tail,this.tail.next=i,this.tail=i,this.numFrames++,this.size+=t.size,this.size>this._maxSize&&this.trimCache())}},{key:"addFrame",value:function(t){if(this.size+t.size>this._maxSize&&this.trimCache(t.size),this.hasFrames()&&this._cacheEnabled){this.addFrameToEndOfCache(t);return}this.assignSingleFrameToCache(t)}},{key:"removeNode",value:function(t){if(!(this.numFrames===0||!this.head||!this.tail)){if(this.numFrames===1&&this.head===this.tail){this.clear();return}t===this.head&&t.next!==null?(this.head=t.next,this.head.prev=null):t===this.tail&&t.prev!==null?(this.tail=t.prev,this.tail.next=null):t.prev!==null&&t.next!==null&&(t.prev.next=t.next,t.next.prev=t.prev),this.numFrames--,this.size-=t.data.size}}},{key:"trimCache",value:function(t){for(;this.hasFrames()&&this.size+(t||0)>this._maxSize&&this.head!==null;)this.removeNode(this.head)}},{key:"clear",value:function(){this.head=null,this.tail=null,this.numFrames=0,this.size=0}}])}(),uO=function(){function r(){Xn(this,r),ue(this,"frameCache",void 0),ue(this,"frameToWaitFor",void 0),ue(this,"lockedForFrame",void 0),ue(this,"currentFrameNumber",void 0),ue(this,"timeStepSize",void 0),ue(this,"onError",void 0),this.currentFrameNumber=-1,this.frameCache=new lO,this.frameToWaitFor=0,this.lockedForFrame=!1,this.timeStepSize=0,this.onError=ri.noop}return qn(r,[{key:"setOnError",value:function(t){this.onError=t}},{key:"currentFrameData",get:function(){if(!this.frameCache.hasFrames())return j0();if(this.currentFrameNumber<0){var t=this.frameCache.getFirstFrame();if(t)return this.currentFrameNumber=t.frameNumber,t}else{var i=this.frameCache.getFrameAtFrameNumber(this.currentFrameNumber);if(i!==void 0)return i}return j0()}},{key:"hasLocalCacheForTime",value:function(t){return this.frameCache.containsTime(t)}},{key:"gotoTime",value:function(t){var i,o=(i=this.frameCache.getFrameAtTime(t))===null||i===void 0?void 0:i.frameNumber;o!==void 0&&(this.currentFrameNumber=o)}},{key:"atLatestFrame",value:function(){return this.currentFrameNumber>=this.frameCache.getLastFrameNumber()}},{key:"gotoNextFrame",value:function(){this.atLatestFrame()||(this.currentFrameNumber+=1)}},{key:"WaitForFrame",value:function(t){this.frameToWaitFor=t,this.lockedForFrame=!0}},{key:"clearCache",value:function(){this.frameCache.clear(),this.currentFrameNumber=-1,this.frameToWaitFor=0,this.lockedForFrame=!1}},{key:"clearForNewTrajectory",value:function(){this.clearCache()}},{key:"parseAgentsFromVisDataMessage",value:function(t){var i=t;if(this.lockedForFrame===!0){if(i.bundleData[0].frameNumber!==this.frameToWaitFor)return;this.lockedForFrame=!1,this.frameToWaitFor=0}var o=oO(i);if(this.frameCache.cacheSizeLimited&&o.size>this.frameCache.maxSize){this.frameExceedsCacheSizeError(o.size);return}this.addFrameToCache(o)}},{key:"parseAgentsFromFrameData",value:function(t){if(t instanceof ArrayBuffer){var i=r.parseOneBinaryFrame(t);i.frameNumber===0&&this.clearCache(),this.addFrameToCache(i);return}this.parseAgentsFromVisDataMessage(t)}},{key:"parseAgentsFromNetData",value:function(t){if(t instanceof ArrayBuffer){var i=new Float32Array(t),o=Math.ceil(i[1]/4),l=(2+o)*4;t=t.slice(l)}this.parseAgentsFromFrameData(t)}},{key:"addFrameToCache",value:function(t){if(this.frameCache.cacheSizeLimited&&t.size>this.frameCache.maxSize){this.frameExceedsCacheSizeError(t.size);return}this.frameCache.addFrame(t)}},{key:"frameExceedsCacheSizeError",value:function(t){this.onError(new el("Frame size exceeds cache size: ".concat(t," > ").concat(this.frameCache.maxSize),Tl.ERROR))}}],[{key:"parseOneBinaryFrame",value:function(t){var i=new Float32Array(t),o=new Uint32Array(t),l={data:t,frameNumber:i[0],time:i[1],agentCount:o[2],size:0},f=Object.keys(l).length-1;return l.size=t.byteLength+f*zk,l}}])}(),cO=function(){function r(){Xn(this,r),ue(this,"entries",void 0),this.entries=new Map}return qn(r,[{key:"containsName",value:function(t){return this.entries.hasOwnProperty(t)}},{key:"containsTag",value:function(t){return Object.values(this.entries).some(function(i){return i.some(function(o){return o.tags.includes(t)})})}},{key:"parse",value:function(t){var i=this;if(this.clear(),!t)throw new Error("Trajectory is missing agent type mapping information.");Object.keys(t).forEach(function(o){if(isNaN(parseInt(o)))throw new Error("Agent ids should be integers, ".concat(o," is not"));if(!t[o].name)throw new Error("Missing agent name for agent ".concat(o));var l="";t[o].geometry&&(l=t[o].geometry.color),i.decode(t[o].name,l,parseInt(o))})}},{key:"decode",value:function(t,i,o){var l="",f=[],d=o!==void 0?o:-1;if(t.includes("#")){var v=t.split("#");f=v[1].split("_"),l=v[0]}else l=t;if(!l)throw new Error("invalid name. Agent id: ".concat(d,", name: ").concat(t));var _=af(new Set(f)),b={id:d,name:l,tags:_,color:i};this.containsName(l)||(this.entries[l]=[]),this.entries[l].push(b)}},{key:"getUnmodifiedStateId",value:function(t){var i=this.entries[t];if(!i)return null;var o=i.find(function(l){return l.tags.length===0});return o?o.id:null}},{key:"getColorsForName",value:function(t){var i=this.entries[t],o=[];return i?(i.forEach(function(l){l.id>=0&&o.push(l.color)}),o):[]}},{key:"getIds",value:function(t,i){var o=this.entries[t],l=[];return o?(o.forEach(function(f){(!i||i.length===0||i.some(function(d){return f.tags.includes(d)}))&&f.id>=0&&l.push(f.id),i&&i.includes("")&&f.tags.length===0&&f.id>=0&&l.push(f.id)}),l):[]}},{key:"getIdsByTags",value:function(t){var i=this,o=[];return Object.keys(this.entries).forEach(function(l){o=o.concat(i.getIds(l,t))}),o.sort(function(l,f){return l-f}),o}},{key:"getTags",value:function(t,i){var o=this.entries[t];if(!o)return[];var l=ri.find(o,function(f){return f.id===i});return l?l.tags:[]}},{key:"getAgentIdsByNamesAndTags",value:function(t){var i=this,o=[];return t.forEach(function(l){var f=l.name,d=l.tags;o=[].concat(af(o),af(i.getIds(f,d)))}),o}},{key:"getHighlightedIds",value:function(t){var i=t.highlightedAgents;return this.getAgentIdsByNamesAndTags(i)}},{key:"getHiddenIds",value:function(t){var i=t.hiddenAgents;return this.getAgentIdsByNamesAndTags(i)}},{key:"clear",value:function(){this.entries=new Map}},{key:"getParentColor",value:function(t){var i=ri.filter(ri.uniq(ri.map(this.entries[t],"color"))),o=i.length===1?i[0]:"";return o}},{key:"getUIDisplayData",value:function(){var t=this;return Object.keys(this.entries).map(function(i){var o=[],l=[],f=Object.keys(t.entries[i]).length>1;t.entries[i].forEach(function(v){!v.tags.length&&f&&o.push({name:"<unmodified>",id:"",color:v.color}),v.tags.forEach(function(_){if(!l.includes(_)){l.push(_);var b={name:_,id:_,color:v.color};o.push(b)}})});var d=t.getParentColor(i);return{name:i,displayStates:o,color:d}})}},{key:"updateUiDataColor",value:function(t,i,o){var l=Yx(o),f=this.entries[t];f.forEach(function(d){i.includes(d.id)&&(d.color=l)})}},{key:"setInitialAgentColors",value:function(t,i,o){var l=this,f=0,d=[];return t.forEach(function(v){var _=f,b=l.getIds(v.name),w=l.getColorsForName(v.name),C=ri.filter(w).length>0,R=ri.uniq(w).length===1;C?w.forEach(function(z,O){var P=f;z?(P=i.indexOf(z),P===-1&&(i=[].concat(af(i),[z]),P=i.length-1)):l.updateUiDataColor(v.name,[b[O]],i[_]),R?_=P:_=-1,d.push({agentIds:[b[O]],color:i[P]})}):(d.push({agentIds:b,color:i[f]}),l.updateUiDataColor(v.name,b,i[f])),_>-1?v.color=Yx(i[_]):v.color="",(ri.filter(w).length!==b.length||_===f)&&f++}),o(d),i}}])}(),li=function(r){return r[r.ID_UNDEFINED_WEB_REQUEST=0]="ID_UNDEFINED_WEB_REQUEST",r[r.ID_VIS_DATA_ARRIVE=1]="ID_VIS_DATA_ARRIVE",r[r.ID_VIS_DATA_REQUEST=2]="ID_VIS_DATA_REQUEST",r[r.ID_VIS_DATA_FINISH=3]="ID_VIS_DATA_FINISH",r[r.ID_VIS_DATA_PAUSE=4]="ID_VIS_DATA_PAUSE",r[r.ID_VIS_DATA_RESUME=5]="ID_VIS_DATA_RESUME",r[r.ID_VIS_DATA_ABORT=6]="ID_VIS_DATA_ABORT",r[r.ID_UPDATE_TIME_STEP=7]="ID_UPDATE_TIME_STEP",r[r.ID_UPDATE_RATE_PARAM=8]="ID_UPDATE_RATE_PARAM",r[r.ID_MODEL_DEFINITION=9]="ID_MODEL_DEFINITION",r[r.ID_HEARTBEAT_PING=10]="ID_HEARTBEAT_PING",r[r.ID_HEARTBEAT_PONG=11]="ID_HEARTBEAT_PONG",r[r.ID_TRAJECTORY_FILE_INFO=12]="ID_TRAJECTORY_FILE_INFO",r[r.ID_GOTO_SIMULATION_TIME=13]="ID_GOTO_SIMULATION_TIME",r[r.ID_INIT_TRAJECTORY_FILE=14]="ID_INIT_TRAJECTORY_FILE",r[r.ID_UPDATE_SIMULATION_STATE=15]="ID_UPDATE_SIMULATION_STATE",r[r.LENGTH=16]="LENGTH",r}({}),gC=function(r){return r[r.ID_LIVE_SIMULATION=0]="ID_LIVE_SIMULATION",r[r.ID_PRE_RUN_SIMULATION=1]="ID_PRE_RUN_SIMULATION",r[r.ID_TRAJECTORY_FILE_PLAYBACK=2]="ID_TRAJECTORY_FILE_PLAYBACK",r[r.LENGTH=3]="LENGTH",r}({}),x0={exports:{}},hO=x0.exports,_C;function fO(){return _C||(_C=1,(function(){var r,e={}.hasOwnProperty,t=function(i,o){for(var l in o)e.call(o,l)&&(i[l]=o[l]);function f(){this.constructor=i}return f.prototype=o.prototype,i.prototype=new f,i.__super__=o.prototype,i};r=function(){var i,o,l;o=Math.log,l=Math.round,o(10),i={base:1e3,minor:!1,shift:null,above:{1:"da",2:"h",3:"k",6:"M",9:"G",12:"T",15:"P",18:"E",21:"Z",24:"Y"},below:{1:"d",2:"c",3:"m",6:"mc",9:"n",12:"p",15:"f",18:"a",21:"z",24:"y"}};function f(d){var v;(d??(d={})).__proto__=i,v=3,d.minor&&(v=!1,Object.hasOwnProperty(d,"base")||(d.base=10)),Object.defineProperty(this,"base",{value:d.base}),d.above&&this.build(d.above,v,d.shift),d.below&&this.build(d.below,v,d.shift,-1),this[0+d.shift]=""}return f.prototype.build=function(d,v,_,b){var w,C,R;b==null&&(b=1),R=[];for(w in d)C=d[w],w=parseInt(w),v&&(w/=v),!(w<1)&&(_&&(w+=_*b),R.push(this[l(w*b)]=C));return R},f}(),r.Binary=function(i){var o;t(l,i),o={3:"Ki",6:"Mi",9:"Gi",12:"Ti",15:"Pi",18:"Ei",21:"Zi",24:"Yi"};function l(){l.__super__.constructor.call(this,{base:1024,above:o,below:!1})}return l}(r),r.Mass=function(i){t(o,i);function o(){o.__super__.constructor.call(this,{shift:-1})}return o}(r),x0.exports=r}).call(hO)),x0.exports}var w0={exports:{}},dO=w0.exports,yC;function pO(){return yC||(yC=1,(function(){w0.exports=function(){var r,e,t,i,o,l,f;r=Math.abs,e=Math.floor,t=Math.log,i=Math.max,o=Math.pow,l=function(v){return parseFloat(v.toFixed(12))},f=function(v,_){return v-_};function d(v,_){this.si=v,this.unit=_,this.baseln=t(this.si.base),this.limit=Object.keys(this.si).sort(f).shift()}return d.prototype.format=function(v,_){return _==null&&(_=""),this.convert(v).join(_)},d.prototype.suffix=function(v){return this.convert(v)[1]},d.prototype.convert=function(v){var _,b;if(!(v&&isFinite(v)))return[v,this.si[0]+this.unit];for(b=v/(v=r(v)),_=i(this.limit,e(t(v)/this.baseln));!(_ in this.si)&&_>this.limit;)_--;return v=l(b*v/o(this.si.base,_)),[v,this.si[_]+this.unit]},d}()}).call(dO)),w0.exports}var Bb,bC;function mO(){if(bC)return Bb;bC=1;var r=fO(),e=pO(),t=new r,i={metre:new e(t,"m"),kilogram:new e(new r.Mass,"g"),second:new e(t,"s"),ampere:new e(t,"A"),kelvin:new e(t,"K"),mole:new e(t,"mol"),candela:new e(t,"cd"),byte:new e(new r.Binary,"B"),litre:new e(t,"l")};return i.byte.decimal=new e(new r({below:!1}),"B"),i.meter=i.metre,i.liter=i.litre,i.Scale=r,i.Unit=e,Bb=i,Bb}var vO=mO();function xC(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,i)}return t}function wm(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?xC(Object(t),!0).forEach(function(i){ue(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):xC(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}var zb=3,gO="Invalid version number in TrajectoryFileInfo:",_O=function(e,t){return t?"Missing typeMapping[".concat(e,"].geometry.displayType, so we couldn't request ").concat(t,". Geometry will default to spheres"):"No typeMapping[".concat(e,"].geometry.displayType. Geometry will default to spheres")},yO=function(e,t){return"DisplayType was ".concat(t," but missing typeMapping[").concat(e,"].geometry.url, so we couldn't request the file. Geometry will default to spheres")},bO=function(e,t){return ri.mapValues(e,function(i,o){var l={};if(i.geometry){var f=i.geometry.url||"",d=i.geometry.displayType;if(d){if(!f&&(d===Di.PDB||d===Di.OBJ)){var _=yO(o,d);t?t(new el(_,Tl.WARNING)):console.log(_),d=Di.SPHERE}}else{var v=_O(o,f);t?t(new el(v,Tl.WARNING)):console.log(v),f="",d=Di.SPHERE}l=wm(wm({},i.geometry),{},{displayType:d,url:f,color:i.geometry.color||""})}else l={displayType:"SPHERE",url:"",color:""};return wm(wm({},i),{},{geometry:l})})},xO=function(e,t){var i=wm(wm({},e),{},{typeMapping:bO(e.typeMapping,t),version:zb});switch(e.version){case zb:break;case 2:break;case 1:var o=e,l=vO.meter.convert(o.spatialUnitFactorMeters),f=l[0],d=l[1].replace("mc","");i={connId:o.connId,msgType:o.msgType,size:o.size,spatialUnits:{magnitude:f,name:d},timeUnits:{magnitude:1,name:"s"},cameraDefault:nM,timeStepSize:o.timeStepSize,totalSteps:o.totalSteps,typeMapping:i.typeMapping,version:zb},console.warn("Using default camera settings since none were provided");break;default:throw new RangeError(gO+e.version)}return i},wO=Object.defineProperty,wC=Object.getOwnPropertySymbols,SO=Object.prototype.hasOwnProperty,EO=Object.prototype.propertyIsEnumerable,vf=Math.pow,SC=(r,e,t)=>e in r?wO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,CO=(r,e)=>{for(var t in e||(e={}))SO.call(e,t)&&SC(r,t,e[t]);if(wC)for(var t of wC(e))EO.call(e,t)&&SC(r,t,e[t]);return r},Ow=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)},vt=(r,e,t)=>(Ow(r,e,"read from private field"),t?t.call(r):e.get(r)),Li=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},Cl=(r,e,t,i)=>(Ow(r,e,"write to private field"),e.set(r,t),t),Er=(r,e,t)=>(Ow(r,e,"access private method"),t),Ni=new Uint8Array(8),pf=new DataView(Ni.buffer),Wu=r=>[(r%256+256)%256],rr=r=>(pf.setUint16(0,r,!1),[Ni[0],Ni[1]]),TO=r=>(pf.setInt16(0,r,!1),[Ni[0],Ni[1]]),gM=r=>(pf.setUint32(0,r,!1),[Ni[1],Ni[2],Ni[3]]),En=r=>(pf.setUint32(0,r,!1),[Ni[0],Ni[1],Ni[2],Ni[3]]),MO=r=>(pf.setUint32(0,Math.floor(r/vf(2,32)),!1),pf.setUint32(4,r,!1),[Ni[0],Ni[1],Ni[2],Ni[3],Ni[4],Ni[5],Ni[6],Ni[7]]),Nw=r=>(pf.setInt16(0,vf(2,8)*r,!1),[Ni[0],Ni[1]]),xh=r=>(pf.setInt32(0,vf(2,16)*r,!1),[Ni[0],Ni[1],Ni[2],Ni[3]]),Vb=r=>(pf.setInt32(0,vf(2,30)*r,!1),[Ni[0],Ni[1],Ni[2],Ni[3]]),yh=(r,e=!1)=>{let t=Array(r.length).fill(null).map((i,o)=>r.charCodeAt(o));return e&&t.push(0),t},wp=r=>r&&r[r.length-1],pg=(r,e,t=!0)=>{let i=r*e;return t?Math.round(i):i},_M=r=>{let e=r*(Math.PI/180),t=Math.cos(e),i=Math.sin(e);return[t,i,0,-i,t,0,0,0,1]},AO=_M(0),yM=r=>[xh(r[0]),xh(r[1]),Vb(r[2]),xh(r[3]),xh(r[4]),Vb(r[5]),xh(r[6]),xh(r[7]),Vb(r[8])],ya=(r,e,t)=>({type:r,contents:e&&new Uint8Array(e.flat(10)),children:t}),ba=(r,e,t,i,o)=>ya(r,[Wu(e),gM(t),i??[]],o),PO=r=>r?ya("ftyp",[yh("isom"),En(0),yh("iso4"),yh("hvc1")]):ya("ftyp",[yh("isom"),En(0),yh("isom"),yh("avc1"),yh("mp41")]),RO=()=>({type:"mdat",largeSize:!0}),IO=(r,e)=>ya("moov",null,[DO(e,r),...r.map(t=>LO(t,e))]),DO=(r,e)=>{let t=pg(Math.max(0,...e.filter(o=>o.samples.length>0).map(o=>wp(o.samples).timestamp+wp(o.samples).duration)),Qx),i=Math.max(...e.map(o=>o.id))+1;return ba("mvhd",0,0,[En(r),En(r),En(Qx),En(t),xh(1),Nw(1),Array(10).fill(0),yM(AO),Array(24).fill(0),En(i)])},LO=(r,e)=>ya("trak",null,[kO(r,e),FO(r,e)]),kO=(r,e)=>{let t=wp(r.samples),i=pg(t?t.timestamp+t.duration:0,Qx);return ba("tkhd",0,3,[En(e),En(e),En(r.id),En(0),En(i),Array(8).fill(0),rr(0),rr(0),Nw(r.info.type==="audio"?1:0),rr(0),yM(_M(r.info.type==="video"?r.info.rotation:0)),xh(r.info.type==="video"?r.info.width:0),xh(r.info.type==="video"?r.info.height:0)])},FO=(r,e)=>ya("mdia",null,[OO(r,e),NO(r.info.type==="video"?"vide":"soun"),UO(r)]),OO=(r,e)=>{let t=wp(r.samples),i=pg(t?t.timestamp+t.duration:0,r.timescale);return ba("mdhd",0,0,[En(e),En(e),En(r.timescale),En(i),rr(21956),rr(0)])},NO=r=>ba("hdlr",0,0,[yh("mhlr"),yh(r),En(0),En(0),En(0),yh("mp4-muxer-hdlr")]),UO=r=>ya("minf",null,[r.info.type==="video"?BO():zO(),VO(),WO(r)]),BO=()=>ba("vmhd",0,1,[rr(0),rr(0),rr(0),rr(0)]),zO=()=>ba("smhd",0,0,[rr(0),rr(0)]),VO=()=>ya("dinf",null,[GO()]),GO=()=>ba("dref",0,0,[En(1)],[HO()]),HO=()=>ba("url ",0,1),WO=r=>ya("stbl",null,[jO(r),eN(r),tN(r),nN(r),iN(r),rN(r)]),jO=r=>ba("stsd",0,0,[En(1)],[r.info.type==="video"?XO(sN[r.info.codec],r):ZO(aN[r.info.codec],r)]),XO=(r,e)=>ya(r,[Array(6).fill(0),rr(1),rr(0),rr(0),Array(12).fill(0),rr(e.info.width),rr(e.info.height),En(4718592),En(4718592),En(0),rr(1),Array(32).fill(0),rr(24),TO(65535)],[oN[e.info.codec](e)]),qO=r=>r.codecPrivate&&ya("avcC",[...r.codecPrivate]),$O=r=>r.codecPrivate&&ya("hvcC",[...r.codecPrivate]),YO=r=>r.codecPrivate&&ya("vpcC",[...r.codecPrivate]),KO=r=>r.codecPrivate&&ya("av1C",[...r.codecPrivate]),ZO=(r,e)=>ya(r,[Array(6).fill(0),rr(1),rr(0),rr(0),En(0),rr(e.info.numberOfChannels),rr(16),rr(0),rr(0),xh(e.info.sampleRate)],[lN[e.info.codec](e)]),JO=r=>ba("esds",0,0,[En(58753152),Wu(32+r.codecPrivate.byteLength),rr(1),Wu(0),En(75530368),Wu(18+r.codecPrivate.byteLength),Wu(64),Wu(21),gM(0),En(130071),En(130071),En(92307584),Wu(r.codecPrivate.byteLength),...r.codecPrivate,En(109084800),Wu(1),Wu(2)]),QO=r=>ya("dOps",[Wu(0),Wu(r.info.numberOfChannels),rr(3840),En(r.info.sampleRate),Nw(0),Wu(0)]),eN=r=>ba("stts",0,0,[En(r.timeToSampleTable.length),r.timeToSampleTable.map(e=>[En(e.sampleCount),En(e.sampleDelta)])]),tN=r=>{if(r.samples.every(t=>t.type==="key"))return null;let e=[...r.samples.entries()].filter(([,t])=>t.type==="key");return ba("stss",0,0,[En(e.length),e.map(([t])=>En(t+1))])},nN=r=>ba("stsc",0,0,[En(r.compactlyCodedChunkTable.length),r.compactlyCodedChunkTable.map(e=>[En(e.firstChunk),En(e.samplesPerChunk),En(1)])]),iN=r=>ba("stsz",0,0,[En(0),En(r.samples.length),r.samples.map(e=>En(e.size))]),rN=r=>r.writtenChunks.length>0&&wp(r.writtenChunks).offset>=vf(2,32)?ba("co64",0,0,[En(r.writtenChunks.length),r.writtenChunks.map(e=>MO(e.offset))]):ba("stco",0,0,[En(r.writtenChunks.length),r.writtenChunks.map(e=>En(e.offset))]),sN={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},oN={avc:qO,hevc:$O,vp9:YO,av1:KO},aN={aac:"mp4a",opus:"opus"},lN={aac:JO,opus:QO},bM=class{constructor(){this.buffer=null}},xM=class{constructor(r,e,t){this.onData=r,this.onDone=e,this.options=t}},uN=class{constructor(r,e){this.stream=r,this.options=e}},op,vm,Uw=class{constructor(){this.pos=0,Li(this,op,new Uint8Array(8)),Li(this,vm,new DataView(vt(this,op).buffer)),this.offsets=new WeakMap}seek(r){this.pos=r}writeU32(r){vt(this,vm).setUint32(0,r,!1),this.write(vt(this,op).subarray(0,4))}writeU64(r){vt(this,vm).setUint32(0,Math.floor(r/vf(2,32)),!1),vt(this,vm).setUint32(4,r,!1),this.write(vt(this,op).subarray(0,8))}writeAscii(r){for(let e=0;e<r.length;e++)vt(this,vm).setUint8(e%8,r.charCodeAt(e)),e%8===7&&this.write(vt(this,op));r.length%8!==0&&this.write(vt(this,op).subarray(0,r.length%8))}writeBox(r){var e,t;if(this.offsets.set(r,this.pos),r.contents&&!r.children)this.writeBoxHeader(r,(e=r.size)!=null?e:r.contents.byteLength+8),this.write(r.contents);else{let i=this.pos;if(this.writeBoxHeader(r,0),r.contents&&this.write(r.contents),r.children)for(let f of r.children)f&&this.writeBox(f);let o=this.pos,l=(t=r.size)!=null?t:o-i;this.seek(i),this.writeBoxHeader(r,l),this.seek(o)}}writeBoxHeader(r,e){this.writeU32(r.largeSize?1:e),this.writeAscii(r.type),r.largeSize&&this.writeU64(e)}patchBox(r){let e=this.pos;this.seek(this.offsets.get(r)),this.writeBox(r),this.seek(e)}};op=new WeakMap;vm=new WeakMap;var S0,yp,mg,E0,Zx,cN=class extends Uw{constructor(r){super(),Li(this,E0),Li(this,S0,void 0),Li(this,yp,new ArrayBuffer(vf(2,16))),Li(this,mg,new Uint8Array(vt(this,yp))),Cl(this,S0,r)}write(r){Er(this,E0,Zx).call(this,this.pos+r.byteLength),vt(this,mg).set(r,this.pos),this.pos+=r.byteLength}finalize(){Er(this,E0,Zx).call(this,this.pos),vt(this,S0).buffer=vt(this,yp).slice(0,this.pos)}};S0=new WeakMap;yp=new WeakMap;mg=new WeakMap;E0=new WeakSet;Zx=function(r){let e=vt(this,yp).byteLength;for(;e<r;)e*=2;if(e===vt(this,yp).byteLength)return;let t=new ArrayBuffer(e),i=new Uint8Array(t);i.set(vt(this,mg),0),Cl(this,yp,t),Cl(this,mg,i)};var Yv,ap,wM=class extends Uw{constructor(r){super(),Li(this,Yv,void 0),Li(this,ap,[]),Cl(this,Yv,r)}write(r){vt(this,ap).push({data:r.slice(),start:this.pos}),this.pos+=r.byteLength}flush(){if(vt(this,ap).length===0)return;let r=[],e=[...vt(this,ap)].sort((t,i)=>t.start-i.start);r.push({start:e[0].start,size:e[0].data.byteLength});for(let t=1;t<e.length;t++){let i=r[r.length-1],o=e[t];o.start<=i.start+i.size?i.size=Math.max(i.size,o.start+o.data.byteLength-i.start):r.push({start:o.start,size:o.data.byteLength})}for(let t of r){t.data=new Uint8Array(t.size);for(let i of vt(this,ap))t.start<=i.start&&i.start<t.start+t.size&&t.data.set(i.data,i.start-t.start);vt(this,Yv).onData(t.data,t.start)}vt(this,ap).length=0}finalize(){var r,e;(e=(r=vt(this,Yv)).onDone)==null||e.call(r)}};Yv=new WeakMap;ap=new WeakMap;var hN=vf(2,24),fN=2,rg,zc,uu,X0,Jx,Bw,SM,zw,EM,sg,q0,CM=class extends Uw{constructor(r){var e,t;if(super(),Li(this,X0),Li(this,Bw),Li(this,zw),Li(this,sg),Li(this,rg,void 0),Li(this,zc,void 0),Li(this,uu,[]),Cl(this,rg,r),Cl(this,zc,(t=(e=r.options)==null?void 0:e.chunkSize)!=null?t:hN),!Number.isInteger(vt(this,zc))||vt(this,zc)<vf(2,10))throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(r){Er(this,X0,Jx).call(this,r,this.pos),Er(this,sg,q0).call(this),this.pos+=r.byteLength}finalize(){var r,e;Er(this,sg,q0).call(this,!0),(e=(r=vt(this,rg)).onDone)==null||e.call(r)}};rg=new WeakMap;zc=new WeakMap;uu=new WeakMap;X0=new WeakSet;Jx=function(r,e){let t=vt(this,uu).findIndex(d=>d.start<=e&&e<d.start+vt(this,zc));t===-1&&(t=Er(this,zw,EM).call(this,e));let i=vt(this,uu)[t],o=e-i.start,l=r.subarray(0,Math.min(vt(this,zc)-o,r.byteLength));i.data.set(l,o);let f={start:o,end:o+l.byteLength};if(Er(this,Bw,SM).call(this,i,f),i.written[0].start===0&&i.written[0].end===vt(this,zc)&&(i.shouldFlush=!0),vt(this,uu).length>fN){for(let d=0;d<vt(this,uu).length-1;d++)vt(this,uu)[d].shouldFlush=!0;Er(this,sg,q0).call(this)}l.byteLength<r.byteLength&&Er(this,X0,Jx).call(this,r.subarray(l.byteLength),e+l.byteLength)};Bw=new WeakSet;SM=function(r,e){let t=0,i=r.written.length-1,o=-1;for(;t<=i;){let l=Math.floor(t+(i-t+1)/2);r.written[l].start<=e.start?(t=l+1,o=l):i=l-1}for(r.written.splice(o+1,0,e),(o===-1||r.written[o].end<e.start)&&o++;o<r.written.length-1&&r.written[o].end>=r.written[o+1].start;)r.written[o].end=Math.max(r.written[o].end,r.written[o+1].end),r.written.splice(o+1,1)};zw=new WeakSet;EM=function(r){let t={start:Math.floor(r/vt(this,zc))*vt(this,zc),data:new Uint8Array(vt(this,zc)),written:[],shouldFlush:!1};return vt(this,uu).push(t),vt(this,uu).sort((i,o)=>i.start-o.start),vt(this,uu).indexOf(t)};sg=new WeakSet;q0=function(r=!1){for(let e=0;e<vt(this,uu).length;e++){let t=vt(this,uu)[e];if(!(!t.shouldFlush&&!r)){for(let i of t.written)vt(this,rg).onData(t.data.subarray(i.start,i.end),t.start+i.start);vt(this,uu).splice(e--,1)}}};var dN=class extends CM{constructor(r){var e;super(new xM((t,i)=>r.stream.write({type:"write",data:t,position:i}),void 0,{chunkSize:(e=r.options)==null?void 0:e.chunkSize}))}},Qx=1e3,pN=["avc","hevc","vp9","av1"],mN=["aac","opus"],vN=2082844800,gN=.5,_N=["strict","offset"],us,_a,gp,fp,dp,ew,$0,tw,TM,nw,MM,iw,AM,Vw,PM,C0,rw,Gw,RM,og,Y0,vg,o_,T0,sw,yN=class{constructor(r){Li(this,tw),Li(this,nw),Li(this,iw),Li(this,Vw),Li(this,C0),Li(this,Gw),Li(this,og),Li(this,vg),Li(this,T0),Li(this,us,void 0),Li(this,_a,void 0),Li(this,gp,void 0),Li(this,fp,null),Li(this,dp,null),Li(this,ew,Math.floor(Date.now()/1e3)+vN),Li(this,$0,!1);var e;if(Er(this,tw,TM).call(this,r),this.target=r.target,Cl(this,us,CO({firstTimestampBehavior:"strict"},r)),r.target instanceof bM)Cl(this,_a,new cN(r.target));else if(r.target instanceof xM)Cl(this,_a,(e=r.target.options)!=null&&e.chunked?new CM(r.target):new wM(r.target));else if(r.target instanceof uN)Cl(this,_a,new dN(r.target));else throw new Error(`Invalid target: ${r.target}`);Er(this,nw,MM).call(this),Er(this,iw,AM).call(this)}addVideoChunk(r,e,t){let i=new Uint8Array(r.byteLength);r.copyTo(i),this.addVideoChunkRaw(i,r.type,t??r.timestamp,r.duration,e)}addVideoChunkRaw(r,e,t,i,o){if(Er(this,T0,sw).call(this),!vt(this,us).video)throw new Error("No video track declared.");Er(this,C0,rw).call(this,vt(this,fp),r,e,t,i,o)}addAudioChunk(r,e,t){let i=new Uint8Array(r.byteLength);r.copyTo(i),this.addAudioChunkRaw(i,r.type,t??r.timestamp,r.duration,e)}addAudioChunkRaw(r,e,t,i,o){if(Er(this,T0,sw).call(this),!vt(this,us).audio)throw new Error("No audio track declared.");Er(this,C0,rw).call(this,vt(this,dp),r,e,t,i,o)}finalize(){vt(this,fp)&&Er(this,og,Y0).call(this,vt(this,fp)),vt(this,dp)&&Er(this,og,Y0).call(this,vt(this,dp));let r=vt(this,_a).offsets.get(vt(this,gp)),e=vt(this,_a).pos-r;vt(this,gp).size=e,vt(this,_a).patchBox(vt(this,gp));let t=IO([vt(this,fp),vt(this,dp)].filter(Boolean),vt(this,ew));vt(this,_a).writeBox(t),Er(this,vg,o_).call(this),vt(this,_a).finalize(),Cl(this,$0,!0)}};us=new WeakMap;_a=new WeakMap;gp=new WeakMap;fp=new WeakMap;dp=new WeakMap;ew=new WeakMap;$0=new WeakMap;tw=new WeakSet;TM=function(r){if(r.video){if(!pN.includes(r.video.codec))throw new Error(`Unsupported video codec: ${r.video.codec}`);if(r.video.rotation!==void 0&&![0,90,180,270].includes(r.video.rotation))throw new Error(`Invalid video rotation: ${r.video.rotation}. Has to be 0, 90, 180 or 270.`)}if(r.audio&&!mN.includes(r.audio.codec))throw new Error(`Unsupported audio codec: ${r.audio.codec}`);if(r.firstTimestampBehavior&&!_N.includes(r.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${r.firstTimestampBehavior}`)};nw=new WeakSet;MM=function(){var r;let e=((r=vt(this,us).video)==null?void 0:r.codec)==="hevc";vt(this,_a).writeBox(PO(e)),Cl(this,gp,RO()),vt(this,_a).writeBox(vt(this,gp)),Er(this,vg,o_).call(this)};iw=new WeakSet;AM=function(){var r;if(vt(this,us).video&&Cl(this,fp,{id:1,info:{type:"video",codec:vt(this,us).video.codec,width:vt(this,us).video.width,height:vt(this,us).video.height,rotation:(r=vt(this,us).video.rotation)!=null?r:0},timescale:720,codecPrivate:new Uint8Array(0),samples:[],writtenChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),vt(this,us).audio){let e=Er(this,Vw,PM).call(this,2,vt(this,us).audio.sampleRate,vt(this,us).audio.numberOfChannels);Cl(this,dp,{id:vt(this,us).video?2:1,info:{type:"audio",codec:vt(this,us).audio.codec,numberOfChannels:vt(this,us).audio.numberOfChannels,sampleRate:vt(this,us).audio.sampleRate},timescale:vt(this,us).audio.sampleRate,codecPrivate:e,samples:[],writtenChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}};Vw=new WeakSet;PM=function(r,e,t){let o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(e),l=t,f="";f+=r.toString(2).padStart(5,"0"),f+=o.toString(2).padStart(4,"0"),o===15&&(f+=e.toString(2).padStart(24,"0")),f+=l.toString(2).padStart(4,"0");let d=Math.ceil(f.length/8)*8;f=f.padEnd(d,"0");let v=new Uint8Array(f.length/8);for(let _=0;_<f.length;_+=8)v[_/8]=parseInt(f.slice(_,_+8),2);return v};C0=new WeakSet;rw=function(r,e,t,i,o,l){var f;let d=i/1e6,v=o/1e6;if(r.firstTimestamp===void 0&&(r.firstTimestamp=d),d=Er(this,Gw,RM).call(this,d,r),r.lastTimestamp=d,(!r.currentChunk||d-r.currentChunk.startTimestamp>=gN)&&(r.currentChunk&&Er(this,og,Y0).call(this,r),r.currentChunk={startTimestamp:d,sampleData:[],sampleCount:0}),r.currentChunk.sampleData.push(e),r.currentChunk.sampleCount++,(f=l==null?void 0:l.decoderConfig)!=null&&f.description&&(r.codecPrivate=new Uint8Array(l.decoderConfig.description)),r.samples.push({timestamp:d,duration:v,size:e.byteLength,type:t}),r.lastTimescaleUnits!==null){let _=pg(d,r.timescale,!1),b=Math.round(_-r.lastTimescaleUnits);r.lastTimescaleUnits+=b;let w=wp(r.timeToSampleTable);w.sampleCount===1?(w.sampleDelta=b,w.sampleCount++):w.sampleDelta===b?w.sampleCount++:(w.sampleCount--,r.timeToSampleTable.push({sampleCount:2,sampleDelta:b}))}else r.lastTimescaleUnits=0,r.timeToSampleTable.push({sampleCount:1,sampleDelta:pg(v,r.timescale)})};Gw=new WeakSet;RM=function(r,e){if(vt(this,us).firstTimestampBehavior==="strict"&&e.lastTimestamp===-1&&r!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${r}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(vt(this,us).firstTimestampBehavior==="offset"&&(r-=e.firstTimestamp),r<e.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${e.lastTimestamp*1e6} to ${r*1e6}).`);return r};og=new WeakSet;Y0=function(r){if(r.currentChunk){r.currentChunk.offset=vt(this,_a).pos;for(let e of r.currentChunk.sampleData)vt(this,_a).write(e);r.currentChunk.sampleData=null,(r.compactlyCodedChunkTable.length===0||wp(r.compactlyCodedChunkTable).samplesPerChunk!==r.currentChunk.sampleCount)&&r.compactlyCodedChunkTable.push({firstChunk:r.writtenChunks.length+1,samplesPerChunk:r.currentChunk.sampleCount}),r.writtenChunks.push(r.currentChunk),Er(this,vg,o_).call(this)}};vg=new WeakSet;o_=function(){vt(this,_a)instanceof wM&&vt(this,_a).flush()};T0=new WeakSet;sw=function(){if(vt(this,$0))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};var bN=function(){function r(e,t){Xn(this,r),ue(this,"getCanvas",void 0),ue(this,"handleFile",void 0),ue(this,"encoder",void 0),ue(this,"muxer",void 0),ue(this,"isRecording",void 0),ue(this,"frameIndex",void 0),ue(this,"supportedBrowser",void 0),ue(this,"frameRate",void 0),this.getCanvas=e,this.handleFile=t,this.encoder=null,this.isRecording=!1,this.frameIndex=0,this.supportedBrowser="VideoEncoder"in window,this.frameRate=iM}return qn(r,[{key:"setup",value:function(){var e=po(ii.mark(function i(){var o=this,l,f,d,v,_,b,w;return ii.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(this.supportedBrowser){R.next=2;break}throw new Error("Browser does not support video recording");case 2:if(l=this.getCanvas(),!l){R.next=26;break}return f=Math.ceil(l.width/2)*2,d=Math.ceil(l.height/2)*2,R.prev=6,this.encoder=new VideoEncoder({output:function(O,P){if(o.isRecording&&o.muxer){var M;(M=o.muxer)===null||M===void 0||M.addVideoChunk(O,P)}},error:function(O){throw new Error("Encoder error: "+O)}}),v={codec:"avc1.640028",width:f,height:d,framerate:this.frameRate,bitrate:25e6,latencyMode:"realtime"},R.next=11,VideoEncoder.isConfigSupported(v);case 11:if(_=R.sent,b=_.supported,w=_.config,!(b&&w)){R.next=18;break}this.encoder.configure(v),R.next=19;break;case 18:throw new Error("Unsupported video encoder configuration");case 19:this.muxer=new yN({target:new bM,video:{codec:"avc",width:l.width,height:l.height}}),this.frameIndex=0,R.next=26;break;case 23:throw R.prev=23,R.t0=R.catch(6),new Error("Error setting up video encoder: "+R.t0);case 26:case"end":return R.stop()}},i,this,[[6,23]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"start",value:function(){var e=po(ii.mark(function i(){return ii.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.isRecording){l.next=11;break}return l.prev=1,l.next=4,this.setup();case 4:this.isRecording=!0,l.next=11;break;case 7:return l.prev=7,l.t0=l.catch(1),console.log("setup failed",l.t0),l.abrupt("return");case 11:case"end":return l.stop()}},i,this,[[1,7]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"stop",value:function(){var e=po(ii.mark(function i(){return ii.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!this.isRecording){l.next=4;break}return this.isRecording=!1,l.next=4,this.onCompletedRecording();case 4:case"end":return l.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"onFrame",value:function(){if(this.isRecording&&this.encoder){if(this.encoder.encodeQueueSize>2){console.log("Dropping frame, too many frames in flight");return}var t=this.getCanvas();if(t){var i=this.frameIndex%this.frameRate===0,o=this.frameIndex/this.frameRate*1e6,l=1e6/this.frameRate,f=new VideoFrame(t,{timestamp:o,duration:l});this.encoder.encode(f,{keyFrame:i}),f.close()}this.frameIndex+=1}}},{key:"onCompletedRecording",value:function(){var e=po(ii.mark(function i(){var o,l;return ii.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.encoder){d.next=2;break}throw new Error("No encoder found to convert video");case 2:return d.next=4,this.encoder.flush();case 4:if(this.muxer){d.next=6;break}throw new Error("No muxer found to convert video.");case 6:this.muxer.finalize(),o=this.muxer.target.buffer,l=new Blob([o],{type:"video/mp4"}),this.handleFile(l);case 10:case"end":return d.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()}])}();function xN(r,e,t){return e=bp(e),qC(r,IM()?Reflect.construct(e,t||[],bp(r).constructor):e.apply(r,t))}function IM(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(IM=function(){return!!r})()}var wN={renderStyle:Ka.WEBGL2_PREFERRED,backgroundColor:[0,0,0],height:800,width:800,loadInitialData:!0,hideAllAgents:!1,showPaths:!0,showBounds:!0,lockedCamera:!1,disableCache:!1,agentColors:[6996453,16720384,15628647,16737792,14241097,16755200,16763904,52479,43775,8407283,521452,7978383,8913151,11141375,13369599,16711884,16711850,16711816,16711782,16711748,16711714,16711680,13434624,11206400,8978176,65484,6749952,4521728,2293504,65450,65416,65450,65535,26367]},SN=300,EC=1e-4,DM=function(r){function e(t){var i;Xn(this,e),i=xN(this,e,[t]),ue(i,"visGeometry",void 0),ue(i,"selectionInterface",void 0),ue(i,"recorder",void 0),ue(i,"lastRenderTime",void 0),ue(i,"startTime",void 0),ue(i,"vdomRef",void 0),ue(i,"handlers",void 0),ue(i,"hit",void 0),ue(i,"animationRequestID",void 0),ue(i,"lastRenderedAgentTime",void 0),ue(i,"stats",void 0),ue(i,"isClick",function(l){var f=i.state.lastClick,d=Date.now()-f.time;return!(d>SN||Math.abs(l.x-f.x)>EC||Math.abs(l.y-f.y)>EC)}),ue(i,"handleTouchStart",function(l){var f=l,d=f.touches[0];i.setState({lastClick:{x:d.pageX,y:d.pageY,time:Date.now()}})}),ue(i,"handleKeyDown",function(l){if(l.target===i.vdomRef.current){var f=l;if(f.code==="Digit1"&&f.altKey&&f.ctrlKey){var d=i.state.showRenderParamsGUI;i.setState({showRenderParamsGUI:!d})}}}),ue(i,"handleTouchEnd",function(l){var f=l,d=f.changedTouches[0],v={x:d.pageX,y:d.pageY,time:Date.now()};if(i.isClick(v)){var _=i.vdomRef.current;if(!_)return;var b=_.getBoundingClientRect(),w=d.clientX-b.left,C=d.clientY-b.top;i.onPickObject(w,C)}}),ue(i,"handleClickStart",function(l){var f=l;i.setState({lastClick:{x:f.x,y:f.y,time:Date.now()}})}),ue(i,"handlePointerDown",function(l){var f=l;i.setState({lastClick:{x:f.x,y:f.y,time:Date.now()}})}),ue(i,"handleMouseUp",function(l){var f=l,d={x:f.x,y:f.y,time:Date.now()};i.isClick(d)&&i.onPickObject(f.offsetX,f.offsetY)}),ue(i,"handlePointerUp",function(l){var f=l,d={x:f.x,y:f.y,time:Date.now()};i.isClick(d)&&i.onPickObject(f.offsetX,f.offsetY)}),ue(i,"handleMouseMove",function(l){var f=l;if(i.vdomRef.current){var d=i.visGeometry.hitTest(f.offsetX,f.offsetY);d!==Za?i.props.lockedCamera||(i.vdomRef.current.style.cursor="pointer"):i.vdomRef.current.style.cursor="default"}});var o=t.loggerLevel==="debug"?Al.DEBUG:Al.OFF;return i.animate=i.animate.bind(i),i.dispatchUpdatedTime=i.dispatchUpdatedTime.bind(i),i.handleTimeChange=i.handleTimeChange.bind(i),i.visGeometry=new vM(o),i.props.simulariumController.visData.frameCache.changeSettings({cacheEnabled:!t.disableCache,maxSize:t.maxCacheSize}),t.onError&&i.props.simulariumController.visData.setOnError(t.onError),i.props.simulariumController.visData.clearCache(),i.visGeometry.createMaterials(t.agentColors),i.vdomRef=ts.createRef(),i.lastRenderTime=Date.now(),i.startTime=Date.now(),i.onPickObject=i.onPickObject.bind(i),i.stats=new Zv,i.stats.showPanel(1),i.handlers={touchstart:i.handleTouchStart,touchend:i.handleTouchEnd,mousedown:i.handleClickStart,mouseup:i.handleMouseUp,pointerdown:i.handlePointerDown,pointerup:i.handlePointerUp,mousemove:i.handleMouseMove},i.hit=!1,i.animationRequestID=0,i.lastRenderedAgentTime=-1,i.selectionInterface=new cO,i.state={lastClick:{x:0,y:0,time:0},showRenderParamsGUI:!1},i.props.onRecordedMovie===void 0?i.recorder=null:i.recorder=new bN(function(){return i.visGeometry.renderDom},i.props.onRecordedMovie),i}return $C(e,r),qn(e,[{key:"onTrajectoryFileInfo",value:function(i){var o=this.props,l=o.simulariumController,f=o.onTrajectoryFileInfoChanged,d=o.onUIDisplayDataChanged,v=o.onError,_=o.agentColors,b=xO(i,v);l.visData.timeStepSize=b.timeStepSize;var w=b.size.x,C=b.size.y,R=b.size.z,z=1e-6;Math.abs(w)<z||Math.abs(C)<z||Math.abs(R)<z?this.visGeometry.resetBounds():this.visGeometry.resetBounds([w,C,R]),l.tickIntervalLength=this.visGeometry.tickIntervalLength,this.visGeometry.handleCameraData(b.cameraDefault),this.visGeometry.handleAgentGeometry(b.typeMapping);try{this.selectionInterface.parse(b.typeMapping)}catch(U){if(v){var O=U;v(new el("error parsing 'typeMapping' data, ".concat(O.message),Tl.ERROR))}else console.log("error parsing 'typeMapping' data",U)}var P=this.selectionInterface.getUIDisplayData();f(b),this.visGeometry.colorHandler.resetDefaultColorsData(_);var M=this.selectionInterface.setInitialAgentColors(P,_,this.visGeometry.applyColorToAgents.bind(this.visGeometry));ri.isEqual(M,_)||this.visGeometry.createMaterials(M),d(this.selectionInterface.getUIDisplayData())}},{key:"componentDidMount",value:function(){var i=this,o=this.props,l=o.backgroundColor,f=o.simulariumController,d=o.loadInitialData,v=o.onError,_=o.lockedCamera;this.visGeometry.setCanvasOnTheDom(this.vdomRef.current,_),l!==void 0&&this.visGeometry.setBackgroundColor(l),this.props.loggerLevel==="debug"&&this.vdomRef&&this.vdomRef.current&&(this.stats.dom.style.position="absolute",this.vdomRef.current.appendChild(this.stats.dom)),v&&(f.onError=v,this.visGeometry.setOnErrorCallBack(v)),f.visGeometry=this.visGeometry,f.trajFileInfoCallback=function(b){i.onTrajectoryFileInfo(b)},f.postConnect=function(){d&&f.initializeTrajectoryFile()},f.startRecording=this.startRecording.bind(this),f.stopRecording=this.stopRecording.bind(this),this.vdomRef.current&&this.vdomRef.current.addEventListener("timeChange",this.handleTimeChange,!1),this.addEventHandlersToCanvas(),this.startTime=Date.now(),this.animate()}},{key:"componentWillUnmount",value:function(){this.visGeometry.destroyGui(),this.vdomRef.current&&this.vdomRef.current.removeEventListener("timeChange",this.handleTimeChange),this.removeEventHandlersFromCanvas(),this.stopAnimate()}},{key:"componentDidUpdate",value:function(i,o){var l=this.props,f=l.backgroundColor,d=l.agentColors,v=l.height,_=l.width,b=l.renderStyle,w=l.hideAllAgents,C=l.showPaths,R=l.showBounds,z=l.selectionStateInfo,O=l.lockedCamera,P=l.disableCache;if(z){if(!ri.isEqual(z.highlightedAgents,i.selectionStateInfo.highlightedAgents)){var M=this.selectionInterface.getHighlightedIds(z);this.visGeometry.setHighlightByIds(M)}if(!ri.isEqual(z.hiddenAgents,i.selectionStateInfo.hiddenAgents)){var U=this.selectionInterface.getHiddenIds(z);this.visGeometry.setVisibleByIds(U)}!ri.isEqual(z.appliedColors,i.selectionStateInfo.appliedColors)&&z.appliedColors.length>0&&this.changeAgentsColor(z.appliedColors)}b!==i.renderStyle&&this.visGeometry.setRenderStyle(b),w!==i.hideAllAgents&&this.visGeometry.toggleAllAgentsHidden(w),C!==i.showPaths&&this.visGeometry.setShowPaths(C),R!==i.showBounds&&this.visGeometry.setShowBounds(R),f!==i.backgroundColor&&this.visGeometry.setBackgroundColor(f),d&&!ri.isEqual(d,i.agentColors)&&this.visGeometry.createMaterials(d),(i.height!==v||i.width!==_)&&this.visGeometry.resize(_,v),i.lockedCamera!==O&&this.visGeometry.toggleControls(O),i.disableCache!==P&&this.props.simulariumController.visData.frameCache.changeSettings({cacheEnabled:!P}),o.showRenderParamsGUI!==this.state.showRenderParamsGUI&&(this.state.showRenderParamsGUI?this.visGeometry.setupGui(this.vdomRef.current):this.visGeometry.destroyGui())}},{key:"addEventHandlersToCanvas",value:function(){var i=this;ri.forOwn(this.handlers,function(o,l){return i.visGeometry.renderDom.addEventListener(l,o,!1)}),document.addEventListener("keydown",this.handleKeyDown,!1)}},{key:"removeEventHandlersFromCanvas",value:function(){var i=this;ri.forOwn(this.handlers,function(o,l){return i.visGeometry.renderDom.removeEventListener(l,o,!1)}),document.removeEventListener("keydown",this.handleKeyDown,!1)}},{key:"onPickObject",value:function(i,o){var l=this.visGeometry.getFollowObject(),f=this.visGeometry.hitTest(i,o);f!==Za?(this.hit=!0,l!==f&&l!==Za&&this.visGeometry.removePathForAgent(l),this.props.lockedCamera||(this.visGeometry.setFollowObject(f),this.visGeometry.addPathForAgent(f))):(l!==Za&&this.visGeometry.removePathForAgent(l),this.hit&&(this.hit=!1),this.visGeometry.setFollowObject(Za)),this.updateFollowObjectData()}},{key:"updateFollowObjectData",value:function(){if(this.props.onFollowObjectChanged!==void 0){var i=this.visGeometry.getFollowObject(),o=this.visGeometry.getObjectData(i);this.props.onFollowObjectChanged(o)}}},{key:"handleTimeChange",value:function(i){var o=this.props.onTimeChange;if(!e.isCustomEvent(i))throw new Error("not custom event");o(i.detail)}},{key:"dispatchUpdatedTime",value:function(i){var o=new CustomEvent("timeChange",{detail:i});this.vdomRef.current&&this.vdomRef.current.dispatchEvent(o)}},{key:"changeAgentsColor",value:function(i){var o=this,l=[];i.forEach(function(f){var d=o.selectionInterface.getAgentIdsByNamesAndTags([{name:f.name,tags:[]}]);l.push({agentIds:d,color:f.color}),f.displayStates.forEach(function(v){var _=o.selectionInterface.getAgentIdsByNamesAndTags([{name:f.name,tags:[v.name]}]);l.push({agentIds:_,color:v.color})})}),this.visGeometry.applyColorToAgents(l)}},{key:"stopAnimate",value:function(){this.animationRequestID!==0&&(cancelAnimationFrame(this.animationRequestID),this.animationRequestID=0)}},{key:"animate",value:function(){var i=this.props.simulariumController,o=i.visData,l=iM,f=1e3/l,d=Date.now(),v=d-this.lastRenderTime,_=d-this.startTime;if(v>f){var b;if(i.isChangingFile){this.visGeometry.render(_),this.lastRenderTime=Date.now(),this.lastRenderedAgentTime=-1,i.markFileChangeAsHandled(),this.animationRequestID=requestAnimationFrame(this.animate);return}var w=o.currentFrameData;w.time!=this.lastRenderedAgentTime&&w.agentCount>0&&(this.dispatchUpdatedTime({time:w.time,frameNumber:w.frameNumber}),this.visGeometry.update(w),this.lastRenderedAgentTime=w.time,this.updateFollowObjectData()),!o.atLatestFrame()&&!i.paused()&&o.gotoNextFrame(),this.stats.begin(),this.visGeometry.render(_),(b=this.recorder)!==null&&b!==void 0&&b.isRecording&&this.recorder.onFrame(),this.stats.end(),this.lastRenderTime=Date.now()}this.animationRequestID=requestAnimationFrame(this.animate)}},{key:"renderViewControls",value:function(){var i=this.props.simulariumController;return ts.createElement("div",{className:"view-controls"},ts.createElement("button",{onClick:i.resetCamera,className:"btn"},ts.createElement(gg,{icon:vP,transform:"flip-h",style:{color:"#737373"}})),ts.createElement("button",{onClick:i.centerCamera,className:"btn-work"},"Re-center"),ts.createElement("button",{onClick:i.reOrientCamera,className:"btn-word"},"Starting orientation"))}},{key:"startRecording",value:function(){this.recorder&&this.recorder.start()}},{key:"stopRecording",value:function(){this.recorder&&this.recorder.stop()}},{key:"render",value:function(){var i=this.props,o=i.width,l=i.height,f=i.showCameraControls;return ts.createElement(ts.Fragment,null,ts.createElement("div",{id:"vdom",style:{height:l,width:o,position:"relative"},ref:this.vdomRef,tabIndex:0,"data-height":l,"data-width":o},f&&this.renderViewControls()))}}],[{key:"isCustomEvent",value:function(i){return"detail"in i}}])}(ts.Component);ue(DM,"defaultProps",wN);var u0,EN=new Uint8Array(16);function CN(){if(!u0&&(u0=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!u0))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return u0(EN)}const TN=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function MN(r){return typeof r=="string"&&TN.test(r)}var Go=[];for(var Gb=0;Gb<256;++Gb)Go.push((Gb+256).toString(16).substr(1));function AN(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Go[r[e+0]]+Go[r[e+1]]+Go[r[e+2]]+Go[r[e+3]]+"-"+Go[r[e+4]]+Go[r[e+5]]+"-"+Go[r[e+6]]+Go[r[e+7]]+"-"+Go[r[e+8]]+Go[r[e+9]]+"-"+Go[r[e+10]]+Go[r[e+11]]+Go[r[e+12]]+Go[r[e+13]]+Go[r[e+14]]+Go[r[e+15]]).toLowerCase();if(!MN(t))throw TypeError("Stringified UUID is invalid");return t}function PN(r,e,t){r=r||{};var i=r.random||(r.rng||CN)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,AN(i)}var RN=function(){function r(e){Xn(this,r),ue(this,"localSimulator",void 0),ue(this,"simulatorIntervalId",0),ue(this,"dataInterval",66),ue(this,"logger",void 0),ue(this,"onTrajectoryFileInfoArrive",void 0),ue(this,"onTrajectoryDataArrive",void 0),ue(this,"handleError",void 0),this.logger=Al.get("netconnection"),this.logger.setLevel(Al.DEBUG),this.onTrajectoryFileInfoArrive=function(){},this.onTrajectoryDataArrive=function(){},this.handleError=function(){},this.localSimulator=e}return qn(r,[{key:"setTrajectoryFileInfoHandler",value:function(t){this.onTrajectoryFileInfoArrive=t}},{key:"setTrajectoryDataHandler",value:function(t){this.onTrajectoryDataArrive=t}},{key:"setErrorHandler",value:function(t){this.handleError=t}},{key:"sendSimulationRequest",value:function(t,i){var o=this;switch(t.msgType){case li.ID_UPDATE_TIME_STEP:break;case li.ID_UPDATE_RATE_PARAM:break;case li.ID_MODEL_DEFINITION:break;case li.ID_UPDATE_SIMULATION_STATE:this.localSimulator.updateSimulationState(t.data);break;case li.ID_VIS_DATA_REQUEST:if(t.frameNumber!==void 0){var l=this.localSimulator.update(t.frameNumber);this.onTrajectoryDataArrive(l)}else{var f=this.localSimulator.getInfo();this.onTrajectoryFileInfoArrive(f)}break;case li.ID_VIS_DATA_PAUSE:window.clearInterval(this.simulatorIntervalId),this.simulatorIntervalId=0;break;case li.ID_VIS_DATA_RESUME:this.simulatorIntervalId=window.setInterval(function(){var _=o.localSimulator.update(0);o.onTrajectoryDataArrive(_)},this.dataInterval);break;case li.ID_VIS_DATA_ABORT:window.clearInterval(this.simulatorIntervalId),this.simulatorIntervalId=0;break;case li.ID_GOTO_SIMULATION_TIME:{var d=this.localSimulator.update(t.time);this.onTrajectoryDataArrive(d)}break;case li.ID_INIT_TRAJECTORY_FILE:{var v=this.localSimulator.getInfo();console.log("receive trajectory file info"),this.onTrajectoryFileInfoArrive(v)}break}}},{key:"sendTimeStepUpdate",value:function(t){var i={msgType:li.ID_UPDATE_TIME_STEP,timeStep:t};this.sendSimulationRequest(i,"Update Time-Step")}},{key:"sendUpdate",value:function(t){return t.msgType=li.ID_UPDATE_SIMULATION_STATE,this.sendSimulationRequest(t,"Simulation State Update"),Promise.resolve()}},{key:"initialize",value:function(t){var i=this,o={msgType:li.ID_VIS_DATA_REQUEST,mode:gC.ID_TRAJECTORY_FILE_PLAYBACK,fileName:t};return Promise.resolve().then(function(){i.sendSimulationRequest(o,"Start Trajectory File Playback")})}},{key:"pause",value:function(){this.sendSimulationRequest({msgType:li.ID_VIS_DATA_PAUSE},"Pause Simulation")}},{key:"stream",value:function(){this.sendSimulationRequest({msgType:li.ID_VIS_DATA_RESUME},"Resume Simulation")}},{key:"abort",value:function(){this.sendSimulationRequest({msgType:li.ID_VIS_DATA_ABORT},"Abort Simulation")}},{key:"requestFrame",value:function(t){this.sendSimulationRequest({msgType:li.ID_VIS_DATA_REQUEST,mode:gC.ID_TRAJECTORY_FILE_PLAYBACK,frameNumber:t},"Request Single Frame")}},{key:"requestFrameByTime",value:function(t){this.sendSimulationRequest({msgType:li.ID_GOTO_SIMULATION_TIME,time:t},"Load single frame at specified Time")}},{key:"requestTrajectoryFileInfo",value:function(t){this.sendSimulationRequest({msgType:li.ID_INIT_TRAJECTORY_FILE,fileName:t},"Initialize trajectory file info")}}])}(),CC=function(){function r(e,t){Xn(this,r),ue(this,"fileName",void 0),ue(this,"simulariumFile",void 0),ue(this,"logger",void 0),ue(this,"onTrajectoryFileInfoArrive",void 0),ue(this,"onTrajectoryDataArrive",void 0),ue(this,"handleError",void 0),ue(this,"playbackIntervalId",0),ue(this,"currentPlaybackFrameIndex",0),this.fileName=e,this.simulariumFile=t,this.logger=Al.get("netconnection"),this.logger.setLevel(Al.DEBUG),this.onTrajectoryFileInfoArrive=function(){},this.onTrajectoryDataArrive=function(){},this.handleError=function(){},console.log("NEW LOCALFILECONNECTION")}return qn(r,[{key:"setTrajectoryFileInfoHandler",value:function(t){this.onTrajectoryFileInfoArrive=t}},{key:"setTrajectoryDataHandler",value:function(t){this.onTrajectoryDataArrive=t}},{key:"setErrorHandler",value:function(t){this.handleError=t}},{key:"initialize",value:function(t){try{var i=this.simulariumFile.getTrajectoryFileInfo();this.onTrajectoryFileInfoArrive(i)}catch(o){return Promise.reject(o)}return Promise.resolve()}},{key:"pause",value:function(){window.clearInterval(this.playbackIntervalId),this.playbackIntervalId=0}},{key:"stream",value:function(){var t=this;this.playbackIntervalId=window.setInterval(function(){var i=t.simulariumFile.getNumFrames();if(t.currentPlaybackFrameIndex>=i){t.currentPlaybackFrameIndex=i-1,t.pause();return}t.onTrajectoryDataArrive(t.getFrame(t.currentPlaybackFrameIndex)),t.currentPlaybackFrameIndex++},1)}},{key:"abort",value:function(){window.clearInterval(this.playbackIntervalId),this.playbackIntervalId=0,this.currentPlaybackFrameIndex=0}},{key:"requestFrame",value:function(t){this.onTrajectoryDataArrive(this.getFrame(t))}},{key:"requestFrameByTime",value:function(t){var i=this.simulariumFile.getFrameIndexAtTime(t);i!==-1&&(this.currentPlaybackFrameIndex=i,this.requestFrame(i))}},{key:"requestTrajectoryFileInfo",value:function(t){this.onTrajectoryFileInfoArrive(this.simulariumFile.getTrajectoryFileInfo())}},{key:"sendUpdate",value:function(t){return Promise.resolve()}},{key:"getFrame",value:function(t){var i=this.simulariumFile.getFrame(t);return i instanceof ArrayBuffer?i:{msgType:0,bundleStart:t,bundleSize:1,bundleData:[i],fileName:this.fileName}}},{key:"getSimulariumFile",value:function(){return this.simulariumFile}}])}(),IN=function(){function r(e,t){Xn(this,r),ue(this,"handleError",void 0),ue(this,"webSocketClient",void 0),this.handleError=t||function(){},this.webSocketClient=e}return qn(r,[{key:"connectToRemoteServer",value:function(){var e=po(ii.mark(function i(){return ii.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.registerJsonMessageHandlers(),l.abrupt("return",this.webSocketClient.connectToRemoteServer());case 2:case"end":return l.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"socketIsValid",value:function(){return this.webSocketClient.socketIsValid()}},{key:"getAvailableMetrics",value:function(){this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_AVAILABLE_METRICS_REQUEST},"Request available metrics from the metrics service")}},{key:"getPlotData",value:function(t,i,o){this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_PLOT_DATA_REQUEST,fileName:o,data:t,plots:i},"Request plot data for a given trajectory and plot types")}},{key:"onAvailableMetricsArrive",value:function(t){console.log("Available metrics: ",t.metrics)}},{key:"onPlotDataArrive",value:function(t){console.log("Plot data: ",t.plotData)}},{key:"registerJsonMessageHandlers",value:function(){this.webSocketClient.addJsonMessageHandler(ji.ID_AVAILABLE_METRICS_RESPONSE,this.onAvailableMetricsArrive),this.webSocketClient.addJsonMessageHandler(ji.ID_PLOT_DATA_RESPONSE,this.onPlotDataArrive)}}])}(),DN=function(){function r(e){Xn(this,r),ue(this,"webSocketClient",void 0),ue(this,"lastRequestedFile",""),ue(this,"healthCheckHandler",void 0),this.webSocketClient=e,this.healthCheckHandler=function(){}}return qn(r,[{key:"setHealthCheckHandler",value:function(t){var i=this;this.healthCheckHandler=t,this.webSocketClient.addJsonMessageHandler(ji.ID_SERVER_HEALTHY_RESPONSE,function(){return i.healthCheckHandler()})}},{key:"connectToRemoteServer",value:function(){var e=po(ii.mark(function i(){return ii.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.webSocketClient.connectToRemoteServer());case 1:case"end":return l.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"convertTrajectory",value:function(){var e=po(ii.mark(function i(o,l,f){return ii.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:this.lastRequestedFile=f,this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_CONVERT_TRAJECTORY_FILE,trajType:l.toLowerCase(),fileName:f,data:o},"Convert trajectory output to simularium file format");case 2:case"end":return v.stop()}},i,this)}));function t(i,o,l){return e.apply(this,arguments)}return t}()},{key:"cancelConversion",value:function(){this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_CANCEL_CONVERSION,fileName:this.lastRequestedFile},"Cancel the requested autoconversion"),this.lastRequestedFile=""}},{key:"checkServerHealth",value:function(){var e=po(ii.mark(function i(){return ii.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.webSocketClient.connectToRemoteServer();case 2:this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_CHECK_HEALTH_REQUEST},"Request server health check");case 3:case"end":return l.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"sendSmoldynData",value:function(){var e=po(ii.mark(function i(o,l){return ii.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.webSocketClient.connectToRemoteServer();case 2:this.lastRequestedFile=o,this.webSocketClient.sendWebSocketRequest({msgType:ji.ID_START_SMOLDYN,fileName:o,smoldynInputVal:l??void 0},"Start smoldyn simulation");case 4:case"end":return d.stop()}},i,this)}));function t(i,o){return e.apply(this,arguments)}return t}()}])}();Al.setHandler(Al.createDefaultHandler());var LN=function(){function r(e){var t=this;Xn(this,r),ue(this,"simulator",void 0),ue(this,"remoteWebsocketClient",void 0),ue(this,"octopusClient",void 0),ue(this,"metricsCalculator",void 0),ue(this,"visData",void 0),ue(this,"visGeometry",void 0),ue(this,"tickIntervalLength",void 0),ue(this,"handleTrajectoryInfo",void 0),ue(this,"postConnect",void 0),ue(this,"startRecording",void 0),ue(this,"stopRecording",void 0),ue(this,"onError",void 0),ue(this,"isPaused",void 0),ue(this,"isFileChanging",void 0),ue(this,"playBackFile",void 0),this.visData=new uO,this.tickIntervalLength=0,this.postConnect=function(){return ri.noop},this.startRecording=function(){return ri.noop},this.stopRecording=function(){return ri.noop},this.handleTrajectoryInfo=function(){return ri.noop},this.onError=function(){return ri.noop},e.remoteSimulator?(this.simulator=e.remoteSimulator,this.simulator.setTrajectoryFileInfoHandler(function(i){t.handleTrajectoryInfo(i)}),this.simulator.setTrajectoryDataHandler(this.visData.parseAgentsFromNetData.bind(this.visData))):e.netConnectionSettings?this.createSimulatorConnection(e.netConnectionSettings,void 0,void 0):(this.simulator=void 0,e.trajectoryPlaybackFile&&console.warn("trajectoryPlaybackFile param ignored, no network config provided")),this.isPaused=!1,this.isFileChanging=!1,this.playBackFile=e.trajectoryPlaybackFile||"",this.zoomIn=this.zoomIn.bind(this),this.zoomOut=this.zoomOut.bind(this),this.resetCamera=this.resetCamera.bind(this),this.centerCamera=this.centerCamera.bind(this),this.reOrientCamera=this.reOrientCamera.bind(this),this.setPanningMode=this.setPanningMode.bind(this),this.setFocusMode=this.setFocusMode.bind(this),this.convertTrajectory=this.convertTrajectory.bind(this),this.setCameraType=this.setCameraType.bind(this),this.startSmoldynSim=this.startSmoldynSim.bind(this),this.cancelCurrentFile=this.cancelCurrentFile.bind(this),this.initNewFile=this.initNewFile.bind(this)}return qn(r,[{key:"createSimulatorConnection",value:function(t,i,o,l,f){var d=this;if(i)this.simulator=new RN(i),this.simulator.setTrajectoryDataHandler(this.visData.parseAgentsFromNetData.bind(this.visData));else if(o)this.simulator=new CC(this.playBackFile,o),this.visGeometry&&l&&!ri.isEmpty(l)&&this.visGeometry.geometryStore.cacheLocalAssets(l),this.simulator.setTrajectoryDataHandler(this.visData.parseAgentsFromFrameData.bind(this.visData));else if(t){var v=new CS(t,this.onError);this.remoteWebsocketClient=v,this.octopusClient=new DN(v),this.simulator=new TS(v,this.onError,f),this.simulator.setTrajectoryDataHandler(this.visData.parseAgentsFromNetData.bind(this.visData))}else throw new Error("Insufficient data to determine and configure simulator connection");this.simulator.setTrajectoryFileInfoHandler(function(_){d.handleTrajectoryInfo(_)})}},{key:"configureNetwork",value:function(t){this.simulator&&this.simulator.abort(),this.createSimulatorConnection(t)}},{key:"isRemoteOctopusClientConfigured",value:function(){var t;return!!(this.simulator&&this.octopusClient&&(t=this.remoteWebsocketClient)!==null&&t!==void 0&&t.socketIsValid())}},{key:"isChangingFile",get:function(){return this.isFileChanging}},{key:"connect",value:function(){var t=this;return this.remoteWebsocketClient?this.remoteWebsocketClient.connectToRemoteServer().then(function(i){return t.postConnect(),i}):Promise.reject(new Error("No network connection established in simularium controller."))}},{key:"start",value:function(){return this.simulator?(this.isPaused=!1,this.visData.clearCache(),this.simulator.initialize(this.playBackFile)):Promise.reject()}},{key:"time",value:function(){return this.visData.currentFrameData.time}},{key:"stop",value:function(){this.simulator&&this.simulator.abort()}},{key:"sendUpdate",value:function(t){this.simulator&&this.simulator.sendUpdate(t)}},{key:"convertTrajectory",value:function(t,i,o,l){var f=l??"".concat(PN(),".simularium");this.cancelCurrentFile(f);try{if(this.isRemoteOctopusClientConfigured()||this.configureNetwork(t),!this.octopusClient)throw new Error("Octopus client not configured");if(!this.simulator)throw new Error("Simulator not initialized");return this.octopusClient.convertTrajectory(i,o,f)}catch(d){return Promise.reject(d)}}},{key:"pause",value:function(){this.simulator&&(this.simulator.pause(),this.isPaused=!0)}},{key:"paused",value:function(){return this.isPaused}},{key:"initializeTrajectoryFile",value:function(){this.simulator&&this.simulator.initialize(this.playBackFile)}},{key:"startSmoldynSim",value:function(t,i,o){this.cancelCurrentFile(i);try{if(this.isRemoteOctopusClientConfigured()||this.configureNetwork(t),!this.octopusClient)throw new Error("Octopus client not configured");if(!this.simulator)throw new Error("Simulator not initialized");return this.octopusClient.sendSmoldynData(i,o)}catch(l){return Promise.reject(l)}}},{key:"gotoTime",value:function(t){this.isFileChanging||!this.simulator||(this.visData.hasLocalCacheForTime(t)?this.visData.gotoTime(t):(this.visData.clearCache(),this.simulator.requestFrameByTime(t)))}},{key:"playFromTime",value:function(t){this.gotoTime(t),this.isPaused=!1}},{key:"resume",value:function(){this.simulator&&(this.simulator.stream(),this.isPaused=!1)}},{key:"clearFile",value:function(){var t;this.isFileChanging=!1,this.playBackFile="",this.visData.clearForNewTrajectory(),(t=this.simulator)===null||t===void 0||t.abort(),this.pause(),this.visGeometry&&(this.visGeometry.clearForNewTrajectory(),this.visGeometry.resetCamera())}},{key:"handleFileChange",value:function(t,i,o){if(!i.includes(".simularium"))throw new Error("File must be a .simularium file");return o?this.changeFile({simulariumFile:t,geoAssets:o},i):this.changeFile({simulariumFile:t},i)}},{key:"cancelCurrentFile",value:function(t){this.isFileChanging=!0,this.playBackFile=t,this.stop(),this.visData.WaitForFrame(0),this.visData.clearForNewTrajectory()}},{key:"initNewFile",value:function(t){var i=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,l=!(o&&this.isRemoteOctopusClientConfigured());if(l)try{if(t)this.createSimulatorConnection(t.netConnectionSettings,t.clientSimulator,t.simulariumFile,t.geoAssets,t.requestJson),this.isPaused=!0;else throw new Error("incomplete simulator config provided")}catch(d){var f=d;this.simulator=void 0,console.warn(f.message),this.isPaused=!1}return this.simulator?this.start().then(function(){i.simulator&&i.simulator.requestFrame(0)}).then(function(){return{status:PP}}):Promise.reject({status:RP})}},{key:"changeFile",value:function(t,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return this.cancelCurrentFile(i),this.initNewFile(t,o)}},{key:"markFileChangeAsHandled",value:function(){this.isFileChanging=!1}},{key:"getFile",value:function(){return this.playBackFile}},{key:"checkServerHealth",value:function(t,i){this.isRemoteOctopusClientConfigured()||this.configureNetwork(i),this.octopusClient&&(this.octopusClient.setHealthCheckHandler(t),this.octopusClient.checkServerHealth())}},{key:"cancelConversion",value:function(){this.octopusClient&&this.octopusClient.cancelConversion()}},{key:"setupMetricsCalculator",value:function(t){var i=this.remoteWebsocketClient&&this.remoteWebsocketClient.socketIsValid()?this.remoteWebsocketClient:new CS(t,this.onError);return new IN(i,this.onError)}},{key:"getMetrics",value:function(){var e=po(ii.mark(function i(o){return ii.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(!this.metricsCalculator||!this.metricsCalculator.socketIsValid())){f.next=4;break}return this.metricsCalculator=this.setupMetricsCalculator(o),f.next=4,this.metricsCalculator.connectToRemoteServer();case 4:this.metricsCalculator.getAvailableMetrics();case 5:case"end":return f.stop()}},i,this)}));function t(i){return e.apply(this,arguments)}return t}()},{key:"getPlotData",value:function(){var e=po(ii.mark(function i(o,l){var f;return ii.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.simulator){v.next=2;break}return v.abrupt("return");case 2:if(!(!this.metricsCalculator||!this.metricsCalculator.socketIsValid())){v.next=6;break}return this.metricsCalculator=this.setupMetricsCalculator(o),v.next=6,this.metricsCalculator.connectToRemoteServer();case 6:this.simulator instanceof CC?(f=this.simulator.getSimulariumFile(),this.metricsCalculator.getPlotData(f.simulariumFile,l)):this.simulator instanceof TS&&this.metricsCalculator.getPlotData({},l,this.simulator.getLastRequestedFile());case 7:case"end":return v.stop()}},i,this)}));function t(i,o){return e.apply(this,arguments)}return t}()},{key:"clearLocalCache",value:function(){this.visData.clearCache()}},{key:"trajFileInfoCallback",set:function(t){this.handleTrajectoryInfo=t,this.simulator&&this.simulator.setTrajectoryFileInfoHandler(t)}},{key:"zoomIn",value:function(){var t;(t=this.visGeometry)===null||t===void 0||t.zoomIn()}},{key:"zoomOut",value:function(){var t;(t=this.visGeometry)===null||t===void 0||t.zoomOut()}},{key:"resetCamera",value:function(){var t;(t=this.visGeometry)===null||t===void 0||t.resetCamera()}},{key:"centerCamera",value:function(){var t;(t=this.visGeometry)===null||t===void 0||t.centerCamera()}},{key:"reOrientCamera",value:function(){var t;(t=this.visGeometry)===null||t===void 0||t.reOrientCamera()}},{key:"setPanningMode",value:function(t){var i;(i=this.visGeometry)===null||i===void 0||i.setPanningMode(t)}},{key:"setAllowViewPanning",value:function(t){var i;(i=this.visGeometry)===null||i===void 0||i.setAllowViewPanning(t)}},{key:"setFocusMode",value:function(t){var i;(i=this.visGeometry)===null||i===void 0||i.setFocusMode(t)}},{key:"setCameraType",value:function(t){var i;(i=this.visGeometry)===null||i===void 0||i.setCameraType(t)}}])}();class kN{constructor(e,t){this.nPoints=e,this.nTypes=t,this.pointsData=this.makePoints(e),this.currentFrame=0}randomFloat(e,t){return t===void 0&&(t=e,e=0),Math.random()*(t-e)+e}randomSpherePoint(e,t,i,o){const l=Math.random(),f=Math.random(),d=2*Math.PI*l,v=Math.acos(2*f-1),_=e+o*Math.sin(v)*Math.cos(d),b=t+o*Math.sin(v)*Math.sin(d),w=i+o*Math.cos(v);return[_,b,w]}randomPtInBox(e,t,i,o,l,f){return[this.randomFloat(e,t),this.randomFloat(i,o),this.randomFloat(l,f)]}makePoints(e){const t=[];let i=[];for(let o=0;o<e;++o)i=this.randomPtInBox(-4,4,-4,4,-4,4),t.push(i[0]),t.push(i[1]),t.push(i[2]);return t}update(e){for(let l=0;l<this.nPoints;++l)this.pointsData[l*3+0]+=this.randomFloat(-.05,.05),this.pointsData[l*3+1]+=this.randomFloat(-.05,.05),this.pointsData[l*3+2]+=this.randomFloat(-.05,.05);const i=[];for(let l=0;l<this.nPoints;++l)i.push(fu.ID_VIS_TYPE_DEFAULT),i.push(l),i.push(l%this.nTypes),i.push(this.pointsData[l*3+0]),i.push(this.pointsData[l*3+1]),i.push(this.pointsData[l*3+2]),i.push(0),i.push(0),i.push(0),i.push(.1),i.push(0);const o={msgType:li.ID_VIS_DATA_ARRIVE,bundleStart:this.currentFrame,bundleSize:1,bundleData:[{data:i,frameNumber:this.currentFrame,time:this.currentFrame}],fileName:"hello world"};return this.currentFrame++,o}getInfo(){const e={};for(let t=0;t<this.nTypes;++t)e[t]={name:`point${t}`};return{connId:"hello world",msgType:li.ID_TRAJECTORY_FILE_INFO,version:2,timeStepSize:1,totalSteps:1e3,size:{x:12,y:12,z:12},cameraDefault:Uc,typeMapping:e,spatialUnits:{magnitude:1,name:"m"},timeUnits:{magnitude:1,name:"s"}}}updateSimulationState(e){}}var rp={},kv={},M0={exports:{}},FN=M0.exports,TC;function zm(){return TC||(TC=1,function(r,e){/** @preserve SAT.js - Version 0.9.0 - Copyright 2012 - 2021 - Jim Riecken <jimr@jimr.ca> - released under the MIT License. https://github.com/jriecken/sat-js */(function(t,i){r.exports=i()})(FN,function(){var t={};function i(V,H){this.x=V||0,this.y=H||0}t.Vector=i,t.V=i,i.prototype.copy=i.prototype.copy=function(V){return this.x=V.x,this.y=V.y,this},i.prototype.clone=i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.perp=i.prototype.perp=function(){var V=this.x;return this.x=this.y,this.y=-V,this},i.prototype.rotate=i.prototype.rotate=function(V){var H=this.x,J=this.y;return this.x=H*Math.cos(V)-J*Math.sin(V),this.y=H*Math.sin(V)+J*Math.cos(V),this},i.prototype.reverse=i.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},i.prototype.normalize=i.prototype.normalize=function(){var V=this.len();return V>0&&(this.x=this.x/V,this.y=this.y/V),this},i.prototype.add=i.prototype.add=function(V){return this.x+=V.x,this.y+=V.y,this},i.prototype.sub=i.prototype.sub=function(V){return this.x-=V.x,this.y-=V.y,this},i.prototype.scale=i.prototype.scale=function(V,H){return this.x*=V,this.y*=typeof H<"u"?H:V,this},i.prototype.project=i.prototype.project=function(V){var H=this.dot(V)/V.len2();return this.x=H*V.x,this.y=H*V.y,this},i.prototype.projectN=i.prototype.projectN=function(V){var H=this.dot(V);return this.x=H*V.x,this.y=H*V.y,this},i.prototype.reflect=i.prototype.reflect=function(V){var H=this.x,J=this.y;return this.project(V).scale(2),this.x-=H,this.y-=J,this},i.prototype.reflectN=i.prototype.reflectN=function(V){var H=this.x,J=this.y;return this.projectN(V).scale(2),this.x-=H,this.y-=J,this},i.prototype.dot=i.prototype.dot=function(V){return this.x*V.x+this.y*V.y},i.prototype.len2=i.prototype.len2=function(){return this.dot(this)},i.prototype.len=i.prototype.len=function(){return Math.sqrt(this.len2())};function o(V,H){this.pos=V||new i,this.r=H||0,this.offset=new i}t.Circle=o,o.prototype.getAABBAsBox=o.prototype.getAABBAsBox=function(){var V=this.r,H=this.pos.clone().add(this.offset).sub(new i(V,V));return new f(H,V*2,V*2)},o.prototype.getAABB=o.prototype.getAABB=function(){return this.getAABBAsBox().toPolygon()},o.prototype.setOffset=o.prototype.setOffset=function(V){return this.offset=V,this};function l(V,H){this.pos=V||new i,this.angle=0,this.offset=new i,this.setPoints(H||[])}t.Polygon=l,l.prototype.setPoints=l.prototype.setPoints=function(V){var H=!this.points||this.points.length!==V.length;if(H){var J,ce=this.calcPoints=[],he=this.edges=[],ge=this.normals=[];for(J=0;J<V.length;J++){var Ae=V[J],me=J<V.length-1?V[J+1]:V[0];if(Ae!==me&&Ae.x===me.x&&Ae.y===me.y){V.splice(J,1),J-=1;continue}ce.push(new i),he.push(new i),ge.push(new i)}}return this.points=V,this._recalc(),this},l.prototype.setAngle=l.prototype.setAngle=function(V){return this.angle=V,this._recalc(),this},l.prototype.setOffset=l.prototype.setOffset=function(V){return this.offset=V,this._recalc(),this},l.prototype.rotate=l.prototype.rotate=function(V){for(var H=this.points,J=H.length,ce=0;ce<J;ce++)H[ce].rotate(V);return this._recalc(),this},l.prototype.translate=l.prototype.translate=function(V,H){for(var J=this.points,ce=J.length,he=0;he<ce;he++)J[he].x+=V,J[he].y+=H;return this._recalc(),this},l.prototype._recalc=function(){var V=this.calcPoints,H=this.edges,J=this.normals,ce=this.points,he=this.offset,ge=this.angle,Ae=ce.length,me;for(me=0;me<Ae;me++){var Ie=V[me].copy(ce[me]);Ie.x+=he.x,Ie.y+=he.y,ge!==0&&Ie.rotate(ge)}for(me=0;me<Ae;me++){var ae=V[me],ye=me<Ae-1?V[me+1]:V[0],de=H[me].copy(ye).sub(ae);J[me].copy(de).perp().normalize()}return this},l.prototype.getAABBAsBox=l.prototype.getAABBAsBox=function(){for(var V=this.calcPoints,H=V.length,J=V[0].x,ce=V[0].y,he=V[0].x,ge=V[0].y,Ae=1;Ae<H;Ae++){var me=V[Ae];me.x<J?J=me.x:me.x>he&&(he=me.x),me.y<ce?ce=me.y:me.y>ge&&(ge=me.y)}return new f(this.pos.clone().add(new i(J,ce)),he-J,ge-ce)},l.prototype.getAABB=l.prototype.getAABB=function(){return this.getAABBAsBox().toPolygon()},l.prototype.getCentroid=l.prototype.getCentroid=function(){for(var V=this.calcPoints,H=V.length,J=0,ce=0,he=0,ge=0;ge<H;ge++){var Ae=V[ge],me=ge===H-1?V[0]:V[ge+1],Ie=Ae.x*me.y-me.x*Ae.y;J+=(Ae.x+me.x)*Ie,ce+=(Ae.y+me.y)*Ie,he+=Ie}return he=he*3,J=J/he,ce=ce/he,new i(J,ce)};function f(V,H,J){this.pos=V||new i,this.w=H||0,this.h=J||0}t.Box=f,f.prototype.toPolygon=f.prototype.toPolygon=function(){var V=this.pos,H=this.w,J=this.h;return new l(new i(V.x,V.y),[new i,new i(H,0),new i(H,J),new i(0,J)])};function d(){this.a=null,this.b=null,this.overlapN=new i,this.overlapV=new i,this.clear()}t.Response=d,d.prototype.clear=d.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var v=[],_=0;_<10;_++)v.push(new i);for(var b=[],_=0;_<5;_++)b.push([]);var w=new d,C=new f(new i,1e-6,1e-6).toPolygon();function R(V,H,J){for(var ce=Number.MAX_VALUE,he=-Number.MAX_VALUE,ge=V.length,Ae=0;Ae<ge;Ae++){var me=V[Ae].dot(H);me<ce&&(ce=me),me>he&&(he=me)}J[0]=ce,J[1]=he}function z(V,H,J,ce,he,ge){var Ae=b.pop(),me=b.pop(),Ie=v.pop().copy(H).sub(V),ae=Ie.dot(he);if(R(J,he,Ae),R(ce,he,me),me[0]+=ae,me[1]+=ae,Ae[0]>me[1]||me[0]>Ae[1])return v.push(Ie),b.push(Ae),b.push(me),!0;if(ge){var ye=0;if(Ae[0]<me[0])if(ge.aInB=!1,Ae[1]<me[1])ye=Ae[1]-me[0],ge.bInA=!1;else{var de=Ae[1]-me[0],ie=me[1]-Ae[0];ye=de<ie?de:-ie}else if(ge.bInA=!1,Ae[1]>me[1])ye=Ae[0]-me[1],ge.aInB=!1;else{var de=Ae[1]-me[0],ie=me[1]-Ae[0];ye=de<ie?de:-ie}var we=Math.abs(ye);we<ge.overlap&&(ge.overlap=we,ge.overlapN.copy(he),ye<0&&ge.overlapN.reverse())}return v.push(Ie),b.push(Ae),b.push(me),!1}t.isSeparatingAxis=z;function O(V,H){var J=V.len2(),ce=H.dot(V);return ce<0?P:ce>J?U:M}var P=-1,M=0,U=1;function L(V,H){var J=v.pop().copy(V).sub(H.pos).sub(H.offset),ce=H.r*H.r,he=J.len2();return v.push(J),he<=ce}t.pointInCircle=L;function B(V,H){C.pos.copy(V),w.clear();var J=te(C,H,w);return J&&(J=w.aInB),J}t.pointInPolygon=B;function $(V,H,J){var ce=v.pop().copy(H.pos).add(H.offset).sub(V.pos).sub(V.offset),he=V.r+H.r,ge=he*he,Ae=ce.len2();if(Ae>ge)return v.push(ce),!1;if(J){var me=Math.sqrt(Ae);J.a=V,J.b=H,J.overlap=he-me,J.overlapN.copy(ce.normalize()),J.overlapV.copy(ce).scale(J.overlap),J.aInB=V.r<=H.r&&me<=H.r-V.r,J.bInA=H.r<=V.r&&me<=V.r-H.r}return v.push(ce),!0}t.testCircleCircle=$;function X(V,H,J){for(var ce=v.pop().copy(H.pos).add(H.offset).sub(V.pos),he=H.r,ge=he*he,Ae=V.calcPoints,me=Ae.length,Ie=v.pop(),ae=v.pop(),ye=0;ye<me;ye++){var de=ye===me-1?0:ye+1,ie=ye===0?me-1:ye-1,we=0,ze=null;Ie.copy(V.edges[ye]),ae.copy(ce).sub(Ae[ye]),J&&ae.len2()>ge&&(J.aInB=!1);var se=O(Ie,ae);if(se===P){Ie.copy(V.edges[ie]);var fe=v.pop().copy(ce).sub(Ae[ie]);if(se=O(Ie,fe),se===U){var Le=ae.len();if(Le>he)return v.push(ce),v.push(Ie),v.push(ae),v.push(fe),!1;J&&(J.bInA=!1,ze=ae.normalize(),we=he-Le)}v.push(fe)}else if(se===U){if(Ie.copy(V.edges[de]),ae.copy(ce).sub(Ae[de]),se=O(Ie,ae),se===P){var Le=ae.len();if(Le>he)return v.push(ce),v.push(Ie),v.push(ae),!1;J&&(J.bInA=!1,ze=ae.normalize(),we=he-Le)}}else{var Be=Ie.perp().normalize(),Le=ae.dot(Be),He=Math.abs(Le);if(Le>0&&He>he)return v.push(ce),v.push(Be),v.push(ae),!1;J&&(ze=Be,we=he-Le,(Le>=0||we<2*he)&&(J.bInA=!1))}ze&&J&&Math.abs(we)<Math.abs(J.overlap)&&(J.overlap=we,J.overlapN.copy(ze))}return J&&(J.a=V,J.b=H,J.overlapV.copy(J.overlapN).scale(J.overlap)),v.push(ce),v.push(Ie),v.push(ae),!0}t.testPolygonCircle=X;function Q(V,H,J){var ce=X(H,V,J);if(ce&&J){var he=J.a,ge=J.aInB;J.overlapN.reverse(),J.overlapV.reverse(),J.a=J.b,J.b=he,J.aInB=J.bInA,J.bInA=ge}return ce}t.testCirclePolygon=Q;function te(V,H,J){for(var ce=V.calcPoints,he=ce.length,ge=H.calcPoints,Ae=ge.length,me=0;me<he;me++)if(z(V.pos,H.pos,ce,ge,V.normals[me],J))return!1;for(var me=0;me<Ae;me++)if(z(V.pos,H.pos,ce,ge,H.normals[me],J))return!1;return J&&(J.a=V,J.b=H,J.overlapV.copy(J.overlapN).scale(J.overlap)),!0}return t.testPolygonPolygon=te,t})}(M0)),M0.exports}var fm={},c0={},MC;function ON(){if(MC)return c0;MC=1,Object.defineProperty(c0,"__esModule",{value:!0}),c0.default=r;function r(i,o,l=0,f=i.length-1,d=t){for(;f>l;){if(f-l>600){const w=f-l+1,C=o-l+1,R=Math.log(w),z=.5*Math.exp(2*R/3),O=.5*Math.sqrt(R*z*(w-z)/w)*(C-w/2<0?-1:1),P=Math.max(l,Math.floor(o-C*z/w+O)),M=Math.min(f,Math.floor(o+(w-C)*z/w+O));r(i,o,P,M,d)}const v=i[o];let _=l,b=f;for(e(i,l,o),d(i[f],v)>0&&e(i,l,f);_<b;){for(e(i,_,b),_++,b--;d(i[_],v)<0;)_++;for(;d(i[b],v)>0;)b--}d(i[l],v)===0?e(i,l,b):(b++,e(i,b,f)),b<=o&&(l=b+1),o<=b&&(f=b-1)}}function e(i,o,l){const f=i[o];i[o]=i[l],i[l]=f}function t(i,o){return i<o?-1:i>o?1:0}return c0}var AC;function NN(){if(AC)return fm;AC=1;var r=fm&&fm.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(fm,"__esModule",{value:!0});const e=r(ON());class t{constructor(U=9){this._maxEntries=Math.max(4,U),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(U){let L=this.data;const B=[];if(!z(U,L))return B;const $=this.toBBox,X=[];for(;L;){for(let Q=0;Q<L.children.length;Q++){const te=L.children[Q],V=L.leaf?$(te):te;z(U,V)&&(L.leaf?B.push(te):R(U,V)?this._all(te,B):X.push(te))}L=X.pop()}return B}collides(U){let L=this.data;if(!z(U,L))return!1;const B=[];for(;L;){for(let $=0;$<L.children.length;$++){const X=L.children[$],Q=L.leaf?this.toBBox(X):X;if(z(U,Q)){if(L.leaf||R(U,Q))return!0;B.push(X)}}L=B.pop()}return!1}load(U){if(!(U&&U.length))return this;if(U.length<this._minEntries){for(let B=0;B<U.length;B++)this.insert(U[B]);return this}let L=this._build(U.slice(),0,U.length-1,0);if(!this.data.children.length)this.data=L;else if(this.data.height===L.height)this._splitRoot(this.data,L);else{if(this.data.height<L.height){const B=this.data;this.data=L,L=B}this._insert(L,this.data.height-L.height-1,!0)}return this}insert(U){return U&&this._insert(U,this.data.height-1),this}clear(){return this.data=O([]),this}remove(U,L){if(!U)return this;let B=this.data;const $=this.toBBox(U),X=[],Q=[];let te,V,H;for(;B||X.length;){if(B||(B=X.pop(),V=X[X.length-1],te=Q.pop(),H=!0),B.leaf){const J=i(U,B.children,L);if(J!==-1)return B.children.splice(J,1),X.push(B),this._condense(X),this}!H&&!B.leaf&&R(B,$)?(X.push(B),Q.push(te),te=0,V=B,B=B.children[0]):V?(te++,B=V.children[te],H=!1):B=null}return this}toBBox(U){return U}compareMinX(U,L){return U.minX-L.minX}compareMinY(U,L){return U.minY-L.minY}toJSON(){return this.data}fromJSON(U){return this.data=U,this}_all(U,L){const B=[];for(;U;)U.leaf?L.push(...U.children):B.push(...U.children),U=B.pop();return L}_build(U,L,B,$){const X=B-L+1;let Q=this._maxEntries,te;if(X<=Q)return te=O(U.slice(L,B+1)),o(te,this.toBBox),te;$||($=Math.ceil(Math.log(X)/Math.log(Q)),Q=Math.ceil(X/Math.pow(Q,$-1))),te=O([]),te.leaf=!1,te.height=$;const V=Math.ceil(X/Q),H=V*Math.ceil(Math.sqrt(Q));P(U,L,B,H,this.compareMinX);for(let J=L;J<=B;J+=H){const ce=Math.min(J+H-1,B);P(U,J,ce,V,this.compareMinY);for(let he=J;he<=ce;he+=V){const ge=Math.min(he+V-1,ce);te.children.push(this._build(U,he,ge,$-1))}}return o(te,this.toBBox),te}_chooseSubtree(U,L,B,$){for(;$.push(L),!(L.leaf||$.length-1===B);){let X=1/0,Q=1/0,te;for(let V=0;V<L.children.length;V++){const H=L.children[V],J=_(H),ce=w(U,H)-J;ce<Q?(Q=ce,X=J<X?J:X,te=H):ce===Q&&J<X&&(X=J,te=H)}L=te||L.children[0]}return L}_insert(U,L,B){const $=B?U:this.toBBox(U),X=[],Q=this._chooseSubtree($,this.data,L,X);for(Q.children.push(U),f(Q,$);L>=0&&X[L].children.length>this._maxEntries;)this._split(X,L),L--;this._adjustParentBBoxes($,X,L)}_split(U,L){const B=U[L],$=B.children.length,X=this._minEntries;this._chooseSplitAxis(B,X,$);const Q=this._chooseSplitIndex(B,X,$),te=O(B.children.splice(Q,B.children.length-Q));te.height=B.height,te.leaf=B.leaf,o(B,this.toBBox),o(te,this.toBBox),L?U[L-1].children.push(te):this._splitRoot(B,te)}_splitRoot(U,L){this.data=O([U,L]),this.data.height=U.height+1,this.data.leaf=!1,o(this.data,this.toBBox)}_chooseSplitIndex(U,L,B){let $,X=1/0,Q=1/0;for(let te=L;te<=B-L;te++){const V=l(U,0,te,this.toBBox),H=l(U,te,B,this.toBBox),J=C(V,H),ce=_(V)+_(H);J<X?(X=J,$=te,Q=ce<Q?ce:Q):J===X&&ce<Q&&(Q=ce,$=te)}return $||B-L}_chooseSplitAxis(U,L,B){const $=U.leaf?this.compareMinX:d,X=U.leaf?this.compareMinY:v,Q=this._allDistMargin(U,L,B,$),te=this._allDistMargin(U,L,B,X);Q<te&&U.children.sort($)}_allDistMargin(U,L,B,$){U.children.sort($);const X=this.toBBox,Q=l(U,0,L,X),te=l(U,B-L,B,X);let V=b(Q)+b(te);for(let H=L;H<B-L;H++){const J=U.children[H];f(Q,U.leaf?X(J):J),V+=b(Q)}for(let H=B-L-1;H>=L;H--){const J=U.children[H];f(te,U.leaf?X(J):J),V+=b(te)}return V}_adjustParentBBoxes(U,L,B){for(let $=B;$>=0;$--)f(L[$],U)}_condense(U){for(let L=U.length-1,B;L>=0;L--)U[L].children.length===0?L>0?(B=U[L-1].children,B.splice(B.indexOf(U[L]),1)):this.clear():o(U[L],this.toBBox)}}fm.default=t;function i(M,U,L){if(!L)return U.indexOf(M);for(let B=0;B<U.length;B++)if(L(M,U[B]))return B;return-1}function o(M,U){l(M,0,M.children.length,U,M)}function l(M,U,L,B,$){$||($=O(null)),$.minX=1/0,$.minY=1/0,$.maxX=-1/0,$.maxY=-1/0;for(let X=U;X<L;X++){const Q=M.children[X];f($,M.leaf?B(Q):Q)}return $}function f(M,U){return M.minX=Math.min(M.minX,U.minX),M.minY=Math.min(M.minY,U.minY),M.maxX=Math.max(M.maxX,U.maxX),M.maxY=Math.max(M.maxY,U.maxY),M}function d(M,U){return M.minX-U.minX}function v(M,U){return M.minY-U.minY}function _(M){return(M.maxX-M.minX)*(M.maxY-M.minY)}function b(M){return M.maxX-M.minX+(M.maxY-M.minY)}function w(M,U){return(Math.max(U.maxX,M.maxX)-Math.min(U.minX,M.minX))*(Math.max(U.maxY,M.maxY)-Math.min(U.minY,M.minY))}function C(M,U){const L=Math.max(M.minX,U.minX),B=Math.max(M.minY,U.minY),$=Math.min(M.maxX,U.maxX),X=Math.min(M.maxY,U.maxY);return Math.max(0,$-L)*Math.max(0,X-B)}function R(M,U){return M.minX<=U.minX&&M.minY<=U.minY&&U.maxX<=M.maxX&&U.maxY<=M.maxY}function z(M,U){return U.minX<=M.maxX&&U.minY<=M.maxY&&U.maxX>=M.minX&&U.maxY>=M.minY}function O(M){return{children:M,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function P(M,U,L,B,$){const X=[U,L];for(;X.length;){if(L=X.pop(),U=X.pop(),L-U<=B)continue;const Q=U+Math.ceil((L-U)/B/2)*B;(0,e.default)(M,Q,U,L,$),X.push(U,Q,Q,L)}}return fm}const UN=[0,0],BN=[0,0],zN=[[0,0],[0,0]],VN=[[0,0],[0,0]];function GN(r,e,t){t===void 0&&(t=0),t=t||0;const i=[0,0],o=r[1][1]-r[0][1],l=r[0][0]-r[1][0],f=o*r[0][0]+l*r[0][1],d=e[1][1]-e[0][1],v=e[0][0]-e[1][0],_=d*e[0][0]+v*e[0][1],b=o*v-d*l;return Z0(b,0,t)||(i[0]=(v*f-l*_)/b,i[1]=(o*_-d*f)/b),i}function ow(r,e,t,i){const o=e[0]-r[0],l=e[1]-r[1],f=i[0]-t[0],d=i[1]-t[1];if(f*l-d*o===0)return!1;const v=(o*(t[1]-r[1])+l*(r[0]-t[0]))/(f*l-d*o),_=(f*(r[1]-t[1])+d*(t[0]-r[0]))/(d*o-f*l);return v>=0&&v<=1&&_>=0&&_<=1}function Sg(r,e,t){return(e[0]-r[0])*(t[1]-r[1])-(t[0]-r[0])*(e[1]-r[1])}function A0(r,e,t){return Sg(r,e,t)>0}function aw(r,e,t){return Sg(r,e,t)>=0}function LM(r,e,t){return Sg(r,e,t)<0}function ag(r,e,t){return Sg(r,e,t)<=0}function HN(r,e,t,i){if(i===void 0&&(i=0),i){const o=UN,l=BN;o[0]=e[0]-r[0],o[1]=e[1]-r[1],l[0]=t[0]-e[0],l[1]=t[1]-e[1];const f=o[0]*l[0]+o[1]*l[1],d=Math.sqrt(o[0]*o[0]+o[1]*o[1]),v=Math.sqrt(l[0]*l[0]+l[1]*l[1]);return Math.acos(f/(d*v))<i}else return Sg(r,e,t)===0}function lg(r,e){const t=e[0]-r[0],i=e[1]-r[1];return t*t+i*i}function Zt(r,e){const t=r.length;return r[e<0?e%t+t:e%t]}function WN(r){r.length=0}function Hu(r,e,t,i){for(let o=t;o<i;o++)r.push(e[o])}function jN(r){let e=0;const t=r;for(let i=1;i<r.length;++i)(t[i][1]<t[e][1]||t[i][1]===t[e][1]&&t[i][0]>t[e][0])&&(e=i);return A0(Zt(r,e-1),Zt(r,e),Zt(r,e+1))?!1:(XN(r),!0)}function XN(r){const e=[],t=r.length;for(let i=0;i!==t;i++)e.push(r.pop());for(let i=0;i!==t;i++)r[i]=e[i]}function kM(r,e){return LM(Zt(r,e-1),Zt(r,e),Zt(r,e+1))}function qN(r,e,t){const i=zN,o=VN;if(aw(Zt(r,e+1),Zt(r,e),Zt(r,t))&&ag(Zt(r,e-1),Zt(r,e),Zt(r,t)))return!1;const l=lg(Zt(r,e),Zt(r,t));for(let f=0;f!==r.length;++f)if(!((f+1)%r.length===e||f===e)&&aw(Zt(r,e),Zt(r,t),Zt(r,f+1))&&ag(Zt(r,e),Zt(r,t),Zt(r,f))){i[0]=Zt(r,e),i[1]=Zt(r,t),o[0]=Zt(r,f),o[1]=Zt(r,f+1);const d=GN(i,o);if(lg(Zt(r,e),d)<l)return!1}return!0}function $N(r,e,t){for(let i=0;i!==r.length;++i)if(!(i===e||i===t||(i+1)%r.length===e||(i+1)%r.length===t)&&ow(Zt(r,e),Zt(r,t),Zt(r,i),Zt(r,i+1)))return!1;return!0}function K0(r,e,t,i){if(i===void 0&&(i=[]),WN(i),e<t)for(let o=e;o<=t;o++)i.push(r[o]);else{for(let o=0;o<=t;o++)i.push(r[o]);for(let o=e;o<r.length;o++)i.push(r[o])}return i}function lw(r){let e=[],t,i;const o=[];let l=Number.MAX_VALUE;for(let f=0;f<r.length;++f)if(kM(r,f)){for(let d=0;d<r.length;++d)if(qN(r,f,d)){t=lw(K0(r,f,d,o)),i=lw(K0(r,d,f,o));for(let v=0;v<i.length;v++)t.push(i[v]);t.length<l&&(e=t,l=t.length,e.push([Zt(r,f),Zt(r,d)]))}}return e}function YN(r){const e=lw(r);return e.length>0?FM(r,e):[r]}function FM(r,e){if(e.length===0)return[r];if(e instanceof Array&&e.length&&e[0]instanceof Array&&e[0].length===2&&e[0][0]instanceof Array){const t=[r];for(let i=0;i<e.length;i++){const o=e[i];for(let l=0;l<t.length;l++){const f=t[l],d=FM(f,o);if(d){t.splice(l,1),t.push(d[0],d[1]);break}}}return t}else{const t=e,i=r.indexOf(t[0]),o=r.indexOf(t[1]);return i!==-1&&o!==-1?[K0(r,i,o),K0(r,o,i)]:!1}}function KN(r){const e=r;let t;for(t=0;t<e.length-1;t++)for(let i=0;i<t-1;i++)if(ow(e[t],e[t+1],e[i],e[i+1]))return!1;for(t=1;t<e.length-2;t++)if(ow(e[0],e[e.length-1],e[t],e[t+1]))return!1;return!0}function PC(r,e,t,i,o){o===void 0&&(o=0);const l=e[1]-r[1],f=r[0]-e[0],d=l*r[0]+f*r[1],v=i[1]-t[1],_=t[0]-i[0],b=v*t[0]+_*t[1],w=l*_-v*f;return Z0(w,0,o)?[0,0]:[(_*d-f*b)/w,(l*b-v*d)/w]}function Kv(r,e,t,i,o,l,f){e===void 0&&(e=[]),t===void 0&&(t=[]),i===void 0&&(i=[]),o===void 0&&(o=25),l===void 0&&(l=100),f===void 0&&(f=0);let d=[0,0],v=[0,0],_=[0,0],b=0,w=0,C=0,R=0,z=0,O=0,P=0;const M=[],U=[],L=r,B=r;if(B.length<3)return e;if(f++,f>l)return console.warn("quickDecomp: max level ("+l+") reached."),e;for(let $=0;$<r.length;++$)if(kM(L,$)){t.push(L[$]),b=w=Number.MAX_VALUE;for(let X=0;X<r.length;++X)A0(Zt(L,$-1),Zt(L,$),Zt(L,X))&&ag(Zt(L,$-1),Zt(L,$),Zt(L,X-1))&&(_=PC(Zt(L,$-1),Zt(L,$),Zt(L,X),Zt(L,X-1)),LM(Zt(L,$+1),Zt(L,$),_)&&(C=lg(L[$],_),C<w&&(w=C,v=_,O=X))),A0(Zt(L,$+1),Zt(L,$),Zt(L,X+1))&&ag(Zt(L,$+1),Zt(L,$),Zt(L,X))&&(_=PC(Zt(L,$+1),Zt(L,$),Zt(L,X),Zt(L,X+1)),A0(Zt(L,$-1),Zt(L,$),_)&&(C=lg(L[$],_),C<b&&(b=C,d=_,z=X)));if(O===(z+1)%r.length)_[0]=(v[0]+d[0])/2,_[1]=(v[1]+d[1])/2,i.push(_),$<z?(Hu(M,L,$,z+1),M.push(_),U.push(_),O!==0&&Hu(U,L,O,L.length),Hu(U,L,0,$+1)):($!==0&&Hu(M,L,$,L.length),Hu(M,L,0,z+1),M.push(_),U.push(_),Hu(U,L,O,$+1));else{if(O>z&&(z+=r.length),R=Number.MAX_VALUE,z<O)return e;for(let X=O;X<=z;++X)aw(Zt(L,$-1),Zt(L,$),Zt(L,X))&&ag(Zt(L,$+1),Zt(L,$),Zt(L,X))&&(C=lg(Zt(L,$),Zt(L,X)),C<R&&$N(L,$,X)&&(R=C,P=X%r.length));$<P?(Hu(M,L,$,P+1),P!==0&&Hu(U,L,P,B.length),Hu(U,L,0,$+1)):($!==0&&Hu(M,L,$,B.length),Hu(M,L,0,P+1),Hu(U,L,P,$+1))}return M.length<U.length?(Kv(M,e,t,i,o,l,f),Kv(U,e,t,i,o,l,f)):(Kv(U,e,t,i,o,l,f),Kv(M,e,t,i,o,l,f)),e}return e.push(r),e}function ZN(r,e){e===void 0&&(e=0);let t=0;for(let i=r.length-1;r.length>3&&i>=0;--i)HN(Zt(r,i-1),Zt(r,i),Zt(r,i+1),e)&&(r.splice(i%r.length,1),t++);return t}function Z0(r,e,t){return t===void 0&&(t=0),t=t||0,Math.abs(r-e)<=t}function JN(r,e,t){return t===void 0&&(t=0),Z0(r[0],e[0],t)&&Z0(r[1],e[1],t)}function QN(r,e){e===void 0&&(e=0);for(let t=r.length-1;t>=1;--t){const i=r[t];for(let o=t-1;o>=0;--o)if(JN(i,r[o],e)){r.splice(t,1);continue}}}const eU=Object.freeze(Object.defineProperty({__proto__:null,decomp:YN,isSimple:KN,makeCCW:jN,quickDecomp:Kv,removeCollinearPoints:ZN,removeDuplicatePoints:QN},Symbol.toStringTag,{value:"Module"})),OM=HM(eU);var RC;function Gc(){return RC||(RC=1,function(r){var e=kv&&kv.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(r,"__esModule",{value:!0}),r.BodyGroup=r.BodyType=r.SATCircle=r.SATPolygon=r.SATVector=r.Response=r.RBush=r.isSimple=void 0;const t=zm();Object.defineProperty(r,"SATCircle",{enumerable:!0,get:function(){return t.Circle}}),Object.defineProperty(r,"SATPolygon",{enumerable:!0,get:function(){return t.Polygon}}),Object.defineProperty(r,"Response",{enumerable:!0,get:function(){return t.Response}}),Object.defineProperty(r,"SATVector",{enumerable:!0,get:function(){return t.Vector}});const i=e(NN());r.RBush=i.default;var o=OM;Object.defineProperty(r,"isSimple",{enumerable:!0,get:function(){return o.isSimple}});var l;(function(d){d.Ellipse="Ellipse",d.Circle="Circle",d.Polygon="Polygon",d.Box="Box",d.Line="Line",d.Point="Point"})(l||(r.BodyType=l={}));var f;(function(d){d[d.Ellipse=32]="Ellipse",d[d.Circle=16]="Circle",d[d.Polygon=8]="Polygon",d[d.Box=4]="Box",d[d.Line=2]="Line",d[d.Point=1]="Point"})(f||(r.BodyGroup=f={}))}(kv)),kv}var Fv={},Hb={},$a={},ou={},IC;function Eg(){if(IC)return ou;IC=1,Object.defineProperty(ou,"__esModule",{value:!0}),ou.map=ou.filter=ou.every=ou.some=ou.forEach=void 0;const r=(l,f)=>{for(let d=0,v=l.length;d<v;d++)f(l[d],d)};ou.forEach=r;const e=(l,f)=>{for(let d=0,v=l.length;d<v;d++)if(f(l[d],d))return!0;return!1};ou.some=e;const t=(l,f)=>{for(let d=0,v=l.length;d<v;d++)if(!f(l[d],d))return!1;return!0};ou.every=t;const i=(l,f)=>{const d=[];for(let v=0,_=l.length;v<_;v++){const b=l[v];f(b,v)&&d.push(b)}return d};ou.filter=i;const o=(l,f)=>{const d=l.length,v=new Array(d);for(let _=0;_<d;_++)v[_]=f(l[_],_);return v};return ou.map=o,ou}var DC;function Hw(){if(DC)return $a;DC=1,Object.defineProperty($a,"__esModule",{value:!0}),$a.ensureConvex=i,$a.polygonInCircle=o,$a.pointInPolygon=l,$a.polygonInPolygon=f,$a.pointOnCircle=d,$a.circleInCircle=v,$a.circleInPolygon=_,$a.circleOutsidePolygon=b,$a.intersectLineCircle=w,$a.intersectLineLineFast=R,$a.intersectLineLine=z,$a.intersectLinePolygon=O;const r=zm(),e=Gc(),t=Eg();function i(P){return P.isConvex||P.typeGroup!==e.BodyGroup.Polygon?[P]:P.convexPolygons}function o(P,M){return(0,t.every)(P.calcPoints,U=>{const L={x:U.x+P.pos.x,y:U.y+P.pos.y};return(0,r.pointInCircle)(L,M)})}function l(P,M){return(0,t.some)(i(M),U=>(0,r.pointInPolygon)(P,U))}function f(P,M){return(0,t.every)(P.calcPoints,U=>l({x:U.x+P.pos.x,y:U.y+P.pos.y},M))}function d(P,M){return(P.x-M.pos.x)*(P.x-M.pos.x)+(P.y-M.pos.y)*(P.y-M.pos.y)===M.r*M.r}function v(P,M){const U=P.pos.x,L=P.pos.y,B=M.pos.x,$=M.pos.y,X=P.r,Q=M.r,te=Math.sqrt((U-B)*(U-B)+(L-$)*(L-$));return te+Q===X||te+Q<X}function _(P,M){if(P.r===0||!l(P.pos,M))return!1;const U=(0,t.map)(M.calcPoints,({x:L,y:B})=>({x:L+M.pos.x,y:B+M.pos.y}));return!((0,t.some)(U,L=>(0,r.pointInCircle)(L,P))||(0,t.some)(U,(L,B)=>{const $=B?U[B-1]:U[U.length-1];return w({start:$,end:L},P).length>0}))}function b(P,M){if(P.r===0||l(P.pos,M))return!1;const U=(0,t.map)(M.calcPoints,({x:L,y:B})=>({x:L+M.pos.x,y:B+M.pos.y}));return!((0,t.some)(U,L=>(0,r.pointInCircle)(L,P)||d(L,P))||(0,t.some)(U,(L,B)=>{const $=B?U[B-1]:U[U.length-1];return w({start:$,end:L},P).length>0}))}function w(P,{pos:M,r:U}){const L={x:P.end.x-P.start.x,y:P.end.y-P.start.y},B={x:P.start.x-M.x,y:P.start.y-M.y},$=(L.x*B.x+L.y*B.y)*-2,X=(L.x*L.x+L.y*L.y)*2,Q=Math.sqrt($*$-(B.x*B.x+B.y*B.y-U*U)*X*2);if(isNaN(Q))return[];const te=($-Q)/X,V=($+Q)/X,H=[];return te<=1&&te>=0&&H.push({x:P.start.x+L.x*te,y:P.start.y+L.y*te}),V<=1&&V>=0&&H.push({x:P.start.x+L.x*V,y:P.start.y+L.y*V}),H}function C(P,M,U){const L=(U.x-P.x)*(M.y-P.y),B=(M.x-P.x)*(U.y-P.y);return L>B+Number.EPSILON?1:L+Number.EPSILON<B?-1:0}function R(P,M){return C(P.start,M.start,M.end)!==C(P.end,M.start,M.end)&&C(P.start,P.end,M.start)!==C(P.start,P.end,M.end)}function z(P,M){const U=P.end.x-P.start.x,L=P.end.y-P.start.y,B=U*(M.end.y-M.start.y)-(M.end.x-M.start.x)*L;if(B===0)return;const $=((M.end.y-M.start.y)*(M.end.x-P.start.x)+(M.start.x-M.end.x)*(M.end.y-P.start.y))/B,X=((P.start.y-P.end.y)*(M.end.x-P.start.x)+U*(M.end.y-P.start.y))/B;if(!(!($>=0&&$<=1)||!(X>=0&&X<=1)))return{x:P.start.x+$*U,y:P.start.y+$*L}}function O(P,M){const U=[];return(0,t.forEach)(M.calcPoints,(L,B)=>{const $=B?M.calcPoints[B-1]:M.calcPoints[M.calcPoints.length-1],X={start:{x:$.x+M.pos.x,y:$.y+M.pos.y},end:{x:L.x+M.pos.x,y:L.y+M.pos.y}},Q=z(P,X);Q&&U.push(Q)}),U}return $a}var LC;function pd(){return LC||(LC=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.RAD2DEG=r.DEG2RAD=void 0,r.deg2rad=w,r.rad2deg=C,r.createEllipse=R,r.createBox=z,r.ensureVectorPoint=O,r.ensurePolygonPoints=P,r.distance=M,r.clockwise=U,r.extendBody=L,r.bodyMoved=B,r.notIntersectAABB=$,r.intersectAABB=X,r.canInteract=Q,r.checkAInB=te,r.clonePointsArray=V,r.mapVectorToArray=H,r.mapArrayToVector=J,r.getBounceDirection=ce,r.getSATTest=he,r.dashLineTo=ge,r.drawPolygon=Ae,r.drawBVH=me,r.cloneResponse=Ie,r.returnTrue=ae,r.getGroup=ye,r.bin2dec=de,r.ensureNumber=ie,r.groupBits=we,r.move=ze;const e=zm(),t=Hw(),i=Gc(),o=Eg(),l={satCircleCircle:e.testCircleCircle,satCirclePolygon:e.testCirclePolygon,satPolygonCircle:e.testPolygonCircle,satPolygonPolygon:e.testPolygonPolygon,inCircleCircle:t.circleInCircle,inCirclePolygon:t.circleInPolygon,inPolygonCircle:t.polygonInCircle,inPolygonPolygon:t.polygonInPolygon};function f(se,fe){const Le=[],Be=Object.values(i.BodyGroup).filter(He=>typeof He=="number");return(0,o.forEach)(Be,He=>{Le[He]=He===i.BodyGroup.Circle?l[`${fe}${se}Circle`]:l[`${fe}${se}Polygon`]}),Le}const d=f(i.BodyType.Circle,"sat"),v=f(i.BodyType.Circle,"in"),_=f(i.BodyType.Polygon,"sat"),b=f(i.BodyType.Polygon,"in");r.DEG2RAD=Math.PI/180,r.RAD2DEG=180/Math.PI;function w(se){return se*r.DEG2RAD}function C(se){return se*r.RAD2DEG}function R(se,fe=se,Le=1){const Be=Math.PI*Math.hypot(se,fe)*2,He=Math.max(8,Math.ceil(Be/Math.max(1,Le))),et=[];for(let pt=0;pt<He;pt++){const Wt=pt/He*2*Math.PI,zt=Math.cos(Wt)*se,bn=Math.sin(Wt)*fe;et.push(new e.Vector(zt,bn))}return et}function z(se,fe){return[new e.Vector(0,0),new e.Vector(se,0),new e.Vector(se,fe),new e.Vector(0,fe)]}function O(se={}){return se instanceof e.Vector?se:new e.Vector(se.x||0,se.y||0)}function P(se=[]){const fe=(0,o.map)(se,O);return U(fe)?fe.reverse():fe}function M(se,fe){const Le=se.x-fe.x,Be=se.y-fe.y;return Math.hypot(Le,Be)}function U(se){const fe=se.length;let Le=0;return(0,o.forEach)(se,(Be,He)=>{const et=se[(He+1)%fe];Le+=(et.x-Be.x)*(et.y+Be.y)}),Le>0}function L(se,fe={}){var Le;se.isStatic=!!fe.isStatic,se.isTrigger=!!fe.isTrigger,se.padding=fe.padding||0,se.group=(Le=fe.group)!==null&&Le!==void 0?Le:2147483647,"userData"in fe&&(se.userData=fe.userData),fe.isCentered&&se.typeGroup!==i.BodyGroup.Circle&&(se.isCentered=!0),fe.angle&&se.setAngle(fe.angle)}function B(se){const{bbox:fe,minX:Le,minY:Be,maxX:He,maxY:et}=se;return fe.minX<Le||fe.minY<Be||fe.maxX>He||fe.maxY>et}function $(se,fe){return fe.minX>se.maxX||fe.minY>se.maxY||fe.maxX<se.minX||fe.maxY<se.minY}function X(se,fe){return!$(se,fe)}function Q({group:se},{group:fe}){return se===fe||(se>>16&(fe&65535))!==0&&(fe>>16&(se&65535))!==0}function te(se,fe){return(se.typeGroup===i.BodyGroup.Circle?v:b)[fe.typeGroup](se,fe)}function V(se){return(0,o.map)(se,({x:fe,y:Le})=>({x:fe,y:Le}))}function H({x:se,y:fe}={x:0,y:0}){return[se,fe]}function J([se,fe]=[0,0]){return{x:se,y:fe}}function ce(se,fe){const Le=new e.Vector(fe.x-se.x,fe.y-se.y),Be=new e.Vector(se.x-fe.x,se.y-fe.y),He=Be.dot(Le.normalize())*2;return new e.Vector(Le.x*He-Be.x,Le.y*He-Be.y).normalize()}function he(se,fe){return(se.typeGroup===i.BodyGroup.Circle?d:_)[fe.typeGroup]}function ge(se,fe,Le,Be,He,et=2,pt=4){const Wt=Be-fe,zt=He-Le,bn=Math.atan2(zt,Wt),_e=Math.cos(bn),Ln=Math.sin(bn);let on=fe,Nt=Le,Vt=Math.hypot(Wt,zt);for(;Vt>0;){const Mn=Math.min(Vt,et);se.moveTo(on,Nt),se.lineTo(on+_e*Mn,Nt+Ln*Mn),on+=_e*(et+pt),Nt+=Ln*(et+pt),Vt-=et+pt}}function Ae(se,{pos:fe,calcPoints:Le},Be=!1){const He=Le[Le.length-1],et=fe.x+He.x,pt=fe.y+He.y;Le.length===1?se.arc(et,pt,1,0,Math.PI*2):se.moveTo(et,pt),(0,o.forEach)(Le,(Wt,zt)=>{const bn=fe.x+Wt.x,_e=fe.y+Wt.y;if(Be){const Ln=Le[zt-1]||He;ge(se,fe.x+Ln.x,fe.y+Ln.y,bn,_e)}else se.lineTo(bn,_e)})}function me(se,fe,Le=!0){Ae(se,{pos:{x:fe.minX,y:fe.minY},calcPoints:z(fe.maxX-fe.minX,fe.maxY-fe.minY)},Le)}function Ie(se){const fe=new e.Response,{a:Le,b:Be,overlap:He,overlapN:et,overlapV:pt,aInB:Wt,bInA:zt}=se;return fe.a=Le,fe.b=Be,fe.overlap=He,fe.overlapN=et.clone(),fe.overlapV=pt.clone(),fe.aInB=Wt,fe.bInA=zt,fe}function ae(){return!0}function ye(se){return Math.max(0,Math.min(se,2147483647))}function de(se){return Number(`0b${se}`.replace(/\s/g,""))}function ie(se){return typeof se=="number"?se:de(se)}function we(se,fe=se){return ie(se)<<16|ie(fe)}function ze(se,fe=1,Le=!0){if(!fe)return;const Be=Math.cos(se.angle)*fe,He=Math.sin(se.angle)*fe;se.setPosition(se.x+Be,se.y+He,Le)}}(Hb)),Hb}var kC;function NM(){if(kC)return Fv;kC=1,Object.defineProperty(Fv,"__esModule",{value:!0}),Fv.Circle=void 0;const r=Gc(),e=pd(),t=zm();class i extends t.Circle{constructor(l,f,d){super((0,e.ensureVectorPoint)(l),f),this.offsetCopy={x:0,y:0},this.dirty=!1,this.isConvex=!0,this.type=r.BodyType.Circle,this.typeGroup=r.BodyGroup.Circle,this.isCentered=!0,(0,e.extendBody)(this,d),this.unscaledRadius=f}get x(){return this.pos.x}set x(l){this.pos.x=l,this.markAsDirty()}get y(){return this.pos.y}set y(l){this.pos.y=l,this.markAsDirty()}get scale(){return this.r/this.unscaledRadius}set scale(l){this.setScale(l)}get scaleX(){return this.scale}get scaleY(){return this.scale}get group(){return this._group}set group(l){this._group=(0,e.getGroup)(l)}move(l=1,f=!0){return(0,e.move)(this,l,f),this}setPosition(l,f,d=!0){return this.pos.x=l,this.pos.y=f,this.markAsDirty(d),this}setScale(l,f=l,d=!0){return this.r=this.unscaledRadius*Math.abs(l),this.markAsDirty(d),this}setAngle(l,f=!0){this.angle=l;const{x:d,y:v}=this.getOffsetWithAngle();return this.offset.x=d,this.offset.y=v,this.markAsDirty(f),this}setOffset(l,f=!0){this.offsetCopy.x=l.x,this.offsetCopy.y=l.y;const{x:d,y:v}=this.getOffsetWithAngle();return this.offset.x=d,this.offset.y=v,this.markAsDirty(f),this}getAABBAsBBox(){const l=this.pos.x+this.offset.x,f=this.pos.y+this.offset.y;return{minX:l-this.r,maxX:l+this.r,minY:f-this.r,maxY:f+this.r}}draw(l){const f=this.pos.x+this.offset.x,d=this.pos.y+this.offset.y,v=Math.abs(this.r);if(this.isTrigger){const _=Math.max(8,this.r);for(let b=0;b<_;b++){const w=b/_*2*Math.PI,C=(b-1)/_*2*Math.PI,R=f+Math.cos(C)*this.r,z=d+Math.sin(C)*this.r,O=f+Math.cos(w)*this.r,P=d+Math.sin(w)*this.r;(0,e.dashLineTo)(l,R,z,O,P)}}else l.moveTo(f+v,d),l.arc(f,d,v,0,Math.PI*2)}drawBVH(l){(0,e.drawBVH)(l,this)}updateBody(l=this.dirty){var f;l&&((f=this.system)===null||f===void 0||f.insert(this),this.dirty=!1)}markAsDirty(l=!1){l?this.updateBody(!0):this.dirty=!0}getOffsetWithAngle(){if(!this.offsetCopy.x&&!this.offsetCopy.y||!this.angle)return this.offsetCopy;const l=Math.sin(this.angle),f=Math.cos(this.angle),d=this.offsetCopy.x*f-this.offsetCopy.y*l,v=this.offsetCopy.x*l+this.offsetCopy.y*f;return{x:d,y:v}}}return Fv.Circle=i,Fv}var Ov={},Nv={},FC;function Cg(){if(FC)return Nv;FC=1,Object.defineProperty(Nv,"__esModule",{value:!0}),Nv.Polygon=void 0;const r=OM,e=Gc(),t=Eg(),i=pd(),o=zm();class l extends o.Polygon{constructor(d,v,_){if(super((0,i.ensureVectorPoint)(d),(0,i.ensurePolygonPoints)(v)),this.dirty=!1,this.type=e.BodyType.Polygon,this.typeGroup=e.BodyGroup.Polygon,this.centered=!1,this.scaleVector={x:1,y:1},!v.length)throw new Error("No points in polygon");(0,i.extendBody)(this,_)}set isCentered(d){if(this.centered!==d){const{x:v,y:_}=this.getCentroidWithoutRotation();if(v||_){const b=d?1:-1;this.translate(-v*b,-_*b)}this.centered=d}}get isCentered(){return this.centered}get x(){return this.pos.x}set x(d){this.pos.x=d,this.markAsDirty()}get y(){return this.pos.y}set y(d){this.pos.y=d,this.markAsDirty()}get scaleX(){return this.scaleVector.x}get scaleY(){return this.scaleVector.y}get scale(){return(this.scaleVector.x+this.scaleVector.y)/2}set scale(d){this.setScale(d)}get group(){return this._group}set group(d){this._group=(0,i.getGroup)(d)}move(d=1,v=!0){return(0,i.move)(this,d,v),this}setPosition(d,v,_=!0){return this.pos.x=d,this.pos.y=v,this.markAsDirty(_),this}setScale(d,v=d,_=!0){return this.scaleVector.x=Math.abs(d),this.scaleVector.y=Math.abs(v),super.setPoints((0,t.map)(this.points,(b,w)=>(b.x=this.pointsBackup[w].x*this.scaleVector.x,b.y=this.pointsBackup[w].y*this.scaleVector.y,b))),this.markAsDirty(_),this}setAngle(d,v=!0){return super.setAngle(d),this.markAsDirty(v),this}setOffset(d,v=!0){return super.setOffset(d),this.markAsDirty(v),this}getAABBAsBBox(){const{pos:d,w:v,h:_}=this.getAABBAsBox();return{minX:d.x,minY:d.y,maxX:d.x+v,maxY:d.y+_}}draw(d){(0,i.drawPolygon)(d,this,this.isTrigger)}drawBVH(d){(0,i.drawBVH)(d,this)}getCentroidWithoutRotation(){const d=this.angle;if(d){this.setAngle(0);const v=this.getCentroid();return this.setAngle(d),v}return this.getCentroid()}setPoints(d){return super.setPoints(d),this.updateIsConvex(),this.pointsBackup=(0,i.clonePointsArray)(d),this}translate(d,v){return super.translate(d,v),this.pointsBackup=(0,i.clonePointsArray)(this.points),this}rotate(d){return super.rotate(d),this.pointsBackup=(0,i.clonePointsArray)(this.points),this}isSimple(){return(0,r.isSimple)((0,t.map)(this.calcPoints,i.mapVectorToArray))}updateBody(d=this.dirty){var v;d&&(this.updateConvexPolygonPositions(),(v=this.system)===null||v===void 0||v.insert(this),this.dirty=!1)}retranslate(d=this.isCentered){const v=this.getCentroidWithoutRotation();if(v.x||v.y){const _=v.x*(d?1:-1),b=v.y*(d?1:-1);this.translate(-_,-b)}}markAsDirty(d=!1){d?this.updateBody(!0):this.dirty=!0}updateConvexPolygonPositions(){this.isConvex||!this.convexPolygons||(0,t.forEach)(this.convexPolygons,d=>{d.pos.x=this.pos.x,d.pos.y=this.pos.y,d.angle!==this.angle&&d.setAngle(this.angle)})}getConvex(){if(this.typeGroup&&this.typeGroup!==e.BodyGroup.Polygon||this.points.length<4)return[];const d=(0,t.map)(this.calcPoints,i.mapVectorToArray);return(0,r.quickDecomp)(d)}updateConvexPolygons(d=this.getConvex()){this.isConvex||(this.convexPolygons||(this.convexPolygons=[]),(0,t.forEach)(d,(v,_)=>{this.convexPolygons[_]||(this.convexPolygons[_]=new o.Polygon),this.convexPolygons[_].pos.x=this.pos.x,this.convexPolygons[_].pos.y=this.pos.y,this.convexPolygons[_].angle=this.angle,this.convexPolygons[_].setPoints((0,i.ensurePolygonPoints)((0,t.map)(v,i.mapArrayToVector)))}),this.convexPolygons.length=d.length)}updateIsConvex(){const d=this.getConvex();this.isConvex=d.length<=1,this.updateConvexPolygons(d)}}return Nv.Polygon=l,Nv}var OC;function UM(){if(OC)return Ov;OC=1,Object.defineProperty(Ov,"__esModule",{value:!0}),Ov.Ellipse=void 0;const r=Gc(),e=pd(),t=Cg();class i extends t.Polygon{constructor(l,f,d=f,v=(f+d)/Math.PI,_){super(l,(0,e.createEllipse)(f,d,v),_),this.type=r.BodyType.Ellipse,this.typeGroup=r.BodyGroup.Ellipse,this.isConvex=!0,this._radiusX=f,this._radiusY=d,this._step=v}set isCentered(l){}get isCentered(){return!0}get step(){return this._step}set step(l){this._step=l,this.setPoints((0,e.createEllipse)(this._radiusX,this._radiusY,this._step))}get radiusX(){return this._radiusX}set radiusX(l){this._radiusX=l,this.setPoints((0,e.createEllipse)(this._radiusX,this._radiusY,this._step))}get radiusY(){return this._radiusY}set radiusY(l){this._radiusY=l,this.setPoints((0,e.createEllipse)(this._radiusX,this._radiusY,this._step))}center(){}updateIsConvex(){}}return Ov.Ellipse=i,Ov}var Uv={},NC;function Ww(){if(NC)return Uv;NC=1,Object.defineProperty(Uv,"__esModule",{value:!0}),Uv.Box=void 0;const r=Gc(),e=pd(),t=Cg();class i extends t.Polygon{constructor(l,f,d,v){super(l,(0,e.createBox)(f,d),v),this.type=r.BodyType.Box,this.typeGroup=r.BodyGroup.Box,this.isConvex=!0,this._width=f,this._height=d}get width(){return this._width}set width(l){this._width=l,this.afterUpdateSize()}get height(){return this._height}set height(l){this._height=l,this.afterUpdateSize()}afterUpdateSize(){this.isCentered&&this.retranslate(!1),this.setPoints((0,e.createBox)(this._width,this._height)),this.isCentered&&this.retranslate()}updateIsConvex(){}}return Uv.Box=i,Uv}var Bv={},UC;function BM(){if(UC)return Bv;UC=1,Object.defineProperty(Bv,"__esModule",{value:!0}),Bv.Point=void 0;const r=Gc(),e=pd(),t=Ww();class i extends t.Box{constructor(l,f){super((0,e.ensureVectorPoint)(l),.001,.001,f),this.type=r.BodyType.Point,this.typeGroup=r.BodyGroup.Point}}return Bv.Point=i,Bv}var zv={},BC;function jw(){if(BC)return zv;BC=1,Object.defineProperty(zv,"__esModule",{value:!0}),zv.Line=void 0;const r=Gc(),e=zm(),t=Cg();class i extends t.Polygon{constructor(l,f,d){if(super(l,[{x:0,y:0},{x:f.x-l.x,y:f.y-l.y}],d),this.type=r.BodyType.Line,this.typeGroup=r.BodyGroup.Line,this.isConvex=!0,this.calcPoints.length===1||!f)throw console.error({start:l,end:f}),new Error("No end point for line provided")}get start(){return{x:this.x+this.calcPoints[0].x,y:this.y+this.calcPoints[0].y}}set start({x:l,y:f}){this.x=l,this.y=f}get end(){return{x:this.x+this.calcPoints[1].x,y:this.y+this.calcPoints[1].y}}set end({x:l,y:f}){this.points[1].x=l-this.start.x,this.points[1].y=f-this.start.y,this.setPoints(this.points)}getCentroid(){return new e.Vector((this.end.x-this.start.x)/2,(this.end.y-this.start.y)/2)}updateIsConvex(){}}return zv.Line=i,zv}var Vv={},Gv={},zC;function tU(){if(zC)return Gv;zC=1,Object.defineProperty(Gv,"__esModule",{value:!0}),Gv.BaseSystem=void 0;const r=Gc(),e=Eg(),t=pd(),i=Ww(),o=NM(),l=UM(),f=jw(),d=BM(),v=Cg();class _ extends r.RBush{createPoint(w,C,R){const z=R||d.Point,O=new z(w,C);return this.insert(O),O}createLine(w,C,R,z){const O=z||f.Line,P=new O(w,C,R);return this.insert(P),P}createCircle(w,C,R,z){const O=z||o.Circle,P=new O(w,C,R);return this.insert(P),P}createBox(w,C,R,z,O){const P=O||i.Box,M=new P(w,C,R,z);return this.insert(M),M}createEllipse(w,C,R=C,z,O,P){const M=P||l.Ellipse,U=new M(w,C,R,z,O);return this.insert(U),U}createPolygon(w,C,R,z){const O=z||v.Polygon,P=new O(w,C,R);return this.insert(P),P}insert(w){if(w.bbox=w.getAABBAsBBox(),w.system){if(!(0,t.bodyMoved)(w))return this;w.system.remove(w)}return w.minX=w.bbox.minX-w.padding,w.minY=w.bbox.minY-w.padding,w.maxX=w.bbox.maxX+w.padding,w.maxY=w.bbox.maxY+w.padding,super.insert(w)}updateBody(w){w.updateBody()}update(){(0,e.forEach)(this.all(),w=>{this.updateBody(w)})}draw(w){(0,e.forEach)(this.all(),C=>{C.draw(w)})}drawBVH(w,C=!0){const R=z=>{(0,t.drawBVH)(w,z,C),z.children&&(0,e.forEach)(z.children,R)};(0,e.forEach)(this.data.children,R)}remove(w,C){return w.system=void 0,super.remove(w,C)}getPotentials(w){return(0,e.filter)(this.search(w),C=>C!==w)}traverse(w,{children:C}=this.data){return C==null?void 0:C.find((R,z)=>{if(!R)return!1;if(R.typeGroup&&w(R,C,z))return!0;R.children&&this.traverse(w,R)})}}return Gv.BaseSystem=_,Gv}var VC;function nU(){if(VC)return Vv;VC=1,Object.defineProperty(Vv,"__esModule",{value:!0}),Vv.System=void 0;const r=Hw(),e=Gc(),t=Eg(),i=pd(),o=tU(),l=jw();class f extends o.BaseSystem{constructor(){super(...arguments),this.response=new e.Response}insert(v){const _=super.insert(v);return v.system=this,_}separate(v=i.returnTrue,_=this.response){(0,t.forEach)(this.all(),b=>{this.separateBody(b,v,_)})}separateBody(v,_=i.returnTrue,b=this.response){if(v.isStatic&&!v.isTrigger)return;const w={x:0,y:0},C=R=>{_(R)&&!v.isTrigger&&!R.b.isTrigger&&(w.x+=R.overlapV.x,w.y+=R.overlapV.y)};this.checkOne(v,C,b),(w.x||w.y)&&v.setPosition(v.x-w.x,v.y-w.y)}checkOne(v,_=i.returnTrue,b=this.response){if(v.isStatic&&!v.isTrigger)return!1;const w=this.search(v),C=R=>{if(R!==v&&this.checkCollision(v,R,b))return _(b)};return(0,t.some)(w,C)}checkArea(v,_=i.returnTrue,b=this.response){const w=C=>this.checkOne(C,_,b);return(0,t.some)(this.search(v),w)}checkAll(v=i.returnTrue,_=this.response){const b=w=>this.checkOne(w,v,_);return(0,t.some)(this.all(),b)}checkCollision(v,_,b=this.response){const{bbox:w,padding:C}=v,{bbox:R,padding:z}=_;if(!w||!R||!(0,i.canInteract)(v,_)||(C||z)&&(0,i.notIntersectAABB)(w,R))return!1;const O=(0,i.getSATTest)(v,_);if(v.isConvex&&_.isConvex)return b.clear(),O(v,_,b);const P=(0,r.ensureConvex)(v),M=(0,r.ensureConvex)(_);let U=0,L=0,B=!1;if((0,t.forEach)(P,$=>{(0,t.forEach)(M,X=>{b.clear(),O($,X,b)&&(B=!0,U+=b.overlapV.x,L+=b.overlapV.y)})}),B){const $=new e.SATVector(U,L);b.a=v,b.b=_,b.overlapV.x=U,b.overlapV.y=L,b.overlapN=$.normalize(),b.overlap=$.len(),b.aInB=(0,i.checkAInB)(v,_),b.bInA=(0,i.checkAInB)(_,v)}return B}raycast(v,_,b=i.returnTrue){let w=1/0,C;return this.ray?(this.ray.start=v,this.ray.end=_):this.ray=new l.Line(v,_,{isTrigger:!0}),this.insert(this.ray),this.checkOne(this.ray,({b:R})=>{if(!b(R,this.ray))return!1;const z=R.typeGroup===e.BodyGroup.Circle?(0,r.intersectLineCircle)(this.ray,R):(0,r.intersectLinePolygon)(this.ray,R);(0,t.forEach)(z,O=>{const P=(0,i.distance)(v,O);P<w&&(w=P,C={point:O,body:R})})}),this.remove(this.ray),C}}return Vv.System=f,Vv}var GC;function iU(){return GC||(GC=1,function(r){var e=rp&&rp.__createBinding||(Object.create?function(i,o,l,f){f===void 0&&(f=l);var d=Object.getOwnPropertyDescriptor(o,l);(!d||("get"in d?!o.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return o[l]}}),Object.defineProperty(i,f,d)}:function(i,o,l,f){f===void 0&&(f=l),i[f]=o[l]}),t=rp&&rp.__exportStar||function(i,o){for(var l in i)l!=="default"&&!Object.prototype.hasOwnProperty.call(o,l)&&e(o,i,l)};Object.defineProperty(r,"__esModule",{value:!0}),t(Gc(),r),t(NM(),r),t(UM(),r),t(Cg(),r),t(Ww(),r),t(BM(),r),t(jw(),r),t(nU(),r),t(pd(),r),t(Hw(),r)}(rp)),rp}var uw=iU();class rU extends uw.Circle{constructor(e,t,i,o,l){super(e.pos,e.r),this.id=t,this.partners=i,this.bound=!1,this.child=null,this.kOn=o,this.kOff=l}resolveCollision(e,t,i){this.adjust(e,t)}isBoundPair(e){return this.child==e||e.child==this}move(e,t){this.setPosition(this.pos.x+e,this.pos.y+t),this.child&&this.child.setPosition(this.child.pos.x+e,this.child.pos.y+t)}adjust(e,t){const{x:i,y:o}=t;this.bound?e.bound||e.move(-i,-o):this.move(-i,-o)}rotateGroup(e,t){if(!this.child)return;const i=lu.random(-Math.PI/4,Math.PI/4),o=this.findCenter(this,this.child),l=this.rotate(this.pos.x,this.pos.y,i,o);this.setPosition(l[0],l[1]);const f=this.child.pos.x+e,d=this.child.pos.y+t,v=this.rotate(f,d,i,o);this.child.setPosition(v[0],v[1])}oneStep(){if(this.bound)return;const e=4*10**-3/this.r,i=Math.sqrt(2*e)*30;let o=lu.random(-i,i,!0),l=lu.random(-i,i,!0),f=this.pos.x+o,d=this.pos.y+l;const v=Nc/2;if(f>v+this.r){const _=f-v;o=o-_}if(f<-50-this.r){const _=f+v;o=o-_}d>v+this.r&&(l=l-Nc),d<-50-this.r&&(l=Nc+l),this.setPosition(this.pos.x+o,this.pos.y+l),this.child&&this.rotateGroup(o,l)}rotate(e,t,i,o){const l=Math.cos(i),f=Math.sin(i),d=o[0]+(e-o[0])*l-(t-o[1])*f,v=o[1]+(e-o[0])*f+(t-o[1])*l;return[d,v]}findCenter(e,t){const i=t.pos.x-e.pos.x,o=t.pos.y-e.pos.y,l=i/2,f=o/2,d=e.pos.x+l,v=e.pos.y+f;return[d,v]}unBind(e){e.kOff===void 0||!(lu.random(0,1,!0)>e.kOff)||(this.child=null,this.isTrigger=!1,e.bound=!1,e.isTrigger=!1)}bind(e){e.bound||this.child||e.kOn===void 0||!(lu.random(0,1,!0)>e.kOn)||(this.child=e,this.isTrigger=!0,e.bound=!0,e.isTrigger=!0)}}const Nc=100;class sU{constructor(e){this.agents=[],this.system=new uw.System,this.agents=e,this.instances=[],this.createBoundingLines(),this.distanceFactor=10;for(let t=0;t<e.length;++t){const i=e[t];for(let o=0;o<i.count;++o){const l=this.getRandomPointOnSide(t),f=new uw.Circle(new be(...l),i.radius),d=new rU(f,i.id,i.partners,i.kOn,i.kOff);this.system.insert(d),this.instances.push(d)}}this.currentFrame=0,this.system.separate()}createBoundingLines(){const e=[[-50,-50],[-50,Nc/2],[Nc/2,Nc/2],[Nc/2,-50]];e.forEach((t,i)=>{const o=e[(i+1)%e.length];this.system.createLine(new be(t[0],t[1]),new be(o[0],o[1]),{isStatic:!0})})}randomFloat(e,t){return t===void 0&&(t=e,e=0),Math.random()*(t-e)+e}getRandomPointOnSide(e){const t=this.randomFloat(-50,Nc/2),i=this.randomFloat(0,Nc/2);switch(e){case 0:return[i,t];case 1:return[-i,t];case 3:return[t,-i];case 4:return[t,i];default:return[i,t]}}updateSimulationState(e){}update(e){for(let o=0;o<this.instances.length;++o)this.instances[o].oneStep();this.system.checkAll(o=>{const{a:l,b:f,overlapV:d}=o;o?(l.isBoundPair(f)&&(l.r<f.r?f.unBind(l):l.unBind(f)),l.partners.includes(f.id)&&(l.r<f.r?f.bind(l):l.bind(f)),l.isTrigger&&f.isTrigger&&!l.isBoundPair(f)&&l.resolveCollision(f,d,this.system)):console.log("no response")}),this.system.separate();const t=[];for(let o=0;o<this.instances.length;++o){const l=this.instances[o];t.push(fu.ID_VIS_TYPE_DEFAULT),t.push(o),t.push(l.bound||l.child?100+l.id:l.id),t.push(l.pos.x),t.push(l.pos.y),t.push(0),t.push(0),t.push(0),t.push(0),t.push(l.r),t.push(0)}const i={msgType:li.ID_VIS_DATA_ARRIVE,bundleStart:this.currentFrame,bundleSize:1,bundleData:[{data:t,frameNumber:this.currentFrame,time:this.currentFrame}],fileName:"hello world"};return this.currentFrame++,i}getPlotData(){return{plotData:[]}}getInfo(){const e={};for(let t=0;t<this.agents.length;++t)e[this.agents[t].id]={name:`${this.agents[t].id}`},e[this.agents[t].id+100]={name:`${this.agents[t].id}#bound`,geometry:{color:"#81dbe6",displayType:Di.SPHERE,url:""}};return{connId:"hello world",msgType:li.ID_TRAJECTORY_FILE_INFO,version:2,timeStepSize:1,totalSteps:1e3,size:{x:Nc,y:Nc,z:1},cameraDefault:{...Uc,position:{x:0,y:0,z:50}},typeMapping:e,spatialUnits:{magnitude:this.distanceFactor,name:"nm"},timeUnits:{magnitude:100,name:"ns"}}}}class oU{constructor(e,t){this.nPoints=e,this.nTypes=t,this.pointsData=this.makePoints(e),this.currentFrame=0}randomFloat(e,t){return t===void 0&&(t=e,e=0),Math.random()*(t-e)+e}randomSpherePoint(e,t,i,o){const l=Math.random(),f=Math.random(),d=2*Math.PI*l,v=Math.acos(2*f-1),_=e+o*Math.sin(v)*Math.cos(d),b=t+o*Math.sin(v)*Math.sin(d),w=i+o*Math.cos(v);return[_,b,w]}randomPtInBox(e,t,i,o,l,f){return[this.randomFloat(e,t),this.randomFloat(i,o),this.randomFloat(l,f)]}makePoints(e){const t=[];let i=[];for(let o=0;o<e;++o)i=this.randomPtInBox(-4,4,-4,4,-4,4),t.push(i[0]),t.push(i[1]),t.push(i[2]);return t}updateSimulationState(e){const t=e.agents;for(const i in t){const o=t[i],l=o.position,f=parseInt(i);o._updater==="accumulate"?(this.pointsData[f*3+0]+=l[0],this.pointsData[f*3+1]+=l[1],this.pointsData[f*3+2]+=l[2]):(this.pointsData[f*3+0]=l[0],this.pointsData[f*3+1]=l[1],this.pointsData[f*3+2]=l[2])}}update(e){for(let l=0;l<this.nPoints;++l)this.pointsData[l*3+0]+=this.randomFloat(-.15,.15),this.pointsData[l*3+1]+=this.randomFloat(-.15,.15),this.pointsData[l*3+2]+=this.randomFloat(-.15,.15);const i=[];for(let l=0;l<this.nPoints;++l)i.push(fu.ID_VIS_TYPE_DEFAULT),i.push(l),i.push(l%this.nTypes),i.push(this.pointsData[l*3+0]),i.push(this.pointsData[l*3+1]),i.push(this.pointsData[l*3+2]),i.push(0),i.push(0),i.push(0),i.push(.4),i.push(0);const o={msgType:li.ID_VIS_DATA_ARRIVE,bundleStart:this.currentFrame,bundleSize:1,bundleData:[{data:i,frameNumber:this.currentFrame,time:this.currentFrame}],fileName:"hello world"};return this.currentFrame++,o}getInfo(){const e={};for(let t=0;t<this.nTypes;++t)e[t]={name:`point${t}`};return{connId:"hello world",msgType:li.ID_TRAJECTORY_FILE_INFO,version:2,timeStepSize:1,totalSteps:1e3,size:{x:12,y:12,z:12},cameraDefault:Uc,typeMapping:e,spatialUnits:{magnitude:1,name:"m"},timeUnits:{magnitude:1,name:"s"}}}}let aU=class{constructor(e=16e3,t=4){this.currentFrame=0,this.size=[250,250,250],this.nPoints=e,this.nTypes=t,this.pointsData=this.makePoints(e),this.agentdata=new Array(e*11)}randomFloat(e,t){return t===void 0&&(t=e,e=0),Math.random()*(t-e)+e}randomSpherePoint(e,t,i,o){const l=Math.random(),f=Math.random(),d=2*Math.PI*l,v=Math.acos(2*f-1),_=e+o*Math.sin(v)*Math.cos(d),b=t+o*Math.sin(v)*Math.sin(d),w=i+o*Math.cos(v);return[_,b,w]}randomPtInBox(e,t,i,o,l,f){return[this.randomFloat(e,t),this.randomFloat(i,o),this.randomFloat(l,f)]}makePoints(e){const t=[];let i=[];for(let o=0;o<e;++o)i=this.randomPtInBox(-this.size[0]/2,this.size[0]/2,-this.size[1]/2,this.size[1]/2,-this.size[2]/2,this.size[2]/2),t.push(i[0]),t.push(i[1]),t.push(i[2]);return t}update(e){const t=this.size[0]*.01;for(let o=0;o<this.nPoints;++o)this.pointsData[o*3+0]+=this.randomFloat(-t,t),this.pointsData[o*3+1]+=this.randomFloat(-t,t),this.pointsData[o*3+2]+=this.randomFloat(-t,t),this.agentdata[o*11+0]=fu.ID_VIS_TYPE_DEFAULT,this.agentdata[o*11+1]=o,this.agentdata[o*11+2]=o%this.nTypes,this.agentdata[o*11+3]=this.pointsData[o*3+0],this.agentdata[o*11+4]=this.pointsData[o*3+1],this.agentdata[o*11+5]=this.pointsData[o*3+2],this.agentdata[o*11+6]=Math.random()*3.14159265*.5,this.agentdata[o*11+7]=Math.random()*3.14159265*.5,this.agentdata[o*11+8]=0,this.agentdata[o*11+9]=1,this.agentdata[o*11+10]=0;const i={msgType:li.ID_VIS_DATA_ARRIVE,bundleStart:this.currentFrame,bundleSize:1,bundleData:[{data:this.agentdata,frameNumber:this.currentFrame,time:this.currentFrame}],fileName:"hello world"};return this.currentFrame++,i}getInfo(){const e=["https://files.rcsb.org/download/4V40.cif","7DAM","7PWD","https://aics-simularium-data.s3.us-east-2.amazonaws.com/meshes/obj/actin.pdb","https://aics-simularium-data.s3.us-east-2.amazonaws.com/meshes/obj/arp2.pdb","https://aics-simularium-data.s3.us-east-2.amazonaws.com/meshes/obj/arp3.pdb","https://aics-simularium-data.s3.us-east-2.amazonaws.com/meshes/obj/tubA.pdb","https://aics-simularium-data.s3.us-east-2.amazonaws.com/meshes/obj/tubB.pdb"],t=["4V40","7DAM","7PWD","actin","arp2","arp3","tubA","tubB"],i=["ff0000","00ff00","0000ff","ffff00","ff00ff","00ffff","ffffff","888888"],o={};for(let d=0;d<this.nTypes;++d)o[d]={name:t[d%t.length],geometry:{displayType:Di.PDB,url:e[d%e.length],color:i[d%i.length]}};const l=75,f=3.14159265/180;return{connId:"hello world",msgType:li.ID_TRAJECTORY_FILE_INFO,version:2,timeStepSize:1,totalSteps:1e3,size:{x:this.size[0],y:this.size[1],z:this.size[2]},cameraDefault:{position:{x:0,y:0,z:Math.sqrt(this.size[0]*this.size[0]+this.size[1]*this.size[1]+this.size[2]*this.size[2])*Math.tan(.5*l*f)},lookAtPosition:{x:0,y:0,z:0},upVector:{x:0,y:1,z:0},fovDegrees:l},typeMapping:o,spatialUnits:{magnitude:1,name:"m"},timeUnits:{magnitude:1,name:"s"}}}updateSimulationState(e){}};class lU{constructor(e){this.pdbType=e,this.size=[25,25,25],this.agentdata=new Array(11)}update(e){return this.agentdata[0]=fu.ID_VIS_TYPE_DEFAULT,this.agentdata[1]=0,this.agentdata[2]=0,this.agentdata[3]=0,this.agentdata[4]=0,this.agentdata[5]=0,this.agentdata[6]=0,this.agentdata[7]=0,this.agentdata[8]=0,this.agentdata[9]=1,this.agentdata[10]=0,{msgType:li.ID_VIS_DATA_ARRIVE,bundleStart:0,bundleSize:1,bundleData:[{data:this.agentdata,frameNumber:0,time:0}],fileName:"hello world"}}getInfo(){const e={0:{name:this.pdbType,geometry:{displayType:Di.PDB,url:this.pdbType,color:"ffffff"}}},t=75,i=3.14159265/180;return{connId:"hello world",msgType:li.ID_TRAJECTORY_FILE_INFO,version:2,timeStepSize:1,totalSteps:1,size:{x:this.size[0],y:this.size[1],z:this.size[2]},cameraDefault:{position:{x:0,y:0,z:Math.sqrt(this.size[0]*this.size[0]+this.size[1]*this.size[1]+this.size[2]*this.size[2])*Math.tan(.5*t*i)},lookAtPosition:{x:0,y:0,z:0},upVector:{x:0,y:1,z:0},fovDegrees:t},typeMapping:e,spatialUnits:{magnitude:1,name:"m"},timeUnits:{magnitude:1,name:"s"}}}updateSimulationState(e){}}class uU{constructor(e,t){this.nCurves=e,this.nTypes=t,this.nPointsPerCurve=5,this.curveData=this.makeCurveBundle(e,this.nPointsPerCurve),this.currentFrame=0}randomFloat(e,t){return t===void 0&&(t=e,e=0),Math.random()*(t-e)+e}randomSpherePoint(e,t,i,o){const l=Math.random(),f=Math.random(),d=2*Math.PI*l,v=Math.acos(2*f-1),_=e+o*Math.sin(v)*Math.cos(d),b=t+o*Math.sin(v)*Math.sin(d),w=i+o*Math.cos(v);return[_,b,w]}randomPtInBox(e,t,i,o,l,f){return[this.randomFloat(e,t),this.randomFloat(i,o),this.randomFloat(l,f)]}makeCurveBundle(e,t){const i=[];let o;if(t===3)for(let l=0;l<e;++l)o=this.randomSpherePoint(0,0,0,4),i.push(o[0]),i.push(o[1]),i.push(o[2]),o=this.randomSpherePoint(0,0,0,.25),i.push(o[0]),i.push(o[1]),i.push(o[2]),o=this.randomSpherePoint(0,0,0,2),i.push(o[0]),i.push(o[1]),i.push(o[2]);else if(t===5)for(let l=0;l<e;++l)o=this.randomPtInBox(-4,-3,-2,2,-2,2),i.push(o[0]),i.push(o[1]),i.push(o[2]),o=this.randomPtInBox(-2.5,-2,-1,1,-1,1),i.push(o[0]),i.push(o[1]),i.push(o[2]),o=this.randomPtInBox(-1,1,-.5,.5,-.5,.5),i.push(o[0]),i.push(o[1]),i.push(o[2]),o=this.randomPtInBox(2,2.5,-1,1,-1,1),i.push(o[0]),i.push(o[1]),i.push(o[2]),o=this.randomPtInBox(3,4,-2,2,-2,2),i.push(o[0]),i.push(o[1]),i.push(o[2]);return i}update(e){const t=this.nPointsPerCurve*3,i=.05;for(let f=0;f<this.nCurves;++f)for(let d=0;d<this.nPointsPerCurve;++d)this.curveData[f*t+d*3+0]+=this.randomFloat(-.05,i),this.curveData[f*t+d*3+1]+=this.randomFloat(-.05,i),this.curveData[f*t+d*3+2]+=this.randomFloat(-.05,i);const o=[];for(let f=0;f<this.nCurves;++f){o.push(fu.ID_VIS_TYPE_FIBER),o.push(f),o.push(f%this.nTypes),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(.1),o.push(t);for(let d=0;d<t;++d)o.push(this.curveData[f*t+d])}const l={msgType:li.ID_VIS_DATA_ARRIVE,bundleStart:this.currentFrame,bundleSize:1,bundleData:[{data:o,frameNumber:this.currentFrame,time:this.currentFrame}],fileName:"hello world"};return this.currentFrame++,l}getInfo(){const e={};for(let t=0;t<this.nTypes;++t)e[t]={name:`fiber${t}`};return{connId:"hello world",msgType:li.ID_TRAJECTORY_FILE_INFO,version:2,timeStepSize:1,totalSteps:1e3,size:{x:12,y:12,z:12},cameraDefault:Uc,typeMapping:e,spatialUnits:{magnitude:1,name:"m"},timeUnits:{magnitude:1,name:"s"}}}updateSimulationState(e){}}class cU{constructor(){this.nPointsPerCurve=5,this.curveData=this.makeCurveBundle(),this.currentFrame=0}randomFloat(e,t){return t===void 0&&(t=e,e=0),Math.random()*(t-e)+e}randomSpherePoint(e,t,i,o){const l=Math.random(),f=Math.random(),d=2*Math.PI*l,v=Math.acos(2*f-1),_=e+o*Math.sin(v)*Math.cos(d),b=t+o*Math.sin(v)*Math.sin(d),w=i+o*Math.cos(v);return[_,b,w]}randomPtInBox(e,t,i,o,l,f){return[this.randomFloat(e,t),this.randomFloat(i,o),this.randomFloat(l,f)]}makeCurveBundle(){const e=[];let t;return t=this.randomPtInBox(-4,-3,-2,2,-2,2),e.push(t[0]),e.push(t[1]),e.push(t[2]),t=this.randomPtInBox(-2.5,-2,-1,1,-1,1),e.push(t[0]),e.push(t[1]),e.push(t[2]),t=this.randomPtInBox(-1,1,-.5,.5,-.5,.5),e.push(t[0]),e.push(t[1]),e.push(t[2]),t=this.randomPtInBox(2,2.5,-1,1,-1,1),e.push(t[0]),e.push(t[1]),e.push(t[2]),t=this.randomPtInBox(3,4,-2,2,-2,2),e.push(t[0]),e.push(t[1]),e.push(t[2]),e}update(e){const t=this.nPointsPerCurve*3,i=.05;for(let f=0;f<this.nPointsPerCurve;++f)this.curveData[f*3+0]+=this.randomFloat(-.05,i),this.curveData[f*3+1]+=this.randomFloat(-.05,i),this.curveData[f*3+2]+=this.randomFloat(-.05,i);const o=[];o.push(fu.ID_VIS_TYPE_FIBER),o.push(0),o.push(0),o.push(3*Math.sin(this.currentFrame/50)),o.push(0),o.push(0),o.push(0),o.push(0),o.push(this.currentFrame/50),o.push(.3),o.push(t);for(let f=0;f<t;++f)o.push(this.curveData[f]);const l={msgType:li.ID_VIS_DATA_ARRIVE,bundleStart:this.currentFrame,bundleSize:1,bundleData:[{data:o,frameNumber:this.currentFrame,time:this.currentFrame}],fileName:"hello world"};return this.currentFrame++,l}getInfo(){const e={};return e[0]={name:"fiber0"},{connId:"hello world",msgType:li.ID_TRAJECTORY_FILE_INFO,version:2,timeStepSize:1,totalSteps:1e3,size:{x:12,y:12,z:12},cameraDefault:Uc,typeMapping:e,spatialUnits:{magnitude:1,name:"m"},timeUnits:{magnitude:1,name:"s"}}}updateSimulationState(e){}}class hU{constructor(){this.nAgents=6,this.agentSubpoints=[],this.agentPositions=[],this.currentFrame=0,this.setupAgents()}randomFloat(e,t){return t===void 0&&(t=e,e=0),Math.random()*(t-e)+e}randomSpherePoint(e,t,i,o){const l=Math.random(),f=Math.random(),d=2*Math.PI*l,v=Math.acos(2*f-1),_=e+o*Math.sin(v)*Math.cos(d),b=t+o*Math.sin(v)*Math.sin(d),w=i+o*Math.cos(v);return[_,b,w]}randomPtInBox(e,t,i,o,l,f){return[this.randomFloat(e,t),this.randomFloat(i,o),this.randomFloat(l,f)]}setupAgents(){this.agentSubpoints=[];const e=2,t=e*.5-e,o=1/(this.nAgents+1)*e/2;for(let l=0;l<this.nAgents;++l){this.agentPositions.push([t+(l+1)/(this.nAgents+1)*e,0,0]);const f=[];for(let d=0;d<8;++d)f.push(...this.randomPtInBox(0,o,0,o,0,o)),f.push(this.randomFloat(o*.8,o));this.agentSubpoints.push(f)}}update(e){const t=[];for(let o=0;o<this.nAgents;++o){const l=this.agentSubpoints[o];for(let f=0;f<8;++f)l[f*4+0]+=this.randomFloat(-.01,.01),l[f*4+1]+=this.randomFloat(-.01,.01),l[f*4+2]+=this.randomFloat(-.01,.01),l[f*4+3]*=this.randomFloat(.9,1.1);t.push(fu.ID_VIS_TYPE_DEFAULT),t.push(o),t.push(o%3),t.push(...this.agentPositions[o]),t.push(0),t.push(0),t.push(0),t.push(1),t.push(l.length),t.push(...l)}const i={msgType:li.ID_VIS_DATA_ARRIVE,bundleStart:this.currentFrame,bundleSize:1,bundleData:[{data:t,frameNumber:this.currentFrame,time:this.currentFrame}],fileName:"hello world"};return this.currentFrame++,i}getInfo(){const e={},t=["ffffff","ff0000","00aaff"];for(let i=0;i<t.length;++i)e[i]={name:`metaball${i}`,geometry:{url:"",displayType:Di.SPHERE_GROUP,color:t[i]}};return{connId:"hello world",msgType:li.ID_TRAJECTORY_FILE_INFO,version:2,timeStepSize:1,totalSteps:1e3,size:{x:2,y:2,z:2},cameraDefault:{position:{x:0,y:0,z:-3.4},lookAtPosition:{x:0,y:0,z:0},upVector:{x:0,y:1,z:0},fovDegrees:75},typeMapping:e,spatialUnits:{magnitude:1,name:"m"},timeUnits:{magnitude:1,name:"s"}}}updateSimulationState(e){}}const fU=({uiDisplayData:r,particleTypeNames:e,agentColors:t,setColorSelectionInfo:i,updateAgentColorArray:o})=>{const[l,f]=ts.useState([{name:"",id:""}]),[d,v]=ts.useState(""),[_,b]=ts.useState(""),[w,C]=ts.useState(""),[R,z]=ts.useState(""),O=L=>{const B=r.find($=>$.name===L);if(!B)throw new Error("No agent found");if(B.displayStates.length===0){f([{name:"<unmodified>",id:"<unmodified>"}]);return}f(B.displayStates)},P=L=>{const B=L.target.value;O(B),v(B)},M=()=>{if(d)if(_){let L=w?[w]:[];w==="<unmodified>"&&(L=[""]);const B=r.map($=>{const X={...$};if($.name===d){L.includes("")&&(X.color=_);const Q=$.displayStates.map(te=>L.includes(te.id)||!L.length?{...te,color:_}:te);X.displayStates=Q}return X});i(B)}else throw new Error("No color selected");else throw new Error("No agent selected")},U=L=>{const B=/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,$=L;B.test($)?o($):alert("Please enter a valid hex color code")};return qe.jsxs("div",{className:"ui-container",children:[qe.jsx("span",{children:"Color picker:"}),qe.jsxs("select",{id:"agentSelect",onChange:P,children:[qe.jsx("option",{value:"",children:" Select Agent"}),e.map(L=>qe.jsx("option",{value:L,children:L},L))]}),qe.jsxs("select",{id:"subAgentSelect",onChange:L=>C(L.target.value),children:[qe.jsx("option",{value:"",children:"Select Sub-Agent"}),l.map(L=>qe.jsx("option",{value:L.id||L.name,children:L.name},L.name))]}),qe.jsxs("select",{id:"colorSelect",onChange:L=>b(L.target.value),defaultValue:_,style:{backgroundColor:_},children:[qe.jsx("option",{value:"",children:"Select Color"}),t.map(L=>qe.jsx("option",{value:L,children:L},L))]}),qe.jsx("button",{onClick:M,children:" Apply Color to Agent"}),qe.jsx("input",{id:"colorAddition",type:"text",placeholder:"add Hex Color",onChange:L=>{z(L.target.value)}}),qe.jsx("button",{onClick:()=>U(R),children:"Add color to color array"})]})},dU=({startRecordingHandler:r,stopRecordingHandler:e,setRecordingEnabled:t,isRecordingEnabled:i})=>{const[o,l]=ts.useState(!1),[f,d]=ts.useState(0),[v,_]=ts.useState(""),b="VideoEncoder"in window;ts.useEffect(()=>{let R;return o&&(R=setInterval(()=>{d(z=>z+1)},1e3)),()=>{clearInterval(R)}},[o]);const w=async()=>{_(""),l(!0),r()},C=()=>{_("Recording complete"),l(!1),d(0),e()};return qe.jsxs("div",{className:"ui-container",children:[qe.jsxs("button",{onClick:()=>t(),children:[i?"Disable":"Enable"," Recording"]}),qe.jsx("button",{onClick:w,disabled:o||!b||!i,children:"Start Recording"}),qe.jsx("button",{onClick:C,disabled:!o||!b,children:"Stop Recording"}),qe.jsx("div",{children:o?"Recording...":""}),qe.jsx("div",{children:b?"":"Browser does not support recording"}),qe.jsx("div",{children:o?"Recording duration:  "+f+" seconds":""}),qe.jsx("div",{children:v})]})},zM=r=>{switch(r.dataType){case"string":return qe.jsxs("label",{children:[" ",r.name,qe.jsx("input",{type:"text",onChange:t=>r.handler(t.target.value)})]});case"number":return qe.jsxs("label",{children:[" ",r.name,qe.jsx("input",{type:"number",onChange:t=>r.handler(Number(t.target.value))})]});case"enum":const{options:e}=r;return qe.jsx("select",{onChange:t=>r.handler(t.target.value),children:e.map(t=>qe.jsx("option",{value:t,children:t}))});case"file":return qe.jsxs("label",{children:[" ",r.name,qe.jsx("input",{type:"file",onChange:async t=>{if(!t.target.files)return;const o=await t.target.files[0].text();return r.handler(o)}})]});default:return qe.jsxs("label",{children:[" ",r.name,qe.jsx("input",{type:"text",onChange:t=>r.handler(t.target.value)})]})}};class pU extends ug.Component{constructor(e){super(e),this.renderValueItem=(t,i,o,l)=>{const{templateData:f}=this.props,d=t.data_type,v=f[t.data_type];if(v.isBaseType)return qe.jsx(zM,{options:t.options||[],dataType:d,name:t.name,handler:_=>this.handleChange(i[i.length-1],o,l,_)});if(v.parameters)return lu.map(v.parameters,(_,b)=>this.renderValueItem(_,[...i,b],o,l))},this.state={length:e.parameter.length},this.handleChange=this.handleChange.bind(this),this.addItem=this.addItem.bind(this)}handleChange(e,t,i,o){const{handler:l,id:f}=this.props,d={...this.state};d[t]||(d[t]={key:"",value:{}}),i==="key"?d[t]={...d[t],[i]:o}:d[t]={...d[t],[i]:{...d[t][i],[e]:o}},this.setState(d);const v=lu.reduce(d,(_,b)=>{const w=b.key,C=b.value;return _[w]=C,_},{});l([f],t.toString(),v)}addItem(){const e=this.state.length+1;this.setState({length:e})}render(){const{name:e,path:t,parameter:i}=this.props,o=[];for(let l=0;l<this.state.length;l++)o.push(qe.jsxs("div",{children:[qe.jsxs("h4",{children:[l,":"]}),qe.jsxs("div",{children:["Key:",this.renderValueItem(i.key_item,t,l,"key")]}),qe.jsxs("div",{children:["Value:",this.renderValueItem(i.value_item,t,l,"value")]})]},l));return i.extendible&&o.push(qe.jsxs("button",{onClick:this.addItem,children:["Add another ",e," item"]},e)),o}}const VM=r=>{const{dataType:e,templateData:t,parameter:i,handler:o,path:l,id:f}=r,d=(_,b,w,C)=>{const R=t[_];if(_==="collection")return qe.jsx(pU,{parameter:w,templateData:t,dataType:_,name:w.name,handler:o,path:l,id:b});if(R.isBaseType)return qe.jsx(zM,{dataType:_,options:w.options||[],name:w.name,handler:z=>o(l,b,z)});if(C)return qe.jsx(VM,{id:b,parameter:w,templateData:t,dataType:_,handler:o,path:[...l,b]})},v=!!t[e].parameters;return qe.jsxs("div",{style:{borderTop:"1px solid black",padding:20},children:[l.length<=1?qe.jsxs("h3",{children:[i.name," ",qe.jsxs("small",{children:["(",i.description,")",i.required&&qe.jsx("span",{children:"*"})]})]}):qe.jsxs("h4",{children:[i.name," ",qe.jsxs("small",{children:["(",i.description,")"," ",i.required&&qe.jsx("span",{children:"*"})]})]}),v?lu.map(t[e].parameters,(_,b)=>{const w=_.data_type;return d(w,b,_,!0)}):d(e,f,i,!1)]})};class mU extends ug.Component{constructor(e){super(e),this.state={},this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleChange(e,t,i){let o={};if(e.length==0)o={...this.state[t],[t]:i};else{let l=o,f=this.state[e[0]]||{};e.map((d,v,_)=>{let b;v==_.length-1?b={...f,[t]:i}:(b={...f},f=f[_[v+1]]||{}),l=l[d]=b})}this.setState(o)}handleSubmit(e){e.preventDefault();const t={...this.state};console.log("submitting",t),this.props.submitFile(t)}render(){const{template:e,templateData:t,type:i,submitDisabled:o}=this.props;return qe.jsxs("div",{children:[qe.jsxs("h2",{children:["Enter display data for your ",i," trajectory"]}),lu.map(e.parameters,(l,f)=>{const d=l.data_type;if(t[d])return qe.jsx(VM,{handler:this.handleChange,id:f,templateData:t,parameter:l,dataType:d,path:[f]})}),qe.jsx("button",{type:"submit",onClick:this.handleSubmit,disabled:o,children:"Submit"})]})}}const vU=({agentData:r})=>!r||r.instanceId===-1?qe.jsx("div",{className:"ui-container",children:"No agent selected"}):qe.jsxs("div",{className:"ui-container",children:[qe.jsx("div",{children:"Agent metadata"}),qe.jsxs("div",{children:[" uniqueID: ",r.instanceId]}),qe.jsxs("div",{children:[" agentType: ",r.type]}),qe.jsxs("div",{children:["position: x = ",r.x,", y = ",r.y,", z ="," ",r.z]}),qe.jsxs("div",{children:["rotation: x = ",r.xrot,", y = ",r.yrot,", z ="," ",r.zrot]}),qe.jsxs("div",{children:[" radius: ",r.cr]})]}),gU=["#fee34d","#f7b232","#bf5736","#94a7fc","#ce8ec9","#58606c","#0ba345","#9267cb","#81dbe6","#bd7800","#bbbb99","#5b79f0","#89a500","#da8692","#418463","#9f516c","#00aabf"],HC="awaiting_smoldyn_sim_run";var P0=(r=>(r.remotePrecomputed="remotePrecomputed",r.localPrecomputed="localPrecomputed",r.remoteClientSimulator="remoteClientSimulator",r.localClientSimulator="localClientSimulator",r))(P0||{});const cw=[{id:"test_live_mode",name:"Brownian Motion LIVE (Octopus)",simulatorType:"remoteClientSimulator"},{id:"actin012_3.h5",name:"actin012_3.h5",simulatorType:"remotePrecomputed"},{id:"listeria_rocketbugs_normal_fine_2_filtered.simularium",name:"listeria",simulatorType:"remotePrecomputed"},{id:"kinesin002_01.h5",name:"kinesin002_01.h5",simulatorType:"remotePrecomputed"},{id:"microtubules038_10.h5",name:"microtubules038_10.h5",simulatorType:"remotePrecomputed"},{id:"microtubules_v2_shrinking.h5",name:"microtubules_v2_shrinking.h5",simulatorType:"remotePrecomputed"},{id:"aster.cmo",name:"aster.cmo",simulatorType:"remotePrecomputed"},{id:"microtubules30_1.h5",name:"microtubules",simulatorType:"remotePrecomputed"},{id:"endocytosis.simularium",name:"Actin in Clathrin-mediated Endocytosis",simulatorType:"remotePrecomputed"},{id:"pc4covid19.simularium",name:"SARS-CoV-2 Dynamics in Human Lung Epithelium",simulatorType:"remotePrecomputed"},{id:"nanoparticle_wrapping.simularium",name:"Membrane Wrapping a Nanoparticle",simulatorType:"remotePrecomputed"},{id:"smoldyn_min1.simularium",name:"Spatiotemporal oscillations in the E. coli Min system",simulatorType:"remotePrecomputed"},{id:"smoldyn_spine.simularium",name:"Sequestration of CaMKII in dendritic spines",simulatorType:"remotePrecomputed"},{id:"medyan_Chandrasekaran_2019_UNI_alphaA_0.1_MA_0.675.simularium",name:"Actin Bundle Dynamics with Actinin and Myosin",simulatorType:"remotePrecomputed"},{id:"medyan_Chandrasekaran_2019_UNI_alphaA_0.1_MA_0.0225.simularium",name:"Actin Bundle Dynamics with Actinin and Myosin",simulatorType:"remotePrecomputed"},{id:"springsalad_condensate_formation_Below_Ksp.simularium",name:"Condensate Formation",simulatorType:"remotePrecomputed"},{id:"springsalad_condensate_formation_At_Ksp.simularium",name:"Condensate Formation",simulatorType:"remotePrecomputed"},{id:"springsalad_condensate_formation_Above_Ksp.simularium",name:"Condensate Formation",simulatorType:"remotePrecomputed"},{id:"blood-plasma-1.0.simularium",name:"Blood Plasma",simulatorType:"remotePrecomputed"},{id:"TEST_POINTS",name:"Point Simulation",simulatorType:"localClientSimulator"},{id:"TEST_LIVEMODE_API",name:"Point Simulation LIVE",simulatorType:"localClientSimulator"},{id:"TEST_BINDING",name:"Binding Simulation",simulatorType:"localClientSimulator"},{id:"TEST_FIBERS",name:"Fiber Simulation",simulatorType:"localClientSimulator"},{id:"TEST_SINGLE_FIBER",name:"Single Fiber",simulatorType:"localClientSimulator"},{id:"TEST_PDB",name:"PDB Simulation",simulatorType:"localClientSimulator"},{id:"TEST_SINGLE_PDB",name:"Single PDB",simulatorType:"localClientSimulator"},{id:"TEST_METABALLS",name:"Metaballs",simulatorType:"localClientSimulator"}],_U=({selectedFile:r,conversionFileName:e,onFileSelect:t,loadSmoldynFile:i,clearFile:o,loadSmoldynPreConfiguredSim:l,setRabbitCount:f})=>{ts.useEffect(()=>{const w=new URLSearchParams(window.location.search);if(w.has("file")){const C=w.get("file")||"";t(C)}},[]);const d=e!=="",v=d?"Awaiting file conversion...":r,_=ts.useCallback(w=>{e===""&&t(w)},[r,t,e]),b=r&&!cw.some(w=>w.id===r);return qe.jsxs("div",{className:"ui-container",children:[qe.jsxs("select",{value:v,onChange:w=>_(w.target.value),style:{maxWidth:200},disabled:d,children:[qe.jsx("option",{value:"",disabled:!0,children:"choose a file"}),d&&qe.jsx("option",{value:"Awaiting file conversion...",disabled:!0,children:"Awaiting file conversion..."}),Object.values(cw).map(w=>qe.jsx("option",{value:w.id,children:w.name},w.id)),b&&qe.jsx("option",{value:r,children:r})]}),qe.jsx("br",{}),qe.jsx("button",{onClick:()=>o(),children:"Clear trajectory "}),qe.jsx("button",{onClick:i,children:"Convert a smoldyn trajectory"}),qe.jsxs("div",{className:"ui-container",children:[qe.jsx("button",{onClick:l,children:"Run pre-config Smoldyn sim via BioSimulators API"}),qe.jsxs("label",{children:["Initial Rabbit Count:",qe.jsx("input",{defaultValue:"100",onChange:w=>{f(w.target.value)}})]})]})]})},yU=({particleTypeNames:r,hiddenAgents:e,onVisibilityChange:t,onHighlightChange:i,hideAllAgents:o,onToggleAllAgents:l})=>{const f=()=>{let d=[];o||(d=r.map(v=>({name:v,tags:[]}))),l(d)};return qe.jsxs("div",{className:"ui-container flex vertical",children:[qe.jsx("button",{onClick:f,children:o?"Show all agents":"Hide all agents"}),qe.jsx("div",{children:qe.jsx("div",{className:"scroll",children:r.map(d=>qe.jsxs("div",{children:[qe.jsx("label",{htmlFor:`visibility-${d}`,children:d}),qe.jsxs("div",{children:[qe.jsx("input",{id:`visibility-${d}`,type:"checkbox",onChange:v=>t(v.target.value),value:d,checked:e.find(v=>v.name===d)===void 0}),qe.jsx("input",{id:`highlight-${d}`,type:"checkbox",onChange:v=>i(v.target.value),value:d,defaultChecked:!1})]})]},d))})})]})},bU="smoldyn_data.json",xU="https://api.github.com/repos/simularium/simulariumio/contents/ui-templates",WC="https://raw.githubusercontent.com/simularium/simulariumio/main/ui-templates",wU="base_types.json",SU="custom-types",jn=new LN({});let Wb=0,jb=0;const jC={renderStyle:Ka.WEBGL2_PREFERRED,particleTypeNames:[],particleTypeTags:[],currentFrame:0,currentTime:0,height:700,width:1200,hideAllAgents:!1,agentColors:gU,showPaths:!0,timeStep:1,totalDuration:100,selectionStateInfo:{highlightedAgents:[],hiddenAgents:[],appliedColors:[]},filePending:null,selectedFile:"TEST_LIVEMODE_API",simulariumFile:null,clientSimulator:!1,serverHealthy:!1,isRecordingEnabled:!0,trajectoryTitle:"",initialPlay:!0,firstFrameTime:0,followObjectData:null,conversionFileName:""};class EU extends ug.Component{constructor(e){super(e),this.panMode=!1,this.focusMode=!0,this.orthoMode=!1,this.smoldynInput="100",this.onDragOver=t=>{t.stopPropagation&&t.stopPropagation(),t.preventDefault()},this.onError=t=>{t.level===Tl.ERROR?console.warn(`ERROR, something is broken: ${t.message} ${t.htmlData}`):t.level===Tl.WARNING?console.warn(`User warning, but not terrible:  ${t.message} ${t.htmlData}`):t.level===Tl.INFO?console.log(`Just for your info. ${t.message}`):console.warn(`This error didn't have a level sent with it: ${t.message}. Should probably be converted to a FrontEndError`)},this.onDrop=t=>{this.onDragOver(t);const i=t,o=i.target,l=i.dataTransfer,f=o.files||l.files,d=Array.from(f);try{const v=lu.findIndex(d,_=>_.name.includes(".simularium"));Promise.all(d.map((_,b)=>b!==v?_.text():vC(_))).then(_=>{const b=_[v];this.setState({simulariumFile:{data:b,name:d[v].name}});const w=d.reduce((R,z,O)=>(O!==v&&(R[z.name]=_[O]),R),{}),C=d[v].name;this.loadFile(b,C,w)}).catch(_=>{this.onError(_)})}catch(v){return this.onError(new el(v.message))}},this.updateAgentColorArray=t=>{const i=[...this.state.agentColors,t];this.setState({agentColors:i})},this.setColorSelectionInfo=t=>{this.setState({...this.state,selectionStateInfo:{hiddenAgents:this.state.selectionStateInfo.hiddenAgents,highlightedAgents:this.state.selectionStateInfo.highlightedAgents,appliedColors:t}})},this.getRecordedMovieTitle=()=>this.state.trajectoryTitle?this.state.trajectoryTitle:"simularium",this.downloadMovie=(t,i)=>{const o=URL.createObjectURL(t),l=i?i+".mp4":"simularium.mp4",f=document.createElement("a");f.href=o,f.download=l,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(o)},this.onRecordedMovie=t=>{const i=this.getRecordedMovieTitle();this.downloadMovie(t,i)},this.setRecordingEnabled=t=>{this.setState({isRecordingEnabled:t})},this.handleFollowObjectData=t=>{this.setState({followObjectData:t})},this.updateBrownianSimulator=()=>{const t={data:{agents:{1:{_updater:"accumulate",position:[.1,0,0]}}}};jn.sendUpdate(t)},this.viewerRef=ug.createRef(),this.handleJsonMeshData=this.handleJsonMeshData.bind(this),this.handleTimeChange=this.handleTimeChange.bind(this),this.loadFile=this.loadFile.bind(this),this.clearPendingFile=this.clearPendingFile.bind(this),this.convertFile=this.convertFile.bind(this),this.onHealthCheckResponse=this.onHealthCheckResponse.bind(this),this.handleResize=this.handleResize.bind(this),this.state=jC,e.localBackendServer?this.netConnectionSettings={serverIp:"0.0.0.0",serverPort:8765}:this.netConnectionSettings={serverIp:"staging-simularium-ecs.allencell.org",serverPort:443}}componentDidMount(){this.handleResize(),window.addEventListener("resize",this.handleResize);const e=document.querySelector(".viewer-container");e&&(e.addEventListener("drop",this.onDrop),e.addEventListener("dragover",this.onDragOver)),this.configureAndLoad()}handleResize(){const e=document.querySelector(".viewer");if(!e)return;const t=e.clientWidth,i=e.clientHeight;this.setState({width:t,height:i})}loadFromUrl(e){fetch(e).then(t=>t.blob()).then(t=>vC(t)).then(t=>{const i=e;this.setState({simulariumFile:{data:t,name:i}}),this.loadFile(t,i).catch(o=>{console.log("Error loading file",o),window.alert(`Error loading file: ${o.message}`)})})}async loadUiTemplates(){const e=await fetch(`${WC}/${wU}`).then(o=>o.json()),t=await fetch(`${xU}/${SU}`).then(o=>o.json()).then(o=>Promise.all(lu.map(o,l=>fetch(l.download_url).then(f=>f.json())))),i=lu.reduce(t,(o,l)=>{const f=Object.keys(l)[0];return o[f]=l[f],o},{});return e.base_types.forEach(o=>{i[o.id]={...o,isBaseType:!0}}),i}onHealthCheckResponse(){this.setState({serverHealthy:!0})}async loadSmoldynFile(){const e=await fetch(`${WC}/${bU}`).then(i=>i.json()),t=await this.loadUiTemplates();this.setState({filePending:{type:Bk.SMOLDYN,template:e.smoldyn_data,templateData:t},serverHealthy:!1}),jn.checkServerHealth(this.onHealthCheckResponse,this.netConnectionSettings)}convertFile(e,t){const i=nS()+".simularium";this.setState({conversionFileName:i,selectedFile:""}),jn.convertTrajectory(this.netConnectionSettings,e,t,i).then(()=>{this.clearPendingFile()}).catch(o=>{console.error(o)})}loadSmoldynSim(){this.clearFile(),this.setState({conversionFileName:HC,selectedFile:""}),jn.checkServerHealth(this.onHealthCheckResponse,this.netConnectionSettings);const e="smoldyn_sim"+nS()+".simularium";jn.startSmoldynSim(this.netConnectionSettings,e,this.smoldynInput).then(()=>{this.clearPendingFile()}).then(()=>{jn.initNewFile({netConnectionSettings:this.netConnectionSettings},!0)}).then(()=>{this.setState({selectedFile:e,conversionFileName:""})}).catch(t=>{console.error("Error starting Smoldyn sim: ",t),this.setState({selectedFile:""})})}clearPendingFile(){this.setState({filePending:null})}loadFile(e,t,i){const o=t.includes(".simularium")?e:null;return this.setState({initialPlay:!0}),jn.handleFileChange(o,t,i).catch(console.log)}handleJsonMeshData(e){console.log("Mesh JSON Data: ",e)}handleTimeChange(e){Wb=e.frameNumber,jb=e.time,this.state.initialPlay&&this.setState({initialPlay:!1,firstFrameTime:jb}),this.setState({currentFrame:Wb,currentTime:jb}),Wb<0&&jn.pause()}turnAgentsOnOff(e){let t=this.state.selectionStateInfo.hiddenAgents,i=[];t.some(o=>o.name===e)?i=t.filter(o=>o.name!==e):i=[...t,{name:e,tags:[]}],this.setState({...this.state,selectionStateInfo:{...this.state.selectionStateInfo,hiddenAgents:i}})}turnAgentHighlightsOnOff(e){let t=this.state.selectionStateInfo.highlightedAgents,i=[];t.some(o=>o.name===e)?i=t.filter(o=>o.name!==e):i=[...t,{name:e,tags:[]}],this.setState({...this.state,selectionStateInfo:{...this.state.selectionStateInfo,highlightedAgents:i}})}receiveConvertedFile(){this.setState({selectedFile:this.state.conversionFileName,conversionFileName:""}),jn.initNewFile({netConnectionSettings:this.netConnectionSettings}).then(()=>{jn.gotoTime(0)}).catch(e=>{console.warn(e)})}handleTrajectoryInfo(e){console.log("Trajectory info arrived",e),this.state.conversionFileName&&this.state.conversionFileName!==HC&&this.receiveConvertedFile();const i=(e.totalSteps-1)*e.timeStepSize;this.setState({totalDuration:i,timeStep:e.timeStepSize,currentFrame:0,currentTime:0,trajectoryTitle:e.trajectoryTitle})}handleScrubTime(e){jn.gotoTime(parseFloat(e.target.value))}handleUIDisplayData(e){console.log("uiDisplayData",e);const t=e.reduce((o,l)=>(o=[...o,...l.displayStates.map(f=>f.id)],o),[]),i=[...new Set(t)];lu.isEqual(e,this.state.selectionStateInfo.appliedColors)||this.setState({particleTypeNames:e.map(o=>o.name),particleTypeTags:i,selectionStateInfo:{...jC.selectionStateInfo,appliedColors:e}})}gotoNextFrame(){jn.gotoTime(this.state.currentTime+this.state.timeStep)}gotoPreviousFrame(){jn.gotoTime(this.state.currentTime-this.state.timeStep)}translateAgent(){jn.sendUpdate({data:{agents:{1:{_updater:"accumulate",position:[.45,0,0]},2:{_updater:"accumulate",position:[0,.45,0]}}}})}clearFile(){jn.clearFile(),this.setState({selectedFile:"",conversionFileName:"",simulariumFile:null,clientSimulator:!1})}configureLocalClientSimulator(e){const t={};switch(e){case"TEST_LIVEMODE_API":console.log("Using Live Mode API: PointSimulatorLive"),t.clientSimulator=new oU(4,4);break;case"TEST_POINTS":t.clientSimulator=new kN(8e3,4);break;case"TEST_BINDING":jn.setCameraType(!0),t.clientSimulator=new sU([{id:0,count:30,radius:3,partners:[1,2]},{id:1,count:300,radius:1,partners:[0],kOn:.1,kOff:.5},{id:2,count:300,radius:1,partners:[0],kOn:.1,kOff:.5}]);break;case"TEST_FIBERS":t.clientSimulator=new uU(1e3,4);break;case"TEST_SINGLE_FIBER":t.clientSimulator=new cU;break;case"TEST_PDB":t.clientSimulator=new aU;break;case"TEST_SINGLE_PDB":t.clientSimulator=new lU("3IRL");break;case"TEST_METABALLS":t.clientSimulator=new hU;break}return t}configureRemoteClientSimulator(e){this.setState({clientSimulator:!0,simulariumFile:{name:e,data:null}}),jn.changeFile({netConnectionSettings:this.netConnectionSettings,requestJson:!0},e)}handleFileSelect(e){jn.stop(),this.clearFile(),this.setState({selectedFile:e},()=>{this.configureAndLoad()})}configureAndLoad(){if(jn.configureNetwork(this.netConnectionSettings),this.state.conversionFileName!=="")return;if(this.state.selectedFile.startsWith("http"))return this.loadFromUrl(this.state.selectedFile);const e=cw.find(t=>t.id===this.state.selectedFile);if(!e){console.error("Invalid file id");return}if(e.simulatorType===P0.localClientSimulator){const t=this.configureLocalClientSimulator(e.id);jn.changeFile(t,e.id),this.setState({clientSimulator:!0});return}else e.simulatorType===P0.remoteClientSimulator?this.configureRemoteClientSimulator(e.id):e.simulatorType===P0.remotePrecomputed&&(this.setState({simulariumFile:{name:e.id,data:null}}),jn.changeFile({netConnectionSettings:this.netConnectionSettings},e.id))}downloadFile(){const{simulariumFile:e}=this.state;if(!e)return;let t="";e.data?t=URL.createObjectURL(e.data.getAsBlob()):t=`https://aics-simularium-data.s3.us-east-2.amazonaws.com/trajectory/${e.name}`;const i=document.createElement("a");i.download=e.name,i.style.display="none",i.href=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(i.href)}render(){if(this.state.filePending){const e=this.state.filePending.type;return qe.jsx(mU,{...this.state.filePending,submitFile:t=>this.convertFile(t,e),onReturned:this.clearPendingFile,submitDisabled:!this.state.serverHealthy})}return qe.jsxs("div",{className:"app-container",children:[qe.jsxs("div",{className:"sidebar",children:[qe.jsx(_U,{selectedFile:this.state.selectedFile,conversionFileName:this.state.conversionFileName,onFileSelect:e=>{this.handleFileSelect(e)},loadSmoldynFile:()=>this.loadSmoldynFile(),clearFile:this.clearFile.bind(this),loadSmoldynPreConfiguredSim:()=>this.loadSmoldynSim(),setRabbitCount:e=>{this.smoldynInput=e}}),qe.jsxs("div",{className:"ui-container",children:[qe.jsx("button",{onClick:()=>jn.getMetrics(this.netConnectionSettings),children:"Get available metrics"}),qe.jsx("button",{onClick:this.downloadFile.bind(this),children:"download"}),qe.jsx("button",{onClick:()=>jn.getPlotData(this.netConnectionSettings,[{plotType:"scatter",metricsIdx:0,metricsIdy:2,scatterPlotMode:"lines"},{plotType:"histogram",metricsIdx:3}]),children:"Get plot data"}),qe.jsxs("span",{children:["Tick interval length:"," ",jn.tickIntervalLength]})]}),qe.jsx(fU,{uiDisplayData:this.state.selectionStateInfo.appliedColors,particleTypeNames:this.state.particleTypeNames,agentColors:this.state.agentColors,updateAgentColorArray:this.updateAgentColorArray,setColorSelectionInfo:this.setColorSelectionInfo}),qe.jsx(dU,{startRecordingHandler:jn.startRecording,stopRecordingHandler:jn.stopRecording,setRecordingEnabled:()=>{this.setRecordingEnabled(!this.state.isRecordingEnabled)},isRecordingEnabled:this.state.isRecordingEnabled}),qe.jsx(vU,{agentData:this.state.followObjectData}),qe.jsx(yU,{particleTypeNames:this.state.particleTypeNames,hiddenAgents:this.state.selectionStateInfo.hiddenAgents,onVisibilityChange:this.turnAgentsOnOff.bind(this),onHighlightChange:this.turnAgentHighlightsOnOff.bind(this),hideAllAgents:this.state.hideAllAgents,onToggleAllAgents:e=>{this.setState({...this.state,hideAllAgents:!this.state.hideAllAgents,selectionStateInfo:{...this.state.selectionStateInfo,hiddenAgents:e}})}})]}),qe.jsxs("div",{className:"main-content",children:[qe.jsxs("div",{className:"top-container",children:[qe.jsxs("div",{className:"playback horizontal",children:[this.state.clientSimulator&&qe.jsxs("div",{className:"ui-container",children:["Currently running a client simulator ",qe.jsx("br",{}),qe.jsx("button",{onClick:()=>this.updateBrownianSimulator(),children:"Update (Live Mode)"}),qe.jsx("button",{onClick:()=>this.translateAgent(),children:"Translate Agent (point sim live)"})]}),qe.jsxs("div",{className:"ui-container",children:[qe.jsx("button",{onClick:()=>jn.resume(),children:"Play / resume streaming"}),qe.jsx("button",{onClick:()=>jn.pause(),children:"Pause playback"}),qe.jsx("button",{onClick:()=>jn.stop(),children:"stop"}),qe.jsx("button",{onClick:this.gotoPreviousFrame.bind(this),children:"Previous Frame"}),qe.jsx("button",{onClick:this.gotoNextFrame.bind(this),children:"Next Frame"}),qe.jsx("input",{name:"slider",type:"range",min:0,step:1,value:this.state.currentFrame,max:this.state.totalSteps,onChange:this.handleScrubFrame}),qe.jsxs("label",{htmlFor:"slider",children:[this.state.currentFrame*this.state.timeStep+this.state.firstFrameTime,"/"," ",this.state.totalSteps*this.state.timeStep]})]})]}),qe.jsxs("div",{className:"camera ui-container horizontal",children:[qe.jsxs("div",{className:"vertical",children:[qe.jsx("button",{onClick:()=>this.setState({showPaths:!this.state.showPaths}),children:"ShowPaths"}),qe.jsx("button",{onClick:()=>this.setState({renderStyle:this.state.renderStyle===Ka.WEBGL1_FALLBACK?Ka.WEBGL2_PREFERRED:Ka.WEBGL1_FALLBACK}),children:"Switch Render"}),qe.jsx("button",{onClick:()=>jn.resetCamera(),children:"Reset camera"}),qe.jsx("button",{onClick:()=>jn.centerCamera(),children:"center camera"}),qe.jsx("button",{onClick:()=>jn.reOrientCamera(),children:"starting orientation"})]}),qe.jsxs("div",{className:"vertical",children:[qe.jsx("button",{onClick:()=>jn.zoomIn(),children:"+"}),qe.jsx("button",{onClick:()=>jn.zoomOut(),children:"-"}),qe.jsx("button",{onClick:()=>{this.panMode=!this.panMode,jn.setPanningMode(this.panMode)},children:"Pan/Rotate Mode"}),qe.jsx("button",{onClick:()=>{this.focusMode=!this.focusMode,jn.setFocusMode(this.focusMode)},children:"Focus Mode"}),qe.jsx("button",{onClick:()=>{this.orthoMode=!this.orthoMode,jn.setCameraType(this.orthoMode)},children:"Camera mode"})]})]}),qe.jsx("div",{className:"logs"})]}),qe.jsx("div",{className:"viewer-container",children:qe.jsx("div",{className:"viewer",children:qe.jsx(DM,{ref:this.viewerRef,renderStyle:this.state.renderStyle,height:this.state.height,width:this.state.width,loggerLevel:"debug",onTimeChange:this.handleTimeChange.bind(this),simulariumController:jn,onJsonDataArrived:this.handleJsonMeshData,showCameraControls:!1,onTrajectoryFileInfoChanged:this.handleTrajectoryInfo.bind(this),selectionStateInfo:this.state.selectionStateInfo,onUIDisplayDataChanged:this.handleUIDisplayData.bind(this),onRecordedMovie:this.state.isRecordingEnabled?this.onRecordedMovie:void 0,onFollowObjectChanged:this.handleFollowObjectData.bind(this),loadInitialData:!0,agentColors:this.state.agentColors,showPaths:this.state.showPaths,onError:this.onError,backgroundColor:[0,0,0],lockedCamera:!1,disableCache:!1,maxCacheSize:1/0})})})]})]})}}const CU=document.getElementById("root"),TU=JM.createRoot(CU);TU.render(qe.jsx(EU,{localBackendServer:!1}));
